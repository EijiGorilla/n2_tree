"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[55865,63733,88877,95327],{4955:(e,t,n)=>{function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,n=0;for(let i=0;i<e.length;i++){const a=e[i].size;"number"==typeof a&&(t+=a,n++)}return t/n}(e.stops):t}function r(e,t){if(!t)return e;const n=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:n,minSize:i}=t;return(a(n,e)+a(i,e))/2}));let i=0;const r=n.length;if(0===r)return e;for(let a=0;a<r;a++)i+=n[a];const o=Math.floor(i/r);return Math.max(o,e)}function o(e){const t=e?.renderer,n=e?.pointerType,a="touch"===n?9:6;if(!t)return a;const o="visualVariables"in t?r(a,t.visualVariables):a;if("simple"===t.type)return i(o,t.symbol);if("unique-value"===t.type){let e=o;return t.uniqueValueInfos?.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=o;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return"dot-density"===t.type||t.type,o}n.d(t,{o:()=>o})},7141:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var i=n(35143),a=n(39356),r=n(50076),o=n(54901),s=(n(81806),n(76460)),l=n(30726),c=n(50346),u=n(68134),d=n(49723),p=n(46053),h=(n(47249),n(85842)),f=n(5600),y=n(87663),g=n(17983),m=n(81130);const w={"buffer-line-to-polygon":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(47413),n.e(34432)]).then(n.bind(n,12051)),"buffer-point-to-polygon":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(47413),n.e(77492)]).then(n.bind(n,77492)),"buffer-polygon-to-polygon":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(47413),n.e(38900)]).then(n.bind(n,38900)),"connection-point":()=>n.e(47615).then(n.bind(n,47615)),"equally-spaced":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(50416)]).then(n.bind(n,50416)),"offset-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(78836)]).then(n.bind(n,78836)),"offset-primary-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(32968)]).then(n.bind(n,32968)),"point-at-all-vertices-of-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(94687)]).then(n.bind(n,94687)),"point-at-beginning-of-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(55012)]).then(n.bind(n,55012)),"point-at-beginning-of-radial":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(17057)]).then(n.bind(n,17057)),"point-at-end-of-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(1158)]).then(n.bind(n,1158)),"point-at-interior-vertices":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(253)]).then(n.bind(n,253)),"point-at-intersection-vertices-of-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(16563)]).then(n.bind(n,16563)),"point-at-not-beginning-of-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(86017)]).then(n.bind(n,8398)),"point-at-not-end-of-line":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(70968),n.e(65587)]).then(n.bind(n,65587)),"point-at-polygon-centroid":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(23942)]).then(n.bind(n,23942)),"point-at-polygon-not-start":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(6389)]).then(n.bind(n,6389)),"point-at-polygon-start":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(98844)]).then(n.bind(n,98844)),"point-identity":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(1729)]).then(n.bind(n,1729)),"point-primary-identity":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(54767)]).then(n.bind(n,54767)),"polygon-boundary":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(30429)]).then(n.bind(n,30429)),"polygon-boundary-two-point":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(23673)]).then(n.bind(n,46054)),"polygon-identity":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(39377)]).then(n.bind(n,39377)),"polygon-primary-identity":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(50335)]).then(n.bind(n,50335)),"polygon-vertices":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(75336)]).then(n.bind(n,75336)),"radial-lines":()=>n.e(49503).then(n.bind(n,49503)),"two-point-lines":()=>Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(52847),n.e(68350)]).then(n.bind(n,68350))};var b=n(19902),v=n(28009),_=n(12899);const M=()=>s.A.getLogger("esri.editing.sharedTemplates.executor.createTemplateExecutor"),I="globalid";async function F(e){if(!(0,f.xZ)(e))throw new r.default("template-executor:template-not-loaded","The template must be loaded before it can be executed.");if((0,f.Cq)(e))return function(e){return t=>{const n=[],i=[];(0,g.i)({geometry:t,template:e,edits:n,relationships:i});const a=(0,m.zE)(n);return{edits:(0,m.Vi)(n),relationships:i,primary:n[0]??null,featureExtent:a,rotationPoint:a?.center??null}}}(e);if((0,f.Dt)(e))return async function(e){const{definition:t}=e,n=await Promise.all(t.allParts.map(S));return(i,a)=>{const r=[],o=[],s=new Set,l=()=>{if(t.createUtilityNetworkAssociations&&"completion"===a){const{utilityNetwork:e,utilityNetworkAssociationsTable:n}=t;e&&n?function(e){const{edits:t,utilityNetworkHelper:n}=e,i=new Map;for(const a of t)""!==a.tag&&n.layerIdToSourceIdLookup.has(a.id)&&(0,y.tE)(i,a.tag,(()=>[])).push(a);for(const a of i.values())if(!(a.length<2))for(let t=0;t<a.length;t++){const n=a[t];for(let i=t+1;i<a.length;i++)T(n,a[i],e)}}({associationGraphics:s,associationsTable:n,edits:r,relationships:o,utilityNetworkHelper:e}):M().warn("Unable to create utility network associations between group template features. The utility network or its associations table is unavailable.")}const e=(0,m.zE)(r);return{associationGraphics:s,edits:(0,m.Vi)(r),relationships:o,primary:r[0]??null,featureExtent:e,rotationPoint:e?.center??null}};if(null==i)return M().warn("No geometry provided to group template executor. Result will be empty."),l();const u=n.map((t=>t({edits:r,mode:a,parentTemplate:e,relationships:o,shape:i}))).filter(c.isPromiseLike);return 0===u.length?l():Promise.all(u).then((()=>l()))}}(e);if((0,f.JC)(e))return async function(e){const{createPresetServiceEdit:t}=await Promise.all([n.e(26871),n.e(91523),n.e(16364),n.e(82103),n.e(48045),n.e(75274)]).then(n.bind(n,75274));return function(n,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(0,b.isPoint)(n))throw new r.default("template-executor:invalid-input-geometry","The input goemetry for a preset template must be a point.");const o=[],s=[],l=t({geometry:n,template:e,edits:o,relationships:s,rotation:a,mode:i});return{edits:(0,m.Vi)(o),relationships:s,primary:o[0]??null,featureExtent:(0,m.zE)(o),rotationPoint:l}}}(e);throw new r.default("template-executor:unsupported-template-type","The template type is not supported.")}async function S(e){const t=await function(e){const t=w[e];if(!t)throw new Error(`Builder type ${e} is not supported.`);return t()}(e.builderType);return n=>t.execute({...n,templatePart:e})}function T(e,t,n){const{associationGraphics:i,associationsTable:r,edits:o,utilityNetworkHelper:s,relationships:l}=n,c=s.findAgat(e.graphic,e.layer),u=s.findAgat(t.graphic,t.layer);if(!c||!u)return;const p=s.findRules(c).map((n=>n.fromNetworkSource?.sourceId!==c.networkSourceId||n.fromAssetGroup?.assetGroupCode!==c.assetGroup||null!==n.fromAssetType?.assetTypeCode&&n.fromAssetType?.assetTypeCode!==c.assetType||n.toNetworkSource.sourceId!==u.networkSourceId||n.toAssetGroup?.assetGroupCode!==u.assetGroup||null!==n.toAssetType&&n.toAssetType?.assetTypeCode!==u.assetType?n.toNetworkSource.sourceId!==c.networkSourceId||n.toAssetGroup?.assetGroupCode!==c.assetGroup||null!==n.toAssetType&&n.toAssetType?.assetTypeCode!==c.assetType||n.fromNetworkSource.sourceId!==u.networkSourceId||n.fromAssetGroup?.assetGroupCode!==u.assetGroup||null!==n.fromAssetType?.assetTypeCode&&n.fromAssetType?.assetTypeCode!==u.assetType?null:{rule:n,from:{agat:u,item:t},to:{agat:c,item:e}}:{rule:n,from:{agat:c,item:e},to:{agat:u,item:t}})).filter((e=>e?.rule.ruleType===_.D2.RTJunctionEdgeConnectivity||e?.rule.ruleType===_.D2.RTEdgeJunctionEdgeConnectivity||e?.rule.ruleType===_.D2.RTContainment?null:e)).filter((e=>null!==e));if(0===p.length)return;const h=(0,v.E)(r),f=new Set;for(const y of p){const e={};e[h.fromNetworkSourceId]=y.rule.fromNetworkSource.sourceId,e[h.fromGlobalId]=y.from.item.graphic.attributes[y.from.item.layer.globalIdField??I],e[h.fromTerminalId]=null,y.rule.fromTerminal&&(e[h.fromTerminalId]=y.rule.fromTerminal.terminalId),e[h.toNetworkSourceId]=y.rule.toNetworkSource.sourceId,e[h.toGlobalId]=y.to.item.graphic.attributes[y.to.item.layer.globalIdField??I],e[h.toTerminalId]=null,y.rule.toTerminal&&(e[h.toTerminalId]=y.rule.toTerminal.terminalId),e[h.associationType]=y.rule.ruleType,e[h.percentAlong]=null,e[h.isContentVisible]=y.rule.ruleType===_.D2.RTContainment?1:0,e[h.status]=0,e[h.globalId]=(0,d.yS)();const t=`${e[h.fromNetworkSourceId]}-${e[h.fromGlobalId]}-${e[h.toNetworkSourceId]}-${e[h.toGlobalId]}-${e[h.associationType]}`;if(f.has(t))continue;f.add(t);const n=new a.default({attributes:e,sourceLayer:r});i.add(n),o.push({id:r.layerId,graphic:n,tag:"",layer:r}),l.push({sourceGraphic:y.to.item.graphic,sourceLayerId:y.to.item.layer.layerId,destinationGraphic:n,destinationLayerId:r.layerId,sourceField:y.to.item.layer.globalIdField??I,destinationField:h.toGlobalId??I}),l.push({sourceGraphic:y.from.item.graphic,sourceLayerId:y.from.item.layer.layerId,destinationGraphic:n,destinationLayerId:r.layerId,sourceField:y.from.item.layer.globalIdField??I,destinationField:h.fromGlobalId??I})}}var A,x=n(63733),E=n(31933),k=n(8503),P=n(94277),Z=n(20072),V=n(97513),C=n(3589),O=n(1723),L=n(48594),R=n(21661),H=n(88877),N=n(95600),z=n(87102),D=n(81257);const U=Symbol(),G=Symbol(),j=Symbol(),q=Symbol(),W={point:["point"],multipoint:["multipoint"],polygon:["polygon","freehandPolygon","rectangle","circle"],polyline:["polyline","freehandPolyline"],mesh:[],multipatch:[]};let $=A=class extends H.default{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._webStyleCache=new Map,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new z.default,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._isActive=!0}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){if(this.pendingFeatures.some((e=>!!this.data.getEditsForPendingFeature(e)?.modified)))return!0;const{creationInfo:e,upload:t}=this.data,n=this._sketchViewModel,{activeComponent:i}=n,a=n.createGraphic?.geometry?.type;return!("polyline"!==a&&"polygon"!==a&&"multipoint"!==a||"draw-2d"!==i?.type&&"draw-3d"!==i?.type)&&i.drawOperation.committedVertices.length>0||!(!t||"pending"!==t.state&&"success"!==t.state)||!!e?.geometryToPlace}get hasPreviousStep(){return this._stepIndex>0||"update-pending"===this.createFeatureState&&!!this.data.selectedPendingFeature&&!this.parent&&!(0,R.v)(this.data.creationInfo)}get helpMessage(){const{creationInfo:e,viewModel:t}=this.data;if("creating-features"!==this.stepId||!e)return;const i=e.layer.geometryType,a=this._sketchViewModel.createGraphic;if("mesh"===i){this._getDrawMeshHelpMessage||n.e(76030).then(n.bind(n,76030)).then((e=>{this._getDrawMeshHelpMessage=e.getDrawMeshHelpMessage}));const{view:e}=t;return"3d"===e?.type?this._getDrawMeshHelpMessage?.(a,e):void 0}const r=this._sketchViewModel.activeCreateToolDrawMode,o=this._sketchViewModel.activeTool;return(0,P.$)("rectangle"===o?"rectangle":"circle"===o?"circle":i,a?.geometry,r)}get layer(){return this.data.creationInfo?.layer}get numPendingFeatures(){return this.pendingFeatures.length}get numPendingFeaturesExcludingHidden(){return this.pendingFeatures.filter((e=>this.data.isDisplayable(e))).length}get parent(){return this.data.parent}get parentLayer(){return this.parent?.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return 0===this.numPendingFeatures}get reliesOnOwnerAdminPrivileges(){return this.data.editorItem?.capabilities.create.reliesOnOwnerAdminPrivileges??!1}get shouldShowAttachments(){return(this.data.selectedPendingFeature&&this.data.editorItem?.capabilities.create.attachments.enabled)??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}get availableCreateTools(){const e=this.data.creationInfo?.layer.geometryType,t=this.data.viewModel.view;if(!e)return[];if(this.data.creationInfo?.maxFeatures&&this.data.creationInfo.maxFeatures<=this.numPendingFeatures)return[];if((0,f.w2)(this.data.fullTemplate)){const{tool:t}=(0,N.Xm)(e,this.data.fullTemplate);return[t]}return"2d"!==t?.type&&"multipoint"===e?[]:[...W[e]]}get _attachmentsActive(){const e=this.data.viewModel.attachmentsViewModel.mode,t=this.stepId;return this.shouldShowAttachments&&("add"===e||"edit"===e||"adding-attachment"===t||"editing-attachment"===t)}async enter(){this._isActive=!0,"awaiting-feature-creation-info"!==this.stepId&&await this._updatingHandles.addPromise(this._setUpCreatingFeaturesStep())}exit(){this._isActive=!1,this.removeHandles([j])}async updatePendingFeature(e){if(e!==this.data.selectedPendingFeature)return this._sketchViewModel.cancel(),this._startUpdating({feature:e})}async start(){return await super.start(),(0,E.bI)(this.data.creationInfo?.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}async save(){const{featureFormViewModel:e}=this;if(e.pendingSubtypeChoice)return;e.submit(),this._stashValidationState();const t=this.data.selectedPendingFeature,n=this._hasValidationErrors(t)?t:this.data.pendingFeatures.find((e=>this._hasValidationErrors(e)));return n?(await this._startUpdating({feature:n}),void e?.submit()):super.save()}back(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||(0,R.v)(this.data.creationInfo)||this._attachmentsActive||this.parent?super.back(e):this._clearSelectedFeature()}previous(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||(0,R.v)(this.data.creationInfo)||this._attachmentsActive?super.previous(e):this._clearSelectedFeature()}cancelFeature(e){this.data.isSharedTemplateWorkflow?s.A.getLogger(this).warn("Cannot cancel individual features created by shared templates."):(this.data.removePendingFeature(e),this.sketchViewModel.layer.graphics.remove(e))}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:n,applyEditsFeatureServiceCallback:i,isNested:a,creationInfo:r,parent:o,snappingManager:s,startAt:l,viewModel:c}=e,u=e.sketchOptions??new V.A,p=r?.layer,h=p?c.findEditorItemForLayer(p):void 0,y=new A({data:new L.default({creationInfo:r,editorItem:h,parent:o,sketchOptions:u,snappingManager:s,viewModel:c}),isNested:a,onCommit:async e=>{const{creationInfo:a}=e;if(!a)return;y._sketchViewModel.cancel();const r=e.pendingFeatures.toArray(),{layer:o}=a,s=o.capabilities?.editing.supportsGlobalId&&"globalIdField"in o,l=y._attachmentFileInfos,{fullTemplate:u}=e,p=(0,N._3)(y.data),h=(0,f.Sf)(u)&&p;if(s){if(function(e){for(const t of e){const{sourceLayer:e}=t;e&&"globalIdField"in e&&null!=e.globalIdField&&(t.attributes[e.globalIdField]??=(0,d.yS)())}}(r),h){let t=function(e,t){return e.map((e=>{const{addFeatures:n}=e;if(!n||0===n.length)return e;const i=[];for(const a of n){const e=t.get(a);if(e)for(const{file:t}of e)i.push({feature:a,attachment:{globalId:(0,d.yS)(),data:t}})}return i.length?{...e,addAttachments:i}:e}))}(p,l);const n=await(0,N.uh)(o,c.view);n&&(t=(0,N.sy)({edits:t,serviceInfo:n,view:c.view,findOriginalFeature:t=>e.getEditsForPendingFeature(t)?.initialFeature??t})),await i(u.featureService,t,{globalIdUsed:!0,gdbVersion:u.layer.gdbVersion??void 0})}else{const e=function(e,t){const n=[];if(!t||0===t.size)return{addFeatures:e};for(const[i,a]of t)for(const{file:e}of a)n.push({feature:i,attachment:{globalId:(0,d.yS)(),data:e}});return n.length?{addFeatures:e,addAttachments:n}:{addFeatures:e}}(r,l);await n(o,e,{globalIdUsed:!0})}return}const g=h?await i(u.featureService,p,{gdbVersion:u.layer.gdbVersion??void 0}):[await n(o,{addFeatures:r})];g&&l.size>0&&await Promise.all(g.map((e=>{if(e?.addFeatureResults)return t(o,function(e,t,n,i){const a=[];return t.forEach(((t,r)=>{if(!t.error){const o=e[r],s=i.get(o)||[];o.attributes[n.objectIdField]=t.objectId,s.forEach((e=>{let{form:t}=e;return a.push({feature:o,attachment:t})}))}})),a}(r,e.addFeatureResults,o,l))})))}});return y._set("steps",this._createWorkflowSteps(y,l)),y}_fadeExistingFeatures(e){if("effect"in e){const t=e.effect;return e.effect="saturate(0.6) opacity(0.8)",(0,o.hA)((()=>e.effect=t))}const t=e.opacity;return e.opacity=.7,(0,o.hA)((()=>e.opacity=t))}async _initializeFullTemplateAndExecutorInfo(e){const{creationInfo:t}=e,{view:n}=e.viewModel;if(!t||!n)return null;const i=await(0,N.sE)(t,n);if(e.fullTemplate=i,i&&(0,f.Sf)(i)){const a={completionResults:[],executor:await F(i),serviceLayersById:await(0,N.EH)(t.layer,n)};e.templateExecutorInfo=a}return i}async _startCreating(){this.removeHandles(G);const{data:e}=this;if(!e.creationInfo)return;const t=this.data.creationInfo?.maxFeatures;if(t&&this.numPendingFeatures>=t)return this.sketchViewModel.cancel(),void(this.numPendingFeatures&&await this._startUpdating({feature:this.pendingFeatures.at(-1)}));this.createFeatureState="create-new",await(0,N.AP)(this._sketchViewModel,e,this._webStyleCache)}async _clearSelectedFeature(){const e=this._featureFormViewModel.pendingSubtypeChoice;e&&(e.resolve("undo"),await e.promise),this._stashValidationState(),this.sketchViewModel.cancel(),this.data.selectedPendingFeature=null,this._featureFormHandle=(0,l.xt)(this._featureFormHandle),this._featureFormViewModel.feature=null;const t=this.data.viewModel.attachmentsViewModel;"add"!==t.mode&&"edit"!==t.mode||this.data.viewModel.activeWorkflow?.previous()}_stashValidationState(){const e=this._featureFormViewModel.feature,t=e&&this.data.getEditsForPendingFeature(e);t&&(t.submittable=this._featureFormViewModel.submittable)}async _selectFeatureForUpdate(e){let{feature:t,initialFeature:n=t}=e;this._stashValidationState();const{data:i,pendingFeatures:a,_webStyleCache:r}=this;a.includes(t)||i.addPendingFeature(t,n),i.selectedPendingFeature=t;const{_featureFormViewModel:s,_sketchViewModel:c}=this,{creationInfo:d,viewModel:p}=i,{attachmentsViewModel:h,layerInfos:f,view:y}=p;if(!y||!d)return;(0,l.xt)(this._featureFormHandle);const g=t.sourceLayer,m=(0,N.Z5)(f,g),w=m?.formTemplate,b=y.spatialReference;s.set({arcadeEditType:"INSERT",feature:t,formTemplate:w,spatialReference:b,map:y.map}),"add"!==h.mode&&"edit"!==h.mode||p.activeWorkflow?.previous(),h.graphic=t,h.fileInfos.removeAll(),h.mode="view",(this._attachmentFileInfos.get(t)||[]).forEach((e=>{let{file:t,form:n}=e;return h.addFile(t,n)})),await(0,N.FC)(t,r,"2d"===y.type?y.scale:null);const v=i.getEditsForPendingFeature(t);this._featureFormHandle=(0,o.vE)([s.on("value-change",(async()=>{v?.updateAttributes(s.getValues()),await(0,N.FC)(t,r,"2d"===y.type?y.scale:null)})),c.on(["update","undo","redo"],(e=>{("undo"===e.type||"redo"===e.type||"update"===e.type&&null!=e.toolEventInfo&&(0,N.Ks)(e.toolEventInfo.type))&&s.notifyFeatureGeometryChanged()})),(0,u.watch)((()=>s.feature?.sourceLayer),(e=>t.sourceLayer=e)),(0,u.watch)((()=>[s.feature,s.submittable]),(()=>this._stashValidationState()))]),this.createFeatureState="update-pending"}async _startUpdating(e){let{feature:t,initialFeature:n=t}=e;await this._selectFeatureForUpdate({feature:t,initialFeature:n});const{_sketchViewModel:i,data:a}=this,{creationInfo:r,viewModel:o}=a,{view:s}=o;if(!s||!r)return;const l=t.sourceLayer??r.layer;return(0,E.bI)(l)?void 0:(this._visualVariableAttributes=(0,N.EO)(t),(0,N.J_)({graphic:t,sketchViewModel:i,sourceLayer:l,visualVariables:this._visualVariableAttributes,webStyleCache:this._webStyleCache}))}static _createWorkflowSteps(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";const{data:n}=e,i=(0,N.z4)(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:t,viewModel:i}=n,{view:a}=i;a&&((0,R.v)(t)?e.addHandles(await(0,R.P)({view:a,data:n,next:()=>e.next(),cancel:()=>i.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(n.parent&&t&&e.addHandles(i.restrictFeatureTemplatesViewModelToLayer(t.layer),this.id),e.addHandles(i.featureTemplatesViewModel.on("select",(t=>{let{item:i}=t;i&&(n.creationInfo={...n.creationInfo,layer:i.layer,template:i.template},e.next())})),this.id)))},async tearDown(){e.removeHandles(this.id)}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(t){const{viewModel:i}=n;t.canceled&&(e.removeHandles([j,U,G,q]),i.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=n.viewModel,{graphic:i,fileInfos:a}=t;e._attachmentFileInfos.set(i,a.toArray()),t.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=n.viewModel,{graphic:i,fileInfos:a}=t;e._attachmentFileInfos.set(i,a.toArray()),t.mode="view"}})});return(0,N.bn)(n,i)}static _configureSketchViewModel(e){const{data:t}=e,n=e._webStyleCache,{creationInfo:i,viewModel:a}=t,{view:r}=a,s=e._sketchViewModel,d=[];if(!r)return(0,o.hA)();if("2d"===r.type){i&&d.push(e._fadeExistingFeatures(i.layer));const t=(0,c.debounce)(((e,t)=>Promise.all(e.map((e=>(0,N.FC)(e,n,t))))));d.push((0,u.watch)((()=>r.scale),(e=>t(s.layer.graphics,e))))}const p=(0,N.nc)(t.fullTemplate,i?.attributeOverrides),h=(0,u.watch)((()=>s.createGraphic),(i=>{i&&!e.hasHandles(G)&&e._updatingHandles.addPromise((0,N.Pi)({creationAttributes:p,data:t,sketchViewModel:s,view:r,webStyleCache:n}).then((t=>e.addHandles(t,G))))})),f=async n=>{const{attachmentsViewModel:o}=a,{_featureFormViewModel:l}=e;if(n.graphics.length>1)return void await e._clearSelectedFeature();const c=n.graphics[0];if("complete"===n.state){const{submittable:t}=l;if(e.numPendingFeatures!==i?.maxFeatures&&t||l.submit(),await e._clearSelectedFeature(),"add"!==o.mode&&"edit"!==o.mode||a.activeWorkflow?.previous(),!n.aborted&&r.activeTool===e.sketchViewModel.activeComponent&&(await e.sketchViewModel.wait(),"ready"===e.sketchViewModel.state&&"mesh"!==e.data.creationInfo?.layer.geometryType))return e._startCreating()}else{if("start"===n.state)return c.sourceLayer??=t.creationInfo?.layer,await(0,N.cY)({sketchViewModel:s,graphic:c,visualVariables:e._visualVariableAttributes,webStyleCache:e._webStyleCache,sourceLayer:c.sourceLayer}),e._selectFeatureForUpdate({feature:c});if("active"===n.state){await e.updatePendingFeature(c);const t=e._visualVariableAttributes;await(0,N.EA)(r,c,n,t,e._webStyleCache);const i=c.attributes,{rotation:a,size:o}=t;if(null!=a){const{field:e}=a;l.setValue(e,i[e])}if(null!=o){const{field:e}=o;l.setValue(e,i[e])}}}},y=async n=>{if(n.graphics.forEach((e=>{t.removePendingFeature(e)})),!(0,R.v)(t.creationInfo))return e._startCreating()};d.push(h,s.on("create",(t=>e._updatingHandles.addPromise((async t=>{if("cancel"!==t.state&&"complete"!==t.state||e.removeHandles(G),"cancel"===t.state&&null!==r.activeTool&&r.activeTool!==e.sketchViewModel.activeComponent&&(await e._waitForActiveToolCleared(),await e._startCreating()),"complete"===t.state&&t.graphic){const n=await e._processEdits(t.graphic,{scale:"2d"===r.type?r.scale:null,useSourceLayer:!0,webStyleCache:e._webStyleCache});n&&(await e._waitForActiveToolCleared(),await e._startUpdating({feature:n}))}})(t)))),s.on("update",(t=>e._updatingHandles.addPromise(f(t)))),s.on("delete",(t=>e._updatingHandles.addPromise(y(t)))),(0,u.when)((()=>!e.numPendingFeatures),(()=>e._updatingHandles.addPromise((async()=>{if((0,R.v)(t.creationInfo))try{await e.data.viewModel.back()}catch{}return e._startCreating()})()))),(0,o.hA)((()=>{s.cancel()})),function(e,t){let n=null;const i=()=>e.snappingOptions.featureSources,a=()=>(n=new C.default({layer:e.layer}),i().add(n),n),r=()=>{null!=n&&(i().remove(n),n=(0,l.pR)(n))};return(0,o.vE)([(0,u.watch)((()=>{const e=t.creationInfo?.layer,n=i().find((t=>t.layer===e));return{hasFeatureLayerSource:!!n,enabled:n?.enabled??!1}}),(e=>{let{hasFeatureLayerSource:t,enabled:i}=e;if(!t)return r();n??=a(),n.enabled=i}),u.syncAndInitial),(0,o.hA)(r)])}(s,t),...function(e){const t=e.viewModel.view;if(!t)return[];const n=[];if("3d"===t.type){const i=new Z.A({view:t});n.push((0,u.watch)((()=>e.selectedPendingFeature),((e,t)=>{i.remove(e),i.add(t)})),(0,o.hA)((()=>i.destroy())))}const i=new Z.A({view:t,highlightName:O.n4});return n.push((0,u.watch)((()=>e.temporaryHighlightFeature),(e=>{i.removeAll(),i.add(e)})),(0,o.hA)((()=>i.destroy()))),n}(t));const g=(0,o.vE)(d);return s.addHandles(g),g}_initializeSketchViewModel(){const{data:e}=this,{view:t}=e.viewModel,n=new x.default({elevationInfo:e.creationInfo?.layer.elevationInfo,internal:!0,listMode:"hide",title:"createFeaturesWorkflow-internal"}),i=new D.default({layer:n,creationMode:"single",sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},view:t});this._sketchViewModel=i,t?.map.add(n),this.addHandles([(0,o.hA)((()=>{t?.destroyed||t?.map.remove(n),n.destroy()})),(0,u.watch)((()=>this.numPendingFeatures>0),(e=>this._sketchViewModel.updateOnGraphicClick=e),u.initial)])}_hasValidationErrors(e){return!!e&&(!this.data.isSubmittable(e)||!!this._featureFormViewModel.validateContingencyConstraints(e.attributes,{includeIncompleteViolations:!0})?.length)}async _processEdits(e,t){const{data:n}=this,{layerInfos:i,view:a}=n.viewModel,r=this._featureFormViewModel,{templateExecutorInfo:o}=n;if(!o){const t=e.clone();return t.geometry=null,n.addPendingFeature(e,t),e}const s=this.sketchViewModel.layer;s.remove(e);const{executor:l}=o,d=l(e.geometry,"completion"),p=(0,c.isPromiseLike)(d)?await d:d;o.completionResults.push(p),(0,N.O)(p.relationships),r.arcadeEditType="INSERT",r.map=a?.map,r.spatialReference=a?.spatialReference,p.primary&&n.creationInfo?.attributeOverrides&&(p.primary.graphic.attributes={...p.primary.graphic.attributes,...n.creationInfo.attributeOverrides});for(const c of p.edits){let e=null;if(c.addFeatures)for(const a of c.addFeatures){const o=a.clone();o.geometry=null,null!=a.geometry&&(a.symbol=await(0,k.getDisplayedSymbol)(a,t),s.add(a));const l=n.addPendingFeature(a,o,{isAssociation:!!p.associationGraphics?.has(a)});a.sourceLayer!==e?.layer&&(e=(0,N.Z5)(i,a.sourceLayer)),r.feature=a,r.formTemplate=e?.formTemplate,await(0,u.whenOnce)((()=>!r.updating)),l.submittable=r.submittable}}return r.feature=null,await(0,u.whenOnce)((()=>!r.updating)),p.edits.reduce(((e,t)=>e+(t.addFeatures?.length??0)),0)>1?null:p.primary?.graphic}async _setUpCreatingFeaturesStep(){if(this.hasHandles(j))return;const{data:e,sketchViewModel:t}=this,{creationInfo:n,viewModel:i}=e,{attachmentsViewModel:s,view:c}=i;if(!c||!n?.layer)throw new r.default("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:d,layer:p}=n,h=[],y=[];this._featureFormHandle=(0,l.xt)(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},e.editorItem=i.findEditorItemForLayer(n.layer),n.template&&(null==e.fullTemplate&&await this._initializeFullTemplateAndExecutorInfo(e),y.push((0,o.hA)((()=>{e.templateExecutorInfo&&(e.templateExecutorInfo.completionResults=[])})))),t.allowDeleteKey=!e.isSharedTemplateWorkflow,(0,N.r8)(s),h.push((0,u.watch)((()=>s.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})));const g=(0,N.Pz)(c);h.push(g);const m=(0,E.bI)(n.layer),{template:w}=n,b=!w||(0,f.gZ)(w)||(0,f.w2)(w)&&"feature"===w.type,v=m&&b;try{if(v){const t=d??new a.default({attributes:(0,N.nc)(e.fullTemplate,n.attributeOverrides),sourceLayer:p}),i=await this._processEdits(t);i&&await this._startUpdating({feature:i})}else h.push(A._configureSketchViewModel(this)),d?(t.layer.add(d),await this._startUpdating({feature:d})):await this._startCreating()}finally{g.remove()}const _=(0,o.hA)((()=>{for(const n of e.pendingFeatures)t.layer.remove(n),e.removePendingFeature(n)})),M=(0,u.watch)((()=>c?.timeZone),(e=>{this._featureFormViewModel.timeZone=e,this.data.timeZone=e}),u.initial),I=(0,o.hA)((()=>{(0,R.v)(n)&&i.cancelWorkflow({warnIfNoWorkflow:!1})}));this._featureFormHandle&&h.push(this._featureFormHandle),this.addHandles(h,this._handleKeys.beforeCommit),this.addHandles(y,this._handleKeys.afterCommit),this.addHandles([(0,o.hA)((()=>s.fileInfos.removeAll())),(0,o.vE)(h),(0,o.vE)(y),I,_,M],j)}async _waitForActiveToolCleared(){const e=this.data.viewModel.view;if(null==e?.activeTool)return;const t=new AbortController;this.addHandles((0,o.rE)(t),q),await(0,u.whenOnce)((()=>null==e?.activeTool),t.signal),t.abort()}};(0,i._)([(0,p.MZ)()],$.prototype,"createFeatureState",void 0),(0,i._)([(0,p.MZ)()],$.prototype,"data",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],$.prototype,"isNested",void 0),(0,i._)([(0,p.MZ)()],$.prototype,"featureFormViewModel",null),(0,i._)([(0,p.MZ)()],$.prototype,"hasPendingEdits",null),(0,i._)([(0,p.MZ)()],$.prototype,"hasPreviousStep",null),(0,i._)([(0,p.MZ)()],$.prototype,"_getDrawMeshHelpMessage",void 0),(0,i._)([(0,p.MZ)()],$.prototype,"helpMessage",null),(0,i._)([(0,p.MZ)()],$.prototype,"layer",null),(0,i._)([(0,p.MZ)()],$.prototype,"parent",null),(0,i._)([(0,p.MZ)()],$.prototype,"parentLayer",null),(0,i._)([(0,p.MZ)()],$.prototype,"keyboardCancellationEnabled",null),(0,i._)([(0,p.MZ)()],$.prototype,"reliesOnOwnerAdminPrivileges",null),(0,i._)([(0,p.MZ)()],$.prototype,"shouldShowAttachments",null),(0,i._)([(0,p.MZ)()],$.prototype,"shouldAllowAttachmentEditing",null),(0,i._)([(0,p.MZ)()],$.prototype,"sketchViewModel",null),(0,i._)([(0,p.MZ)()],$.prototype,"availableCreateTools",null),(0,i._)([(0,p.MZ)()],$.prototype,"_attachmentsActive",null),$=A=(0,i._)([(0,h.$)("esri.widgets.Editor.CreateFeaturesWorkflow")],$);const B=$},12482:(e,t,n)=>{n.d(t,{$7:()=>S,B:()=>F,Fo:()=>_,M7:()=>x,NN:()=>p,Q5:()=>M,Tq:()=>k,Up:()=>I,XF:()=>A,Ze:()=>m,bK:()=>s,bh:()=>d,id:()=>w,ky:()=>u,qt:()=>E,tW:()=>T,v9:()=>h,w7:()=>l,wF:()=>o,wS:()=>b,wz:()=>y,x:()=>f,xS:()=>v,ze:()=>c});var i=n(31633),a=n(59097);function r(e){return e?E:k}function o(e,t){return t?.mode?t.mode:r(e).mode}function s(e,t){return null!=t?t:r(e)}function l(e,t){return o(null==e||(e.hasZ??!1),t)}function c(e,t){return s(null==e||(e.hasZ??!1),t)}function u(e){const t=g(e);return l(e.geometry,t)}function d(e){const t=g(e),n=l(e.geometry,t),i=null!=t&&"on-the-ground"!==n?x(t):0,a=t?.featureExpressionInfo;return{mode:n,offset:i,featureExpressionInfo:a}}function p(e){return y(d(e))}function h(e){return y(e)||f(e)}function f(e){return"0"===e?.featureExpressionInfo?.expression}function y(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function g(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function m(e,t){if(!e?.offset)return 0;const{offset:n,unit:a}=e;if("decimal-degrees"===a)return 0;const r="unknown"!==a&&a?a:"meters",o=(0,i.mq)(t);return o?(0,i.oU)(n,r,o):0}function w(e,t,n){if(!n?.mode)return;const i=e.hasZ?e.z:0,a=m(n,e.spatialReference);switch(n.mode){case"absolute-height":return i-a;case"on-the-ground":return 0;case"relative-to-ground":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"ground")??0)+a);case"relative-to-scene":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"scene")??0)+a)}}function b(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function v(e,t,n,i){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return _(e,t[0],t[1],t.length>2?t[2]:0,n,i,a)}function _(e,t,n,i,a,r){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==r)return;const s=null!=o?o.mode:"absolute-height";if("on-the-ground"===s)return 0;const{absoluteZ:l}=M(t,n,i,a,e,r);return function(e,t,n,i,a,r,o,s){const l=m(o,a);switch(s){case"absolute-height":return e-l;case"relative-to-ground":return e-((r.elevationProvider.getElevation(t,n,i,a,"ground")??0)+l);case"relative-to-scene":return e-((r.elevationProvider.getElevation(t,n,i,a,"scene")??0)+l)}}(l,t,n,i,a,e,o,s)}function M(e,t,n,i,a,r){const o=m(r,i);switch(r.mode){case"absolute-height":return{absoluteZ:n+o,elevation:0};case"on-the-ground":{const n=a.elevationProvider.getElevation(e,t,0,i,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const r=a.elevationProvider.getElevation(e,t,n,i,"ground")??0;return{absoluteZ:n+r+o,elevation:r}}case"relative-to-scene":{const r=a.elevationProvider.getElevation(e,t,n,i,"scene")??0;return{absoluteZ:n+r+o,elevation:r}}}}function I(e,t){if(null==t)return!1;const{mode:n}=t;return null!=n&&("scene"===e&&"relative-to-scene"===n||"ground"===e&&"absolute-height"!==n)}function F(e,t,n){return n&&n.mode!==t?`${e} only support ${t} elevation mode`:null}function S(e,t,n){return n?.mode===t?`${e} do not support ${t} elevation mode`:null}function T(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function A(e,t){t&&e.warn(".elevationInfo=",t)}function x(e){return(e?.offset??0)*(0,a.Ao)(e?.unit)}const E={mode:"absolute-height",offset:0},k={mode:"on-the-ground",offset:null}},14487:(e,t,n)=>{n.d(t,{F:()=>r});n(9624);var i=n(13312),a=n(64232);function r(e,t,n,i,r){return!(null==t||null==i||e.length<2)&&(o.x=e[0],o.y=e[1],o.z=e[2],o.spatialReference=t,(0,a.g)(o,n,i,r))}const o=(0,n(18117).T)(0,0,0,i.default.WGS84)},17983:(e,t,n)=>{n.d(t,{i:()=>h});var i=n(39356),a=n(50076),r=n(49723),o=n(5600),s=n(81130),l=n(66388),c=n(19247),u=n(65215),d=n(23701),p=n(31933);function h(e){let{edits:t,geometry:n,relationships:l,tag:c="",template:u}=e;if((0,s.AO)(n)){const e=n.geometry.clone();for(const n of e.paths)h({geometry:new d.default({spatialReference:e.spatialReference,paths:[n],hasZ:e.hasZ,hasM:e.hasM}),template:u,edits:t,relationships:l,tag:c});return}const{definition:p,layer:y}=u;n=f(n,y);const g=new i.default({attributes:p.defaultValues?{...p.defaultValues}:{},geometry:n,sourceLayer:y});if(b(g,y),y.globalIdField&&(g.attributes[y.globalIdField]=(0,r.yS)()),t.push({id:y.layerId,graphic:g,tag:c,layer:y}),0!==p.relationships.length)for(const s of p.relationships||[]){const e=s.template;if(null==s.relationshipMetadata||!(0,o.xZ)(e))throw new a.default("shared-template:missing-relationship-metadata-or-definition","Relationship part must have metadata and a fully loaded template with definition");const{layer:n}=e,c=new i.default({attributes:{...p.defaultValues},sourceLayer:n});b(c,n),n.globalIdField&&(c.attributes[n.globalIdField]=(0,r.yS)()),t.push({graphic:c,id:n.layerId,tag:"",layer:n}),l.push({...s.relationshipMetadata,sourceGraphic:g,destinationGraphic:c})}}function f(e,t){if(!e)return null;if(e.hasZ===t.hasZ&&e.hasM===t.hasM)return e;switch(e.type){case"point":return new c.default({spatialReference:e.spatialReference,x:e.x,y:e.y,...t.hasZ?e.hasZ?{z:e.z}:{z:m(t)}:{},...t.hasM?e.hasM?{m:e.m}:{m:w(t)??void 0}:{}});case"polygon":return new u.default({spatialReference:e.spatialReference,rings:y(e.rings,t.hasZ,t.hasM,m(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"polyline":return new d.default({spatialReference:e.spatialReference,paths:y(e.paths,t.hasZ,t.hasM,m(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"multipoint":return new l.default({spatialReference:e.spatialReference,hasZ:t.hasZ,hasM:t.hasM,points:g(e.points,t.hasZ,t.hasM,m(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1)});default:return e}}function y(e,t,n,i,a,r,o){const s=[];for(const l of e)s.push(g(l,t,n,i,a,r,o));return s}function g(e,t,n,i,a,r,o){const s=[];for(const l of e){const e=[l[0],l[1]];t&&(e[2]=o>-1?l[2]:i),n&&(e[t?3:2]=r>-1?l[r]:a),s.push(e)}return s}function m(e){return e.capabilities.editing?.zDefault??0}function w(e){return e.capabilities.editing.supportsUpdateWithoutM?void 0:0}function b(e,t){(0,p.F2)(t)&&(e.sourceLayer=t.findSublayerForFeature(e))}},18117:(e,t,n)=>{function i(e,t,n,i){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:i,type:"point"}}function a(e,t,n,i,a){e.x=t,e.y=n,e.z=i,e.hasZ=null!=i,e.spatialReference=a}n.d(t,{J:()=>a,T:()=>i})},20072:(e,t,n)=>{n.d(t,{A:()=>p});var i=n(35143),a=n(91967),r=n(46053),o=(n(81806),n(76460),n(47249),n(85842)),s=n(69120),l=n(1723),c=n(90992),u=n(9912);let d=class extends a.default{constructor(e){super(e),this.view=null,this.highlightName=l.Tv}add(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._highlight(e)))}remove(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._removeHighlight(e)))}removeAll(){this.removeAllHandles()}_highlight(e){const t=(0,s.i)(this.view,e.layer);(0,c.Of)(t)&&this.addHandles(t.highlight(e,{name:this.highlightName}),(0,u.getHighlightKeyForFeature)(e))}_removeHighlight(e){e&&this.removeHandles((0,u.getHighlightKeyForFeature)(e))}};(0,i._)([(0,r.MZ)()],d.prototype,"view",void 0),(0,i._)([(0,r.MZ)({constructOnly:!0})],d.prototype,"highlightName",void 0),d=(0,i._)([(0,o.$)("esri.views.draw.support.HighlightHelper")],d);const p=d},20578:(e,t,n)=>{n.d(t,{r:()=>o});n(81806),n(76460);var i=n(20664),a=n(99791),r=n(64753);class o extends r.m{constructor(e,t,n){super(n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.n.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&(0,i.p)(this.lineStart,e.lineStart)&&(0,i.p)(this.lineEnd,e.lineEnd)}}},21661:(e,t,n)=>{n.d(t,{P:()=>l,v:()=>c});var i=n(39356),a=n(54901),r=n(50346),o=n(68134),s=n(95600);async function l(e){let{view:t,data:l,signal:u,next:d,cancel:p}=e;const{creationInfo:h}=l;if(!h)return(0,a.hA)();if(!c(h))return(0,a.hA)();const{layer:f}=h,y=null!=h.geometryToPlace;if(h.geometryToPlace=null,y)return p(),(0,a.hA)();const{Upload:g}=await n.e(34881).then(n.bind(n,34881));(0,r.throwIfAborted)(u);const m=new g;l.upload=m;let w=null;const b=()=>w?.remove(),v=(0,a.vE)([(0,o.watch)((()=>m.state),(e=>{switch(e){case"default":case"error":b();break;case"pending":b(),w=(0,s.Pz)(t);break;case"success":{h.maxFeatures=1;const{result:e}=m;"georeferenced"===e?.type||"georeferenced-reprojected"===e?.type?(h.geometryToPlace=e.mesh,h.initialFeature=new i.default({attributes:(0,s.nc)(l.fullTemplate,h.attributeOverrides),geometry:e.mesh,sourceLayer:f}),t.goTo(h.initialFeature,{animate:!1}).catch(r.ignoreAbortErrors)):h.geometryToPlace=e?.mesh,b(),d();break}}})),(0,a.hA)((()=>{m.cancel(),b()}))]);return m.uploadTo(f),v}function c(e){const t=e?.layer;return"scene"===t?.type}},23543:(e,t,n)=>{n.d(t,{c:()=>o});n(81806),n(76460);var i=n(20664),a=n(99791),r=n(64753);class o extends r.m{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.n.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,r),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=s}equals(e){return e instanceof o&&this.type===e.type&&(0,i.p)(this.lineStart,e.lineStart)&&(0,i.p)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,i.j)(this.lineStart,this.lineEnd)}}},30484:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(20664),a=n(99791),r=n(64753);class o extends r.m{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.n.ALL),this.intersectionPoint=e}equals(e){return e instanceof o&&(0,i.p)(this.intersectionPoint,e.intersectionPoint)}}},48594:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var i=n(35143),a=n(91967),r=n(19276),o=n(76460),s=n(67993),l=n(46053),c=(n(81806),n(47249),n(85842)),u=n(5600),d=n(79256);let p=class extends a.default{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.fullTemplate=null,this.parent=null,this.temporaryHighlightFeature=null,this.sketchOptions=null,this.snappingManager=null,this.templateExecutorInfo=null,this.viewModel=null,this.upload=null,this._pendingEdits=new s.A}get isSharedTemplateWorkflow(){return!!this.fullTemplate&&(0,u.w2)(this.fullTemplate)}get pendingFeatures(){return new r.default([...this._pendingEdits.keys()])}set selectedPendingFeature(e){this._set("selectedPendingFeature",e),this.temporaryHighlightFeature=null}set timeZone(e){this._set("timeZone",e),this._pendingEdits.forEach((t=>{t.timeZone=e}))}isSubmittable(e){const t=this._pendingEdits.get(e);return!!t?.submittable||!!t?.isAssociation}isDisplayable(e){return!this._pendingEdits.get(e)?.isAssociation}addPendingFeature(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isAssociation:!1};this.temporaryHighlightFeature=null;const{_pendingEdits:i}=this;if(i.has(e))return i.get(e);e.sourceLayer||o.A.getLogger("esri.widgets.Editor.CreateFeaturesWorkflowData").warn("source-layer-not-set","A feature added to `pendingFeatures` did not have `sourceLayer` set. This may cause problems throughout `CreateFeaturesWorkflow`.");const a=new d.default({feature:e,isAssociation:n.isAssociation});return a.trackChanges(t),i.set(e,a),a}getEditsForPendingFeature(e){return this._pendingEdits.get(e)}removePendingFeature(e){this.temporaryHighlightFeature=null;const{_pendingEdits:t}=this,n=t.get(e);n&&(n.destroy(),t.delete(e)),this.selectedPendingFeature===e&&(this.selectedPendingFeature=null)}getFeatureTitle(e){return this._pendingEdits.get(e)?.displayTitle}};(0,i._)([(0,l.MZ)()],p.prototype,"creationInfo",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"editorItem",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"fullTemplate",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"isSharedTemplateWorkflow",null),(0,i._)([(0,l.MZ)()],p.prototype,"parent",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"pendingFeatures",null),(0,i._)([(0,l.MZ)()],p.prototype,"selectedPendingFeature",null),(0,i._)([(0,l.MZ)()],p.prototype,"temporaryHighlightFeature",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],p.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"templateExecutorInfo",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"viewModel",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"upload",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"timeZone",null),p=(0,i._)([(0,c.$)("esri.widgets.Editor.CreateFeaturesWorkflowData")],p);const h=p},52447:(e,t,n)=>{n.d(t,{y:()=>s});var i=n(35143),a=n(54099),r=n(46053),o=(n(81806),n(76460),n(47249),n(85842));let s=class extends a.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}};(0,i._)([(0,r.MZ)({constructOnly:!0})],s.prototype,"graphic",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"tracking",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"displaying",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"error",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"isDraped",void 0),s=(0,i._)([(0,o.$)("esri.views.3d.layers.graphics.GraphicState")],s)},53787:(e,t,n)=>{async function i(e,t){if("2d"===e.type)return e.hitTest(t);const n=await e.hitTest(t);if(0===n.results.length)return n;const i=n.results[0],r=(i.distance??0)*(1+a),o=n.results.findIndex((e=>(e.distance??0)>r));return-1!==o&&(n.results=n.results.slice(0,o)),i&&n.ground.distance>r&&(n.ground.mapPoint=null),n}n.d(t,{h$:()=>s,oZ:()=>i,zF:()=>o});const a=.05;function r(e){return"graphic"===e?.type}function o(e){return e.find(r)??null}function s(e){return e.filter(r)}},55754:(e,t,n)=>{n.d(t,{V:()=>o,t:()=>s});var i=n(31633),a=n(76797),r=n(4955);function o(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.default,o=0;if("2d"===n.type)o=t*(n.resolution??0);else if("3d"===n.type){const a=n.overlayPixelSizeInMapUnits(e),r=n.basemapSpatialReference;o=null==r||r.equals(n.spatialReference)?t*a:(0,i.GA)(r)/(0,i.GA)(n.spatialReference)}const s=e.x-o,l=e.y-o,c=e.x+o,u=e.y+o,{spatialReference:d}=n;return r.xmin=Math.min(s,c),r.ymin=Math.min(l,u),r.xmax=Math.max(s,c),r.ymax=Math.max(l,u),r.spatialReference=d,r}function s(e,t,n){const i=n.toMap(e);return null!=i&&o(i,(0,r.o)(),n,l).intersects(t)}const l=new a.default},56061:(e,t,n)=>{n.d(t,{t:()=>a,x:()=>i});const i=["freehand","hybrid","click"],a="click"},56572:(e,t,n)=>{n.d(t,{l:()=>o});n(81806),n(76460);var i=n(20664),a=n(99791),r=n(64753);class o extends r.m{constructor(e,t,n,i){super(i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.n.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof o&&(0,i.p)(this.previousVertex,e.previousVertex)&&(0,i.p)(this.centerVertex,e.centerVertex)&&(0,i.p)(this.nextVertex,e.nextVertex)}}},63078:(e,t,n)=>{n.d(t,{N:()=>u});var i=n(35143),a=n(69539),r=n(42553),o=n(46053),s=n(85842);let l=class extends r.A{constructor(){super(...arguments),this.enabled=!0}};(0,i._)([(0,o.MZ)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,i._)([(0,s.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends r.A{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new a.default([255,127,0]),this.orangeTransparent=new a.default([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"verticalLineThresholdMeters",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:a.default,nonNullable:!0})],c.prototype,"orange",void 0),(0,i._)([(0,o.MZ)({type:a.default,nonNullable:!0})],c.prototype,"orangeTransparent",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"satisfiesConstraintScreenThreshold",void 0),c=(0,i._)([(0,s.$)("esri.views.interactive.snapping.Settings.Defaults")],c);const u=new c},63733:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var i=n(35143),a=n(46053),r=(n(81806),n(76460),n(47249),n(85842)),o=n(5364),s=n(25515),l=n(65624),c=n(5682),u=n(64519),d=n(731);let p=class extends((0,l.dM)((0,c.j)(s.default))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i._)([(0,a.MZ)({type:d.A})],p.prototype,"elevationInfo",void 0),(0,i._)([(0,a.MZ)((0,o.C)(u.Y,"graphics"))],p.prototype,"graphics",void 0),(0,i._)([(0,a.MZ)({type:["show","hide"]})],p.prototype,"listMode",void 0),(0,i._)([(0,a.MZ)()],p.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],p.prototype,"type",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],p.prototype,"internal",void 0),p=(0,i._)([(0,r.$)("esri.layers.GraphicsLayer")],p);const h=p},64232:(e,t,n)=>{n.d(t,{W:()=>s,g:()=>o});var i=n(9392),a=n(9624),r=n(45308);function o(e,t,n,i){if((0,a.canProjectWithoutEngine)(e.spatialReference,n)){l[0]=e.x,l[1]=e.y;const a=e.z;return l[2]=a??i??0,(0,r.projectBuffer)(l,e.spatialReference,0,t,n,0)}const o=(0,a.tryProjectWithZConversion)(e,n);return!!o&&(t[0]=o?.x,t[1]=o?.y,t[2]=o?.z??i??0,!0)}async function s(e,t,n,i,r){return await(0,a.initializeProjection)(e.spatialReference,n,null,r),o(e,t,n,i)}const l=(0,i.vt)()},64753:(e,t,n)=>{n.d(t,{m:()=>i});class i{constructor(e,t){this.isDraped=e,this.domain=t}}},79256:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(35143),a=n(91967),r=n(50346),o=n(46053),s=(n(81806),n(76460),n(47249),n(85842)),l=n(41289),c=n(23301);let u=class extends a.default{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null,this.submittable=!1,this.displayTitle=null,this.isAssociation=!1,this._debouncedRefreshDisplayTitle=(0,r.debounce)(this._refreshDisplayTitle.bind(this),100)}get attributesModified(){return!function(e,t){const n=e??{},i=t??{},a=new Set(Object.keys(n));(0,l.FB)(a,Object.keys(i));for(const r of a){const e=n[r],t=i[r];if(!(0,c.D_)(e,t))return!1}return!0}(this.initialFeature?.attributes,this.feature?.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}set timeZone(e){this._set("timeZone",e),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.feature;this.initialFeature=e?.clone(),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateAttributes(e){const{feature:t}=this;t&&(t.attributes=e,this.notifyChange("attributesModified")),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateGeometry(e){const{feature:t}=this;t&&(t.geometry=e,this.notifyChange("geometryModified"))}_stringifyGeometry(e){const t=e?.geometry;return function(e){return null==e?null:JSON.stringify(e)}("mesh"===t?.type?{transform:t.transform,vertexSpace:t.vertexSpace}:t)}async _refreshDisplayTitle(e){const t=this.feature,n=t?.sourceLayer;if(!n||!("getFeatureTitle"in n))return;const i=await n.getFeatureTitle(t,{fetchMissingFields:!1,timeZone:this.timeZone});e.aborted||(this.displayTitle=""===i?null:i)}};(0,i._)([(0,o.MZ)()],u.prototype,"_stagedForDelete",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"attributesModified",null),(0,i._)([(0,o.MZ)()],u.prototype,"feature",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"geometryModified",null),(0,i._)([(0,o.MZ)()],u.prototype,"initialFeature",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"modified",null),(0,i._)([(0,o.MZ)()],u.prototype,"submittable",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"displayTitle",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"isAssociation",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"timeZone",null),u=(0,i._)([(0,s.$)("esri.widgets.Editor.Edits")],u);const d=u},81130:(e,t,n)=>{n.d(t,{AO:()=>c,Bi:()=>s,Cg:()=>r,Rg:()=>l,Vi:()=>d,fT:()=>o,zE:()=>u});var i=n(87663),a=n(76797);const r=100;function o(e){return"point"===e.type}function s(e){return"polygon"===e.type}function l(e){return"polyline"===e.type}function c(e){return!!e&&"radial"===e.type}function u(e){let t=null;for(const n of e)if(n.graphic.geometry){const e=n.graphic.geometry,i=o(e)?new a.default({spatialReference:e.spatialReference,xmin:e.x,xmax:e.x,ymax:e.y,ymin:e.y}):e.extent;t=null==t?i?.clone():t.union(i.extent)}return t}function d(e){const t=new Map;for(const n of e)(0,i.tE)(t,n.id,(()=>({addFeatures:[],id:n.id,identifierFields:{globalIdField:n.layer.globalIdField,objectIdField:n.layer.objectIdField}}))).addFeatures?.push(n.graphic);return[...t.values()]}},88877:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(35143),a=n(50076),r=n(54099),o=n(50346),s=n(46053),l=(n(81806),n(76460),n(47249),n(85842)),c=n(19451);let u=class extends r.A.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new c.U,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter((e=>!e.parent)).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,t=e&&e[this._stepIndex];return t&&t.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Promise.resolve(!0);this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!0};return!1!==e.force?this._cancel(e):new Promise(((t,n)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...e,force:!0}).then(t)},deny:()=>n(new a.default("workflow:cancel-denied","Request to cancel workflow was denied."))}})}))}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:t}=this,n=t.findIndex((t=>t.id===e));this._indexHistory.push(this._stepIndex),await this._go(n)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cancelCurrentStep:!1};await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=-1===this._stepIndex?0:this._stepIndex;await this._go(e)}async _cancel(){let{emitCancelEvent:e=!0,error:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&(this._set("started",!1),await this._transaction((()=>this.steps[this._stepIndex]?.tearDown({canceled:!0})))),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:t})}_go(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._transaction((async()=>{const{steps:n}=this;if(!(e<=-1||e>=n.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await n[this._lastStepIndex].tearDown({canceled:t});try{await n[e].setUp()}catch(i){(0,o.throwIfNotAbortError)(i)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}}))}async _transaction(e){const t=this._pendingOperation,n=(0,o.createResolver)(),i=(t??Promise.resolve()).then((()=>n.promise));this._pendingOperation=i,this._updatingHandles.addPromise(i);try{t&&await t,await e()}finally{n.resolve(),i===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};(0,i._)([(0,s.MZ)()],u.prototype,"data",void 0),(0,i._)([(0,s.MZ)()],u.prototype,"hasNextStep",null),(0,i._)([(0,s.MZ)()],u.prototype,"hasPreviousStep",null),(0,i._)([(0,s.MZ)()],u.prototype,"onCommit",void 0),(0,i._)([(0,s.MZ)()],u.prototype,"reliesOnOwnerAdminPrivileges",null),(0,i._)([(0,s.MZ)()],u.prototype,"hasInvalidFormTemplate",null),(0,i._)([(0,s.MZ)()],u.prototype,"shouldShowAttachments",null),(0,i._)([(0,s.MZ)()],u.prototype,"shouldAllowAttachmentEditing",null),(0,i._)([(0,s.MZ)()],u.prototype,"started",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],u.prototype,"stepId",null),(0,i._)([(0,s.MZ)()],u.prototype,"steps",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,s.MZ)()],u.prototype,"helpMessage",null),(0,i._)([(0,s.MZ)()],u.prototype,"hasPendingEdits",null),(0,i._)([(0,s.MZ)()],u.prototype,"keyboardCancellationEnabled",null),(0,i._)([(0,s.MZ)()],u.prototype,"updating",null),u=(0,i._)([(0,l.$)("esri.widgets.Editor.Workflow")],u);const d=u},89646:(e,t,n)=>{n.d(t,{$h:()=>y,Ef:()=>F,IP:()=>m,P1:()=>_,hF:()=>I,jQ:()=>v,rT:()=>M,rZ:()=>i,uR:()=>w});var i,a,r=n(73582),o=n(24648),s=n(31633),l=n(19555),c=n(72745),u=n(20664),d=n(9392),p=n(14487),h=n(7137),f=n(80963);function y(e,t){if(null==e||null==t)return;const n=g(e,t);return null!=n?(0,o.Wq)(n,"radians","geographic"):void 0}(a=i||(i={})).Absolute="absolute",a.Relative="relative",a.RelativeBilateral="relative-bilateral";const g=(()=>{const e=(0,d.vt)(),t=(0,d.vt)();return(n,i)=>((0,u.i)(e,n.x,n.y,n.z??0),(0,u.i)(t,i.x,i.y,i.z??0),m(e,t,n.spatialReference,i.spatialReference))})(),m=(()=>{const e=(0,c.vt)(),t=(0,d.vt)(),n=(0,d.vt)();return(i,a,r,o)=>{if((0,u.p)(i,a))return;const d=(0,h.geodesicCompatibleSpatialReference)(r),y=(0,h.geodesicCompatibleSpatialReference)(o);if(d&&y&&(0,f.aI)(d,y)&&(0,p.F)(i,r,t,d)&&(0,p.F)(a,o,n,y)){const{azimuth:e}=(0,h.inverseGeodeticSolver)(T,t,n,d);return null!=e?(0,s.oU)(e,"degrees","radians"):void 0}e[0]=a[0]-i[0],e[1]=a[1]-i[1];let g=(0,l.g7)(c.JP,e);return e[0]<0&&(g=A-g),g}})();function w(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Absolute;if(t&&n)switch(a){case i.Absolute:return y(t,n);case i.Relative:return v(b(e,t,n),i.Relative);case i.RelativeBilateral:return v(b(e,t,n),i.RelativeBilateral)}}function b(e,t,n){if(!e||!t||!n)return;const i=g(e,t),a=g(t,n);return null!=i&&null!=a?(0,o.Wq)(a-i,"radians","geographic"):void 0}function v(e,t){if(null!=e)switch(t){case i.Absolute:return _(e);case i.Relative:{const t=I(e);let n=E.normalize(t,0,!0);return-180===n&&(n=180),(0,o.Wq)(n,"degrees","geographic")}case i.RelativeBilateral:{const t=I(e),n=Math.abs(E.normalize(t,0,!0));return(0,o.Wq)(n,"degrees","geographic")}}}function _(e){const t=I(e),n=x.normalize(t,0,!0);return(0,o.Wq)(n,"degrees","geographic")}const M=(()=>{const e=(0,d.vt)();return function(t,n,i,a,r){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,u.c)(e,n);const c=I(r);if("geodesic"===l){const r=(0,h.geodesicCompatibleSpatialReference)(i);if(r&&(0,p.F)(e,i,e,r))return(0,h.directGeodeticSolver)(t,e,c,a,r),t[2]=n[2],!!(0,p.F)(t,r,t,i)}const d=(0,o.g2)(c,"geographic","arithmetic"),f=(0,s.oU)(d,"degrees","radians"),y=n[0]+a*Math.cos(f),g=n[1]+a*Math.sin(f),m=n[2];return(0,u.i)(t,y,g,m),!0}})();function I(e){if(null!=e)return(0,o.g2)(S(e),e.rotationType,"geographic")}function F(e){if(null!=e)return(0,o.g2)(S(e),e.rotationType,"arithmetic")}function S(e){return(0,s.oU)(e.value,e.unit,"degrees")}const T=new h.InverseGeodeticSolverResult,A=2*Math.PI,x=r.ie,E=new r.hr(-180,180)},90992:(e,t,n)=>{n.d(t,{E5:()=>s,JU:()=>o,Of:()=>a,Uk:()=>r,WK:()=>l,g7:()=>c,lO:()=>u,lQ:()=>d});var i=n(50076);function a(e){return e&&"function"==typeof e.highlight}function r(e){return e&&"function"==typeof e.maskOccludee}function o(e,t,n){return null==e||e>=n&&(0===t||e<=t)}function s(e,t){if(t&&e){const{minScale:n,maxScale:i}=e;if(l(n,i))return o(t,n,i)}return!0}function l(e,t){return null!=e&&e>0||null!=t&&t>0}function c(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}function u(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatures"in e&&"layer"in e&&"view"in e}function d(e,t,n){return new i.default("layerview:spatial-reference-incompatible",`The spatial reference of this ${e}${t?`(wkid:${t})`:""} is incompatible with the spatial reference of the view${n?`(wkid:${n})`:""}.`,{})}},94277:(e,t,n)=>{function i(e,t,n){if(null==e)return"noTool";switch(e){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function(e,t){const n=null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0;return"freehand"===t?n<2?"freehandStart":"freehandEnd":n<2?"polylineZeroVertices":"polylineOneVertex"}(t,n);case"polygon":return function(e,t){const n=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(n<4)return"freehand"===t?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(t,n);case"rectangle":case"circle":return function(e,t){if((null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(t,n);default:return}}n.d(t,{$:()=>i})},95327:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(35143),a=n(91967),r=n(46053),o=(n(81806),n(76460),n(47249),n(85842));let s=class extends a.default{constructor(e){super(e),this.enabled=!1}};(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],s.prototype,"enabled",void 0),s=(0,i._)([(0,o.$)("esri.views.interactive.sketch.SketchLabelOptions")],s);const l=s},95600:(e,t,n)=>{n.d(t,{bn:()=>be,nv:()=>Fe,ON:()=>Se,Xm:()=>q,z4:()=>we,Zs:()=>le,mU:()=>ue,Z5:()=>se,nc:()=>ae,sE:()=>Ae,_3:()=>Ee,uh:()=>Q,EH:()=>Y,EO:()=>U,Ks:()=>Me,bl:()=>D,sy:()=>ee,r8:()=>_e,O:()=>xe,vM:()=>fe,Pi:()=>$,cY:()=>pe,Pz:()=>Te,AP:()=>W,J_:()=>de,z7:()=>ye,FC:()=>j,EA:()=>he,QZ:()=>Ie});var i=n(69539),a=n(39356),r=n(18690),o=n(98773),s=(n(81806),n(50076)),l=n(54901),c=n(53084),u=n(76460),d=n(87663),p=n(50346),h=n(68134),f=n(76931),y=n(15011),g=n(5600),m=n(49750),w=n(66830),b=n(63733),v=n(53430),_=n(31933),M=n(4955),I=n(3454),F=n(4815),S=n(15492),T=n(86875),A=n(38996),x=n(76940),E=n(87708),k=n(8503),P=n(5874),Z=n(52447),V=n(56061),C=n(55754),O=n(53787);function L(e,t){const n={};t=t||{continueOnCircularDependency:!1};const i=[],a={};e.forEach((e=>{const t=e[0];let i;(i=n[t])||(i=n[t]=new R(t)),e.forEach((e=>{e!==t&&(n[e]||(n[e]=new R(e)),i.afters.push(e))}))}));const r=Object.keys(n);return r.sort(H),r.forEach((function e(r,o){const s=n[r],l=s.id;if(a[r])return;const c=Array.isArray(o)?o:[];c.push(l),a[r]=!0,s.afters.sort(H),s.afters.forEach((n=>{if(c.includes(n)){if(t?.continueOnCircularDependency)return;throw new Error("Circular chain found: "+l+" must be before "+n+" due to a direct order specification, but "+n+" must be before "+l+" based on other specifications.")}e(n,c.slice())})),i.push(l)})),i.reverse()}class R{constructor(e){this.id=e,this.afters=[]}}function H(e,t){return e<t?1:e>t?-1:0}var N=n(21270);const z=()=>u.A.getLogger("esri.widgets.Editor.workflowUtils");function D(e){return"update"===e.type}function U(e){const t=e.sourceLayer;if(!t||"feature"!==t.type||!function(e){switch(e?.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}(t.renderer))return{rotation:null,size:null};let i=null,a=null;const r=t.renderer.getVisualVariablesForType("rotation").filter((t=>(!t.axis||"heading"===t.axis)&&t.field&&!t.valueExpression&&null!=(0,S.getRotationAngle)(t,e)));1===r.length&&(i=function(e,t){const n="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,i=e.field,a=t.fields&&t.fields.filter((e=>e.name===i)),r=a&&1===a.length?a[0].type:"double",o={initial:0,current:0};return{field:i,fieldType:r,getDefault:()=>Promise.resolve(0),getValue:e=>(o.current=o.initial-n*e,G((o.current+360)%360,r)),setInitialValue:e=>{o.initial=e,o.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}(r[0],t));const o=t.renderer.getVisualVariablesForType("size").filter((t=>t.field&&!t.useSymbolValue&&!t.valueExpression&&(0,F.KZ)(t)===F._w.RealWorldSize&&null!=(0,S.getSize)(t,e)));return 1===o.length&&(a=function(e,t){const i=e.field,a=e.axis,r=t.fields&&t.fields.filter((e=>e.name===i)),o=r&&1===r.length?r[0].type:"double",s={initial:0,current:0},l=I.j[e.valueUnit]??1;let c;return c="area"===e.valueRepresentation?e=>(e*l/2)**2*Math.PI:"radius"===e.valueRepresentation||"distance"===e.valueRepresentation?e=>e*l/2:e=>e*l,{field:i,fieldType:o,getDefault:async(e,t)=>G(c(await async function(e,t,i){if(null==t)return 0;const{symbol:a}=(0,E.t)(t);if(null==a||"web-style"===a.type||"cim"===a.type)return 0;const r=a.symbolLayers.at(0);if(!r)return 0;switch(r.type){case"icon":{const{computeIconLayerResourceSize:e}=await n.e(44374).then(n.bind(n,44374));return r.size||Math.min(me.icon,(await e(r,me.icon))[0])||me.icon}case"text":return r.size||me.text;case"line":return r.size||me.line;case"object":{const{computeObjectLayerResourceSize:t}=await n.e(44374).then(n.bind(n,44374));return function(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}(await t(r,e.scale/me.viewScaleSizeFactor),i)}case"path":return(null!=r.width?r.width:r.height)||e.scale/me.viewScaleSizeFactor;case"extrude":return r.size||e.scale/me.viewScaleSizeFactor;default:return 0}}(t,e,a)),o),getValue:(e,t)=>(s.initial||(s.initial=t.pixelSizeAt(t.center)),s.current=s.initial*e,G(s.current,o)),setInitialValue:e=>{s.initial=e,s.current=0},isUpdatingInteractively:!1,displayUnit:ve(e.valueUnit),axis:e.axis}}(o[0],t)),{rotation:i,size:a}}function G(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}async function j(e,t,n){const i=await(0,k.getDisplayedSymbol)(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:n});null!=(0,y.Ui)(e.symbol,i)&&(e.symbol=i)}function q(e,t){if(!e||!t)throw new Error("no geometry type");if("multipatch"===e)return{tool:"mesh",createOptions:{mode:"hybrid"}};const n=new Map;n.set("circle",{mode:"freehand"}),n.set("rectangle",{mode:"freehand"});const i={mode:V.t,optionsPerTool:n};if((0,g.w2)(t)){const a=t.defaultTool,r=(0,g.Dt)(t)?t.definition?.inputGeometryType??e:e;switch(a){case"freehand":case"stream-line":return{tool:"polyline"===r?"freehandPolyline":"freehandPolygon",createOptions:i};case"autocomplete-freehand-polygons":case"stream-polygon":return{tool:"freehandPolygon",createOptions:i};case"autocomplete-polygons":case"difference-polygon":case"create-structures":case"polygon":case"trace":return{tool:"polygon"===r?"polygon":"polyline",createOptions:i};case"circle":return n.get("circle").preserveAspectRatio=!0,{tool:"circle",createOptions:i};case"ellipse":return n.get("circle").preserveAspectRatio=!1,{tool:"circle",createOptions:i};case"create-points-along-line":case"multipoint":return{tool:"multipoint",createOptions:i};case"line":case"radial-line":case"right-angle-line":case"split":case"two-point-line":return{tool:"polyline",createOptions:i};case"rectangle":case"regular-polygon":case"right-angle-polygon":return{tool:"rectangle",createOptions:i};case"elevation-point-from-contour":case"elevation-point-from-dem":case"parcel-seed":case"point":case"point-and-rotation":case"point-at-end-of-line":return{tool:"point",createOptions:i}}}else{const a=t.drawingTool;if("circle"===a||"ellipse"===a)return n.get("circle").preserveAspectRatio="circle"===a,{tool:"circle",createOptions:i};if("rectangle"===a)return{tool:"rectangle",createOptions:i};if("freehand"===a)return{tool:"polygon"===e?"freehandPolygon":"freehandPolyline",createOptions:i}}return{tool:e,createOptions:i}}async function W(e,t,n){const{creationInfo:i,fullTemplate:a}=t;if(!i)throw new s.default("No creation info provided.");const r=i.layer,o=ae(a,i.attributeOverrides),{view:l}=e,c="2d"===l?.type;(0,g.Dt)(a)||(0,g.JC)(a)||await re(e,r,o,n,c?l.scale:null);const{capabilities:u}=r;e.layer.elevationInfo=r.elevationInfo;const d=q(r.geometryType,a);e.defaultCreateOptions={graphicProperties:{attributes:o,sourceLayer:r},mode:d.createOptions.mode,optionsPerTool:d.createOptions.optionsPerTool,preserveAspectRatio:d.createOptions.preserveAspectRatio,hasZ:u.data.supportsZ,defaultZ:(c?u.editing.zDefault:null)??e.defaultCreateOptions.defaultZ},null==i.geometryToPlace?await e.create(d.tool):await e.place(i.geometryToPlace,{graphicProperties:{attributes:o,sourceLayer:r}})}async function $(e){return(0,l.vE)([await B(e),await J(e)])}async function B(e){let{creationAttributes:t,data:n,sketchViewModel:i,view:a,webStyleCache:r}=e;const{creationInfo:o}=n,{fullTemplate:s}=n;if(!o||"2d"!==a?.type||(0,g.Dt)(s)||(0,g.JC)(s))return null;const l=(0,p.debounce)((e=>re(i,o.layer,t,r,e)));return(0,h.watch)((()=>a.scale),(e=>l(e)))}async function J(e){let{data:t,sketchViewModel:n,view:a}=e;const{templateExecutorInfo:o}=t;if(!o)return null;const c=n.activeComponent;if(!a||!(0,N.xJ)(c))return z().error(new s.default("Failed to set up template feedback.")),null;const u=new b.default({effect:"saturate(0.6) opacity(0.8)",listMode:"hide",title:"Shared Template Feedback Graphics"});a.map?.add(u);const{executor:d,serviceLayersById:f}=o,y=a.theme?.accentColor??new i.default([255,165,0,1]);return(0,l.vE)([(0,h.on)((()=>c),["cursor-update","vertex-add"],(()=>{u.removeAll();const e=c.graphic?.geometry;if(!e||!function(e){switch(e.type){case"point":case"multipoint":return!0;case"polyline":return e.paths[0].length>1;case"polygon":{const t=e.rings[0];return(0,r.aI)(t.at(0),t.at(-1))?t.length>2:t.length>1}default:return!1}}(e))return;const t=d(e,"digitizing");if(!(0,p.isPromiseLike)(t))for(const n of t.edits){const e=f.get(n.id);if(e&&n.addFeatures&&0!==n.addFeatures.length)for(const t of e)if(!t.isTable)for(const e of n.addFeatures){const t=K(e,y);t&&u.add(t)}}})),(0,l.hA)((()=>{a.map.remove(u),u.destroy()}))])}function K(e,t){let n=null;switch(e.geometry?.type){case"point":case"multipoint":n=new x.default({angle:0,color:t,outline:new A.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:1}),path:"undefined",size:8,style:"circle",xoffset:0,yoffset:0});break;case"polygon":n=new T.default({color:t,outline:new A.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:3}),style:"none"});break;case"polyline":n=new A.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:2});break;default:return null}return new a.default({geometry:e.geometry,symbol:n,attributes:{...e.attributes}})}async function Q(e,t){const n=await(0,P.Z)(t).load(),i=(0,_.Sv)(e)?e.parent:e;return n.tablesAndLayersLookup.get(i)}async function Y(e,t){const n=await Q(e,t);if(!n)return new Map;const i=new Map;for(const a of n.layersAndTables)(0,d.tE)(i,a.layerId,(()=>[])).push(a);return i}function X(e){const t=e.objectIdField,n=e.globalIdField??"";return{id:e.layerId,identifierFields:{objectIdField:t,globalIdField:n},addFeatures:[],deleteAttachments:[],addAttachments:[],deleteFeatures:[],updateFeatures:[]}}function ee(e){const{edits:t,serviceInfo:n,view:i,findOriginalFeature:a}=e,o=function(e){const t=new Map;for(const n of e)t.set(n.layerId,n);return t}(n.layersAndTables),l=n.layersAndTables.toArray(),{allEditData:c,editDataByLayerIdMap:u,editDataByIdMap:d}=function(e,t,n){const i=new Map,a=[],r=new Map;let o=1;for(const l of e){const e=[],c=t.get(l.id);if(!c)throw new s.default(`Failed to prepare applyEdits payload. Layer with id ${l.id} not found.`);for(const t of l.addFeatures??[])e.push({uniqueId:"T"+o++,operationType:"add",layer:c,after:t});for(const t of l.deleteFeatures??[])e.push({uniqueId:"T"+o++,operationType:"delete",before:t,layer:c});for(const t of l.deleteAttachments??[])e.push({uniqueId:"T"+o++,operationType:"deleteAttachment",attachmentId:t,layer:c});for(const t of l.addAttachments??[])e.push({uniqueId:"T"+o++,operationType:"addAttachment",attachment:t,layer:c});for(const t of l.updateFeatures??[])e.push({uniqueId:"T"+o++,operationType:"modify",before:n(t),after:t,layer:c});i.set(c.layerId,e);for(const t of e)a.push(t),r.set(t.uniqueId,t)}return{allEditData:a,editDataByIdMap:r,editDataByLayerIdMap:i}}(t,o,a),p=function(e,t,n){const i=[];for(const a of e){const e=a.layer.relationships??[],{uniqueId:r}=a;for(const o of e){const e=o.keyField;if("origin"===o.role){const s=n.get(o.relatedTableId);if(!s||0===s.length)continue;const l=te(a.layer,o),c=t.get(l);if(void 0===c||""===c)continue;switch(a.operationType){case"add":for(const t of s)t!==a&&("add"!==t.operationType&&"modify"!==t.operationType||t.after.attributes[c]===a.after.attributes[e]&&i.push([r,t.uniqueId]));break;case"modify":if(a.before.attributes[e]!==a.after.attributes[e])for(const t of s){const n=t.uniqueId;t!==a&&("delete"===t.operationType?t.before.attributes[c]===a.before.attributes[e]?i.push([n,r]):t.before.attributes[c]===a.after.attributes[e]&&i.push([r,n]):"add"===t.operationType?t.after.attributes[c]===a.after.attributes[e]?i.push([r,n]):t.after.attributes[c]===a.before.attributes[e]&&i.push([n,r]):"modify"===t.operationType&&(t.before.attributes[c]!==t.after.attributes[c]?t.after.attributes[c]===a.after.attributes[e]?i.push([r,n]):i.push([n,r]):i.push([r,n])))}break;case"delete":for(const t of s)t!==a&&("delete"!==t.operationType&&"modify"!==t.operationType||t.before.attributes[c]===a.before.attributes[e]&&i.push([t.uniqueId,r]))}}}}return i}(c,function(e,t){const n=new Map;for(const i of e)for(const e of i.relationships??[])if(n.set(te(i,e),""),t.has(e.relatedTableId)){const a=t.get(e.relatedTableId);if(a.length>0)for(const t of a[0].layer.relationships??[])if(t.id===e.id){n.set(te(i,e),t.keyField);break}}return n}(l,u),u);if(function(e,t,n){const i=[];for(const r of e)ne(r.layer,n)&&i.push(r);if(0===i.length)return;let a=[];for(const r of i){const n=r.layer;switch(r.operationType){case"delete":a=[...ie(r.before.attributes[n.fieldsIndex.get("fromglobalid").name],e),...ie(r.before.attributes[n.fieldsIndex.get("toglobalid").name],e)];for(const e of a)t.push([r.uniqueId,e.uniqueId]);break;case"add":a=[...ie(r.after.attributes[n.fieldsIndex.get("fromglobalid").name],e),...ie(r.after.attributes[n.fieldsIndex.get("toglobalid").name],e)];for(const e of a)t.push([e.uniqueId,r.uniqueId])}}}(c,p,i),0===p.length)return t;const h=L(p,{continueOnCircularDependency:!0}).map((e=>d.get(e))).filter(r.Ru),f=new Map;for(const r of h)f.set(r.uniqueId,r);const y=[];for(const r of c)f.has(r.uniqueId)||y.push(r);const g=[];let m=null;for(const r of h){const{layer:e}=r;switch(null==m?m=X(e):m.id!==e.layerId&&(g.push(m),m=X(e)),r.operationType){case"add":case"modify":m.addFeatures.push(r.after);break;case"delete":m.deleteFeatures.push(r.before)}}null!==m&&g.push(m);for(const r of y){const e=r.layer.layerId,t=g.find((t=>t.id===e))??X(r.layer);switch(g.includes(t)||g.push(t),r.operationType){case"add":t.addFeatures.push(r.after);break;case"modify":t.updateFeatures.push(r.after);break;case"delete":t.deleteFeatures.push(r.before);break;case"deleteAttachment":t.deleteAttachments.push(r.attachmentId);break;case"addAttachment":t.addAttachments.push(r.attachment)}}for(const r of g)void 0!==r.deleteAttachments&&0===r.deleteAttachments.length&&delete r.deleteAttachments,void 0!==r.addAttachments&&0===r.addAttachments.length&&delete r.addAttachments;return g}function te(e,t){return`${e.layerId}:${t.id}`}function ne(e,t){return!!(t?.map&&"utilityNetworks"in t.map&&t.map.utilityNetworks?.length&&t.map.utilityNetworks.some((t=>!(!t.loaded||!e.url?.startsWith(t.featureServiceUrl)||e.layerId!==t.networkSystemLayers.associationsTableId))))}function ie(e,t){const n=[],i=t.filter((e=>{let{layer:t}=e;return""!==t.globalIdField&&null!=t.globalIdField}));for(const a of i){const t=a.layer.globalIdField;("before"in a&&a.before?.attributes[t]===e||"after"in a&&a.after?.attributes[t]===e)&&n.push(a)}return n}function ae(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.Dt)(e)||(0,g.JC)(e)?{}:(0,g.gZ)(e)?{...e.prototype.attributes,...t}:(0,g.Cq)(e)?{...e.definition?.defaultValues,...t}:{...t}}async function re(e,t,n,i,r){const o=new a.default({sourceLayer:t,attributes:n}),{rotation:s,size:l}=U(o);let c=await(0,k.getDisplayedSymbol)(o,{useSourceLayer:!0,webStyleCache:i,scale:r}),u=!1;for(const a of[l,s])null!=a&&null==n[a.field]&&(n[a.field]=await a.getDefault(c,e.view),u=!0);switch(u&&(c=await(0,k.getDisplayedSymbol)(o,{useSourceLayer:!0,webStyleCache:i,scale:r})),c?.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=c;break;case"simple-line":case"line-3d":e.polylineSymbol=c;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=c;break;case"mesh-3d":e.meshSymbol=c}oe(e.tooltipOptions,l,s)}function oe(e,t,n){e.visualVariables=null!=t||null!=n?{size:null!=t?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:null!=n?{valueType:n.fieldType,rotationType:n.rotationType??"geographic"}:null}:null}function se(e,t){return e?.find((e=>e.layer===t))}async function le(e,t,n,i){switch(t.type){case"3d":return async function(e,t,n,i){if(0===e.length)return[];const{updatable:a,graphicsByLayer:o}=await n.async((async()=>{const{results:a}=await(0,p.whenOrAbort)((0,O.oZ)(t,n),i),r=new Map,o=e=>{const t=e.layer,n=r.get(t);if(!n){const e=new Array;return r.set(t,e),e}return n};(0,O.h$)(a).forEach((e=>{let{graphic:t}=e;return o(t).push(t)}));const s=e.filter((e=>{let{capabilities:t,layer:n}=e;return t.update.enabled&&r.has(n)}));return 0!==s.length&&n.stopPropagation(),{updatable:s,graphicsByLayer:r}}));return(0,p.whenOrAbort)(Promise.allSettled(a.map((async e=>{let{layer:t}=e;const n=o.get(t),a=ce(t);if(n.every((e=>(0,v.featureHasFields)(a,e))))return n;const s=[];for(const i of n){s.push(i.getObjectId());const e=Object.keys(i.attributes);(0,r.FB)(a,e)}const l=t.createQuery();return l.returnGeometry=!1,l.objectIds=s,l.outFields=(0,v.fixFields)(t.fieldsIndex,a),t.queryFeatures(l,{signal:i}).then((e=>{let{features:t}=e;return t}))}))),i)}(e,t,n,i);case"2d":return async function(e,t,n,i){if(0===e.length)return[];const{mapPoint:a}=n;if(null==a)return[];let r=null;const o=await n.async((async()=>{const{results:a}=await(0,p.whenOrAbort)(t.hitTest(n),i);if(0===a.length)return[];const o=new Set;r=(0,O.h$)(a),r.forEach((e=>{let{graphic:t}=e;return t&&o.add(t.layer)}));const s=e.filter((e=>o.has(e.layer)&&e.supportsUpdateWorkflow));return s.length>0&&n.stopPropagation(),s}));return(0,p.whenOrAbort)(Promise.allSettled(o.map((async e=>{let{layer:o}=e;const s=o.createQuery();s.returnGeometry=!0,s.outFields=ce(o);const l="renderer"in o?(0,M.o)({renderer:o.renderer,pointerType:n.pointerType}):0;s.geometry=(0,C.V)(a,l,t),s.outSpatialReference=t.spatialReference;const{features:c}=await o.queryFeatures(s,{signal:i});return r?.forEach((e=>{let{graphic:t}=e;t.layer!==o||c.some((e=>e.getObjectId()===t.getObjectId()))||c.push(t)})),c}))),i)}(e,t,n,i)}}function ce(e){return(0,v.fixFields)(e.fieldsIndex,[e.objectIdField,(0,v.getDisplayFieldName)({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function ue(e,t,n){const{sourceLayer:i}=e,a=i.createQuery();a.objectIds=[e.getAttribute(i.objectIdField)],a.outFields=["*"],a.returnM=i.capabilities.data.supportsM,a.returnZ=i.capabilities.data.supportsZ,"scene"===i.type&&null!=i.infoFor3D||(a.outSpatialReference=t);const r=await i.queryFeatures(a,{signal:n});return(0,p.throwIfAborted)(n),r.features[0]}async function de(e){const{graphic:t,sketchViewModel:n,sourceLayer:i,visualVariables:a}=e;await pe(e);const r={multipleSelectionEnabled:!1};return"point"===i.geometryType&&(r.enableRotation=null!=a.rotation,r.enableScaling=null!=a.size),n.update(t,r)}async function pe(e){const{graphic:t,sketchViewModel:n,sourceLayer:i,visualVariables:a,webStyleCache:r}=e;let o=!1;const{rotation:s,size:l}=a;if([s,l].forEach((async e=>{if(null==e)return;const i=t.getAttribute(e.field);if(null!=i)e.setInitialValue(i);else{const i=await e.getDefault(t.symbol,n.view);e.setInitialValue(i),t.setAttribute(e.field,i),o=!0}})),o){const e="2d"===n.view?.type?n.view.scale:null;await j(t,r,e)}oe(n.tooltipOptions,l,s),n.layer.elevationInfo=i.elevationInfo}async function he(e,t,n,i,a){if(null==t.geometry||"point"!==t.geometry?.type)return;const r=i.rotation,o=function(e){return null==e||"rotate-start"!==e.type&&"rotate"!==e.type&&"rotate-stop"!==e.type?null:e}(n.toolEventInfo);if(null!=r&&null!=o){const{field:n,getValue:i}=r;"rotate-stop"===o.type?(r.isUpdatingInteractively=!1,r.setInitialValue(t.getAttribute(n))):(r.isUpdatingInteractively=!0,t.setAttribute(n,i(o.angle,e)))}const s=i.size,l=function(e){return null==e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}(n.toolEventInfo);if(null!=s&&null!=l){const{field:n,getValue:i}=s;"scale-stop"===l.type?(s.isUpdatingInteractively=!1,s.setInitialValue(t.getAttribute(n))):(s.isUpdatingInteractively=!0,t.setAttribute(n,i(l.xScale,e)))}await j(t,a,"2d"===e.type?e.scale:null)}async function fe(e){let{feature:t,featureClone:n,visualVariableAttributes:i,sketchViewModel:a,view:r,onUpdate:o,webStyleCache:s,addUpdatingPromise:c,addHandle:u}=e;await j(n,s,"2d"===r.type?r.scale:null);let d=null;if("2d"===a?.view?.type){const e=(0,p.debounce)((e=>j(n,s,e)));d=(0,h.watch)((()=>a?.view?.scale),(t=>e(t)))}const f=n.sourceLayer,y=Ie(r,f);await de({graphic:n,sketchViewModel:a,sourceLayer:f,visualVariables:i,webStyleCache:s});let g=null;y.then((e=>g=e)).catch((()=>{}));const m=i.size,w=i.rotation,b=(0,h.watch)((()=>t.attributes),(async e=>{let t=!1;for(const i in e){const a=e[i];a!==n.getAttribute(i)&&(n.setAttribute(i,a),null==m||m.isUpdatingInteractively||m.field!==i||m.setInitialValue(a),null==w||w.isUpdatingInteractively||w.field!==i||w.setInitialValue(a),(null==g||g.requiredFields.includes(i))&&(t=!0))}t&&await j(n,s,"2d"===r.type?r.scale:null)})),v=a.on("update",(async e=>{const t=e.graphics[0],n={graphic:t,sketchViewModel:a,sourceLayer:f,visualVariables:i,webStyleCache:s};if("complete"===e.state){if(null===r.activeTool)return de(n);const e=new AbortController,t=(0,l.rE)(e);return u(t),c((0,h.whenOnce)((()=>null===r.activeTool),e.signal).then((()=>(e.abort(),de(n)))))}await he(r,t,e,i,s),o(Se(t),e)})),_=a.on(["undo","redo"],(async e=>{o(Se(e.graphics[0]),e)}));return(0,l.vE)([_,v,(0,l.hA)((()=>a.cancel())),b,d])}async function ye(e,t,n){const i=e.view;e.layer.add(n);const a=t.sourceLayer,r=t.layer,s=t.getAttribute(r.objectIdField);let c=null;function u(e){c?.abort(),c=(0,o.UT)((async t=>{const n=await Ie(i,a);(0,p.throwIfAborted)(t),n.setVisibility?.(s,e)}))}return await async function(e,t){if("3d"===e.type){const n=new Z.y({graphic:t}),i=e.trackGraphicState(n);await(0,h.whenOnce)((()=>n.displaying||n.error)),i.remove()}else await(0,h.whenOnce)((()=>t.visible))}(i,n),u(!1),(0,l.vE)([ge(i,n,(e=>u(!e))),(0,l.hA)((async()=>{u(!0);try{const e=await Ie(i,a);await(0,h.whenOnce)((()=>!e.updating))}finally{e.layer.remove(n)}}))])}function ge(e,t,n){if("3d"===e.type){const i=new Z.y({graphic:t});return(0,l.vE)([e.trackGraphicState(i),(0,h.watch)((()=>i.displaying),n)])}return(0,h.watch)((()=>t.visible),n)}const me={icon:(0,f.PN)(24),text:(0,f.PN)(12),line:(0,f.PN)(1),viewScaleSizeFactor:100};function we(e,t,n){let i=!1;return e.filter((e=>!!i||(i=e===t,i))).map((e=>n[e]()))}function be(e,t){e.viewModel.syncFeatureTemplates();const n=e.creationInfo;if("awaiting-feature-creation-info"===t[0].id&&n){const i=n.layer,a=e.viewModel.getTemplatesForLayer(i);1===a.length&&"scene"!==i.type&&(n.template=a[0],t.shift())}return t}function ve(e){return"unknown"===e?null:e}function _e(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const Me=e=>/-stop/.test(e)||/vertex-/.test(e),Ie=(e,t)=>{const n="subtype-sublayer"===t.type?t.parent:t;return e.whenLayerView(n)};function Fe(e){return"createInteractiveEditSession"in e}function Se(e){const t=e.geometry;if("mesh"===t?.type){const n=e.cloneShallow();return n.attributes=(0,c.clone)(e.attributes),n.geometry=t.cloneShallow(),n.geometry.transform=t.transform?.clone()??null,n}return e.clone()}function Te(e){const t=e.cursor;return e.cursor="progress",(0,l.hA)((()=>e.cursor=t))}async function Ae(e,t){const{template:n}=e;if(null==n)return null;if((0,g.Sf)(n))return n.load();if((0,g.w2)(n)){const e=(0,w.B)(t,{makeSharedTemplateFromJSON:ke}),i=await e.getTemplates({templateIds:[n.templateId],featureService:n.featureService});if(0===i.length)throw new s.default("editor:failed-to-load-template","Unable to load the provided template");return i[0].load()}return n}function xe(e){for(const t of e){const{destinationGraphic:e,destinationField:n,sourceGraphic:i,sourceField:a}=t;e.setAttribute(n,i.getAttribute(a))}}function Ee(e){const t=e.templateExecutorInfo?.completionResults;return t?.length?(t.forEach((e=>xe(e.relationships))),t.flatMap((e=>e.edits))):null}const ke=e=>m.default.fromJSON(e)},99791:(e,t,n)=>{var i;n.d(t,{n:()=>i}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))}}]);
//# sourceMappingURL=55865.46ea6b1a.chunk.js.map