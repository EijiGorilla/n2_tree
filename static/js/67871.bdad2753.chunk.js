"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[67871],{12482:(e,t,n)=>{n.d(t,{$7:()=>E,B:()=>A,Fo:()=>O,M7:()=>T,NN:()=>d,Q5:()=>b,Tq:()=>z,Up:()=>w,XF:()=>S,Ze:()=>m,bK:()=>a,bh:()=>f,id:()=>x,ky:()=>u,qt:()=>N,tW:()=>R,v9:()=>h,w7:()=>l,wF:()=>s,wS:()=>_,wz:()=>g,x:()=>p,xS:()=>y,ze:()=>c});var r=n(31633),i=n(59097);function o(e){return e?N:z}function s(e,t){return t?.mode?t.mode:o(e).mode}function a(e,t){return null!=t?t:o(e)}function l(e,t){return s(null==e||(e.hasZ??!1),t)}function c(e,t){return a(null==e||(e.hasZ??!1),t)}function u(e){const t=v(e);return l(e.geometry,t)}function f(e){const t=v(e),n=l(e.geometry,t),r=null!=t&&"on-the-ground"!==n?T(t):0,i=t?.featureExpressionInfo;return{mode:n,offset:r,featureExpressionInfo:i}}function d(e){return g(f(e))}function h(e){return g(e)||p(e)}function p(e){return"0"===e?.featureExpressionInfo?.expression}function g(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function v(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function m(e,t){if(!e?.offset)return 0;const{offset:n,unit:i}=e;if("decimal-degrees"===i)return 0;const o="unknown"!==i&&i?i:"meters",s=(0,r.mq)(t);return s?(0,r.oU)(n,o,s):0}function x(e,t,n){if(!n?.mode)return;const r=e.hasZ?e.z:0,i=m(n,e.spatialReference);switch(n.mode){case"absolute-height":return r-i;case"on-the-ground":return 0;case"relative-to-ground":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"ground")??0)+i);case"relative-to-scene":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"scene")??0)+i)}}function _(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return O(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,r)}function y(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return O(e,t[0],t[1],t.length>2?t[2]:0,n,r,i)}function O(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==o)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=b(t,n,r,i,e,o);return function(e,t,n,r,i,o,s,a){const l=m(s,i);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((o.elevationProvider.getElevation(t,n,r,i,"ground")??0)+l);case"relative-to-scene":return e-((o.elevationProvider.getElevation(t,n,r,i,"scene")??0)+l)}}(l,t,n,r,i,e,s,a)}function b(e,t,n,r,i,o){const s=m(o,r);switch(o.mode){case"absolute-height":return{absoluteZ:n+s,elevation:0};case"on-the-ground":{const n=i.elevationProvider.getElevation(e,t,0,r,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const o=i.elevationProvider.getElevation(e,t,n,r,"ground")??0;return{absoluteZ:n+o+s,elevation:o}}case"relative-to-scene":{const o=i.elevationProvider.getElevation(e,t,n,r,"scene")??0;return{absoluteZ:n+o+s,elevation:o}}}}function w(e,t){if(null==t)return!1;const{mode:n}=t;return null!=n&&("scene"===e&&"relative-to-scene"===n||"ground"===e&&"absolute-height"!==n)}function A(e,t,n){return n&&n.mode!==t?`${e} only support ${t} elevation mode`:null}function E(e,t,n){return n?.mode===t?`${e} do not support ${t} elevation mode`:null}function R(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function S(e,t){t&&e.warn(".elevationInfo=",t)}function T(e){return(e?.offset??0)*(0,i.Ao)(e?.unit)}const N={mode:"absolute-height",offset:0},z={mode:"on-the-ground",offset:null}},14239:(e,t,n)=>{n.d(t,{N:()=>c});var r=n(4212),i=n(16506),o=n(59246),s=n(80517),a=n(84093),l=n(34781);class c extends o.w{constructor(e,t){super(e,t,new i.$(s.a,(()=>n.e(71043).then(n.bind(n,71043)))))}initializePipeline(e){switch(e.blitMode){case a.d.None:case a.d.Depth:return(0,l.Ey)({colorWrite:l.kn});case a.d.Alpha:return(0,l.Ey)({blending:l.Ky,colorWrite:l.kn});default:(0,r.Xb)(e.blitMode);case a.d.PremultipliedAlpha:case a.d.COUNT:return(0,l.Ey)({blending:l.Os,colorWrite:l.kn})}}}},14487:(e,t,n)=>{n.d(t,{F:()=>o});n(9624);var r=n(13312),i=n(64232);function o(e,t,n,r,o){return!(null==t||null==r||e.length<2)&&(s.x=e[0],s.y=e[1],s.z=e[2],s.spatialReference=t,(0,i.g)(s,n,r,o))}const s=(0,n(18117).T)(0,0,0,r.default.WGS84)},18117:(e,t,n)=>{function r(e,t,n,r){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:r,type:"point"}}function i(e,t,n,r,i){e.x=t,e.y=n,e.z=r,e.hasZ=null!=r,e.spatialReference=i}n.d(t,{J:()=>i,T:()=>r})},21255:(e,t,n)=>{n.d(t,{DC:()=>s,MQ:()=>a,mi:()=>l});var r=n(3112),i=n(35737),o=n(46571);function s(e){return(0,o.i3)(e)&&e.intersector===r.dz.TERRAIN&&!!e.target}class a extends i.R6{constructor(e,t,n){super(e,t),this.triangleNr=n}}function l(e){return(0,o.i3)(e)&&e.intersector===r.dz.OVERLAY&&!!e.target}},21812:(e,t,n)=>{n.d(t,{_:()=>r});class r{constructor(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=e,this.count=t,this.type=n,this.offset=r,this.stride=i,this.normalized=o,this.divisor=s}}},25530:(e,t,n)=>{n.d(t,{G:()=>c,V:()=>f});var r=n(43047),i=n(55855),o=n(69817),s=n(3799),a=n(58350),l=n(86955);function c(e,t){const n=e.vertex;t.hasVerticalOffset?(f(n),t.hasScreenSizePerspective&&(e.include(o.Y6),(0,o.OH)(n),(0,s.yu)(e.vertex,t)),n.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):n.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,i.vt)();function f(e){e.uniforms.add(new a.E("verticalOffset",((e,t)=>{const{minWorldLength:n,maxWorldLength:i,screenLength:o}=e.verticalOffset,s=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,r.s)(u,o*a,s,n,i)})))}},27963:(e,t,n)=>{n.d(t,{Ir:()=>u});var r=n(19555),i=n(72745),o=n(43047),s=n(55855),a=n(28450),l=n(51596),c=n(86955);function u(e){e.fragment.uniforms.add(new l.I("projInfo",(e=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,o.s)(f,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,o.s)(f,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(e.camera)))),e.fragment.uniforms.add(new a.E("zScale",(e=>0===e.camera.projectionMatrix[11]?(0,r.hZ)(d,0,1):(0,r.hZ)(d,1,0)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const f=(0,s.vt)();const d=(0,i.vt)()},30310:(e,t,n)=>{n.d(t,{FI:()=>h,FV:()=>f,Gy:()=>d,QS:()=>m,SM:()=>v});var r=n(34761),i=n(9392),o=n(42294),s=n(78315),a=n(45270),l=n(21255),c=n(46571),u=n(71488);function f(e,t){return(0,c.$I)(e)||(0,c.hH)(e)?g(e.target?.object,t):(0,l.DC)(e)?t.map?.ground:(0,a.rb)(e)||(0,a.db)(e)||(0,l.mi)(e)||(0,a.Q5)(e)?g(e.target,t):null}function d(e,t){const n=h(e,t);return null!=n&&"graphic"===n.type?n.graphic:null}function h(e,t){if(null==e)return null;if((0,c.$I)(e)||(0,c.hH)(e))return p(e.target?.object,t);if((0,a.rb)(e)){const t=e.target.createGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.Q5)(e)){const t=e.target.createVoxelGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.W3)(e)){const t=e.target.createTiles3DGraphic();return{type:"graphic",graphic:t,layer:t.layer}}return(0,l.mi)(e)||(0,u.H)(e)?p(e.target,t):(0,a.db)(e)?function(e,t){const n=g(e,t);if(null==n)return null;const r=t.allLayerViews.find((e=>e.layer===n));return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?function(e){return null!=e?{type:"graphic",graphic:e,layer:e.layer}:null}(r.getGraphicFromIntersectorTarget(e)):null}(e.target,t):null}function p(e,t){if(null==e?.graphicUid)return null;const n=g(e,t);if(null==n)return null;if(n===t.graphics)return null==t.graphicsView||"number"!=typeof e.graphicUid?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find((e=>e.layer===n));return!r||r.suspended||null==e.graphicUid?null:"getHit"in r?r.getHit(e.graphicUid):null}function g(e,t){return null==e?.layerUid?null:null!=t.graphicsView&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.allLayers.find((t=>t.uid===e.layerUid))}function v(e,t){if((0,c.$I)(e)||(0,c.hH)(e))return(0,s.g)(e.target.object.boundingVolumeWorldSpace.bounds);if((0,u.H)(e)){(0,r.IL)(x,e.transformation);const t=Math.max(x[0],x[1],x[2]);return e.target.baseBoundingSphere.radius*t}if((0,a.db)(e)){const n=function(e,t){const n=g(e,t);if(null==n)return null;const r=t.allLayerViews.find((e=>e.layer===n));return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}(e.target,t);return n?.5*(0,o._F)(n):null}return null}function m(e){return!(0,c.$I)(e)&&!(0,c.hH)(e)&&((0,u.H)(e)?e.target.numLodLevels>1:!!(0,a.db)(e))}const x=(0,i.vt)()},35202:(e,t,n)=>{n.d(t,{G:()=>a});var r=n(80517),i=n(14239),o=n(84093),s=n(93345);class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.d.None;this._techniques=e,this._parameters=new r.C,this._configuration=new o.N,this._configuration.blitMode=t,e.precompile(i.N,this._configuration)}blit(e,t,n,r){e.bindFramebuffer(n.fbo),e.setClearColor(0,0,0,1),e.clear(s.NV.COLOR),this._parameters.texture=t.getTexture();const o=this._techniques.get(i.N,this._configuration);e.bindTechnique(o,r,this._parameters),e.screen.draw()}blend(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this._configuration.hasOpacityFactor=o<1;const s=this._techniques.get(i.N,this._configuration);return!!s.compiled&&(e.bindFramebuffer(n.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=o,e.bindTechnique(s,r,this._parameters),e.screen.draw(),!0)}}},36911:(e,t,n)=>{n.d(t,{Z:()=>c});var r=n(76460),i=n(30726),o=n(97255),s=n(93345),a=n(27207);const l=()=>r.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=n,this._buffers=r,this._indexBuffer=i,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(this._buffers.size+(this._indexBuffer?1:0))*o.i5}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,i.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:n}=this;e||l().error("Vertex buffer dictionary is empty!");const r=this._context.gl;this._buffers.forEach(((e,n)=>{const r=t.get(n);r?(0,a.yu)(this._context,this._locations,e,r):l().error("Vertex element descriptor is empty!")})),null!=n&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},37431:(e,t,n)=>{n.d(t,{Gc:()=>l,RI:()=>u,Z4:()=>c,dk:()=>d,vr:()=>f});var r=n(76931),i=n(19555),o=n(20664),s=n(95925),a=n(75762);function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.vt)();return c(e,(0,r.WA)(t),n),(0,o.n)(n.direction,n.direction),n}function c(e,t,n){return u(e,e.screenToRender(t,(0,r.sc)(a.rq.get())),n)}function u(e,t,n){const s=(0,r.sc)((0,i.C)(a.rq.get(),t));if(s[2]=0,!e.unprojectFromRenderScreen(s,n.origin))return null;const l=(0,r.sc)((0,i.C)(a.rq.get(),t));l[2]=1;const c=e.unprojectFromRenderScreen(l,a.rq.get());return null==c?null:((0,o.d)(n.direction,c,n.origin),n)}function f(e,t,n){return d(e,e.screenToRender(t,(0,r.sc)(a.rq.get())),n)}function d(e,t,n){(0,o.c)(n.origin,e.eye);const r=(0,o.i)(a.rq.get(),t[0],t[1],1),i=e.unprojectFromRenderScreen(r,a.rq.get());return null==i?null:((0,o.d)(n.direction,i,n.origin),n)}},40318:(e,t,n)=>{n.d(t,{Q:()=>d,R:()=>f});var r=n(25530),i=n(69817),o=n(3799),s=n(51596),a=n(23148),l=n(21390),c=n(86955),u=n(66470);const f=.5;function d(e,t){e.include(i.Y6),e.attributes.add(u.r.POSITION,"vec3"),e.attributes.add(u.r.NORMAL,"vec3"),e.attributes.add(u.r.CENTEROFFSETANDDISTANCE,"vec4");const n=e.vertex;(0,o.NB)(n,t),(0,o.yu)(n,t),n.uniforms.add(new s.I("viewport",(e=>e.camera.fullViewport)),new l.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.U("cameraGroundRelative",(e=>e.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,r.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add(c.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),n.code.add(c.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?c.H.float(0):c.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,o.S7)(n),t.draped||(n.uniforms.add(new a.U("perDistancePixelRatio",(e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2)))),n.code.add(c.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${c.H.float(f)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,o.Nz)(n),t.hasScreenSizePerspective&&(0,i.OH)(n),n.code.add(c.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?c.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":c.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},41595:(e,t,n)=>{n.d(t,{KF:()=>g,MF:()=>p,VG:()=>f,g7:()=>h,gf:()=>d,hI:()=>c,o8:()=>l,q6:()=>u});var r=n(76460),i=n(50346),o=n(32535),s=n(98976);const a=()=>r.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){const t=e?.expression;if("string"==typeof t){const e=m(t);if(null!=e)return{cachedResult:e}}return null}async function u(e,t,n,r){const o=e?.expression;if("string"!=typeof o)return null;const a=m(o);if(null!=a)return{cachedResult:a};const l=await(0,s.lw)();(0,i.throwIfAborted)(n);const c=l.arcadeUtils,u=c.createSyntaxTree(o);return c.dependsOnView(u)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function f(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function d(e,t){if(null!=e&&!v(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const n=t;n._geometry&&(n._geometry=(0,o.wZ)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function h(e){if(null!=e){if(v(e))return e.cachedResult;const t=e.arcade;let n=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function p(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e?.featureExpressionInfo;const r=n?.expression;return t||"0"===r||(n=null),n??null}const g={cachedResult:0};function v(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},44640:(e,t,n)=>{n.d(t,{m:()=>o});var r=n(69728),i=n(87003);class o extends i.n{constructor(e,t,n){super(e,"mat4",r.c.Pass,((n,r,i)=>n.setUniformMatrix4fv(e,t(r,i))),n)}}},44680:(e,t,n)=>{function r(){return[1,0,0,0,1,0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function o(e,t,n,r,i,o,s,a,l){return[e,t,n,r,i,o,s,a,l]}n.d(t,{fA:()=>o,o8:()=>i,vt:()=>r,zK:()=>s});const s=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:i,create:r,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:o},Symbol.toStringTag,{value:"Module"}))},45270:(e,t,n)=>{n.d(t,{Aw:()=>c,Jb:()=>l,Q5:()=>d,W3:()=>h,d:()=>s,db:()=>f,kV:()=>u,rb:()=>a});var r=n(3112),i=n(35737),o=n(46571);class s extends i.R6{constructor(e,t,n,r){super(t,n),this.point=e,this.createGraphic=r}}function a(e){return(0,o.i3)(e)&&e.intersector===r.dz.PCL&&!!e.target}class l extends i.HE{constructor(e,t,n,r,i){super(e),this.layerUid=e,this.sublayerUid=t,this.nodeIndex=n,this.componentIndex=r,this.triangleNr=i}}class c extends i.R6{constructor(e,t,n){super(t,null),this.point=e,this.createVoxelGraphic=n}}class u extends i.R6{constructor(e,t){super(e,null),this.createTiles3DGraphic=t}}function f(e){return(0,o.i3)(e)&&e.intersector===r.dz.I3S&&!!e.target}function d(e){return(0,o.i3)(e)&&e.intersector===r.dz.VOXEL&&!!e.target}function h(e){return(0,o.i3)(e)&&e.intersector===r.dz.TILES3D&&!!e.target}},49296:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(59097),i=n(41595);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,r.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,i.g7)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,r.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,n){if(null==e)return void(this._featureExpressionInfoContext=null);const r=e?.arcade;r&&null!=t&&null!=n?(this._featureExpressionInfoContext=(0,i.o8)(e),(0,i.gf)(this._featureExpressionInfoContext,(0,i.VG)(r.modules,t,n))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return null!=e&&t.setFromElevationInfo(e),t}}},57662:(e,t,n)=>{var r,i,o;n.d(t,{O7:()=>i,Om:()=>r,sv:()=>o}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(i||(i={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(o||(o={}))},62374:(e,t,n)=>{n.d(t,{y:()=>c});var r=n(98720),i=n(98521),o=n(51596),s=n(23148),a=n(86955),l=n(4653);function c(e){e.vertex.uniforms.add(new s.U("renderTransparentlyOccludedHUD",(e=>e.hudRenderStyle===i.D.Occluded?1:e.hudRenderStyle===i.D.NotOccluded?0:.75)),new o.I("viewport",(e=>e.camera.fullViewport)),new l.x("hudVisibilityTexture",(e=>e.hudVisibility?.getTexture()))),e.vertex.include(r.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},64232:(e,t,n)=>{n.d(t,{W:()=>a,g:()=>s});var r=n(9392),i=n(9624),o=n(45308);function s(e,t,n,r){if((0,i.canProjectWithoutEngine)(e.spatialReference,n)){l[0]=e.x,l[1]=e.y;const i=e.z;return l[2]=i??r??0,(0,o.projectBuffer)(l,e.spatialReference,0,t,n,0)}const s=(0,i.tryProjectWithZConversion)(e,n);return!!s&&(t[0]=s?.x,t[1]=s?.y,t[2]=s?.z??r??0,!0)}async function a(e,t,n,r,o){return await(0,i.initializeProjection)(e.spatialReference,n,null,o),s(e,t,n,r)}const l=(0,r.vt)()},67425:(e,t,n)=>{n.d(t,{I2:()=>v,Kf:()=>x,Uk:()=>O,ai:()=>y,au:()=>h,fe:()=>_,nG:()=>g,nu:()=>m,sE:()=>p,uw:()=>r});var r,i,o=n(34761),s=n(13191),a=n(9392),l=n(5809),c=n(45308),u=n(81284),f=n(80935),d=n(66470);function h(e,t,n,r,i,o,s,a,l,u,f){const d=b[f.mode];let h,p,g=0;if((0,c.projectBuffer)(e,t,n,r,l.spatialReference,i,a))return d?.requiresAlignment(f)?(g=d.applyElevationAlignmentBuffer(r,i,o,s,a,l,u,f),h=o,p=s):(h=r,p=i),(0,c.projectBuffer)(h,l.spatialReference,p,o,u.spatialReference,s,a)?g:void 0}function p(e,t,n,r,i){const o=((0,u.v)(e)?e.z:(0,f.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":{const n=(0,f.R1)(t,e,"ground")??0;return i.verticalDistanceToGround=0,i.sampledElevation=n,void(i.z=n)}case"relative-to-ground":{const s=(0,f.R1)(t,e,"ground")??0,a=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=a,i.sampledElevation=s,void(i.z=a+s)}case"relative-to-scene":{const s=(0,f.R1)(t,e,"scene")??0,a=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=a,i.sampledElevation=s,void(i.z=a+s)}case"absolute-height":{const s=n.geometryZWithOffset(o,r),a=(0,f.R1)(t,e,"ground")??0;return i.verticalDistanceToGround=s-a,i.sampledElevation=a,void(i.z=s)}default:return void(i.z=0)}}function g(e,t,n,r){return p(e,t,n,r,A),A.z}function v(e,t,n){return"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?null==t||null==n?e.definedChanged:r.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function x(e){return"absolute-height"!==e}function _(e,t,n,r,i){p(t,n,i,r,A),y(e,A.verticalDistanceToGround);const s=A.sampledElevation,a=(0,o.C)(w,e.transformation);return E[0]=t.x,E[1]=t.y,E[2]=A.z,(0,l.l)(t.spatialReference,E,a,r.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function y(e,t){for(let n=0;n<e.geometries.length;++n){const r=e.geometries[n].getMutableAttribute(d.r.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[n],d.r.CENTEROFFSETANDDISTANCE))}}class O{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(i=r||(r={}))[i.NONE=0]="NONE",i[i.UPDATE=1]="UPDATE",i[i.RECREATE=2]="RECREATE";const b={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let u=0;u<i;++u){const i=e[t],o=e[t+1],s=e[t+2];n[r]=i,n[r+1]=o,n[r+2]=null==c?s+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o){let s=0;const a=o.spatialReference;t*=3,r*=3;for(let l=0;l<i;++l){const i=e[t],l=e[t+1],c=e[t+2],u=o.getElevation(i,l,c,a,"ground")??0;s+=u,n[r]=i,n[r+1]=l,n[r+2]=u,t+=3,r+=3}return s/i},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,f=o.spatialReference;t*=3,r*=3;for(let d=0;d<i;++d){const i=e[t],s=e[t+1],a=e[t+2],d=o.getElevation(i,s,a,f,"ground")??0;l+=d,n[r]=i,n[r+1]=s,n[r+2]=null==u?a+d+c:d+c,t+=3,r+=3}return l/i},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,f=o.spatialReference;t*=3,r*=3;for(let d=0;d<i;++d){const i=e[t],s=e[t+1],a=e[t+2],d=o.getElevation(i,s,a,f,"scene")??0;l+=d,n[r]=i,n[r+1]=s,n[r+2]=null==u?a+d+c:d+c,t+=3,r+=3}return l/i},requiresAlignment:()=>!0}},w=(0,s.vt)(),A=new O,E=(0,a.vt)()},67737:(e,t,n)=>{n.d(t,{G:()=>r,Q:()=>i});const r={stableRendering:!1},i={rootOrigin:null}},69817:(e,t,n)=>{n.d(t,{OH:()=>c,Y6:()=>a,pM:()=>l});var r=n(20664),i=n(9392),o=n(5517),s=n(86955);function a(e){e.vertex.code.add(s.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(s.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(s.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(s.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new o.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new o.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,r.i)(f,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const f=(0,i.vt)()},71118:(e,t,n)=>{n.d(t,{n:()=>r,u:()=>l});var r,i,o=n(81806),s=n(75941),a=n(98476);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!(0,o.A)("disable-feature:high-quality-idle"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=new s.O;return e?(n.set(a.M.IDLE,r.Antialiasing,"low"!==t),n.set(a.M.IDLE,r.HighResolutionAtmosphere,"low"!==t),n.set(a.M.IDLE,r.HighQualityTransparency,!0),n.set(a.M.IDLE,r.SSAO,!0),n.set(a.M.IDLE,r.WaterReflection,!0),n.set(a.M.IDLE,r.PhysicalPixelRendering,!0)):(n.set(a.M.ANIMATING,r.HighResolutionShadows,!0),n.set(a.M.ANIMATING,r.HighResolutionViewshed,!0),n.set(a.M.INTERACTING,r.HighResolutionShadows,!0),n.set(a.M.INTERACTING,r.HighResolutionViewshed,!0)),n.set(a.M.IDLE,r.HighResolutionShadows,!0),n.set(a.M.IDLE,r.HighResolutionViewshed,!0),n.set(a.M.IDLE,r.HighResolutionVoxel,!0),n}(i=r||(r={}))[i.Antialiasing=0]="Antialiasing",i[i.HighQualityTransparency=1]="HighQualityTransparency",i[i.HighResolutionVoxel=2]="HighResolutionVoxel",i[i.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",i[i.SSAO=4]="SSAO",i[i.WaterReflection=5]="WaterReflection",i[i.HighResolutionShadows=6]="HighResolutionShadows",i[i.HighResolutionViewshed=7]="HighResolutionViewshed",i[i.PhysicalPixelRendering=8]="PhysicalPixelRendering"},71488:(e,t,n)=>{n.d(t,{H:()=>a,h:()=>s});var r=n(3112),i=n(35737),o=n(46571);class s extends i.R6{constructor(e,t,n,r,i){super(e,t),this.layerUid=e,this.graphicUid=t,this.triangleNr=n,this.baseBoundingSphere=r,this.numLodLevels=i}}function a(e){return(0,o.i3)(e)&&e.intersector===r.dz.LOD&&!!e.target}},75507:(e,t,n)=>{n.d(t,{f:()=>o});var r=n(9392);class i{constructor(e,t){this.vec3=e,this.id=t}}function o(e,t,n,o){return new i((0,r.fA)(e,t,n),o)}},76718:(e,t,n)=>{n.d(t,{g:()=>c});var r=n(18690),i=(n(81806),n(76460)),o=n(78393),s=n(61678),a=n(93345);const l=()=>i.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,n){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,n)}static createVertex(e,t,n){return new c(e,a.NZ.ARRAY_BUFFER,t,n)}static createUniform(e,t,n){return new c(e,a.NZ.UNIFORM_BUFFER,t,n)}static createPixelPack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_READ,n=arguments.length>2?arguments[2]:void 0;const r=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return n&&r.setSize(n),r}static createPixelUnpack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_DRAW,n=arguments.length>2?arguments[2]:void 0;return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,n)}static createTransformFeedback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STATIC_DRAW,n=arguments.length>2?arguments[2]:void 0;const r=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return r.setSize(n),r}constructor(e,t,n,r){this._context=e,this.bufferType=t,this.usage=n,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,s.Y2)(this._context.gl),r&&this.setData(r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,o.mg)(e)?this._indexType=a.pe.UNSIGNED_BYTE:(0,o.jq)(e)?(t/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,o.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._size=e;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const r=this._context.gl;null!=t?r.bufferData(this.bufferType,t,this.usage):r.bufferData(this.bufferType,e,this.usage),(0,s.Y2)(r),this._isVAOAware&&this._context.bindVAO(n)}setSubData(e,t,n,r){if(!e)return;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,n,r-n),(0,s.Y2)(o),this._isVAOAware&&this._context.bindVAO(i)}getSubData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(n<0||i<0)return;const o=function(e){return(0,r.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(o*((n??0)+(i??0))>e.byteLength)return;t+o*(i??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const s=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),s.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,n,i),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),s.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,n,i),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;await this._context.clientWaitAsync(),this.getSubData(e,t,n,r)}}},80517:(e,t,n)=>{n.d(t,{C:()=>h,a:()=>g,b:()=>p});var r=n(73398),i=n(65058),o=n(81449),s=n(28450),a=n(21390),l=n(86955),c=n(70367),u=n(84093),f=n(31432),d=n(2687);class h extends f.Y{constructor(){super(...arguments),this.opacity=1}}function p(e){const t=new d.N5;t.include(r.c),t.fragment.uniforms.add(new c.N("tex",(e=>e.texture))),e.hasOpacityFactor&&t.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity)));const n=e.blitMode===u.d.Depth;return n&&(t.fragment.uniforms.add(new s.E("nearFar",(e=>e.camera.nearFar))),t.fragment.include(i.E),t.fragment.include(o.W)),t.fragment.main.add(l.H`
    ${n?l.H`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:l.H`
          fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};`}`),t}const g=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h,build:p},Symbol.toStringTag,{value:"Module"}))},84093:(e,t,n)=>{n.d(t,{N:()=>a,d:()=>r});var r,i,o=n(35143),s=n(6485);(i=r||(r={}))[i.None=0]="None",i[i.Alpha=1]="Alpha",i[i.PremultipliedAlpha=2]="PremultipliedAlpha",i[i.Depth=3]="Depth",i[i.COUNT=4]="COUNT";class a extends s.K{constructor(){super(...arguments),this.blitMode=r.None,this.hasOpacityFactor=!1}}(0,o._)([(0,s.W)({count:r.COUNT})],a.prototype,"blitMode",void 0),(0,o._)([(0,s.W)()],a.prototype,"hasOpacityFactor",void 0)},87572:(e,t,n)=>{n.d(t,{U:()=>i});var r=n(86955);function i(e){e.code.add(r.H`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}},95756:(e,t,n)=>{n.d(t,{G:()=>o});var r=n(69728),i=n(87003);class o extends i.n{constructor(e,t){super(e,"vec2",r.c.Pass,((n,r,i)=>n.setUniform2fv(e,t(r,i))))}}},97255:(e,t,n)=>{n.d(t,{$B:()=>i,Qf:()=>c,Qh:()=>a,RS:()=>o,ez:()=>d,i5:()=>h,lM:()=>s,qK:()=>f,rq:()=>u});var r=n(78393);function i(e){return 32+e.length}const o=16;function s(e){if(!e)return 0;let t=f;for(const n in e)e.hasOwnProperty(n)&&(t+=l(e[n],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return c(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return u(e,8);let n=d;for(let r=0;r<t;r++)n+=l(e[r]);return n}(e);let t=f;for(const n in e)e.hasOwnProperty(n)&&(t+=l(e[n]));return t}function l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?a(e):f;case"string":return i(e);case"number":return o;case"boolean":return 4;default:return 8}}function c(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>e+(t?(0,r.iu)(t)?t.byteLength+h:Array.isArray(t)?u(t,o):0:0)),0)}function u(e,t){return d+e.length*t}const f=32,d=16,h=145},97583:(e,t,n)=>{n.d(t,{g:()=>m});n(81806);var r=n(90632),i=n(20664),o=n(9392),s=n(55855),a=n(45308),l=n(50468),c=n(87634),u=n(17345),f=n(75507),d=n(37046),h=n(67737),p=n(66470),g=n(8918),v=n(425);class m{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,r.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=h.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,f.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const n=(0,f.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,n),n}const n=this._gridSize,r=Math.round(e[0]/n),o=Math.round(e[1]/n),s=Math.round(e[2]/n),a=`${r}/${o}/${s}`;let l=this._origins.get(a);const c=.5*n;if((0,i.d)(x,e,t.vec3),x[0]=Math.abs(x[0]),x[1]=Math.abs(x[1]),x[2]=Math.abs(x[2]),x[0]<c&&x[1]<c&&x[2]<c){if(l){const t=Math.max(...x);if((0,i.d)(x,e,l.vec3),x[0]=Math.abs(x[0]),x[1]=Math.abs(x[1]),x[2]=Math.abs(x[2]),Math.max(...x)<t)return l}return t}return l||(l=(0,f.f)(r*n,o*n,s*n,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.fA)(1,1,0,1);const n=window.view,r=n._stage,i=t.toString();if(!this._objects.has(i)){this._material=new v.W({width:2,color:t}),r.add(this._material);const e=new g.x(r,{pickable:!1}),n=new d.B({castShadow:!1});r.add(n),e.add(n),this._objects.set(i,n)}const o=this._objects.get(i),f=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],h=f.length,m=new Array(3*h),x=new Array,_=.5*this._gridSize;for(let s=0;s<h;s++)m[3*s]=e[0]+(1&f[s]?_:-_),m[3*s+1]=e[1]+(2&f[s]?_:-_),m[3*s+2]=e[2]+(4&f[s]?_:-_),s>0&&x.push(s-1,s);(0,a.projectBuffer)(m,this._originSR,0,m,n.renderSpatialReference,0,h);const y=new u.V(this._material,[[p.r.POSITION,new l.n(m,x,3,!0)]],null,c.X.Line);r.add(y),o.addGeometry(y)}get test(){}}const x=(0,o.vt)()},98521:(e,t,n)=>{var r;n.d(t,{D:()=>r}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},98720:(e,t,n)=>{n.d(t,{K:()=>o});var r=n(67582),i=n(86955);function o(e){e.uniforms.add(new r.o("alignPixelEnabled",(e=>e.alignPixelEnabled))),e.code.add(i.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(i.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}}}]);
//# sourceMappingURL=67871.bdad2753.chunk.js.map