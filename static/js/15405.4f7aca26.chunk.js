"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[15405],{7342:(e,t,r)=>{r.d(t,{Cc:()=>c,Qo:()=>u,CC:()=>d,RF:()=>l});var n=r(69539),o=(r(81806),r(76931)),i=r(55855);var s=r(46702),a=r(28014);function l(e){return e&&e.enabled&&(function(e){return"extrude"===e.type}(e)||function(e){return"fill"===e.type}(e))&&null!=e.edges}function c(e,t){return u(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function u(e,t){if(null==e)return null;const r=null!=e.color?(0,i.ci)(n.default.toUnitRGBA(e.color)):(0,i.fA)(0,0,0,0),s=(0,o.Lz)(e.size),l=(0,o.Lz)(e.extensionLength);switch(e.type){case"solid":return d({color:r,size:s,extensionLength:l,...t});case"sketch":return c={color:r,size:s,extensionLength:l,...t},{...f,...c,type:a.gP.Sketch};default:return}var c}function d(e){return{...h,...e,type:a.gP.Solid}}const h={color:(0,i.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:s.x.OPAQUE,hasSlicePlane:!1},f={color:(0,i.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:s.x.OPAQUE,hasSlicePlane:!1}},9612:(e,t,r)=>{r.d(t,{p:()=>n});r(17345);function n(e){return null!=e.mapPositions}},10708:(e,t,r)=>{r.d(t,{H:()=>s});var n=r(65058),o=r(86955),i=r(4653);function s(e){e.include(n.E),e.uniforms.add(new i.x("geometryDepthTexture",(e=>e.geometryDepth?.attachment))),e.code.add(o.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}},11687:(e,t,r)=>{r.d(t,{$:()=>n});class n{constructor(e,t){this.renderer=e,this.symbol=t}}},12062:(e,t,r)=>{r.d(t,{Fe:()=>p,Rn:()=>c,dI:()=>u,hr:()=>f,iC:()=>h});var n=r(18690),o=r(97255),i=r(29808),s=r(3112),a=r(66470),l=r(71488);class c{constructor(e,t,r,n){this.material=e,this.bufferWriter=e.createBufferWriter(),this.vertexBufferLayout=this.bufferWriter.vertexBufferLayout,this.buffer=t,this.elementCount=r,this.boundingInfo=n}get numTriangles(){return this.elementCount/3}get numVertices(){return this.elementCount}computeUsedMemory(){return this.buffer.byteLength+o.i5}getRenderGeometry(){return this}intersect(e,t,r,n,o,i,s,a){const l=this.bufferWriter,c=this.buffer;l.intersect(c,e,r,n,((r,n,l,c,u)=>d(r,n,l,u,e,t,i,s,o,a)))}}class u{constructor(e){this.engineGeometry=e}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.attributes.get(a.r.POSITION).indices.length}get numTriangles(){return this.engineGeometry.indexCount/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce(((e,t)=>e+(0,o.Qf)(t.data,t.indices)),0)}getRenderGeometry(){const e=this.material,t=this.engineGeometry,r=t.attributes,n=t.boundingInfo,o=e.createBufferWriter(),i=o.vertexBufferLayout,s=o.elementCount(r),a=i.createBuffer(s);return o.write(null,null,r,null,a,0),new c(e,a.buffer,s,n)}intersect(e,t,r,n,o,i,s,a){const l=this.engineGeometry;this.material.intersect(l,e.transform.transform,e,r,n,((r,n,l,c,u)=>d(r,n,l,u,e,t,i,s,o,a)))}}function d(e,t,r,n,o,a,c,u,d,h){if(e<0)return;if(a&&!a(o.rayBegin,o.rayEnd,e))return;const f=new l.h(c.layerUid,c.graphicUid(d),r,u,h);if((null==o.results.min.drapedLayerOrder||n>=o.results.min.drapedLayerOrder)&&(null==o.results.min.dist||e<o.results.min.dist)&&o.results.min.set(s.dz.LOD,f,e,t,o.transform.transform,n),o.options.store!==s.oH.MIN&&(null==o.results.max.drapedLayerOrder||n>=o.results.max.drapedLayerOrder)&&(null==o.results.max.dist||e>o.results.max.dist)&&o.results.max.set(s.dz.LOD,f,e,t,o.transform.transform,n),o.options.store===s.oH.ALL){const r=(0,i.G7)(o.results.min.ray);r.set(s.dz.LOD,f,e,t,o.transform.transform,n),o.results.all.push(r)}}class h{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}}class f{constructor(e,t,r){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=r;const o=(0,n.Am)(this.components.map((e=>e.geometry)));this.numVertices=o.reduce(((e,t)=>e+t.numVertices),0)}}class p{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}getMaterials(){const e=[];return this.levels.forEach((t=>t.components.forEach((t=>e.push(t.geometry.material))))),(0,n.Am)(e)}getTextures(){const e=new Array;return this.levels.forEach((t=>t.components.forEach((t=>{null!=t.textures&&e.push(...t.textures)})))),(0,n.Am)(e)}getGeometries(){const e=new Array;return this.levels.forEach((t=>t.components.forEach((t=>{e.push(t.geometry)})))),(0,n.Am)(e)}getEngineGeometries(){return this.getGeometries().map((e=>e.engineGeometry)).filter((e=>null!=e))}computeUsedMemory(){const e=this.getGeometries(),t=this.getTextures(),r=e.reduce(((e,t)=>e+t.computeUsedMemory()),0);return t.reduce(((e,t)=>e+t.memoryEstimate),0)+r}}},13545:(e,t,r)=>{r.d(t,{cz:()=>b,Sg:()=>f,B:()=>v,Hi:()=>y});var n=r(4212),o=r(14522),i=r(59581),s=r(34981),a=r(81449),l=r(20123),c=r(86955),u=r(69728),d=r(87003);class h extends d.n{constructor(e,t){super(e,"int",u.c.Draw,((r,n,o)=>r.setUniform1i(e,t(n,o))))}}var f,p=r(27374),m=r(61785),g=r(66470);!function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"}(f||(f={}));const y=429496.7296;function v(e,t){(0,o.U)(e/y*.5+.5,t)}function b(e,t){switch(t.componentData){case f.Varying:return function(e,t){const{vertex:r,fragment:n}=e;r.include(a.W),r.uniforms.add(new p.o("componentColorTex",(e=>e.componentParameters.texture.texture))),e.attributes.add(g.r.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const o=t.output===s.V.ObjectAndLayerIdColor;o&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(i.A),r.constants.add("stride","float",(0,m.E)()?3:2),r.code.add(c.H`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(c.H`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${c.H.float(y)};
  }

  ${o?c.H`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:c.H`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),n.code.add(c.H`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${o?c.H`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}(e,t);case f.Uniform:return function(e,t){const{vertex:r,fragment:n}=e;e.varyings.add("vExternalColor","vec4"),r.uniforms.add(new l.V("externalColor",(e=>e.componentParameters.externalColor))).code.add(c.H`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const o=t.output===s.V.ObjectAndLayerIdColor;n.uniforms.add(new h("externalColorMixMode",(e=>e.componentParameters.externalColorMixMode))).code.add(c.H`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${(0,c.If)(o,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}(e,t);case f.COUNT:return;default:(0,n.Xb)(t.componentData)}}},15255:(e,t,r)=>{r.d(t,{L:()=>o});var n=r(2413);class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scene";this.context=e,this.extent=(0,n.Ie)()}}},19852:(e,t,r)=>{r.d(t,{Ws:()=>Y,Rj:()=>te,AG:()=>ee});var n=r(69539),o=r(81806),i=r(76931),s=r(9392),a=r(55855),l=r(11687),c=r(82041),u=r(29308),d=r(67425),h=r(49296),f=r(49048),p=r(99057),m=r(28350),g=r(24947),y=r(36423),v=r(88265),b=r(90346),x=r(50468),S=r(87634),O=r(17345),_=r(66470),E=r(88685),P=r(59422),w=r(48549),C=r(34981),L=r(59696),A=r(45463),T=r(77730),I=r(52757),F=r(16506),R=r(59246),D=r(40431),z=r(93345),M=r(34781);class U extends R.w{constructor(e,t){super(e,t,new F.$(D.L,(()=>r.e(99873).then(r.bind(r,99873)))))}initializePipeline(e){const{hudDepth:t,terrainDepthTest:r}=e,n={func:r?z.MT.ALWAYS:z.MT.LESS};return(0,M.Ey)(t?{depthTest:n,depthWrite:M.Uy}:{blending:(0,M.p3)(z.dn.ONE,z.dn.SRC_ALPHA,z.dn.ONE_MINUS_SRC_ALPHA,z.dn.ONE_MINUS_SRC_ALPHA),depthTest:n,colorWrite:M.kn})}}var G=r(35143),j=r(6485),V=r(94570);class N extends V.E{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}}(0,G._)([(0,j.W)()],N.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,G._)([(0,j.W)()],N.prototype,"occlusionTestEnabled",void 0),(0,G._)([(0,j.W)()],N.prototype,"hasVerticalOffset",void 0),(0,G._)([(0,j.W)()],N.prototype,"hasScreenSizePerspective",void 0),(0,G._)([(0,j.W)()],N.prototype,"hudDepth",void 0),(0,G._)([(0,j.W)()],N.prototype,"hudDepthAlignStart",void 0),(0,G._)([(0,j.W)()],N.prototype,"terrainDepthTest",void 0);var H=r(75569);class B extends A.im{constructor(e,t){super(e,W),this.produces=new Map([[T.N.LINE_CALLOUTS,e=>(0,C.RN)(e)],[T.N.LINE_CALLOUTS_HUD_DEPTH,e=>(0,C.RN)(e)]]),this._configuration=new N(t),this._uniqueMaterialIdentifier=k(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){const r=t.slot===T.N.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=H.Q||(this.parameters.borderColor?.[3]??0)>=H.Q}intersect(){}createGLMaterial(e){return new $(e)}createBufferWriter(){return new Q}validateParameters(e){this._uniqueMaterialIdentifier=k(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}function k(e){let{renderOccluded:t,isDecoration:r,horizontalScreenOffset:n,color:o,size:i,occlusionTest:s,shaderPolygonOffset:a,hudDepthAlignStart:l,centerOffsetUnits:c,hasSlicePlane:u,screenSizePerspective:d,verticalOffset:h,borderColor:f}=e;return E.ML`${t}:${r}:${n}:[${o}]:${i}:${s}:${a}:${l}:${c}:${u}:${null!=d}:{${h.screenLength}:${h.minWorldLength}:${h.maxWorldLength}}:[${f}]`}class $ extends L.A{beginSlot(e){return this.getTechnique(U,e)}}class W extends A.qA{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=(0,a.fA)(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const q=(0,w.BP)().vec3f(_.r.POSITION).vec3f(_.r.NORMAL).vec2f(_.r.UV0).vec4f(_.r.CENTEROFFSETANDDISTANCE),Z=[(0,P.fA)(0,0),(0,P.fA)(1,0),(0,P.fA)(0,1),(0,P.fA)(1,0),(0,P.fA)(1,1),(0,P.fA)(0,1)];class Q{constructor(){this.vertexBufferLayout=q}elementCount(e){return 6*e.get(_.r.POSITION).indices.length}write(e,t,r,n,o,i){(0,I.Hk)(r.get(_.r.POSITION),e,o.position,i,6),(0,I.p1)(r.get(_.r.NORMAL),t,o.normal,i,6),(0,I.Ut)(r.get(_.r.CENTEROFFSETANDDISTANCE),o.centerOffsetAndDistance,i,6);for(let s=0;s<Z.length;++s)o.uv0.setVec(i+s,Z[s])}}class Y extends g.U{constructor(e,t){super(e,null,t,K),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new B(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){const e=new W,t=this.symbol,r=t.callout;if(r.color){const t=n.default.toUnitRGBA(r.color);t[3]*=this._getLayerOpacity(),e.color=t}else e.color=a.uY;if(e.size=(0,i.Lz)(r.size||0),t.verticalOffset){const{screenLength:r,minWorldLength:n,maxWorldLength:o}=t.verticalOffset;e.verticalOffset={screenLength:(0,i.Lz)(r),minWorldLength:n||0,maxWorldLength:null!=o?o:1/0}}e.borderColor=null!=r.border?.color?n.default.toUnitRGBA(r.border.color):null;const s="object"===t.symbolLayers.at(0).type,l="label-3d"===t.type;return e.occlusionTest=!s&&!(0,o.A)("enable-feature:non-occluded-hud"),s&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=l,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return X}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new h.F,t.elevationOffset||0),o=t.symbol,i="on-the-ground"===this._elevationContext.mode&&("cim"===o.type||!o.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==o.type&&i)return null;if("point-3d"===o.type&&o.symbolLayers.every((e=>"text"===e.type&&!(0,c.Ie)(e))))return null;const s=(0,y.W$)(r.geometry);return null==s?null:this._createAs3DShape(s,n,t,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){const n=this._elevationContext.mode,o=(0,d.I2)(Y.elevationModeChangeTypes,r,n);return o!==d.uw.UPDATE||e.forEach((e=>{const r=t(e);null!=r&&this.updateGraphicElevationContext(e.graphic,r)})),o}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){const{elevationContext:r,metadata:n}=t;this.setGraphicElevationContext(e,r,n?.elevationOffset??0),t.needsElevationUpdates=(0,d.nu)(r.mode)}computeComplexity(){return new b.rz({verticesPerFeature:6})}_getOrCreateMaterial(e){const t=this._perInstanceMaterialParameters(e),r=k(t);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=e.materialCollection){let n=e.materialCollection.get(r);return null==n&&(n=new B(t,this._context.spherical),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new B(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,r,n){const o=this._context.layer.uid,i=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}),s=this._getOrCreateMaterial(r),a=new O.V(s.material,function(e){const{translation:t,centerOffset:r}=e,n=new x.n(t?[t[0],t[1],t[2]]:[0,0,0],J,3,!0),o=new x.n(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],J,4,!0);return[[_.r.POSITION,n],[_.r.NORMAL,new x.n([0,0,1],J,3,!0)],[_.r.CENTEROFFSETANDDISTANCE,o]]}(r),null,S.X.Point,i),l=(0,v.SZ)(this._context,e,a,t,n);if(null==l)return null;const c=new p.Y(this,l.object,[a],s.isUnique?[s.material]:null,null,u.G8,t);return c.metadata=new m.Z(r.elevationOffset),c.alignedSampledElevation=l.sampledElevation,c.needsElevationUpdates=(0,d.nu)(t.mode),(0,v.d2)(c,e,this._context.elevationProvider),c}}Y.elevationModeChangeTypes={definedChanged:d.uw.UPDATE,staysOnTheGround:d.uw.UPDATE,onTheGroundChanged:d.uw.RECREATE};const J=[0],X={mode:"relative-to-ground",offset:0},K={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class ee extends l.${constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.vt)(),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.vt)(),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;super(e,t),this.translation=r,this.centerOffset=n,this.horizontalScreenOffset=o,this.centerOffsetUnits=i,this.elevationOffset=l,this.materialCollection=c}}class te extends f.x{}},22294:(e,t,r)=>{r.d(t,{$:()=>o,S:()=>i});var n=r(64465);class o{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===n.RT.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}}class i{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}}},24947:(e,t,r)=>{r.d(t,{U:()=>y});var n=r(69539),o=(r(81806),r(76460)),i=r(9392),s=r(55855),a=r(5262),l=r(48989),c=r(67425),u=r(49296),d=r(41595),h=r(36423),f=r(41854),p=r(75646),m=r(63048);const g=()=>o.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class y extends p.x{constructor(e,t,r,n){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=g(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new u.F,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=v(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){const e=this.complexity;return null==e?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,r=v(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size||r.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,n){const o=e.projectionSuccess,i="polygons"in e?e.polygons:null,s=`${n} geometry failed to be created`;o?!this._logGeometryValidationWarnings(t,r,n)&&i&&0===i.length&&"rings"===r&&t.length>0&&t[0].length>2&&g().warnOncePerTick(`${s} (filled rings should use clockwise winding - try reversing the order of vertices)`):g().warnOncePerTick(`${s} (failed to project geometry to view spatial reference)`)}updateFocus(e,t){}_logGeometryValidationWarnings(e,t,r){const n=`${r} geometry failed to be created`;return!e.length||1===e.length&&!e[0].length?(g().warnOncePerTick(`${n} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(g().warnOncePerTick(`${n} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const t=e;if(!isFinite(t.x)||!isFinite(t.y))return g().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":(0,a.m3)(e)&&g().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return b}_defaultElevationInfoZ(){return x}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDefaultElevationInfo(e);return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.F;const r=e.geometry,n=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:n.unit,t.mode=this.getGeometryElevationMode(r,n),t.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const o=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;o&&(t.mode="relative-to-ground",t.offsetMeters=0);const i=o?d.KF:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(i,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,r,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;return this._context.layer.opacity??1}_getCombinedOpacity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?r:e?r*e.a:t.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,h.$C)(null,r);const o=null!=e?n.default.toUnitRGB(e):i.Un;return(0,h.$C)(o,r)}_getVertexOpacityAndColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,o=(0,h.$C)(r,n);return t&&(o[0]*=t,o[1]*=t,o[2]*=t,o[3]*=t),o}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return(0,l.JV)(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,e)!==c.uw.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,r){let n=c.uw.UPDATE;return e.forEach((e=>{const o=t(e);if(null!=o){const t=e.graphic;this.setGraphicElevationContext(t,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else n=c.uw.RECREATE})),n}applyRendererDiff(e,t){return f.w.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,r=t.size?(0,m.ul)(t.size.field,e):0,n=t.color?(0,m.ul)(t.color.field,e):0,o=t.opacity?(0,m.ul)(t.opacity.field,e):0;return(0,s.fA)(r,n,o,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&g().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}}function v(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let r=0;r<e.stops.length;r++){const n=e.stops[r].color;n&&(t.opacity=!0,n.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0;break;case"rotation":t.rotation=!0}})),t}const b={mode:"on-the-ground",offset:0,unit:"meters"},x={mode:"absolute-height",offset:0,unit:"meters"},S={hasIntrinsicColor:!1}},26611:(e,t,r)=>{r.d(t,{L:()=>a});var n=r(76460),o=r(82041),i=r(19852);const s=()=>n.A.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function a(e,t){if(!(0,o.YX)(e))return s().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=l[e.callout.type];return r?new r(e,t):(s().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const l={line:i.Ws}},28014:(e,t,r)=>{r.d(t,{E7:()=>y,gP:()=>n,s0:()=>o,zP:()=>v});var n,o,i=r(13545),s=r(59046),a=r(89299),l=r(81449),c=r(72468),u=r(5517),d=r(86955),h=r(42759),f=r(72106),p=r(23687),m=r(27374),g=r(66470);function y(e,t){const r=e.vertex;r.include(l.W),e.include(s.Y,t);const{silhouette:n,legacy:o,spherical:y}=t;r.uniforms.add(new m.o("componentDataTex",(e=>e.componentDataTexture))),e.attributes.add(g.r.COMPONENTINDEX,"float");r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.code.add(d.H`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = ${d.H.float(3)}  * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, ${d.H.float(0)});
      vec2 otherIndex = _componentTextureCoords(componentIndex, ${d.H.float(1)});
      vec2 verticalOffsetIndex = _componentTextureCoords(float(componentIndex), ${d.H.float(2)} );
      vec3 normal = normalModel();
      vec3 normal2 = ${n?d.H`decompressNormal(normal2Compressed)`:d.H`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${d.H.float(i.Hi)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / ${d.H.float(8)} ),
        otherValue.y * 255.0 - ${d.H.float(128)},
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),o?r.code.add(d.H`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new h.h("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel))),r.code.add(d.H`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),n?(e.attributes.add(g.r.NORMAL2COMPRESSED,"vec2"),r.code.add(d.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):r.code.add(d.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),o?r.code.add(d.H`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(a.u,t),r.uniforms.add(new f.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new h.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new c.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL)),new c.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new u.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new u.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH))),r.code.add(d.H`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${y?"normalize(transformWorldFromModelTL + rotatedModelPosition);":"vec3(0.0, 0.0, 1.0);"}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new p.F("transformProjFromView",(e=>e.camera.projectionMatrix))).code.add(d.H`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(d.H`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function v(e){return e===n.Sketch||e===n.Mixed}!function(e){e[e.Solid=0]="Solid",e[e.Sketch=1]="Sketch",e[e.Mixed=2]="Mixed",e[e.COUNT=3]="COUNT"}(n||(n={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(o||(o={}))},28350:(e,t,r)=>{r.d(t,{Z:()=>n});class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.labelText=t,this.elevationOffset=e??0}}},28660:(e,t,r)=>{r.d(t,{B1:()=>i,ab:()=>a,bR:()=>s,mK:()=>o});var n=r(81806);function o(){return(0,n.A)("curve-densification-coarse-segments")}function i(){return(0,n.A)("curve-densification-max-segments")}function s(){return(0,n.A)("curve-densification-min-segments")}function a(){return(0,n.A)("curve-densification-pixels-per-segment")}},29308:(e,t,r)=>{r.d(t,{B6:()=>p,G8:()=>m,Jf:()=>y,Zd:()=>v});var n=r(34761),o=r(13191),i=r(20664),s=r(9392),a=r(5809),l=r(45308),c=r(67425),u=r(22955),d=r(80935),h=r(9612),f=r(66470);function p(e,t,r,n,o){const i=e.stageObject,s=i.geometries;let a=0;for(const l of s){if(!(0,h.p)(l))continue;const{update:e,averageGeometrySampledElevation:s}=w(l,t,r,n,o);a+=s,e&&i.geometryVertexAttributeUpdated(l,f.r.POSITION)}return a/s.length}function m(e,t,r,o,s,l){const d=e.stageObject,h=t.centerPointInElevationSR;let f=0;d.usesVerticalDistanceToGround?(o(h,P),(0,c.ai)(d,P.verticalDistanceToGround),f=P.sampledElevation):(o(h,P),"absolute-height"!==t.mode&&(f=P.sampledElevation));const p=(0,n.C)(g,l??d.transformation),m=(0,i.i)(E,p[12],p[13],p[14]);u.b.TESTS_DISABLE_OPTIMIZATIONS?(x[0]=h.x,x[1]=h.y,x[2]=P.z,(0,a.l)(h.spatialReference,x,p,s.spatialReference)&&(l?(0,n.C)(l,p):d.transformation=p)):s.setAltitudeOfTransformation(P.z,p);const y=b/s.unitInMeters;return(Math.abs(p[12]-m[0])>=y||Math.abs(p[13]-m[1])>=y||Math.abs(p[14]-m[2])>=y)&&(l?(0,n.C)(l,p):d.transformation=p),f}const g=(0,o.vt)();function y(e,t,r,n,o){const s=e.graphics3DSymbolLayer.lodRenderer;if(null==s)return 0;const l=t.centerPointInElevationSR;n(l,P);const c="absolute-height"!==t.mode?P.sampledElevation:0,d=s.instanceData,h=e.instanceIndex,f=_;d.getGlobalTransform(h,f);const p=(0,i.i)(E,f[12],f[13],f[14]);u.b.TESTS_DISABLE_OPTIMIZATIONS?(x[0]=l.x,x[1]=l.y,x[2]=P.z,(0,a.l)(l.spatialReference,x,f,o.spatialReference)&&d.setGlobalTransform(h,f)):o.setAltitudeOfTransformation(P.z,f);const m=b/o.unitInMeters;return(u.b.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(f[12]-p[0])>=m||Math.abs(f[13]-p[1])>=m||Math.abs(f[14]-p[2])>=m)&&d.setGlobalTransform(h,f),c}function v(e,t,r,n,o){const i=e.stageObject,s=i.geometries;if(0===s.length)return 0;let a=0,l=null,c=0,u=!1;for(const d of s){if(!(0,h.p)(d))continue;const e=d.attributes.get(f.r.POSITION);if(e!==l){const{update:i,averageGeometrySampledElevation:s}=w(d,t,r,n,o);c=s,l=e,u=i}u&&i.geometryVertexAttributeUpdated(d,f.r.POSITION),a+=c}return a/s.length}const b=.01,x=(0,s.vt)(),S=(0,s.vt)(),O=(0,s.vt)(),_=(0,o.vt)(),E=(0,s.vt)(),P=new c.Uk;function w(e,t,r,n,o){let i=!1;const s=e.transformation,a=t.requiresSampledElevationInfo;S[0]=s[12],S[1]=s[13],S[2]=s[14],e.invalidateBoundingInfo();const c=e.getMutableAttribute(f.r.POSITION),h=c.data,p=c.size,m=h.length/p,g=new d.aY(e.mapPositions,r);let y=0,v=0;for(let d=0;d<m;d++){if(O[0]=h[y],O[1]=h[y+1],O[2]=h[y+2],n(g,P),a&&(v+=P.sampledElevation),u.b.TESTS_DISABLE_OPTIMIZATIONS)h[y]=g.array[g.offset],h[y+1]=g.array[g.offset+1],h[y+2]=P.z,(0,l.projectBuffer)(h,r,y,h,o.spatialReference,y,1),h[y]-=S[0],h[y+1]-=S[1],h[y+2]-=S[2],i=!0;else{x[0]=h[y]+S[0],x[1]=h[y+1]+S[1],x[2]=h[y+2]+S[2],o.setAltitude(x,P.z),h[y]=x[0]-S[0],h[y+1]=x[1]-S[1],h[y+2]=x[2]-S[2];const e=b/o.unitInMeters;(Math.abs(O[0]-h[y])>=e||Math.abs(O[1]-h[y+1])>=e||Math.abs(O[2]-h[y+2])>=e)&&(i=!0)}y+=p,g.offset+=3}return v/=m,{update:i,averageGeometrySampledElevation:v}}},38865:(e,t,r)=>{r.d(t,{VN:()=>s,qD:()=>o,r4:()=>i});var n=r(55855);const o=1.2,i=n.uY,s=4},40318:(e,t,r)=>{r.d(t,{Q:()=>h,R:()=>d});var n=r(25530),o=r(69817),i=r(3799),s=r(51596),a=r(23148),l=r(21390),c=r(86955),u=r(66470);const d=.5;function h(e,t){e.include(o.Y6),e.attributes.add(u.r.POSITION,"vec3"),e.attributes.add(u.r.NORMAL,"vec3"),e.attributes.add(u.r.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,i.NB)(r,t),(0,i.yu)(r,t),r.uniforms.add(new s.I("viewport",(e=>e.camera.fullViewport)),new l.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.U("cameraGroundRelative",(e=>e.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,n.V)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(c.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(c.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?c.H.float(0):c.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,i.S7)(r),t.draped||(r.uniforms.add(new a.U("perDistancePixelRatio",(e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2)))),r.code.add(c.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${c.H.float(d)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,i.Nz)(r),t.hasScreenSizePerspective&&(0,o.OH)(r),r.code.add(c.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?c.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":c.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},40431:(e,t,r)=>{r.d(t,{L:()=>O,b:()=>x});var n=r(19555),o=r(72745),i=r(55855),s=r(26917),a=r(98720),l=r(40318),c=r(62374),u=r(10708),d=r(69817),h=r(28450),f=r(95756),p=r(51596),m=r(58350),g=r(21390),y=r(86955),v=r(66470),b=r(2687);function x(e){const t=new b.N5,{vertex:r,fragment:o}=t,{terrainDepthTest:x}=e;return r.include(a.K),t.include(l.Q,e),t.vertex.include(s.rA,e),t.attributes.add(v.r.UV0,"vec2"),r.uniforms.add(new p.I("viewport",(e=>e.camera.fullViewport)),new g.m("lineSize",((e,t)=>e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0)),new h.E("pixelToNDC",(e=>(0,n.hZ)(S,2/e.camera.fullViewport[2],2/e.camera.fullViewport[3]))),new g.m("borderSize",((e,t)=>e.borderColor?t.camera.pixelRatio:0)),new f.G("screenOffset",((e,t)=>(0,n.hZ)(S,e.horizontalScreenOffset*t.camera.pixelRatio,0)))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),x&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(c.y),e.hasScreenSizePerspective&&(0,d.OH)(r),r.main.add(y.H`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${(0,y.If)(e.occlusionTestEnabled,y.H`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${e.hasScreenSizePerspective?y.H`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${(0,y.If)(x,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${(0,y.If)(e.hudDepth,e.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?y.H`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:y.H`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),o.uniforms.add(new m.E("uColor",(e=>e.color??i.uY)),new m.E("borderColor",(e=>e.borderColor??i.uY))),x&&(o.include(u.H,e),o.uniforms.add(new h.E("inverseViewport",(e=>e.inverseViewport)))),o.main.add(y.H`
    ${(0,y.If)(x,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${(0,y.If)(!e.hudDepth,y.H`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),t}const S=(0,o.vt)(),O=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}))},41595:(e,t,r)=>{r.d(t,{KF:()=>m,MF:()=>p,VG:()=>d,g7:()=>f,gf:()=>h,hI:()=>c,o8:()=>l,q6:()=>u});var n=r(76460),o=r(50346),i=r(32535),s=r(98976);const a=()=>n.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){const t=e?.expression;if("string"==typeof t){const e=y(t);if(null!=e)return{cachedResult:e}}return null}async function u(e,t,r,n){const i=e?.expression;if("string"!=typeof i)return null;const a=y(i);if(null!=a)return{cachedResult:a};const l=await(0,s.lw)();(0,o.throwIfAborted)(r);const c=l.arcadeUtils,u=c.createSyntaxTree(i);return c.dependsOnView(u)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function d(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function h(e,t){if(null!=e&&!g(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=(0,i.wZ)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function f(e){if(null!=e){if(g(e))return e.cachedResult;const t=e.arcade;let r=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function p(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e?.featureExpressionInfo;const n=r?.expression;return t||"0"===n||(r=null),r??null}const m={cachedResult:0};function g(e){return null!=e.cachedResult}function y(e){return"0"===e?0:null}},41854:(e,t,r)=>{var n,o;r.d(t,{G:()=>o,w:()=>n}),function(e){e[e.RecreateSymbol=0]="RecreateSymbol",e[e.RecreateGraphics=1]="RecreateGraphics",e[e.FastUpdate=2]="FastUpdate"}(n||(n={})),function(e){e[e.Slow=0]="Slow",e[e.Fast=1]="Fast",e[e.Mixed=2]="Mixed",e[e.Loading=3]="Loading",e[e.Undefined=4]="Undefined"}(o||(o={}))},42136:(e,t,r)=>{r.d(t,{I:()=>i,k:()=>s});var n=r(9392),o=r(45308);function i(e,t,r){if(null==e||null==r)return!1;let n=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,n=n&&(0,o.projectBuffer)(a,e.spatialReference,0,t,r,0),a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,n=n&&(0,o.projectBuffer)(a,e.spatialReference,0,t,r,3),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),n}function s(e,t,r){if(null==e||null==r)return!1;let n=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,n=n&&(0,o.projectBuffer)(a,e.spatialReference,0,a,r,0),t[0]=a[0],t[1]=a[1],a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,n=n&&(0,o.projectBuffer)(a,e.spatialReference,0,a,r,0),t[2]=a[0],t[3]=a[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),n}const a=(0,n.vt)()},46702:(e,t,r)=>{var n;r.d(t,{x:()=>n}),function(e){e[e.TRANSPARENT=0]="TRANSPARENT",e[e.OPAQUE=1]="OPAQUE"}(n||(n={}))},48989:(e,t,r)=>{r.d(t,{Eg:()=>d,GI:()=>g,JV:()=>m,Tf:()=>h,k9:()=>f,pg:()=>v,uD:()=>u});var n=r(4212),o=r(47675),i=r(86954),s=r(73177),a=r(90346),l=r(7342),c=r(65131);const u=new a.hk({});function d(e){return"web-style"===e.type?u:h(e.symbolLayers.toArray().map((t=>m(e,t))))}function h(e){let t=0,r=0,n=0,o=!1,i=0;const s=new a.i3;for(const a of e)null!=a&&(t+=a.verticesPerFeature,r+=a.verticesPerCoordinate,n+=a.drawCallsPerFeature,s.bytesPerFeature+=a.memory.bytesPerFeature,s.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s.resourceBytes+=a.memory.resourceBytes,s.draped.bytesPerFeature+=a.memory.bytesPerFeature,s.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o=o||a.estimated,++i);return o?new a.a8(i,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:n,memory:s}):new a.MT(i,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:n,memory:s})}function f(e){const t=h(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}const p={};function m(e,t){const r=g(e,t),s=(0,l.RF)(t)?2:0;switch(t.type){case"extrude":return new a.rz({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:s,memory:r});case"fill":if("mesh-3d"===e.type)return new a.rz({drawCallsPerFeature:s,memory:r});if(null!=t.outline&&t.outline.size>0)return new a.rz({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new a.rz({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new a.rz({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return t.resource?.href?new a.hk({verticesPerFeature:100,memory:r}):{...y(t.resource?.primitive??o.r),memory:r};case"path":{let e=0,o=0;switch(t.profile){case"circle":e=i.ZC;break;case"quad":e=4;break;default:return void(0,n.Xb)(t.profile)}switch(t.join){case"round":o=i.kf;break;case"miter":case"bevel":o=1;break;default:return}const s=2*e,l=e*o*2,c=l+s;let u=-2*l-s;switch(t.cap){case"none":break;case"butt":case"square":u+=2*(e-1);break;case"round":u+=2*(e*(i.RL-1)*2+e);break;default:return}return new a.rz({verticesPerFeature:u,verticesPerCoordinate:c,memory:r})}case"text":case"icon":return new a.rz({verticesPerFeature:6,memory:r});default:return}}function g(e,t){const r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?b.EXTRUDE_EDGES:b.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?b.FILL_OUTLINE:b.FILL;case"water":return b.FILL;case"line":return"round"===t.join?b.LINE_ROUND:b.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return b.PATH_ROUND_CIRCLE;case"quad":return b.PATH_ROUND_QUAD;default:return void(0,n.Xb)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return b.PATH_MITER_CIRCLE;case"quad":return b.PATH_MITER_QUAD;default:return void(0,n.Xb)(t.profile)}default:return}case"object":return r?b.OBJECT_POINT:b.OBJECT_POLYGON;case"icon":case"text":return r?b.ICON_POINT:b.ICON_POLYGON;default:return}}function y(e){const t=p[e];if(t)return t;const r=v((0,s._)(e,new c.$U({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return p[e]=new a.rz({verticesPerFeature:r}),p[e]}function v(e){return e.reduce(((e,t,r)=>e+t.numVertices*(1/10**r)),0)/e.reduce(((e,t,r)=>e+1/10**r),0)}const b={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}}},49048:(e,t,r)=>{r.d(t,{x:()=>n});class n{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}}},49223:(e,t,r)=>{r.d(t,{Q:()=>l});var n=r(40492),o=r(48989),i=r(41854),s=r(75646),a=r(73625);class l extends s.x{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e,acceptedFormats:n.t});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:o.uD}globalPropertyChanged(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):i.w.RecreateSymbol}prepareSymbolPatch(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,n){return this.graphics3DSymbol?.updateTransform(e,t,r,n)??!1}onRemoveGraphic(){}updateFocus(e,t){}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??i.G.Loading}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}get cachedMemory(){return(0,a.h)(this)}}},49296:(e,t,r)=>{r.d(t,{F:()=>i});var n=r(59097),o=r(41595);class i{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,n.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,o.g7)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,n.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,r){if(null==e)return void(this._featureExpressionInfoContext=null);const n=e?.arcade;n&&null!=t&&null!=r?(this._featureExpressionInfoContext=(0,o.o8)(e),(0,o.gf)(this._featureExpressionInfoContext,(0,o.VG)(n.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new i;return null!=e&&t.setFromElevationInfo(e),t}}},50840:(e,t,r)=>{r.d(t,{S:()=>a});var n=r(9392),o=r(45308),i=r(2413),s=r(80963);function a(e,t,r,n){return null!=e&&((0,s.aI)(t,n)?((0,i.C)(r,e),!0):(l[0]=e[0],l[1]=e[1],l[2]=0,!!(0,o.projectBuffer)(l,t,0,l,n,0)&&(r[0]=l[0],r[1]=l[1],l[0]=e[2],l[1]=e[3],l[2]=0,!!(0,o.projectBuffer)(l,t,0,l,n,0)&&(r[2]=l[0],r[3]=l[1],!0))))}const l=(0,n.vt)()},57662:(e,t,r)=>{var n,o,i;r.d(t,{O7:()=>o,Om:()=>n,sv:()=>i}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(n||(n={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(o||(o={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(i||(i={}))},62374:(e,t,r)=>{r.d(t,{y:()=>c});var n=r(98720),o=r(98521),i=r(51596),s=r(23148),a=r(86955),l=r(4653);function c(e){e.vertex.uniforms.add(new s.U("renderTransparentlyOccludedHUD",(e=>e.hudRenderStyle===o.D.Occluded?1:e.hudRenderStyle===o.D.NotOccluded?0:.75)),new i.I("viewport",(e=>e.camera.fullViewport)),new l.x("hudVisibilityTexture",(e=>e.hudVisibility?.getTexture()))),e.vertex.include(n.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},65768:(e,t,r)=>{r.d(t,{P:()=>n,T:()=>o});class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=r,this.maximumFeatures=n,this.nodes=o,this.core=i}}function o(e){return"performanceInfo"in e}},67425:(e,t,r)=>{r.d(t,{I2:()=>g,Kf:()=>v,Uk:()=>S,ai:()=>x,au:()=>f,fe:()=>b,nG:()=>m,nu:()=>y,sE:()=>p,uw:()=>n});var n,o,i=r(34761),s=r(13191),a=r(9392),l=r(5809),c=r(45308),u=r(81284),d=r(80935),h=r(66470);function f(e,t,r,n,o,i,s,a,l,u,d){const h=O[d.mode];let f,p,m=0;if((0,c.projectBuffer)(e,t,r,n,l.spatialReference,o,a))return h?.requiresAlignment(d)?(m=h.applyElevationAlignmentBuffer(n,o,i,s,a,l,u,d),f=i,p=s):(f=n,p=o),(0,c.projectBuffer)(f,l.spatialReference,p,i,u.spatialReference,s,a)?m:void 0}function p(e,t,r,n,o){const i=((0,u.v)(e)?e.z:(0,d.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const r=(0,d.R1)(t,e,"ground")??0;return o.verticalDistanceToGround=0,o.sampledElevation=r,void(o.z=r)}case"relative-to-ground":{const s=(0,d.R1)(t,e,"ground")??0,a=r.geometryZWithOffset(i,n);return o.verticalDistanceToGround=a,o.sampledElevation=s,void(o.z=a+s)}case"relative-to-scene":{const s=(0,d.R1)(t,e,"scene")??0,a=r.geometryZWithOffset(i,n);return o.verticalDistanceToGround=a,o.sampledElevation=s,void(o.z=a+s)}case"absolute-height":{const s=r.geometryZWithOffset(i,n),a=(0,d.R1)(t,e,"ground")??0;return o.verticalDistanceToGround=s-a,o.sampledElevation=a,void(o.z=s)}default:return void(o.z=0)}}function m(e,t,r,n){return p(e,t,r,n,E),E.z}function g(e,t,r){return"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?null==t||null==r?e.definedChanged:n.UPDATE:e.onTheGroundChanged}function y(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function b(e,t,r,n,o){p(t,r,o,n,E),x(e,E.verticalDistanceToGround);const s=E.sampledElevation,a=(0,i.C)(_,e.transformation);return P[0]=t.x,P[1]=t.y,P[2]=E.z,(0,l.l)(t.spatialReference,P,a,n.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function x(e,t){for(let r=0;r<e.geometries.length;++r){const n=e.geometries[r].getMutableAttribute(h.r.CENTEROFFSETANDDISTANCE);n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[r],h.r.CENTEROFFSETANDDISTANCE))}}class S{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(o=n||(n={}))[o.NONE=0]="NONE",o[o.UPDATE=1]="UPDATE",o[o.RECREATE=2]="RECREATE";const O={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,n,o,i,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,n*=3;for(let u=0;u<o;++u){const o=e[t],i=e[t+1],s=e[t+2];r[n]=o,r[n+1]=i,r[n+2]=null==c?s+l:l,t+=3,n+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,o,i){let s=0;const a=i.spatialReference;t*=3,n*=3;for(let l=0;l<o;++l){const o=e[t],l=e[t+1],c=e[t+2],u=i.getElevation(o,l,c,a,"ground")??0;s+=u,r[n]=o,r[n+1]=l,r[n+2]=u,t+=3,n+=3}return s/o},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,o,i,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,d=i.spatialReference;t*=3,n*=3;for(let h=0;h<o;++h){const o=e[t],s=e[t+1],a=e[t+2],h=i.getElevation(o,s,a,d,"ground")??0;l+=h,r[n]=o,r[n+1]=s,r[n+2]=null==u?a+h+c:h+c,t+=3,n+=3}return l/o},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,n,o,i,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,d=i.spatialReference;t*=3,n*=3;for(let h=0;h<o;++h){const o=e[t],s=e[t+1],a=e[t+2],h=i.getElevation(o,s,a,d,"scene")??0;l+=h,r[n]=o,r[n+1]=s,r[n+2]=null==u?a+h+c:h+c,t+=3,n+=3}return l/o},requiresAlignment:()=>!0}},_=(0,s.vt)(),E=new S,P=(0,a.vt)()},67737:(e,t,r)=>{r.d(t,{G:()=>n,Q:()=>o});const n={stableRendering:!1},o={rootOrigin:null}},70335:(e,t,r)=>{r.d(t,{Rg:()=>l,Sc:()=>a});var n=r(72745),o=r(20664),i=r(9392),s=r(13927);function a(e,t,r,n){return h(e,t,r,u(n,t,r,!0))}function l(e,t,r,n){const i=(0,o.f)(r,(0,o.d)(e,n,t));return(0,o.g)(e,t,(0,o.h)(e,r,i))}const c={dir:(0,i.vt)(),len:0,clip:(0,n.vt)()};function u(e,t,r,n){const i=c;return e?(r&&n&&(i.len=(0,o.j)(t,r)),(0,o.c)(i.dir,e)):n?(i.len=(0,o.j)(t,r),(0,o.d)(i.dir,r,t),(0,o.h)(i.dir,i.dir,1/i.len)):((0,o.d)(i.dir,r,t),(0,o.n)(i.dir,i.dir)),i}function d(e,t,r){const n=(0,o.f)((0,s.Qj)(e),r.dir),i=-(0,s.mN)(e,t);if(i<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return i>0;if((i<0||n<0)&&!(i<0&&n<0))return!0;const a=i/n;return n>0?a<r.clip[1]&&(r.clip[1]=a):a>r.clip[0]&&(r.clip[0]=a),r.clip[0]<=r.clip[1]}function h(e,t,r,n){n.clip[0]=0,n.clip[1]=r?n.len:Number.MAX_VALUE;for(let o=0;o<e.length;o++)if(!d(e[o],t,n))return!1;return!0}},71488:(e,t,r)=>{r.d(t,{H:()=>a,h:()=>s});var n=r(3112),o=r(35737),i=r(46571);class s extends o.R6{constructor(e,t,r,n,o){super(e,t),this.layerUid=e,this.graphicUid=t,this.triangleNr=r,this.baseBoundingSphere=n,this.numLodLevels=o}}function a(e){return(0,i.i3)(e)&&e.intersector===n.dz.LOD&&!!e.target}},73177:(e,t,r)=>{r.d(t,{_:()=>s,k:()=>i});r(81806);var n=r(62577),o=r(12062);function i(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function s(e,t){const r=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new o.Fe(e.map((e=>{const i=t(e.tesselation);return r&&(0,n.zC)(i),new o.hr([new o.iC(new o.dI(i))],e.minScreenSpaceRadius)})))};switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>(0,n.uX)(t,.5,e,!0)));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,n.C1)(t,1)));case"cone":return r(a,(e=>(0,n.EE)(t,1,.5,e,!1)),!0);case"inverted-cone":return r(a,(e=>(0,n.EE)(t,1,.5,e,!0)),!0);case"cylinder":return r(a,(e=>(0,n.nW)(t,1,.5,e,[0,0,1],[0,0,.5])));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,n.Ho)(t,1)),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,n.td)(t,1)),!0);default:return}}const a=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},73625:(e,t,r)=>{r.d(t,{h:()=>i});const n=2216,o=4096;function i(e){return n+o*e.symbolLayers.length+e.complexity.memory.resourceBytes}},75507:(e,t,r)=>{r.d(t,{f:()=>i});var n=r(9392);class o{constructor(e,t){this.vec3=e,this.id=t}}function i(e,t,r,i){return new o((0,n.fA)(e,t,r),i)}},75646:(e,t,r)=>{r.d(t,{P:()=>n,x:()=>a});var n,o,i=r(30726),s=r(50346);class a{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=n.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===n.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===n.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=n.LOADED}),(e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=n.FAILED,!(0,s.isAbortError)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e}))),this._loader.then(e,t).catch((()=>{})),this._loader)}abortLoad(){null!=this._abortController?this._abortController=(0,i.DC)(this._abortController):this._loadStatus===n.LOADING&&(this._loadStatus=n.FAILED),this._loader=null}}(o=n||(n={}))[o.LOADING=0]="LOADING",o[o.LOADED=1]="LOADED",o[o.FAILED=2]="FAILED"},86486:(e,t,r)=>{r.d(t,{LO:()=>a,kg:()=>l,or:()=>c,vl:()=>s});var n=r(69539),o=r(11687),i=r(15492);function s(e,t){const r=function(e,t){if(null!=e.symbol)return e.symbol;const r=t?.renderer;return null!=r&&"dot-density"!==r.type?r.getSymbol(e,t):null}(e,t);if(null==r)return null;const n=t?.renderer,s=new o.$(n,r);if(null==n||!("visualVariables"in n)||!n.visualVariables)return s;const a=(0,i.getVisualVariableValues)(n,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:o,value:i}of a)switch(o.type){case"color":s.color=i.toRgba();break;case"size":if("outline"===o.target)s.outlineSize=i;else{const e=o.axis,t=o.useSymbolValue?"symbol-value":i;switch(e){case"width":l[0]=t;break;case"depth":l[1]=t;break;case"height":l[2]=t;break;case"width-and-depth":l[0]=l[1]=t;break;default:l[0]=l[1]=l[2]=t}}break;case"opacity":s.opacity=i;break;case"rotation":switch(o.axis){case"tilt":s.tilt=i;break;case"roll":s.roll=i;break;default:s.heading=i}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(s.size=l),s}async function a(e,t){const r=await async function(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}(e,t);if(!r)return null;const s=t?.renderer,a=new o.$(s,r);if(!s||!("visualVariables"in s)||!s.visualVariables)return a;const l=(0,i.getVisualVariableValues)(s,e,t)??[],c=["proportional","proportional","proportional"];for(const{variable:o,value:i}of l)if("color"===o.type)a.color=n.default.toUnitRGBA(i);else if("size"===o.type)if("outline"===o.target)a.outlineSize=i;else{const e=o.axis,t=o.useSymbolValue?"symbol-value":i;"width"===e?c[0]=t:"depth"===e?c[1]=t:"height"===e?c[2]=t:c[0]=c[1]="width-and-depth"===e?t:c[2]=t}else"opacity"===o.type?a.opacity=i:"rotation"===o.type&&"tilt"===o.axis?a.tilt=i:"rotation"===o.type&&"roll"===o.axis?a.roll=i:"rotation"===o.type&&(a.heading=i);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(a.size=c),a}function l(e){const t=e[arguments.length>1&&void 0!==arguments[1]?arguments[1]:0];return"number"==typeof t&&isFinite(t)?t:null}function c(e){for(let t=0;t<3;t++){const r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}},86954:(e,t,r)=>{r.d(t,{RL:()=>o,ZC:()=>i,kf:()=>n});const n=3,o=3,i=10},88265:(e,t,r)=>{r.d(t,{R$:()=>g,SZ:()=>d,ZX:()=>m,d2:()=>p,hS:()=>h});var n=r(9392),o=r(64232),i=r(42294),s=r(5262),a=r(18117),l=r(67425),c=r(36423),u=r(37046);function d(e,t,r,n,o){if(f(e,t))return null;r.localOrigin=g(e,t);const i=new u.B({geometries:[r],castShadow:!1,layerUid:e.layer.uid,graphicUid:o,usesVerticalDistanceToGround:!0});return{object:i,sampledElevation:(0,l.fe)(i,t,e.elevationProvider,e.renderCoordsHelper,n)}}function h(e,t,r,n){return f(t,r)?null:(0,l.fe)(e,r,t.elevationProvider,t.renderCoordsHelper,n)}function f(e,t){const r=e.clippingExtent;return!!r&&((0,o.g)(t,y,e.elevationProvider.spatialReference),!(0,i.Uc)(r,y))}function p(e,t,r){const n=e.elevationContext,i=r.spatialReference;(0,o.g)(t,y,i),n.centerPointInElevationSR=(0,a.T)(y[0],y[1],t.hasZ?y[2]:0,null!=i?i:null)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,c.W$)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,s.$H)(t,(0,s.Yl)(t)/2);return(0,a.T)(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.extent.center}return null}function g(e,t){return(0,o.g)(t,y,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(y)}const y=(0,n.vt)()},89422:(e,t,r)=>{var n,o;r.d(t,{Z:()=>n,u:()=>o}),function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"}(n||(n={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}(o||(o={}))},89848:(e,t,r)=>{r.d(t,{Z:()=>T});var n=r(18690),o=r(98773),i=(r(81806),r(50346)),s=r(48989),a=r(97255),l=r(3789),c=r(19555),u=r(72745),d=r(20664),h=r(9392),f=r(65215),p=r(50840),m=r(42294),g=r(2413),y=r(80963),v=r(99784),b=r(98618),x=r(89422),S=r(41595);const O=new l.A(Array,(e=>(0,m.hZ)(e,m.v_)),null,10,5),_=(0,g.vt)();class E{get labelLayers(){return this._labelLayers||n.tR}get extent(){return this._extent}get isElevationSource(){return this.layers.some((e=>e?.isElevationSource))}constructor(e,t,r,n,o){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=x.Z.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=o?(0,S.VG)(o,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic((t=>{t.initialize(e),t.setVisibility(this.isVisible())}))}destroy(){this._forEachSymbolLayerGraphic((e=>e.destroy())),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic((e=>e.destroy())),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(x.u.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic((t=>{"draped"===t.type&&(e=!0)})),e}isVisible(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.u.GRAPHIC,t=arguments.length>1?arguments[1]:void 0;const r=t?this._visibleFlags|t|x.u.LABEL*t:this._visibleFlags;return e===x.u.GRAPHIC?(r&x.Z.ALL_GRAPHIC)===x.Z.ALL_GRAPHIC:(r&x.Z.ALL_LABEL)===x.Z.ALL_LABEL}setVisibilityFlag(e,t,r){const n=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const o=this.isVisible(e);if(n===o)return!1;if(e===x.u.LABEL)this._forEachLabelGraphic((e=>e.setVisibility(o)));else{this._forEachSymbolLayerGraphic((e=>e.setVisibility(o)));const e=this.isVisible(x.u.LABEL);this._forEachLabelGraphic((t=>t.setVisibility(e)))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,g.vt)(),(0,v.iQ)(t,this._extent);const r=t.spatialReference;if(!(0,y.aI)(r,e)&&!(0,p.S)(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let n=e.geometry;return"mesh"!==n.type&&"extent"!==n.type||(n=f.default.fromExtent("mesh"===n.type?n.extent:n)),(0,b.Ux)(n,t,r)}get usedMemory(){let e=(0,a.lM)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((t=>e+=t.graphics3DSymbolLayer.usedMemory)),e}computeAttachmentOrigin(){const e={render:{origin:(0,h.vt)(),num:0},draped:{origin:(0,u.vt)(),num:0}};for(const t of this.layers)null!=t&&t.computeAttachmentOrigin(e);return e.render.num>1&&(0,d.h)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&(0,c.hs)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,n,i){return i||(i={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),i.boundingBox?(0,m.Ie)(i.boundingBox):i.boundingBox=(0,m.Ie)(),i.requiresDrapedElevation=!1,await(0,o.jJ)(this.layers,(async o=>{if(null==o)return;const s="draped"===o.type?t:e,a=O.acquire(),l=await o.getProjectedBoundingBox(s,r,i.screenSpaceObjects,n,a);isFinite(l[2])&&isFinite(l[5])||(i.requiresDrapedElevation=!0),l&&(0,m.RF)(i.boundingBox,a),O.release(a)})),(0,m.vQ)(i.boundingBox)||(0,g.vQ)((0,m.ES)(i.boundingBox,_))?i:null}needsElevationUpdates(){for(const e of this.layers)if(null!=e&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;return this._labelLayers?.some((e=>e?.needsElevationUpdates??!1))??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic((n=>{"object3d"!==n.type&&"lod-instance"!==n.type||n.alignWithElevation(e,t,this._featureExpressionFeature,r)}))}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic((n=>{"object3d"===n.type&&n.alignWithAbsoluteElevation(e,t,r)}))}addObjectStateSet(e){this._forEachSymbolLayerGraphic((t=>t.addObjectState(e)))}removeObjectState(e){this._forEachSymbolLayerGraphic((t=>t.removeObjectState(e)))}updateHighlights(e){this._forEachSymbolLayerGraphic((t=>t.updateHighlights(e)))}_forEachGraphicList(e,t){e?.forEach((e=>e&&t(e)))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}var P=r(99057),w=r(22294),C=r(41854),L=r(75646),A=r(73625);class T extends L.x{set symbol(e){this._symbol=e,e.symbolLayers.forEach(((t,r)=>{const n=this.symbolLayers[r];null!=n&&(n.symbol=e,n.symbolLayer=t)}))}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const n=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const s=[],{make:a}=await Promise.all([r.e(45888),r.e(401),r.e(33062),r.e(71423),r.e(44944),r.e(95019),r.e(3595),r.e(7323),r.e(41009),r.e(97215)]).then(r.bind(r,60287));for(let r=0;r<n;r++){const o=t.at(r);if(!1===o.enabled)continue;I.renderPriority=1-(1+r)/n,I.renderPriorityStep=1/n,I.ignoreDrivers=o.ignoreDrivers;const l=a(this.symbol,o,this._context,I),c=(0,i.onAbortOrThrow)(e,(()=>{this.symbolLayers[r]=null,l.destroy()}));c&&s.push(c),this.symbolLayers[r]=l}if(await(0,o.jJ)(this.symbolLayers,(async(e,t)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}})),s.forEach((e=>e.remove())),(0,i.throwIfAborted)(e),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some((e=>e?.queryForSnapping))}updateFocus(e,t){this.symbolLayers.forEach((r=>r?.updateFocus(e,t)))}createGraphics3DGraphic(e,t){const r=e.graphic,n=this.symbolLayers.map((t=>t?.createGraphics3DGraphic(e)??null)),o=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new E(r,t||this,n,e.layer,o)}get complexity(){return(0,s.Tf)(this.symbolLayers.map((e=>null!=e?e.complexity:null)))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let n=0;n<r;n++){const r=this.symbolLayers[n],o=e=>{const t=e.layers[n];return t instanceof P.Y?t:null};if(null!=r&&!r.globalPropertyChanged(e,t,o))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==L.P.LOADED?C.w.RecreateSymbol:this.symbolLayers.reduce(((r,n)=>r!==C.w.RecreateSymbol&&null!=n?Math.min(r,n.applyRendererDiff(e,t)):r),C.w.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===L.P.FAILED)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const r=t.symbolLayers.diff;this.symbolLayers.forEach(((t,n)=>{if(null==t)return;const o=r[n];if(o){const r={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(r),e.symbolStatePatches.push(...r.symbolLayerStatePatches),r.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,t)=>{const o=e.layers[n];null!=o&&r.graphics3DGraphicPatches.forEach((e=>e(o,t)))}))}}))}updateGeometry(e,t){return this._updateGeometryOrTransform(e,((e,r)=>e.updateGeometry(r,t)))}updateTransform(e,t,r,n){return this._updateGeometryOrTransform(e,((e,o)=>e.updateTransform(o,t,r,n)))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){const n=this.symbolLayers[r];if(null==n)continue;const o=e.layers[r];if(!o||!t(n,o))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(null==r)continue;const n=e.layers[t];null!=n&&r.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=!1,t=!1;for(const r of this.symbolLayers)if(null!=r){if(r.loadStatus===L.P.LOADING)return C.G.Loading;r.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?C.G.Mixed:C.G.Fast:e?C.G.Slow:C.G.Undefined}async queryForSnapping(e,t,r,o){const s=this.symbolLayers.filter(n.Ru).filter((e=>null!=e.queryForSnapping)).map((n=>n.queryForSnapping(e,t,r,o))),a=await Promise.all(s);return(0,i.throwIfAborted)(o),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)null!=e&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return(0,A.h)(this)}}const I=new w.S},90346:(e,t,r)=>{r.d(t,{MT:()=>i,a8:()=>s,hk:()=>o,i3:()=>a,rz:()=>n});class n{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new a}}class o extends n{constructor(e){super(e),this.estimated=!0}}class i extends n{constructor(e,t){super(t),this.numComplexities=e}}class s extends o{constructor(e,t){super(t),this.numComplexities=e}}class a{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}},90992:(e,t,r)=>{r.d(t,{E5:()=>a,JU:()=>s,Of:()=>o,Uk:()=>i,WK:()=>l,g7:()=>c,lO:()=>u,lQ:()=>d});var n=r(50076);function o(e){return e&&"function"==typeof e.highlight}function i(e){return e&&"function"==typeof e.maskOccludee}function s(e,t,r){return null==e||e>=r&&(0===t||e<=t)}function a(e,t){if(t&&e){const{minScale:r,maxScale:n}=e;if(l(r,n))return s(t,r,n)}return!0}function l(e,t){return null!=e&&e>0||null!=t&&t>0}function c(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}function u(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatures"in e&&"layer"in e&&"view"in e}function d(e,t,r){return new n.default("layerview:spatial-reference-incompatible",`The spatial reference of this ${e}${t?`(wkid:${t})`:""} is incompatible with the spatial reference of the view${r?`(wkid:${r})`:""}.`,{})}},94683:(e,t,r)=>{r.d(t,{I:()=>l,p:()=>a});var n=r(18690),o=(r(81806),r(50346)),i=r(66388),s=r(59752);class a{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,n,o){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,o,r,n)}}class l{constructor(e,t,r,n){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(s.W6.ELEVATION_QUERY,this)}destroy(){let{completeTasks:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{completeTasks:!1};if(this._frameTask.remove(),this.running)if(e)this.runTask(s.Bb);else for(const t of this._queries)t.result.reject((0,o.createAbortError)())}queryElevation(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=(0,o.createResolver)(),a={x:e,y:t,minDemResolution:i,result:s,signal:r};return this._queries.push(a),(0,o.onAbort)(r,(()=>{(0,n.TF)(this._queries,a),s.reject((0,o.createAbortError)())})),s.promise}get running(){return this._queries.length>0}runTask(e){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return t.forEach((e=>e.result.reject())),void e.madeProgress();const n=t.map((e=>[e.x,e.y])),s=t.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),a=new i.default({points:n,spatialReference:this.spatialReference}),l=t.length>1&&t.some((e=>!!e.signal))?new AbortController:null,c=null!=l?l.signal:t[0].signal;if(null!=l){let e=0;t.forEach((r=>(0,o.onAbort)(r.signal,(()=>{e++,r.result.reject((0,o.createAbortError)()),e===t.length&&l.abort()}))))}const u={...this._queryOptions,minDemResolution:s,signal:c};r.queryElevation(a,u).then((e=>{t.forEach(((t,r)=>{null!=t.signal&&t.signal.aborted?t.result.reject((0,o.createAbortError)()):t.result.resolve(e.geometry.points[r][2])}))})).catch((e=>{t.forEach((t=>t.result.reject(e)))})),e.madeProgress()}get test(){}}},97583:(e,t,r)=>{r.d(t,{g:()=>y});r(81806);var n=r(90632),o=r(20664),i=r(9392),s=r(55855),a=r(45308),l=r(50468),c=r(87634),u=r(17345),d=r(75507),h=r(37046),f=r(67737),p=r(66470),m=r(8918),g=r(425);class y{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,n.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=f.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,d.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const r=(0,d.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,n=Math.round(e[0]/r),i=Math.round(e[1]/r),s=Math.round(e[2]/r),a=`${n}/${i}/${s}`;let l=this._origins.get(a);const c=.5*r;if((0,o.d)(v,e,t.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),v[0]<c&&v[1]<c&&v[2]<c){if(l){const t=Math.max(...v);if((0,o.d)(v,e,l.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),Math.max(...v)<t)return l}return t}return l||(l=(0,d.f)(n*r,i*r,s*r,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.fA)(1,1,0,1);const r=window.view,n=r._stage,o=t.toString();if(!this._objects.has(o)){this._material=new g.W({width:2,color:t}),n.add(this._material);const e=new m.x(n,{pickable:!1}),r=new h.B({castShadow:!1});n.add(r),e.add(r),this._objects.set(o,r)}const i=this._objects.get(o),d=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],f=d.length,y=new Array(3*f),v=new Array,b=.5*this._gridSize;for(let s=0;s<f;s++)y[3*s]=e[0]+(1&d[s]?b:-b),y[3*s+1]=e[1]+(2&d[s]?b:-b),y[3*s+2]=e[2]+(4&d[s]?b:-b),s>0&&v.push(s-1,s);(0,a.projectBuffer)(y,this._originSR,0,y,r.renderSpatialReference,0,f);const x=new u.V(this._material,[[p.r.POSITION,new l.n(y,v,3,!0)]],null,c.X.Line);n.add(x),i.addGeometry(x)}get test(){}}const v=(0,i.vt)()},98521:(e,t,r)=>{var n;r.d(t,{D:()=>n}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(n||(n={}))},98720:(e,t,r)=>{r.d(t,{K:()=>i});var n=r(67582),o=r(86955);function i(e){e.uniforms.add(new n.o("alignPixelEnabled",(e=>e.alignPixelEnabled))),e.code.add(o.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(o.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},99057:(e,t,r)=>{r.d(t,{H:()=>h,Y:()=>f});var n=r(20664),o=r(9392),i=r(42294),s=r(78315),a=r(67425),l=r(41595),c=r(36423),u=r(83490),d=r(46702);class h{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=r}}class f{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,r,n,o,i,s){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=n,this._sharedResource=o,this.elevationAligner=i,this.elevationContext=s,this._edgeState=a,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){const{stageObject:r,_edgeState:n,_stageLayer:o}=this;if(null==n)return;const i=p(n.baseMaterial);n.edgeMaterial.objectTransparency!==i&&(n.edgeMaterial.objectTransparency=i,this.resetEdgeObject(t)),o.stage.renderer.withEdgeView((t=>t.updateAllComponentOpacities(r,[e])))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){const{stageObject:r,_edgeState:n,_stageLayer:o}=this;null!=n&&o.stage.renderer.withEdgeView((o=>{o.updateAllComponentMaterials(r,n.edgeMaterial,e,!t),n.hasSlicePlane=e}))}setVisibility(e){const{_edgeState:t,stageObject:r,_stageLayer:n}=this;null!=n&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(n.add(r),this._addedToStage=!0),null!=t&&n.stage.renderer.withEdgeView((n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(t,n,!1)})))}get visible(){return this._visible}alignWithElevation(e,t,r,n){if(null==this.elevationAligner)return;null!=r&&(0,l.gf)(this.elevationContext.featureExpressionInfoContext,r);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,((r,n)=>(0,a.sE)(r,e,this.elevationContext,t,n)),t),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,t,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,((t,r)=>{r.sampledElevation=e,r.verticalDistanceToGround=0,r.z=e}),t),this.resetEdgeObject(r)}getCenterObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,o.vt)();return(0,n.c)(e,(0,s.a)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.vt)();const t=this.stageObject.boundingVolumeObjectSpace;return(0,i.Ne)(e,t.min),(0,i.vI)(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(y)&&((0,n.t)(y,y,t),(0,n.g)(e.render.origin,e.render.origin,y),e.render.num++)}async getProjectedBoundingBox(e,t,r,o,s){const a=this.getBoundingBoxObjectSpace(s),l=v,u=(0,i.fT)(a)?1:l.length;for(let i=0;i<u;i++){const e=l[i];g[0]=a[e[0]],g[1]=a[e[1]],g[2]=a[e[2]],(0,n.t)(g,g,this.stageObject.transformation),m[3*i]=g[0],m[3*i+1]=g[1],m[3*i+2]=g[2]}if(!e(m,0,u))return null;(0,i.Ie)(a);let d=null;this.calculateRelativeScreenBounds&&(d=this.calculateRelativeScreenBounds());for(let n=0;n<3*u;n+=3){for(let e=0;e<3;e++)a[e]=Math.min(a[e],m[n+e]),a[e+3]=Math.max(a[e+3],m[n+e]);d&&r.push({location:m.slice(n,n+3),screenSpaceBoundingRect:d})}if(t?.service&&"absolute-height"!==this.elevationContext.mode){(0,i.gX)(a,y);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let r=0;if(t.useViewElevation)r=t.service.getElevation(y[0],y[1],e)??0;else try{const n=(0,c.vY)(a,t.service.spatialReference,t);r=await t.service.queryElevation(y[0],y[1],o,n,e)??0}catch(h){}(0,i.cY)(a,0,0,-this.alignedSampledElevation+r)}return a}addObjectState(e){e.stateType===u.Mg.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===u.Mg.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:r,_stageLayer:n,_visible:o}=this;null!=t&&n.stage.renderer.withEdgeView((n=>{o?this._addOrUpdateEdgeObject(t,n,e):n.removeObject(r)}))}_addOrUpdateEdgeObject(e,t,r){const n=p(e.baseMaterial);e.edgeMaterial.objectTransparency=n,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then((()=>this._stageLayer?.sync()))}}function p(e){return e.parameters.transparent?d.x.TRANSPARENT:d.x.OPAQUE}const m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=(0,o.vt)(),y=(0,o.vt)(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},99784:(e,t,r)=>{r.d(t,{Ek:()=>v,HP:()=>h,JS:()=>m,Kq:()=>b,N3:()=>f,RW:()=>_,Uz:()=>E,ao:()=>x,gR:()=>y,iQ:()=>O,jy:()=>p,w9:()=>S});r(81806);var n=r(97255),o=r(90632),i=r(13312),s=r(42294),a=r(2413),l=r(76279),c=r(31608),u=r(44135),d=r(28660);r(74e3);class h{constructor(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function f(e){return null!=e.geometry}class p{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function m(e,t){const r=c.gy.fromJSON(e.geometryType),n=i.default.fromJSON(e.spatialReference),s=e.transform,a=e.objectIdFieldName,d=t?.maxStringAttributeLength,h=t?.maxStringAttributeFields;let f;const p=e.features.map((t=>{const i=function(e,t,r,n){return{uid:(0,o.c)(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:g(e.geometry,t,r),visible:!0}}(t,r,n,e.objectIdFieldName),c=i.geometry;if(E(i.attributes,h,d,(e=>{f??=[];const t=_(i,a);null!=t&&f.push({objectId:t,attribute:e})})),null!=c&&s)switch(c.type){case"point":i.geometry=(0,l.Tr)(s,c,c);break;case"multipoint":i.geometry=(0,l.SW)(s,c,c);break;case"polygon":i.geometry=(0,l.$X)(s,c,c);break;case"polyline":i.geometry=(0,l.P5)(s,c,c);break;case"extent":case"mesh":i.geometry=c}return i}));return{geometryType:r,features:p,spatialReference:n,fields:e.fields?.map((e=>u.default.fromJSON(e)))??[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null,missingAttributes:f}}function g(e,t,r){if(null==e)return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:r}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:r}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:r}}}}function y(e){if(null==e)return 0;switch(e.type){case"point":return n.qK+10+8+24;case"polyline":case"polygon":{let t=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),o="polyline"===e.type?e.paths:e.rings,i="polyline"===e.type?e.curvePaths:e.curveRings;if(i?.length){const e=3*(0,d.B1)()*128;t=8*e*r+128*e+32*(o.length+1)}else t=(0,n.Qh)(o);return n.qK+64+t+34}case"multipoint":{const t=(0,n.Qh)(e.points);return n.qK+t+64+34+32}case"extent":return n.qK+10+64+34;case"mesh":{const t=e.vertexAttributes;return n.qK+(0,n.Qf)(t.position,t.normal,t.uv,t.tangent)}default:return n.qK}}function v(e){let t=32;return t+=(0,n.lM)(e.attributes),t+=3,t+=8+y(e.geometry),t}function b(e){if(null==e)return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function x(e){if(null==e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function S(e,t){switch((0,s.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,s.Jf)(t,e.paths[r],!!e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,s.Jf)(t,e.rings[r],!!e.hasZ);break;case"multipoint":(0,s.Jf)(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function O(e,t){switch((0,a.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,a.Jf)(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,a.Jf)(t,e.rings[r]);break;case"multipoint":(0,a.Jf)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function _(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function E(e,t,r,n){if(t?.size&&null!=r&&e)for(const o in e){if(!t.has(o))continue;const i=e[o];"string"==typeof i&&i.length>r&&(n(o),e[o]="")}}}}]);
//# sourceMappingURL=15405.4f7aca26.chunk.js.map