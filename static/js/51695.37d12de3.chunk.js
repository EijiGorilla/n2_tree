"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[9912,30295,51695],{3320:(e,t,n)=>{n.d(t,{Au:()=>I,CU:()=>P,Et:()=>b,Gq:()=>N,H1:()=>R,HG:()=>x,Iy:()=>O,Kl:()=>Q,Kn:()=>H,LZ:()=>M,TN:()=>_,U3:()=>K,Ve:()=>q,XI:()=>Z,bx:()=>T,cU:()=>E,k_:()=>w,lB:()=>G,l_:()=>D,n4:()=>z,nT:()=>v,oc:()=>k,qG:()=>V,rf:()=>h,s9:()=>S,t6:()=>$,tM:()=>j,vp:()=>A,wr:()=>F});n(11265);var r=n(18690),i=n(4212),l=n(53084),a=n(76460),o=n(88685),s=n(71764),u=n(15142),d=n(53430),c=n(31933),f=n(42633),p=n(20639),m=n(23301),y=n(26547),g=n(39348);const h=e=>"field"===e?.type,b=e=>"group"===e?.type,v=e=>"relationship"===e?.type,w=e=>"text"===e.type,I=e=>"utilityNetworkAssociations"===e.type,T=e=>!b(e)&&null!=e.group,F=e=>e.reduce(((e,t)=>b(t)?[...e,...t.inputs]:[...e,t]),[]),O=e=>F(e).filter(h),E=e=>F(e).filter(v),_=e=>F(e).filter(I),Z=e=>null!=e&&(x(e,"combo-box")||x(e,"radio-buttons")),x=(e,t)=>null!=e&&e.input?.type===t,N=e=>{let{domain:t,inputType:n="text-box",dataType:r}=e;return"number"===r&&"text-box"===n&&(!t||"coded-value"!==t.type)};function A(e,t){const{title:n,feature:r}=e??{};return n||(r?(0,y.R)(r):null)||t||""}function M(e){const{attributes:t,fieldsIndex:n,label:i,timeZone:l}=e;if(!t||"object"!=typeof t)return i;const a=Object.keys(t).filter((e=>(0,o.mk)(i,e))),s=a.map((e=>t[e])),u=a.map((e=>n.get(e))).filter(r.Ru);return function(e,t){return(0,o.HC)((0,o.HC)(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[t.toLowerCase(),n]}))))}(i,q({values:s,fields:u,timeZone:l}))}const L="expression/",C="expr/",U="field/";function k(e){const[t,n]=e.split(L);return""===t&&n?n:(a.A.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${L}/expressionName'`),"")}function $(e){return`${L}${e}`}function R(e){return`${U}${e}`}function S(e){return e.startsWith(L)}function V(e){return e.startsWith(C)}function q(e){const{fields:t,values:n}=e,r=e.timeZone??void 0,i=t.map(((e,t)=>{let i=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===i));t?.name&&(i=t.name)}return((0,f.fs)(e)||(0,d.isTimeOnlyField)(e))&&(i=(0,p.ZP)(e,i,{timeZone:r,...(0,p.ZT)(e)})),[e.name,i]}));return Object.fromEntries(i)}const P=e=>{const t={typeFieldName:null,types:[]};return e?((0,c.Sv)(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map((e=>{let{id:t,name:n,domains:r}=e;return{code:t,name:n,domains:r}}))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},j=(e,t,n)=>{const{dataType:r,error:i,minLength:l}=e,a=t?.validationErrors;if(!a||!i)return null;if(i===m.gK.CANNOT_BE_EMPTY)return a.cannotBeNull;if(i===u.Mh.VALUE_OUT_OF_RANGE||i===d.NumericRangeValidationError.OUT_OF_RANGE){const{field:t,range:i}=e,l={type:"date",intlOptions:{timeZone:"date"===t.type&&n?n:void 0,...(0,p.ZT)(t)}},o=(0,m.hQ)(i,a);return(0,g.V)(o,i,{format:{max:"date"===r?l:null!=i.max&&(0,m.qn)(i.max)?m.Qv:m.PA,min:"date"===r?l:null!=i.min&&(0,m.qn)(i.min)?m.Qv:m.PA}})}return i===u.Mh.INVALID_CODED_VALUE?a.invalidCodedValue:i===d.TypeValidationError.INVALID_TYPE?a.invalidType:i===m.gK.TOO_SHORT?(0,g.V)(a.tooShort,{min:l}):(m.gK.TOO_LONG,null)},D=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":"mesh"===r||"mesh"===n||"multipatch"===n?"cube":"multipoint"===r||"multipoint"===n?"point":r||n||"table"},z=e=>{const t=[];if(e.formTemplate){const{description:n,title:r}=e.formTemplate;e.fields?.forEach((e=>{const i=r&&(0,o.mk)(r,e.name),l=n&&(0,o.mk)(n,e.name);(i||l)&&t.push(e.name)}))}return t};function G(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(s.jt)??[]).some((t=>{let{fieldName:n}=t;return!e.fieldsIndex.get(n)}))}function H(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function Q(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return(0,i.Xb)(t.objectType),!1}}function K(e,t,n){const r=(0,c.fV)(e),i=r?.find((e=>e.code===n));if(!i)return!1;const a=r?.find((e=>e.code===t));return!(0,l.equalsShallow)(i.defaultValues,a?.defaultValues)&&Object.values(i.defaultValues).some((e=>null!=e))}},9912:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>J,createFieldInfoMap:()=>Q,findRelatedLayer:()=>oe,findUtilityNetwork:()=>se,fixTokens:()=>$,formatAttributes:()=>W,formatEditInfo:()=>H,formatValueToFieldInfo:()=>D,getAllFieldInfos:()=>K,getFieldInfo:()=>G,getFieldInfoLabel:()=>x,getFixedFieldName:()=>N,getFixedFieldNames:()=>A,getHighlightKeyForFeature:()=>ce,getSourceLayer:()=>O,graphicCallback:()=>E,htmlEntities:()=>B,isAssociatedFeatureSupportedLayer:()=>P,isExpressionField:()=>Z,isFeatureSupportedLayer:()=>S,isGraphicForRelatableFeatureSupportedLayer:()=>j,isRelatableFeatureSupportedLayer:()=>q,isRelatableLayer:()=>V,isRelatedField:()=>te,preLayerQueryCallback:()=>le,preRequestCallback:()=>ae,querySourceLayer:()=>Y,queryUpdatedFeature:()=>ee,shouldOpenInNewTab:()=>_,substituteAttributes:()=>U,substituteFieldsInLinksAndAttributes:()=>C});var r=n(81806),i=n(76460),l=n(88685),a=n(65256),o=n(50265),s=n(53430),u=n(31933),d=n(42633),c=n(98976),f=n(67478);const p=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),m=/href=(""|'')/gi,y=/(\{([^{\r\n]+)\})/g,g=/'/g,h=/^\s*expression\//i,b=/(\n)/gi,v=/[\u00A0-\u9999<>&]/gim,w=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,I=/^(?:mailto:|tel:)/,T="relationships/",F=(0,a.J2)("short-date-short-time");function O(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function E(e){let{type:t,value:n,event:r}=e;try{return"function"==typeof n?n(r):await n}catch(i){return void p().error("error",`An error occurred when calling the "${t}" function`,{error:i,graphic:r.graphic,value:n})}}function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!I.test(e.trim().toLowerCase())}function Z(e){return!!e&&h.test(e)}function x(e,t){const n=function(e,t){if(!t||!Z(t)||!e)return;const n=t.replace(h,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===n}))}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function N(e,t){const n=M(t,e);return n?n.name:e}function A(e,t){return e&&e.map((e=>N(e,t)))}function M(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function L(e){return`${e}`.trim()}function C(e){let{attributes:t,globalAttributes:n,layer:r,text:i,expressionAttributes:l,fieldInfoMap:a}=e;return i?U({formattedAttributes:n,template:R(i,{...n,...l,...t},r),fieldInfoMap:a}):""}function U(e){let{formattedAttributes:t,template:n,fieldInfoMap:r}=e;return L(function(e){return e.replaceAll(m,"")}((0,l.HC)((0,l.HC)(n,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,r))),t)))}function k(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t[e];if("string"==typeof r){const i="%27",l=(n?encodeURIComponent(r):r).replaceAll(g,i);t[e]=l}}(e,n,t))),n}function $(e,t){return e.replaceAll(y,((e,n,r)=>{const i=M(t,r);return i?`{${i.name}}`:n}))}function R(e,t,n){const r=$(e,n);return r?r.replaceAll(w,((e,n,r)=>function(e,t,n){const r=(t=L(t))&&"{"!==t[0];return(0,l.HC)(e,k(n,r||!1))}(e,n||r,t))):r}function S(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function V(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function q(e){return S(e)&&V(e)}function P(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function j(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&q(e.sourceLayer)}function D(e,t){const{fieldInfos:n,fieldName:r,preventPlacesFormatting:i,layer:l,timeZone:a}=t,u=G(n,r),c=M(l,r);if(u&&!(0,s.isRasterPixelValueField)(r)){const t=c?.type,n=u.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,d.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:l&&"preferredTimeZone"in l?l.preferredTimeZone:null,viewTimeZone:a,datesInUnknownTimezone:!(!l||!("datesInUnknownTimezone"in l))&&!!l.datesInUnknownTimezone}})}const f=u?.format;return"string"==typeof e&&(0,s.isRasterPixelValueField)(r)&&f?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?z(e,",",", ",t):e.includes(";")?z(e,";","; ",t):e.includes(" ")?z(e," "," ",t):(0,o.ZV)(Number(e),(0,o.yx)(t))}(e,f):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,f))||null==e||null==f?J(e):(0,o.ZV)(e,i?{...(0,o.yx)(f),minimumFractionDigits:0,maximumFractionDigits:20}:(0,o.yx)(f))}function z(e,t,n,r){return e.trim().split(t).map((e=>(0,o.ZV)(Number(e),(0,o.yx)(r)))).join(n)}function G(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function H(e,t,n,r){const{creatorField:i,creationDateField:l,editorField:o,editDateField:s}=e;if(!t)return;const u=(0,f.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,n,F,"date"),d={...F,...u},c=t[s];if("number"==typeof c){const e=t[o];return{type:"edit",date:(0,a.Yq)(c,d),user:e}}const p=t[l];if("number"==typeof p){const e=t[i];return{type:"create",date:(0,a.Yq)(p,d),user:e}}return null}function Q(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=N(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function K(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}})),t):t}function B(e){return e.replaceAll(v,(e=>`&#${e.charCodeAt(0)};`))}function J(e){return"string"==typeof e?e.replaceAll(b,'<br class="esri-text-new-line" />'):e}function X(e){const{value:t,fieldName:n,fieldInfos:i,fieldInfoMap:l,layer:a,graphic:o,timeZone:u}=e;if(null==t)return"";const c=function(e){let{fieldName:t,value:n,graphic:i,layer:l}=e;if(te(t))return null;if(!l||"function"!=typeof l.getFieldDomain)return null;const a=i&&l.getFieldDomain(t,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(n):null}({fieldName:n,value:t,graphic:o,layer:a});if(c)return c;const f=function(e){let{fieldName:t,graphic:n,layer:r}=e;if(te(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const l=r.getFeatureType(n);return l?l.name:null}({fieldName:n,graphic:o,layer:a});if(f)return f;if(l.get(n.toLowerCase()))return D(t,{fieldInfos:i||Array.from(l.values()),fieldName:n,layer:a,timeZone:u});const p=a?.fieldsIndex?.get(n);return p&&((0,d.fs)(p)||(0,s.isTimeOnlyField)(p))?(0,d.i0)(t,{fieldType:p.type,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:u,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}}):J(t)}function W(e){let{fieldInfos:t,attributes:n,layer:r,graphic:i,fieldInfoMap:l,relatedInfos:a,timeZone:o}=e;const s={};return a?.forEach((e=>function(e){let{attributes:t,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:a}=e;t&&n&&(n.relatedFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:a}))),n.relatedStatsFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:a}))))}({attributes:s,relatedInfo:e,fieldInfoMap:l,fieldInfos:t,layer:r,timeZone:o}))),n&&Object.keys(n).forEach((e=>{const a=n[e];s[e]=X({fieldName:e,fieldInfos:t,fieldInfoMap:l,layer:r,value:a,graphic:i,timeZone:o})})),s}async function Y(e,t){const{layer:n,graphic:r,outFields:i,objectIds:l,returnGeometry:a,spatialReference:o}=e,s=l[0];if("number"!=typeof s&&"string"!=typeof s){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:r,objectId:s,requiredFields:i};return p().warn(e,t),null}if(!(0,u.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:r,requiredFields:i,returnGeometry:a};return p().warn(e,t),null}const d=n.createQuery();return d.objectIds=l,d.outFields=i?.length?i:[n.objectIdField],d.returnGeometry=!!a,d.returnZ=!!a,d.returnM=!!a,d.outSpatialReference=o,(await n.queryFeatures(d,t)).features[0]}async function ee(e,t){let{graphic:n,popupTemplate:r,layer:i,spatialReference:l}=e;if(!i||!r)return;if("function"==typeof i.load&&await i.load(t),!n.attributes)return;const a=i.objectIdField,o=n.attributes[a];if(null==o)return;const u=[o],d=await r.getRequiredFields(i.fieldsIndex),f=(0,s.featureHasFields)(d,n),p=f?[]:d.includes(a)?d:[...d,a],m=r.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(r);if(f&&!m)return;const y=await Y({layer:i,graphic:n,outFields:p,objectIds:u,returnGeometry:m,spatialReference:l},t);y&&(y.geometry&&(n.geometry=y.geometry),y.attributes&&(n.attributes={...n.attributes,...y.attributes}))}function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(T)}function ne(e){let{attributes:t,graphic:n,relatedInfo:r,fieldInfos:i,fieldInfoMap:l,layer:a,timeZone:o}=e;t&&n&&r&&Object.keys(n.attributes).forEach((e=>{const s=function(e){return`${T}${e.layerId}/${e.fieldName}`}({layerId:r.relation.id.toString(),fieldName:e}),u=n.attributes[e];t[s]=X({fieldName:s,fieldInfos:i,fieldInfoMap:l,layer:a,value:u,graphic:n,timeZone:o})}))}const re=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ie=e=>{let{layer:t,method:n,query:r,definitionExpression:i}=e;if(!t.capabilities?.query?.supportsCacheHint||"attachments"===n)return;const l=null!=r.where?r.where:null,a=null!=r.geometry?r.geometry:null;re(i)||re(l)||"extent"===a?.type||"tile"===r.resultType||(r.cacheHint=!0)},le=e=>{let{query:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})},ae=e=>{let{queryPayload:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})};function oe(e,t,n){return e&&t&&n?"sublayer"===t.type?de({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:n})||de({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):de({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||de({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function se(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function ue(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function de(e){let{map:t,relationship:n,relationship:{relatedTableId:r},relatedLayer:i,layers:l}=e;if(!l)return null;for(const a of l){if("map-image"===a.type){const e=de({layers:a.sublayers,map:t,relatedLayer:i,relationship:n})||de({layers:a.subtables,map:t,relatedLayer:i,relationship:n});if(e)return e;continue}if(!q(a))continue;if("sublayer"===i.type){if(a!==i&&a.id===r)return a.isTable?ue(t,a):a;continue}const e="scene"===i.type&&i.associatedLayer?i.associatedLayer.url:i.url;if(!e)return null;if("sublayer"!==a.type){if(a!==i&&a.url===e&&a.layerId===r)return a}else if(a!==i&&a.layer?.url===e&&a.id===r)return a.isTable?ue(t,a):a}return null}function ce(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}},12482:(e,t,n)=>{n.d(t,{$7:()=>E,B:()=>O,Fo:()=>I,M7:()=>x,NN:()=>f,Q5:()=>T,Tq:()=>A,Up:()=>F,XF:()=>Z,Ze:()=>h,bK:()=>o,bh:()=>c,id:()=>b,ky:()=>d,qt:()=>N,tW:()=>_,v9:()=>p,w7:()=>s,wF:()=>a,wS:()=>v,wz:()=>y,x:()=>m,xS:()=>w,ze:()=>u});var r=n(31633),i=n(59097);function l(e){return e?N:A}function a(e,t){return t?.mode?t.mode:l(e).mode}function o(e,t){return null!=t?t:l(e)}function s(e,t){return a(null==e||(e.hasZ??!1),t)}function u(e,t){return o(null==e||(e.hasZ??!1),t)}function d(e){const t=g(e);return s(e.geometry,t)}function c(e){const t=g(e),n=s(e.geometry,t),r=null!=t&&"on-the-ground"!==n?x(t):0,i=t?.featureExpressionInfo;return{mode:n,offset:r,featureExpressionInfo:i}}function f(e){return y(c(e))}function p(e){return y(e)||m(e)}function m(e){return"0"===e?.featureExpressionInfo?.expression}function y(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function g(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function h(e,t){if(!e?.offset)return 0;const{offset:n,unit:i}=e;if("decimal-degrees"===i)return 0;const l="unknown"!==i&&i?i:"meters",a=(0,r.mq)(t);return a?(0,r.oU)(n,l,a):0}function b(e,t,n){if(!n?.mode)return;const r=e.hasZ?e.z:0,i=h(n,e.spatialReference);switch(n.mode){case"absolute-height":return r-i;case"on-the-ground":return 0;case"relative-to-ground":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"ground")??0)+i);case"relative-to-scene":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"scene")??0)+i)}}function v(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return I(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,r)}function w(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return I(e,t[0],t[1],t.length>2?t[2]:0,n,r,i)}function I(e,t,n,r,i,l){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==l)return;const o=null!=a?a.mode:"absolute-height";if("on-the-ground"===o)return 0;const{absoluteZ:s}=T(t,n,r,i,e,l);return function(e,t,n,r,i,l,a,o){const s=h(a,i);switch(o){case"absolute-height":return e-s;case"relative-to-ground":return e-((l.elevationProvider.getElevation(t,n,r,i,"ground")??0)+s);case"relative-to-scene":return e-((l.elevationProvider.getElevation(t,n,r,i,"scene")??0)+s)}}(s,t,n,r,i,e,a,o)}function T(e,t,n,r,i,l){const a=h(l,r);switch(l.mode){case"absolute-height":return{absoluteZ:n+a,elevation:0};case"on-the-ground":{const n=i.elevationProvider.getElevation(e,t,0,r,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const l=i.elevationProvider.getElevation(e,t,n,r,"ground")??0;return{absoluteZ:n+l+a,elevation:l}}case"relative-to-scene":{const l=i.elevationProvider.getElevation(e,t,n,r,"scene")??0;return{absoluteZ:n+l+a,elevation:l}}}}function F(e,t){if(null==t)return!1;const{mode:n}=t;return null!=n&&("scene"===e&&"relative-to-scene"===n||"ground"===e&&"absolute-height"!==n)}function O(e,t,n){return n&&n.mode!==t?`${e} only support ${t} elevation mode`:null}function E(e,t,n){return n?.mode===t?`${e} do not support ${t} elevation mode`:null}function _(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function Z(e,t){t&&e.warn(".elevationInfo=",t)}function x(e){return(e?.offset??0)*(0,i.Ao)(e?.unit)}const N={mode:"absolute-height",offset:0},A={mode:"on-the-ground",offset:null}},20639:(e,t,n)=>{n.d(t,{Ng:()=>F,OM:()=>h,Q0:()=>w,T8:()=>v,ZP:()=>T,ZT:()=>I,eX:()=>_,fD:()=>N,fb:()=>m,fl:()=>p,iP:()=>x,oh:()=>O,rX:()=>A,sH:()=>y,yk:()=>M});n(11265),n(81806);var r=n(50076),i=n(15941),l=n(65256),a=n(96017),o=n(85632),s=n(36693),u=n(24241),d=n(38042);const c=s.n$,f={date:null,time:null,timeZoneOffset:null},p=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),m="latn",y=new Set(["date-only","time-only","timestamp-offset"]),g=e=>"valueAsDate"in e;function h(e){return{locale:(0,d.JK)(),numberingSystem:m,zone:e??c}}function b(e,t){return null==e?null:u.c9.fromMillis(e,h(t))}function v(e,t){if(null==e||!(0,o.Kg)(e)||""===e){if(t){const e=u.c9.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return f}const n=u.c9.fromISO(e,{setZone:!0});return{date:n.toFormat(a.mo,h()),time:n.toFormat(a.Uq.HMS_MS,h()),timeZoneOffset:n.offset.toString()}}function w(e,t){if(null==e||!(0,o.Et)(e)||isNaN(e))return f;const n=b(e,t);return n?{date:n.toFormat(a.mo,h(t)),time:n.toFormat(a.Fj,h(t))}:f}function I(e){switch(e.type){case"date":default:return(0,l.J2)("short-date-short-time");case"date-only":return(0,l.J2)("short-date");case"time-only":return(0,l.J2)("short-time");case"timestamp-offset":return{...(0,l.J2)("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function T(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return(0,l.Yq)(t,n);case"date-only":return(0,l.iS)(t,n);case"time-only":return(0,l.F8)(t,n);case"timestamp-offset":return(0,l.Ey)(t,n);default:return null}}function F(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:r,timeZoneComponent:i,oldValue:l}=e;if(!t?.value)return null;const{year:o,month:d,day:c}=u.c9.fromFormat(t.value,a.mo),{hour:f,minute:p,second:m,millisecond:y}=E(r,s.n$)??u.c9.now(),g=v(l,n),h=i?.value?parseInt(i.value,10):null!=g.timeZoneOffset?parseInt(g.timeZoneOffset,10):(new Date).getTimezoneOffset(),b=u.mQ.instance(h),w=u.c9.fromObject({year:o,month:d,day:c,hour:f,minute:p,second:m,millisecond:y},{zone:b});return w.isValid?w.toISO({includeOffset:!0}):null}function O(e){const{dateComponent:t,timeComponent:n,timeZone:r,max:i,min:l,oldValue:a}=e,o=E(t,r);let s=!!e.applyRange;if(!o)return null;let d=null;if(null!=n?.value){const e=E(n,r),t=Date.now(),l=null!=i&&i<t?i:t,a=u.c9.fromMillis(l,h(r)),s=o||a,{year:c,month:f,day:p}=s,{hour:m,minute:y,second:g,millisecond:b}=e||a;d=s.set({year:c,month:f,day:p,hour:m,minute:y,second:g,millisecond:b})}else{const e=b(Z({value:a??Date.now(),max:i,min:l}),r),{year:t,month:n,day:u}=o,{hour:c,minute:f,second:p,millisecond:m}=e;s=!0,d=o.set({year:t,month:n,day:u,hour:c,minute:f,second:p,millisecond:m})}if(!d.isValid)return null;const c=d.toMillis();return s?Z({value:c,max:i,min:l}):c}function E(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=g(e)?u.c9.fromFormat(e.value,a.mo,h(t)):(0,a.UE)(e.value),n?.isValid?n:null}function _(e){const{max:t,min:n,value:r}=e;return!isNaN(r)&&!(null!=t&&r>t)&&!(null!=n&&r<n)}function Z(e){const{max:t,min:n,value:r}=e;return null!=t&&null!=n?(0,i.qE)(r,n,t):null!=t&&r>t?t:null!=n&&r<n?n:r}function x(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new r.default("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),i=new Array(3);for(let r=0;r<3;r++){const e=n.at(r)??"";i[r]=e.padStart(2,"0")}return i.join(":")}function N(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return x(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function A(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function M(e){const{type:t,range:n,value:r}=e;if(null==r||!n||r===n.min||r===n.max)return!0;if("date"===t)return _({value:r,min:n.min,max:n.max});const{rawMax:i,rawMin:l}=n;let o=null,s=null,u=null;switch(t){case"date-only":o=(0,a.Xi)(i),s=(0,a.Xi)(l),u=(0,a.Xi)(r);break;case"time-only":o=(0,a.UE)(i),s=(0,a.UE)(l),u=(0,a.UE)(r);break;case"timestamp-offset":o=(0,a.gz)(i),s=(0,a.gz)(l),u=(0,a.gz)(r)}return!u||_({value:u.valueOf(),min:s?.valueOf(),max:o?.valueOf()})}},23301:(e,t,n)=>{n.d(t,{$$:()=>I,D_:()=>f,Gd:()=>c,Kx:()=>r,PA:()=>h,Po:()=>p,Qv:()=>b,gK:()=>i,hQ:()=>w,jl:()=>y,of:()=>d,qn:()=>v,zU:()=>m});var r,i,l,a=n(71764),o=n(15142),s=n(53430),u=n(20639);(l=r||(r={})).Text="text",l.Number="number",l.Date="date",l.Unsupported="unsupported",function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(i||(i={}));const d=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};function c(e,t){const{dataType:n,domain:r,field:l,maxLength:a,minLength:d,range:c,required:f}=t;if(null==e)return f?i.CANNOT_BE_EMPTY:null;if("text"===n&&"string"==typeof e){if(d>-1&&e.length<d)return i.TOO_SHORT;if(a>-1&&e.length>a)return i.TOO_LONG}return"date"!==n||(0,u.yk)({type:l.type,range:c,value:e})?r?(0,o.wb)(l,e,r):(0,s.validateFieldValue)(l,e)??(0,o.wb)(l,e):s.NumericRangeValidationError.OUT_OF_RANGE}function f(e,t){return!(!p(e)||!p(t))||e===t}function p(e){return null==e||""===e}function m(e){let{dataType:t,field:n,input:i}=e;if(t===r.Date)return-1;const l=g(n.length);if(!i||!(0,a.AI)(i))return l;const o=g(i.maxLength);return-1===o?l:-1===l?o:Math.min(l,o)}function y(e){let{dataType:t,field:n,input:i}=e;if(t===r.Date)return-1;if(!i||!(0,a.AI)(i))return-1;const l=g(i.minLength);if(l<0)return-1;const o=g(n.length);return o>-1&&o<l?-1:l}function g(e){return"number"==typeof e&&e>-1?e:-1}const h={type:"number"},b={type:"number",intlOptions:{notation:"scientific"}};function v(e){return e>=1e7||e<=-1e7}function w(e,t){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}const I=e=>e&&!Number.isNaN(e.valueOf())},26547:(e,t,n)=>{function r(e){const{attributes:t,sourceLayer:n}=e??{},r=n&&"displayField"in n?n.displayField:null,i=r?t?.[r]:null,l=null!=i?JSON.stringify(i):null,a=e?.getObjectId()?.toString();return l||a||""}n.d(t,{R:()=>r})},51695:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var r=n(35143),i=n(91967),l=n(46053),a=(n(81806),n(76460)),o=(n(47249),n(85842)),s=n(31933),u=n(12482);let d=class extends i.default{constructor(e){super(e),this.layer=null}get attachments(){return{enabled:this._effectiveEnabled&&!!this._effectiveCapabilities?.data.supportsAttachment}}get create(){const{_effectiveCapabilities:e,layer:t}=this,n=this._createEnabled,r=n,i=t.capabilities?.operations.supportsAdd,l=!!e?.operations.supportsAdd;return{attachments:{enabled:n&&this.attachments.enabled},attributes:n,enabled:n,geometry:r,reliesOnOwnerAdminPrivileges:!i&&l}}get delete(){const{_effectiveCapabilities:e,layer:t}=this,n=t.capabilities?.operations.supportsDelete,r=!!e?.operations.supportsDelete;return{enabled:this._effectiveEnabled&&!!e?.operations.supportsDelete,reliesOnOwnerAdminPrivileges:!n&&r}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){const{_effectiveCapabilities:e,layer:t}=this,n=this._updateEnabled,r=!(!n||!e?.editing.supportsGeometryUpdate),i=t.capabilities?.operations.supportsUpdate,l=!!e?.operations.supportsUpdate,a=this.attachments.enabled,o=a&&this._canCreateOrUpdate;return{attachments:{enabled:a,create:o,update:o},attributes:n,enabled:n,geometry:r,reliesOnOwnerAdminPrivileges:!i&&l}}get _createEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsAdd}get _updateEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsUpdate}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return(0,s.tk)(this.layer)}get _effectiveCapabilities(){return(0,s.BR)(this.layer)}};(0,r._)([(0,l.MZ)()],d.prototype,"attachments",null),(0,r._)([(0,l.MZ)()],d.prototype,"create",null),(0,r._)([(0,l.MZ)()],d.prototype,"delete",null),(0,r._)([(0,l.MZ)()],d.prototype,"layer",void 0),(0,r._)([(0,l.MZ)()],d.prototype,"reliesOnOwnerAdminPrivileges",null),(0,r._)([(0,l.MZ)()],d.prototype,"update",null),(0,r._)([(0,l.MZ)()],d.prototype,"_createEnabled",null),(0,r._)([(0,l.MZ)()],d.prototype,"_updateEnabled",null),(0,r._)([(0,l.MZ)()],d.prototype,"_canCreateOrUpdate",null),(0,r._)([(0,l.MZ)()],d.prototype,"_effectiveEnabled",null),(0,r._)([(0,l.MZ)()],d.prototype,"_effectiveCapabilities",null),d=(0,r._)([(0,o.$)("esri.layers.support.EditingCapabilities")],d);const c=d;var f=n(80963),p=n(19463),m=n(64465);const y="esri.views.layers.support.editableLayerViews";var g=n(9912);let h=class extends c{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==t?.enabled}}get create(){const{attachments:e,defaults:t,layerInfo:n,layer:r,layerView:i}=this,l=t.create,a=!1!==n?.enabled&&!1!==n?.addEnabled,o=l.enabled&&a;return{attributes:o&&l.attributes,enabled:o,geometry:o&&l.geometry&&b(r,i),attachments:{enabled:e.enabled&&o&&!1!==n?.attachmentsOnCreateEnabled},reliesOnOwnerAdminPrivileges:l.reliesOnOwnerAdminPrivileges}}get defaults(){return new c({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,n=e.delete,r=!1!==t?.enabled&&!1!==t?.deleteEnabled;return{enabled:n.enabled&&r,reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return t?.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){const{layer:e}=this,t=!(!(0,g.isRelatableFeatureSupportedLayer)(e)||!e.relationships?.length),n=!!this.formTemplate?.elements?.some((e=>"relationship"===e.type));return{enabled:t&&n}}get update(){const{attachments:e,defaults:t,layerInfo:n,layer:r,layerView:i}=this,l=t.update,a=!1!==n?.enabled&&!1!==n?.updateEnabled,o=l.enabled&&a,s=o&&l.attributes&&!1!==n?.attributeUpdatesEnabled,u=o&&l.geometry&&!1!==n?.geometryUpdatesEnabled&&b(r,i),d=e.enabled&&!1!==n?.attachmentsOnUpdateEnabled;return{attributes:s,enabled:o,geometry:u,attachments:{enabled:d,create:d&&l.attachments.create,update:d&&l.attachments.update},reliesOnOwnerAdminPrivileges:l.reliesOnOwnerAdminPrivileges}}};function b(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&function(e,t){const{associatedLayer:n}=e,r=n?.infoFor3D;if(!r)return!1;const i=(0,p.U9)(r);if(null==i||!r.queryFormats.includes(i))return a.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const l=e.spatialReference,o=n.spatialReference;if(!(0,f.aI)(l,o))return a.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${l.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${o.wkid}).`),!1;const s=n.sourceJSON.sourceSpatialReference;if(null!=s&&!(0,f.aI)(s,o))return a.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${o.wkid}) is different from its source spatial reference (wkid:${s.wkid}).`),!1;const{view:u}=t;if(t.destroyed||null==u)return!1;const d=u.spatialReference,{viewingMode:c}=u.state,g=(0,f.EA)(l),h=c===m.RT.Global;return g&&!h?(a.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${l.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!g&&h?(a.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${l.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!((0,f.aI)(l,d)||h&&(0,f.K8)(d)&&(0,f.oT)(l))||(a.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${l.wkid}) does not match the view spatial reference (wkid:${d.wkid}).`),!1)}(e,t)}(0,r._)([(0,l.MZ)()],h.prototype,"attachments",null),(0,r._)([(0,l.MZ)()],h.prototype,"create",null),(0,r._)([(0,l.MZ)()],h.prototype,"defaults",null),(0,r._)([(0,l.MZ)()],h.prototype,"delete",null),(0,r._)([(0,l.MZ)()],h.prototype,"formTemplate",null),(0,r._)([(0,l.MZ)()],h.prototype,"layerInfo",void 0),(0,r._)([(0,l.MZ)()],h.prototype,"layerView",void 0),(0,r._)([(0,l.MZ)()],h.prototype,"relationship",null),(0,r._)([(0,l.MZ)()],h.prototype,"update",null),h=(0,r._)([(0,o.$)("esri.widgets.Editor.support.EditorEditingCapabilities")],h);const v=h;var w=n(3320);let I=class extends i.default{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){return!!this.layerView?.suspended}get capabilities(){return new v({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:n,delete:{enabled:r}}=this.capabilities,i=e.attachments.enabled||n.attachments.enabled;return!this.disabled&&(e.enabled||n.enabled||i||r||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return(0,w.lB)(this.layer,this.formTemplate)}get isTable(){return(0,s.bI)(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;if("3d"===this.layerView?.view?.type&&(0,u.wz)(this.layer.elevationInfo))return!1;const{enabled:e,geometry:t}=this.capabilities.create;return this.isTable?e:e&&t}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};(0,r._)([(0,l.MZ)()],I.prototype,"_suspended",null),(0,r._)([(0,l.MZ)()],I.prototype,"capabilities",null),(0,r._)([(0,l.MZ)()],I.prototype,"disabled",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"editable",null),(0,r._)([(0,l.MZ)()],I.prototype,"formTemplate",null),(0,r._)([(0,l.MZ)()],I.prototype,"hasInvalidFormTemplate",null),(0,r._)([(0,l.MZ)()],I.prototype,"isTable",null),(0,r._)([(0,l.MZ)()],I.prototype,"layer",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"layerInfo",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"layerView",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"supportsCreateFeaturesWorkflow",null),(0,r._)([(0,l.MZ)()],I.prototype,"supportsUpdateWorkflow",null),(0,r._)([(0,l.MZ)()],I.prototype,"visible",null),I=(0,r._)([(0,o.$)("esri.widgets.Editor.support.EditorItem")],I);const T=I}}]);
//# sourceMappingURL=51695.37d12de3.chunk.js.map