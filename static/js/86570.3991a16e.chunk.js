"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[35757,43277,58138,86570],{4336:(e,t,r)=>{function n(){return[0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3]]}function s(e,t,r,n){return[e,t,r,n]}r.d(t,{fA:()=>s,o8:()=>i,vt:()=>n,zK:()=>o});const o=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:i,create:n,fromValues:s},Symbol.toStringTag,{value:"Module"}))},10033:(e,t,r)=>{r.r(t),r.d(t,{createVersioningStates:()=>h,getVersioningStates:()=>f});var n=r(19276),i=r(54901),s=r(76460),o=r(87663),a=r(8163),c=r(43277),u=r(54265),l=r(85056);async function h(e,t){let r;if("layers"in e){const t=(0,l.createVersionAdapters)(e.allTables.concat(e.allLayers).filter((e=>"group"!==e.type)).toArray());e.utilityNetworks&&e.utilityNetworks.forEach((e=>{const r=(0,l.createVersionAdapters)([e]);t.push(...r)})),r=t}else r=new n.default(e);const i=new Map;for(const o of r){const e=i.get(o.featureServiceUrl);e?e.push(o):i.set(o.featureServiceUrl,new n.default([o]))}const s=new n.default;for(const[n,o]of i){const e=new a.default({url:n});if(await e.load(),!e.versionManagementServiceUrl)continue;const r=new u.default({url:e.versionManagementServiceUrl});s.push(new c.default({versionManagementService:r,versionableItems:o,usePersistentReadSessions:t}))}return s}const d=new Map;async function f(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=await h(e.map,t);return(0,o.tE)(d,e,(()=>(e.addHandles((0,i.hA)((()=>{d.delete(e),r.forEach((e=>e.destroy()))}))),r.forEach((e=>e.load().catch((e=>{s.A.getLogger("esri.versionManagement.VersioningState").error("Failed to load Versioning State",e)})))),r)))}},13191:(e,t,r)=>{function n(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function s(e,t,r,n,i,s,o,a,c,u,l,h,d,f,v,g){return[e,t,r,n,i,s,o,a,c,u,l,h,d,f,v,g]}r.d(t,{fA:()=>s,o8:()=>i,vt:()=>n,zK:()=>o});const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:i,create:n,createView:function(e,t){return new Float64Array(e,t,16)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},43277:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var n=r(35143),i=r(19276),s=r(50076),o=r(42553),a=r(49304),c=r(76460),u=r(46053),l=(r(81806),r(47249),r(85842));let h=class extends(o.A.JSONSupportMixin(a.A)){constructor(e){super(e),this.versionManagementService=null,this.featureServiceUrl=null,this.url=null,this.currentVersion=null,this.currentVersionInfo=null,this.versionInfos=[],this.versionableItems=new i.default,this.usePersistentReadSessions=!1,this.state="lock-none"}initialize(){this.url=this.versionManagementService.url,this.featureServiceUrl=this.url.replace(/\/VersionManagementServer/i,"/FeatureServer"),this.addHandles([this.versionableItems.on("before-add",(e=>{if(e.item.featureServiceUrl.toLowerCase()!==this.featureServiceUrl.toLowerCase())return e.preventDefault(),void c.A.getLogger(this).error("#add()","Cannot add versionAdapter, feature service urls do not match.")})),this.versionableItems.on("before-remove",(e=>{if(0===this.versionableItems.items.length&&this.currentVersion&&"name"in this.currentVersion&&"none"!==this.versionManagementService.getLockType(this.currentVersion))return e.preventDefault(),void c.A.getLogger(this).error("#remove()","Cannot remove last versionAdapter.")}))])}load(e){return this.addResolvingPromise(this._setUpState(e)),Promise.resolve(this)}get defaultVersionIdentifier(){return this.versionManagementService.defaultVersionIdentifier}get isDefault(){return!this.currentVersion||!!this.currentVersion&&"name"in this.currentVersion&&this.currentVersion.name===this.defaultVersionIdentifier.name}async getVersionInfos(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this.versionInfos=await this.versionManagementService.getVersionInfos()),this.versionInfos}async alterVersion(e,t){if(this.currentVersion&&"guid"in this.currentVersion&&e.guid===this.currentVersion.guid)return!1;const r=await this.versionManagementService.alterVersion(e,t);return r&&await this.getVersionInfos(!0),r}async deleteVersion(e){if(this.currentVersion&&"guid"in this.currentVersion&&e.guid===this.currentVersion.guid)return!1;const t=await this.versionManagementService.deleteVersion(e);return t&&await this.getVersionInfos(!0),t}async getVersionInfoExtended(){return this.currentVersion&&"name"in this.currentVersion?this.versionManagementService.getVersionInfoExtended(this.currentVersion):this.versionManagementService.getVersionInfoExtended(this.defaultVersionIdentifier)}async startEditing(){if(this._isDefaultOrHistoricVersion())return{success:!1};if(!this.usePersistentReadSessions){const e=await this.versionManagementService.startReadingWithResult(this.currentVersion);if(!e.success)return e;this.state="lock-read"}const e=await this.versionManagementService.startEditingWithResult(this.currentVersion);return e.success&&(this.state="lock-write"),e}async stopEditing(e){if(this._isDefaultOrHistoricVersion())return{success:!1};const t=await this.versionManagementService.stopEditingWithResult(this.currentVersion,e);if(!t.success)return t;if(this.state="lock-read",!this.usePersistentReadSessions){const e=await this.versionManagementService.stopReadingWithResult(this.currentVersion);return e.success&&(this.state="lock-none"),e}return t}async changeVersion(e){let t=null;if(this.usePersistentReadSessions){if(this._isDefaultOrHistoricVersion(e))e&&"name"in e?(t=await this.versionManagementService.getVersionInfoExtended(e),this.state="public"===t?.access?"lock-none":"lock-read"):this.state="lock-read";else if(!await this.versionManagementService.startReading(e))throw new s.default("Failed to acquire read lock for version: "+e);this._isDefaultOrHistoricVersion(this.currentVersion)||await this.versionManagementService.stopReading(this.currentVersion)}const r=await this.versionManagementService.changeVersionWithResult(this.versionableItems,this.currentVersion,e);let n=!1;return r.forEach(((e,t)=>{n=n||e.success})),n&&(this.currentVersion=e,this.currentVersionInfo=t||await this.getVersionInfoExtended(),this._isDefaultOrHistoricVersion()?this.currentVersion&&"name"in this.currentVersion?this.state="public"===this.currentVersionInfo?.access?"lock-none":"lock-read":this.state="lock-read":this.state="read"!==this.versionManagementService.getLockType(this.currentVersion)?"lock-none":"lock-read"),r}async undo(){return this._isDefaultOrHistoricVersion()?{success:!1}:(this.versionManagementService.undo(this.currentVersion),{success:!0})}async redo(){return this._isDefaultOrHistoricVersion()?{success:!1}:(this.versionManagementService.redo(this.currentVersion),{success:!0})}async _setUpState(e){await this.versionManagementService.load(e),this.state="lock-none",this.currentVersionInfo=await this.getVersionInfoExtended(),this.versionableItems.forEach((e=>{this.currentVersion?"name"in this.currentVersion?(e.gdbVersion=this.currentVersion.name,e.historicMoment=null):(e.historicMoment=this.currentVersion,e.gdbVersion=null):(e.gdbVersion=null,e.historicMoment=null)})),this.usePersistentReadSessions&&(this._isDefaultOrHistoricVersion()?this.currentVersion&&"name"in this.currentVersion?this.state="public"===this.currentVersionInfo?.access?"lock-none":"lock-read":this.state="lock-read":await this.versionManagementService.startReading(this.currentVersion)&&(this.state="lock-read"))}_isDefaultOrHistoricVersion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentVersion;return!(e&&"name"in e)||e.name===this.versionManagementService.defaultVersionIdentifier.name}};(0,n._)([(0,u.MZ)()],h.prototype,"versionManagementService",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"featureServiceUrl",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"url",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"currentVersion",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"currentVersionInfo",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"versionInfos",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"versionableItems",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"usePersistentReadSessions",void 0),(0,n._)([(0,u.MZ)()],h.prototype,"state",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],h.prototype,"defaultVersionIdentifier",null),(0,n._)([(0,u.MZ)({readOnly:!0})],h.prototype,"isDefault",null),h=(0,n._)([(0,l.$)("esri.versionManagement.VersioningState")],h);const d=h}}]);
//# sourceMappingURL=86570.3991a16e.chunk.js.map