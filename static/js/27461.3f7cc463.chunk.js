"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[6840,27461,48988,52629],{1484:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(97255);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new s(e.lengths,e.coords)}static fromRect(e){const[t,r,i,n]=e,o=i-t,a=n-r;return new s([5],[t,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}get usedMemory(){return 64+(0,i.Qf)(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];if(i<3)continue;let s=this.coords[2*t],n=this.coords[2*t+1];for(let r=1;r<i;r+=1){const i=this.coords[2*(r+t)],o=this.coords[2*(r+t)+1];e+=-.5*(i-s)*(o+n),s=i,n=o}t+=i}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let i=0;for(const s of r){for(let e=1;e<s;e++)t[2*(i+e)]+=t[2*(i+e)-2],t[2*(i+e)+1]+=t[2*(i+e)-1];i+=s}return e}clone(e){if(0===this.lengths.length)return new s([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),r=this.coords.slice(0,t);return e?(e.set(r),new s(this.lengths,e)):new s(Array.from(this.lengths),Array.from(r))}}},6840:(e,t,r)=>{r.r(t),r.d(t,{CIMSymbolRasterizer:()=>h});var i=r(30050),s=r(94110),n=r(401),o=r(48988),a=r(83367),l=r(97763);const c=96/72;class h{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new i.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,r,i,s,c,h,u,d,p){if(!e)return null;const{data:m}=e;if(!m||"CIMSymbolReference"!==m.type||!m.symbol)return null;const{symbol:y}=m;c||(c=(0,l.n5)(y));const g=await o.OverrideHelper.resolveSymbolOverrides(m,t,this._spatialReference,s,c,h,u),v=this._cimResourceManager,w=[];n.wp.fetchResources(g,v,w),n.wp.fetchFonts(g,v,w),w.length>0&&await Promise.all(w);const{width:M,height:b}=r;let x=f(c,M,b,i,p);const C=n.wp.getEnvelope(g,x,v);if(!C)return null;C.x===1/0&&(C.x=M+2),C.y===1/0&&(C.y=-b/2),C.width===-1/0&&(C.width=M),C.height===-1/0&&(C.height=b);let I=1,S=0,P=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;C.width>M&&(e=M/C.width);let t=1;C.height>b&&(t=b/C.height),"preview"===i&&(C.width<M&&(e=M/C.width),C.height<b&&(t=b/C.height)),I=Math.min(e,t),S=C.x+C.width/2,P=C.y+C.height/2}break;case"CIMLineSymbol":if(p){P=C.y+C.height/2,S=C.x+C.width/2;const e=C.width-M,t=C.height-b;x={paths:(0,a.hs)(x.paths,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{(d||C.height>b)&&(I=b/C.height),P=C.y+C.height/2;const e=C.x*I+M/2,t=(C.x+C.width)*I+M/2,{paths:r}=x;r[0][0][0]-=e/I,r[0][2][0]-=(t-M)/I}break;case"CIMPolygonSymbol":if(p){P=C.y+C.height/2,S=C.x+C.width/2;const e=C.width-M,t=C.height-b;x={paths:(0,a.hs)(x.rings,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{S=C.x+C.width/2,P=C.y+C.height/2;const e=C.x*I+M/2,t=(C.x+C.width)*I+M/2,r=C.y*I+b/2,i=(C.y+C.height)*I+b/2,{rings:s}=x;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),r<0&&(s[0][0][1]+=r,s[0][1][1]+=r,s[0][4][1]+=r),t>M&&(s[0][1][0]-=t-M,s[0][2][0]-=t-M),i>b&&(s[0][2][1]+=i-b,s[0][3][1]+=i-b)}}const O={type:"cim",data:{type:"CIMSymbolReference",symbol:g}};return this.rasterize(O,M,b,S,P,I,c,1,x)}rasterize(e,t,r,i,n,o,a){let h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:window.devicePixelRatio||1;const{data:p}=e;if(!p||"CIMSymbolReference"!==p.type||!p.symbol)return null;const{symbol:m}=p,y=this._canvas,g=d*c;y.width=t*g,y.height=r*g,a||(a=(0,l.n5)(m)),u||(u=f(a,t,r,"legend")),y.width+=2*h,y.height+=2*h;const v=y.getContext("2d",{willReadFrequently:!0}),w=s.IT.createIdentity();return w.translate(-i,-n),w.scale(o*g,-o*g),w.translate(t*g/2+h,r*g/2+h),v.clearRect(0,0,y.width,y.height),new s.Rj(v,this._cimResourceManager,w,!0).drawSymbol(m,u),v.getImageData(0,0,y.width,y.height)}}function f(e,t,r,i,s){const n=-t/2+1,o=t/2-1,l=r/2-1,c=-r/2+1;if(s&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const i=function(e,t,r,i){return"esriGeometryPolygon"===t?{rings:(0,a.Tl)((0,a.hs)(e.rings,{xmin:0,ymin:0,xmax:r,ymax:i,width:r,height:i}),-1*r/2,-1*i/2)}:"esriGeometryPolyline"===t?{paths:(0,a.Tl)((0,a.hs)(e.paths,{xmin:0,ymin:0,xmax:r,ymax:i,width:r,height:i}),-1*r/2,-1*i/2)}:null}(s,e,t,r);if(i)return i}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[o,0]]]};default:return"legend"===i?{rings:[[[n,l],[o,0],[o,c],[n,c],[n,l]]]}:{rings:[[[n,l],[o,l],[o,c],[n,c],[n,l]]]}}}},14522:(e,t,r)=>{r.d(t,{T:()=>n,U:()=>s});var i=r(15941);function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=(0,i.qE)(e,0,l);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*c(s*o[i]))}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=n(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},28675:(e,t,r)=>{r.d(t,{previewCIMSymbol:()=>y});var i=r(76931),s=r(401),n=r(6840),o=r(48988),a=r(97763),l=r(65709),c=r(26291);const h=new n.CIMSymbolRasterizer(null),f=(0,i.PN)(l.CB.size),u=(0,i.PN)(l.CB.maxSize),d=(0,i.PN)(l.CB.lineWidth),p=1;async function m(e,t,r){const i=t?.size;let n=null!=i&&"object"==typeof i&&"width"in i?i.width:i,a=null!=i&&"object"==typeof i&&"height"in i?i.height:i;if(null==n||null==a)if("esriGeometryPolygon"===r)n=a=t.maxSize?Math.min(t.maxSize,f):f;else{const i=await async function(e,t,r){const{feature:i,fieldMap:n,viewParams:a}=t.cimOptions||t,l=await o.OverrideHelper.resolveSymbolOverrides(e.data,i,null,n,r,null,a);if(!l)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:l},e.data.primitiveOverrides=void 0;const c=[];return s.wp.fetchResources(l,h.resourceManager,c),s.wp.fetchFonts(l,h.resourceManager,c),c.length>0&&await Promise.all(c),s.wp.getEnvelope(l,null,h.resourceManager)}(e,t,r);i&&(n=i.width,a=i.height),"esriGeometryPolyline"===r&&(n=t.maxSize?Math.min(t.maxSize,d):d),n=null!=n&&isFinite(n)?Math.min(n,u):f,a=null!=a&&isFinite(a)?Math.max(Math.min(a,u),p):f}return"legend"===t.style&&"esriGeometryPolyline"===r&&(n=d),{width:n,height:a}}async function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{node:r,opacity:s,symbolConfig:n}=t,o=null!=n&&"object"==typeof n&&"isSquareFill"in n&&n.isSquareFill,l=t.cimOptions||t,f=l.geometryType||(0,a.n5)(e?.data?.symbol),u=await m(e,t,f),{feature:d,fieldMap:p}=l,y=t?.geometry||o||"esriGeometryPolygon"!==f?"preview":"legend";let g=u;const v=u;if(t?.geometry&&("esriGeometryPolygon"===f||"esriGeometryPolyline"===f)){const e=200;if((0,i.Lz)(u.width)<e||(0,i.Lz)(u.height)<e){const t=u.width>u.height?(0,i.PN)(e)*u.height/u.width:(0,i.PN)(e);g={width:u.width>u.height?(0,i.PN)(e):(0,i.PN)(e)*u.width/u.height,height:t}}}const w=await h.rasterizeCIMSymbolAsync(e,d,g,y,p,f,null,l.viewParams,l.allowScalingUp,t?.geometry?.toJSON());if(!w)return null;const{width:M,height:b}=w,x=document.createElement("canvas");x.width=M,x.height=b,x.getContext("2d").putImageData(w,0,0);const C=(0,i.Lz)(v.width),I=(0,i.Lz)(v.height),S=new Image(C,I);S.src=x.toDataURL(),S.ariaLabel=t.ariaLabel??null,S.alt=t.ariaLabel??"",null!=s&&(S.style.opacity=`${s}`);let P=S;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:C,height:I,src:S.src},fill:null,stroke:null,offset:[0,0]};P=(0,c.fz)([[e]],[C,I],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return r&&P&&r.appendChild(P),P}},30050:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(85504),s=r(16770);class n{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const r=this._resourceMap.get(e);if(r)return{width:r.width,height:r.height};let i=this._inFlightResourceMap.get(e);return i?i.then((e=>({width:e.width,height:e.height}))):(i=(0,s.M5)(e,t),this._inFlightResourceMap.set(e,i),i.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,i.Al)(e)}}},48988:(e,t,r)=>{r.d(t,{OverrideHelper:()=>h});var i=r(69539),s=r(59784),n=r(53084),o=r(98976),a=r(97763),l=r(52629);const c=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:s}=e;return[t,r,i,255*s]};class h{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let i=!1;for(const t of r)if(t.primitiveName===e.primitiveName){i=!0;break}if(!i)for(const s of t)s.primitiveName===e.primitiveName&&r.push(s)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)h.findApplicableOverrides(i,t,r);if(e.symbolLayers)for(const i of e.symbolLayers)h.findApplicableOverrides(i,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const i of e.effects)h.findApplicableOverrides(i,t,r);if(e.markerPlacement&&h.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const i of e.markerGraphics)h.findApplicableOverrides(i,t,r),h.findApplicableOverrides(i.symbol,t,r)}else"CIMCharacterMarker"===e.type?h.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?h.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&h.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,a.FH)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,a.rB)(e),i=e.primitiveName,s=[];for(const n of t)n.primitiveName===i&&s.push((0,a.rB)(n));return{type:"cim-effect-param",effect:r,overrides:(0,a.pk)(s)}}static async resolveSymbolOverrides(e,t,r,i,s,o,l){if(!e?.symbol)return null;let{symbol:c,primitiveOverrides:f}=e;const u=!!f;if(!u&&!i)return c;c=(0,n.clone)(c),f=(0,n.clone)(f);let d=!0;if(t||(t={attributes:{}},d=!1),u){if(d||(f=f.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),l||(f=f.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),f.length>0){const e={spatialReference:r,fields:(0,a.O2)(t.attributes),geometryType:s};await h.createRenderExpressions(f,e),h.evaluateOverrides(f,t,s??"esriGeometryPoint",o,l)}h.applyOverrides(c,f)}return i&&h.applyDictionaryTextOverrides(c,t,i,null),c}static async createRenderExpressions(e,t){const r=[];for(const i of e){const e=i.valueExpressionInfo;if(!e||h._expressionToRenderExpression.has(e.expression))continue;const s=(0,o.Ad)(e.expression,t.spatialReference,t.fields);r.push(s),s.then((t=>h._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,i,n){const o={$view:{scale:n?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,s.IB)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=c(a.value));const e=a.valueExpressionInfo;if(!e)continue;const n=h._expressionToRenderExpression.get(e.expression);n&&(a.value=(0,l.default)(n,t,o,r,i))}}static applyDictionaryTextOverrides(e,t,r,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Normal";if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const n=e.symbolLayers;if(!n)return;for(const o of n)o&&"CIMVectorMarker"===o.type&&h.applyDictionaryTextOverrides(o,t,r,i,"CIMTextSymbol"===e.type?e.textCase:s)}break;case"CIMVectorMarker":{const s=e.markerGraphics;if(!s)return;for(const e of s)e&&h.applyDictionaryTextOverrides(e,t,r,i)}break;case"CIMMarkerGraphic":{const n=e.textString;if(n&&n.includes("[")){const o=(0,a.gQ)(n,r);e.textString=(0,a.FM)(t,o,i,s)}}}}static applyOverrides(e,t,r,i){if(e.primitiveName)for(const s of t)if(s.primitiveName===e.primitiveName){const t=(0,a.YF)(s.propertyName);if(i&&i.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const i of r)i.primitiveName===e.primitiveName&&(t=!0);t||r.push(s)}null!=s.value&&(e[t]=s.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)h.applyOverrides(s,t,r,i);if(e.symbolLayers)for(const s of e.symbolLayers)h.applyOverrides(s,t,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)h.applyOverrides(s,t,r,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)h.applyOverrides(s,t,r,i),h.applyOverrides(s.symbol,t,r,i)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new i.default(t).toRgba();return e[3]*=255,e}return t}}h._expressionToRenderExpression=new Map},52629:(e,t,r)=>{r.d(t,{default:()=>o});var i=r(50076),s=r(76460),n=r(76279);function o(e,t,r,i,n){if(null==e)return null;const o=e.references("geometry")&&n?l(t,i,n):t,a=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:a},e.services)}catch(c){return s.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}}const a=new Map;function l(e,t,r){const{transform:o,hasZ:l,hasM:c}=r;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,s)=>(0,n.Tr)(r,t,e,i,s);case"esriGeometryPolygon":return(e,r,i,s)=>(0,n.$X)(r,t,e,i,s);case"esriGeometryPolyline":return(e,r,i,s)=>(0,n.P5)(r,t,e,i,s);case"esriGeometryMultipoint":return(e,r,i,s)=>(0,n.SW)(r,t,e,i,s);default:return s.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new i.default("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const h=a.get(t)(e.geometry,o,l,c);return{...e,geometry:h}}},97255:(e,t,r)=>{r.d(t,{$B:()=>s,Qf:()=>c,Qh:()=>a,RS:()=>n,ez:()=>u,i5:()=>d,lM:()=>o,qK:()=>f,rq:()=>h});var i=r(78393);function s(e){return 32+e.length}const n=16;function o(e){if(!e)return 0;let t=f;for(const r in e)e.hasOwnProperty(r)&&(t+=l(e[r],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return c(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return h(e,8);let r=u;for(let i=0;i<t;i++)r+=l(e[i]);return r}(e);let t=f;for(const r in e)e.hasOwnProperty(r)&&(t+=l(e[r]));return t}function l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?a(e):f;case"string":return s(e);case"number":return n;case"boolean":return 4;default:return 8}}function c(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(((e,t)=>e+(t?(0,i.iu)(t)?t.byteLength+d:Array.isArray(t)?h(t,n):0:0)),0)}function h(e,t){return u+e.length*t}const f=32,u=16,d=145}}]);
//# sourceMappingURL=27461.3f7cc463.chunk.js.map