"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[13206,20339,33106,42331,44670,45355,77404],{13206:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var i=r(35143),a=r(42553),o=r(46053),n=(r(81806),r(76460),r(47249),r(85842));let s=class extends a.A{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};(0,i._)([(0,o.MZ)({readOnly:!0,json:{read:!1}})],s.prototype,"type",void 0),s=(0,i._)([(0,n.$)("esri.webscene.background.Background")],s);const l=s},20339:(e,t,r)=>{r.d(t,{WU:()=>J,Y7:()=>D,save:()=>A,saveAs:()=>M});var i=r(50076),a=r(77717),o=r(68134),n=r(90534),s=r(37888),l=r(13312),p=r(80963),c=r(45417),u=r(13096),d=r(31933),h=r(24883),f=r(98662),m=r(79942),y=r(72945),w=r(71334),g=r(70414),v=r(86300),b=r(79880),_=r(24907);const S=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((e=>e.toLowerCase()));async function A(e,t,r){r??={},function(e,t){if(!t.portalItem)throw new i.default(`${e.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");R(e,t.portalItem)}(e,t),await(0,o.whenOnce)((()=>!t.updatingFromView)),await t.load(),await P(t),await(0,_.d)(t),await O(e,t);const a=t.portalItem,{json:n,jsonContext:s}=await I(t,a,e.origin);return(0,_.c)(s,{errorName:`${e.name}:save`},r),await L(t,a),await async function(e,t,r,i,a){await r.update({data:i}),K(e,t,r,i,a)}(e,t,a,n,s),await Promise.all([t.updateItemThumbnail(),(0,b.r)(t.resourceReferences,s)]),a}async function I(e,t,r){const i=(0,m.m)(t,r,!0),a=e.write({},i);return await Promise.all(i.resources.pendingOperations),{json:a,jsonContext:i}}async function M(e,t,r,a){a??={};const n=function(e,t){let r=f.default.from(t);return r.id&&(r=r.clone(),r.id=null),r.type||(r.type=e.itemType),r.portal||(r.portal=h.default.getDefault()),R(e,r),r}(e,r);await(0,o.whenOnce)((()=>!t.updatingFromView)),await t.load(),await P(t),await(0,_.d)(t),await O(e,t);const{json:s,jsonContext:l}=await I(t,n,e.origin);(0,_.c)(l,{errorName:`${e.name}:save`},a),await async function(e,t){(0,y.OM)(t,V),(0,y.OM)(t,$),(0,y.OM)(t,y.mm.METADATA),(0,y.OM)(t,U),(0,y.OM)(t,G),(0,y.OM)(t,W),(0,y.OM)(t,N),(0,y.OM)(t,x),await L(e,t)}(t,n);const p=t.getThumbnailState();return await async function(e,t,r,a,o,n){const s=t.portalItem,l={item:s,authenticated:!(!s?.id||!s.portal.user)},p=r.portal;await p.signIn();const{copyAllowed:c,itemReloaded:u}=await J(l,p);if(l.authenticated||=u,!c)throw new i.default(`${e.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const d=await D(r,l,a,n);return t.portalItem=r,K(e,t,r,a,o),d}(e,t,n,s,l,a)&&(t.resourceReferences.portalItem=n),t.restoreThumbnailFromState(p),await Promise.all([t.updateItemThumbnail(),(0,b.r)(t.resourceReferences,l)]),n}function R(e,t){if(t.type!==e.itemType)throw new i.default(`${e.name}:portal-item-wrong-type`,`Portal item needs to have type "${e.itemType}"`)}async function O(e,t){if("linkchart"===e.name)return;if(!t.basemap?.baseLayers.length)throw new i.default(`${e.name}:save`,"Map does not have a valid basemap with a base layer.");let r=null;if(await(0,o.whenOnce)((()=>{const e=(0,v.n8)(t.initialViewProperties,t.basemap);return r=e.spatialReference,!e.updating})),!(0,p.aI)(r,t.initialViewProperties.spatialReference))throw new i.default(`${e.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:r})}function P(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function L(e,t){t.extent=await async function(e,t){const i=t.clone().normalize();let a;if(i.length>1)for(const r of i)a?r.width>a.width&&(a=r):a=r;else a=i[0];return async function(e,t){const i=t.spatialReference;if(i.isWGS84)return t.clone();if(i.isWebMercator)return(0,c.webMercatorToGeographic)(t);const{getGeometryServiceURL:a}=await r.e(39483).then(r.bind(r,39483)),o=await a(e),n=new g.default({geometries:[t],outSpatialReference:l.default.WGS84});return(await(0,w.C)(o,n))[0]}(e,a)}(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await async function(e,t){(0,y.LG)(t,E),await function(e){const t=B(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}(e),function(e,t){(0,y.Y)(t,V)||(0,y.Y)(t,N)||(0,y.Y)(t,x)||(0,y.Y)(t,W)||!q(e)?(0,y.OM)(t,j):(0,y.LG)(t,j)}(e,t),function(e,t){q(e)?(0,y.LG)(t,T):(0,y.OM)(t,T)}(e,t),function(e,t){!(0,y.Y)(t,U)&&function(e){return B(e).filter((e=>"group"!==e.type)).every((t=>t.loaded&&function(e,t){return(0,d.W_)(t)&&t.capabilities.operations.supportsSync||function(e){return(0,d.Ov)(e)||"map-notes"===e.type||"route"===e.type}(t)&&!t.portalItem||function(e){return("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||function(e){return"tile"===e.type&&(0,u.tK)(e.url)&&S.some((t=>e.url?.toLowerCase().includes("/"+t+"/")))}(e)||(0,v.JT)(e))}(t)&&!function(e){return"vector-tile"===e.type&&Object.keys(e.sourceNameToSource).length>1}(t)&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t)))}(e)?(0,y.LG)(t,C):(0,y.OM)(t,C)}(e,t),function(e,t){(0,v.Rc)(e.basemap)?(0,y.LG)(t,k):(0,y.OM)(t,k)}(e,t),function(e,t){e.utilityNetworks?.length?(0,y.LG)(t,F):(0,y.OM)(t,F)}(e,t),function(e,t){e.ipsInfo?(0,y.LG)(t,Z):(0,y.OM)(t,Z)}(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}(e,t)}const E=y.mm.JSAPI,V="CollectorDisabled",j="Collector",T="Data Editing",U="OfflineDisabled",C="Offline",N="Workforce Project",x="Workforce Worker",W="Workforce Dispatcher",G="Offline Map Areas",$="FieldMapsDisabled",k=y.mm.DEVELOPER_BASEMAP,F="UtilityNetwork",Z="IPS";function B(e){return e.allLayers.concat(e.allTables)}function q(e){return B(e).some((e=>e.loaded&&(0,d.W_)(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}async function J(e,t){const{item:r,authenticated:i}=e;return r?.id&&r.typeKeywords?.includes("useOnly")?r.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(i||await r.reload(),{copyAllowed:"admin"===r.itemControl||"update"===r.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function D(e,t,r,i){const a=e.portal,{item:o}=t,{folder:s,copyAllResources:l}=i;let p=!1;if(l&&o?.id&&(0,n.hasSameCanonicalPortal)(o.portal.url,a.url)&&parseInt(o.portal.currentVersion,10)>=2023){const{total:e}=await o.fetchResources();p=!!e}if(p){const t=await o.copy({copyResources:"all",folder:s});e.id=t.id,e.portal=t.portal;const i=e.toJSON();await e.load(),e.read(i),await e.update({data:r})}else await a.user.addItem({item:e,folder:s,data:r});return p}function K(e,t,r,i,o){a.L.prototype.read.call(t,{version:i.version,authoringApp:i.authoringApp,authoringAppVersion:i.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:r.itemUrl?(0,n.urlToObject)(r.itemUrl):void 0}),(0,s.v)(o),t.resourceInfo=i}},24387:(e,t,r)=>{function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}r.d(t,{H:()=>i})},24907:(e,t,r)=>{r.d(t,{c:()=>n,d:()=>a});var i=r(50076);async function a(e){const t=[];for(const r of e.allLayers)if("beforeSave"in r&&"function"==typeof r.beforeSave){const e=r.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}const o=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function n(e,t,r){let a=(e.messages??[]).filter((e=>{let{type:t}=e;return"error"===t})).map((e=>{let{name:t,message:r,details:a}=e;return new i.default(t,r,a)}));if(e.blockedRelativeUrls&&(a=a.concat(e.blockedRelativeUrls.map((e=>new i.default("url:unsupported",`Relative url '${e}' is not supported`))))),r){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:i}=r;e&&(a=a.filter((e=>{let{name:r}=e;return!(o.has(r)||t.includes(r))}))),i&&(a=a.filter((e=>"web-document-write:property-required"!==e.name)))}if(a.length>0)throw new i.default(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})}},33106:(e,t,r)=>{r.d(t,{addOrUpdateResources:()=>s,bg:()=>h,cL:()=>d,fetchResources:()=>n,removeAllResources:()=>p,removeResource:()=>l});var i=r(3825),a=r(50076),o=r(90534);async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;await e.load(r);const i=(0,o.join)(e.itemUrl,"resources"),{start:a=1,num:n=10,sortOrder:s="asc",sortField:l="resource"}=t,p={query:{start:a,num:n,sortOrder:s,sortField:l,token:e.apiKey},signal:r?.signal},c=await e.portal.request(i,p);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map((t=>{let{created:r,size:i,resource:a}=t;return{created:new Date(r),size:i,resource:e.resourceFromPath(a)}}))}}async function s(e,t,r,i){const n=new Map;for(const{resource:o,content:l,compress:p,access:u}of t){if(!o.hasPath())throw new a.default(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const[e,t]=c(o.path),i=`${e}/${p??""}/${u??""}`;n.has(i)||n.set(i,{prefix:e,compress:p,access:u,files:[]}),n.get(i).files.push({fileName:t,content:l})}await e.load(i);const s=(0,o.join)(e.userItemUrl,"add"===r?"addResources":"updateResources");for(const{prefix:a,compress:o,access:l,files:p}of n.values()){const t=25;for(let r=0;r<p.length;r+=t){const n=p.slice(r,r+t),c=new FormData;a&&"."!==a&&c.append("resourcesPrefix",a),o&&c.append("compress","true"),l&&c.append("access",l);let u=0;for(const{fileName:e,content:t}of n)c.append("file"+ ++u,t,e);c.append("f","json"),await e.portal.request(s,{method:"post",body:c,signal:i?.signal})}}}async function l(e,t,r){if(!t.hasPath())throw new a.default("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const i=(0,o.join)(e.userItemUrl,"removeResources");await e.portal.request(i,{method:"post",query:{resource:t.path},signal:r?.signal}),t.portalItem=null}async function p(e,t){await e.load(t);const r=(0,o.join)(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function c(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function u(e){const[t,r]=function(e){const t=(0,o.getPathExtension)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[i,a]=c(t);return[i,a,r]}async function d(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,i.default)(e.url,{responseType:"blob"})).data}function h(e,t){if(!e.hasPath())return null;const[r,,i]=u(e.path);return e.portalItem.resourceFromPath((0,o.join)(r,t+i))}},37888:(e,t,r)=>{r.d(t,{v:()=>a});var i=r(24387);function a(e){e?.writtenProperties&&e.writtenProperties.forEach((e=>{let{target:t,propName:r,newOrigin:a}=e;(0,i.H)(t)&&a&&t.originOf(r)!==a&&t.updateOrigin(r,a)}))}},41653:(e,t,r)=>{r.r(t),r.d(t,{default:()=>_});var i=r(35143),a=r(42553),o=r(53084),n=r(76460),s=r(46053),l=(r(81806),r(85842)),p=r(68814),c=r(53203),u=r(30650),d=r(98277),h=r(99372),f=r(13206),m=r(45355);const y={base:f.default,key:"type",typeMap:{color:m.default}};const w={types:y,json:{read:function(e){return(t,r,i)=>{if(!t)return t;for(const a in e.typeMap)if(t.type===a){const r=new e.typeMap[a];return r.read(t,i),r}}}(y),write:{overridePolicy:(e,t,r)=>({enabled:!r?.isPresentation})}}};var g;const v=(e,t,r)=>({enabled:!r?.isPresentation});let b=g=class extends a.A{constructor(e){super(e),this.lighting=new d.default,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){(0,c.TJ)(e?.type,n.A.getLogger(this))&&this._set("weather",e)}clone(){return new g(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?h.default.prototype.clone.call(this.lighting):d.default.prototype.clone.call(this.lighting),background:(0,o.clone)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};(0,i._)([(0,s.MZ)({types:u.S,nonNullable:!0,json:{write:!0}})],b.prototype,"lighting",void 0),(0,i._)([(0,s.MZ)(w)],b.prototype,"background",void 0),(0,i._)([(0,s.MZ)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:v}}})],b.prototype,"atmosphereEnabled",void 0),(0,i._)([(0,s.MZ)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:v}}})],b.prototype,"starsEnabled",void 0),(0,i._)([(0,s.MZ)({types:c.eM,nonNullable:!0,json:{write:!0},value:new p.default})],b.prototype,"weather",null),b=g=(0,i._)([(0,l.$)("esri.webscene.Environment")],b);const _=b},42331:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var i=r(35143),a=r(19276),o=r(3975),n=r(42553),s=r(46053),l=r(21403),p=(r(81806),r(47249),r(85842)),c=r(77679);const u=a.default.ofType(c.default);let d=class extends n.A{constructor(e){super(e),this.slides=new u}destroy(){this.slides.forEach((e=>e.destroy())),this.slides.removeAll()}set slides(e){e&&(e=e.filter((e=>!!e.viewpoint))),this._set("slides",(0,o.V)(e,this._get("slides"),u))}clone(){return new(0,this.constructor)({slides:this.slides.clone()})}};(0,i._)([(0,s.MZ)({type:u,nonNullable:!0,json:{write:!0}}),(0,l.w)(o.H)],d.prototype,"slides",null),d=(0,i._)([(0,p.$)("esri.webscene.Presentation")],d);const h=d},44670:(e,t,r)=>{r.r(t),r.d(t,{default:()=>de});var i=r(35143),a=r(55171),o=r(58963),n=r(48053),s=r(19276),l=r(50076),p=r(53084),c=r(49304),u=r(27741),d=r(76460),h=r(30726),f=r(77717),m=r(91291),y=r(50346),w=r(68134),g=r(90534),v=r(62754),b=r(46053),_=(r(81806),r(28379)),S=r(85842),A=r(17707),I=r(37888),M=r(6527),R=r(76797),O=r(91605),P=r(9624),L=r(13312),E=r(47700),V=r(19902),j=r(80963),T=r(24883),U=r(98662),C=r(79942),N=r(72945),x=r(86300),W=r(52334),G=r(72027);function $(e){return new l.default("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}var k,F=r(59187),Z=r(64465),B=r(59801),q=r(61701),J=r(15372),D=r(79880),K=r(24907),H=r(94200),X=r(20339),z=r(77404),Y=r(41653),Q=r(65847),ee=r(42331),te=r(42553);r(47249);let re=k=class extends te.A{constructor(e){super(e)}clone(){return new k({name:this.name,path:this.path,title:this.title})}};(0,i._)([(0,b.MZ)({type:String,json:{write:{isRequired:!0}}})],re.prototype,"name",void 0),(0,i._)([(0,b.MZ)({type:String,json:{write:{isRequired:!0}}})],re.prototype,"path",void 0),(0,i._)([(0,b.MZ)({type:String,json:{write:{isRequired:!0}}})],re.prototype,"title",void 0),re=k=(0,i._)([(0,S.$)("esri.webscene.TransportationNetwork")],re);const ie=re;var ae=r(19898);class oe extends ae.R{constructor(e,t){super(e,t,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}var ne=r(75569);let se=null;var le;const pe=new oe(1,36),ce="Web Scene";let ue=class extends(c.A.LoadableMixin(m.A.EsriPromiseMixin((0,f.P)(o.default)))){constructor(e){super(e),this[le]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new ee.default,this.initialViewProperties=new Q.default,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=(0,y.debounce)((async(e,t,r)=>{switch(e){case q.X.SAVE:return this._saveImpl(t);case q.X.SAVE_AS:return this._saveAsImpl(r,t)}})),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch((e=>{d.A.getLogger(this).error("#load()","Failed to load web scene",e)})),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles((0,w.on)((()=>this.allLayers),"change",(()=>this._scheduleLayersIdGC())))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=(0,h.pR)(this.portalItem)}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,r,i){t[r]=this._layersToJSON(e,"operational-layers",i)}readSourceVersion(e,t){const[r,i]=t.version.split(".");return new oe(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${pe.major}.${pe.minor}`}writeTables(e,t,r,i){const a=this._layersToJSON(e,"tables",i);a.length&&(t[r]=a)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=a.version}writeGround(e,t,r,i){t[r]=e?e.write({},i):{transparency:0,layers:[]}}readInitialViewProperties(e,t){const r={};t.initialState?.environment&&(r.environment=Y.default.fromJSON(t.initialState.environment)),r.spatialReference=t.spatialReference?L.default.fromJSON(t.spatialReference):L.default.WebMercator,r.viewingMode=t.viewingMode??"global",t.initialState?.viewpoint&&(r.viewpoint=n.default.fromJSON(t.initialState.viewpoint));const i=t.initialState?.timeExtent;return null!=i&&(r.timeExtent=F.default.fromArray(i)),new Q.default(r)}get spatialReference(){return this.initialViewProperties?.spatialReference??L.default.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const t=this.ground;return this.addResolvingPromise(this._loadFromSource().then((()=>{t&&t!==this.ground&&t.destroy(),this._validateFeatureLayerSymbolVisibility()}))),Promise.resolve(this)}loadAll(){return(0,u.g)(this,(e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map((e=>e.basemap)),this.tables)}))}read(e,t){t={...t,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,i=this._isAuthoringAppSetByUser;if((0,M.t)(this,e,(t=>super.read(e,t)),t),i||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const t=e.baseMap.elevationLayers.map((e=>({id:e.id}))),r=this.presentation.slides,i=(e,t)=>e.visibleLayers.some((e=>e.id===t)),a=t.filter((e=>!r.some((t=>i(t,e.id)))));r.forEach((e=>{e.visibleLayers.addMany(a)}))}}_writeBasemapElevationLayers(e){const t=e.ground?.layers;!e.baseMap&&t?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=(0,p.clone)(t))}_layersToJSON(e,t,r){const i={...r,layerContainerType:t};return e.map((e=>this._verifyWritableLayer(e,r)?e.write({},i):null)).filter((e=>!!e)).toArray()}_verifyWritableLayer(e,t){return!!e.persistenceEnabled&&("write"in e||(t?.messages&&t.messages.push(new l.default("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,t){if("loaded"!==this.loadStatus){const e=new l.default("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw d.A.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),e}this._runLayersIdGC();const r=!t?.messages;t={messages:[],...t,origin:"web-scene"};const i=super.write(e,t);if(r){const e=t.messages?.filter((e=>"web-document-write:property-required"===e.name))??[];if(e.length){const t=new l.default("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:e});throw d.A.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",e),t}}return this._writeBasemapElevationLayers(i),i}async save(e){return this._debouncedSaveOperations(q.X.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw new l.default("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(this.portalItem?.type!==ce)throw new l.default("webscene:portal-item-wrong-type",`Portal item needs to have type "${ce}"`);const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls((0,C.m)(this.portalItem,"web-scene",!0)),i=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(i,r,q.X.SAVE,e),this._updateTypeKeywords(this.portalItem),await(0,D.S)(this.portalItem,i,this._resourceReferences,r),(0,I.v)(r),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(q.X.SAVE_AS,t,e)}async _saveAsImpl(e,t){let r=U.default.from(e);if(!r)throw new l.default("webscene:portal-item-required","saveAs requires a portal item to save to");r.id&&(r=r.clone(),r.id=null);const i=r.portal||T.default.getDefault();await this._ensureLoadBeforeSave(),r.type=ce,r.portal=i;const a=this._enableVerifyItemRelativeUrls((0,C.m)(r,"web-scene",!0)),o=this.write({},a);await Promise.all(a.resources.pendingOperations),await this._verifySaveAs(o,a,t);const n=this.thumbnailUrl,s=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(r),await i.signIn();const p=this.portalItem,c={item:p,authenticated:!(!p?.id||!p.portal.user)},{copyAllowed:u,itemReloaded:d}=await(0,X.WU)(c,i);if(c.authenticated||=d,!u)throw new l.default(`${a.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const h={...t,copyAllResources:!0};return await(0,X.Y7)(r,c,o,h)&&(this._resourceReferences.portalItem=r),await(0,D.r)(this._resourceReferences,a),this.portalItem=r,f.L.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?(0,g.urlToObject)(r.itemUrl):void 0}),(0,I.v)(a),n&&(this.thumbnailUrl=s?(0,g.addQueryParameter)(n,"w","8192"):n),a.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await(this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,t,r,i){if(!(0,j.B3)(this.spatialReference))throw new l.default("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:a,requiredPropertyChecksDisabled:o,strictSchemaValidationEnabled:n}=i||{};(0,K.c)(t,{errorName:"webscene:save"},{ignoreUnsupported:a,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:o});const s=se;if(n&&s){const t=(await s()).validate(e);if(!t.length)return;const i=`webscene did not validate:\n${t.join("\n")}`;d.A.getLogger(this).error(`${r===q.X.SAVE_AS?"saveAs":"save"}(): ${i}`);const a=t.map((e=>new l.default("webscene:schema-validation",e)));throw $(a)}}_verifySaveAs(e,t,r){return this._verifySave(e,t,q.X.SAVE_AS,r)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},t);return this._verifySaveAs(r,t,e)}canNotSaveAs(){return!1}async updateFrom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this._updateFrom(e,t);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=Y.default.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=e.timeExtent?.clone()??null,null!=e.clippingArea?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const e="visible";e in r&&e in r.layer&&r._isOverridden(e)&&(r.layer[e]=r[e])}if(!t.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this);(!1===t.thumbnailExcluded||null==t.thumbnailExcluded&&!t.viewpointExcluded)&&await this._updateFromThumbnail(e,t.thumbnailSize??void 0)}async _updateFromThumbnail(e,t){const r=(0,H.S)(e,t),i=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=i.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r,t)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const a of e.baseMap.elevationLayers)t.push(a);const r=[],i=e=>(e.layers&&(e.layers=e.layers.filter(i)),"ArcGISTiledElevationServiceLayer"!==e.layerType||(this.sourceVersion?.supportsGround||r.push(e),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(i):[],operationalElevationLayers:r,basemapElevationLayers:t}}async _loadFromJSON(e,t){const i=new s.default;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:a}=await r.e(60239).then(r.bind(r,60239)),{operationalLayers:o,operationalElevationLayers:n,basemapElevationLayers:l}=this._extractOperationalLayers(e),p=[],c={context:{...t,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||T.default.getDefault()),l.length>0){const e={...c,context:{...c.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",p.push(a(this.ground.layers,l,e))}if(n.length>0){const e={...c,context:{...c.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",p.push(a(i,n,e))}o&&o.length>0&&p.push(a(this.layers,o,c)),e.tables?.length&&p.push(a(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(p),await this._loadObjectsWithLayers(),this.ground.layers.addMany(i.filter((e=>"base-elevation"===e.type||"elevation"===e.type)))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],t=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(t.push(...r.baseLayers.items),t.push(...r.referenceLayers.items));for(const r of t)if("beforeSave"in r&&"function"==typeof r.beforeSave){const t=r.beforeSave();t&&e.push(t)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach((t=>{t.basemap&&e.push(t.basemap.load())})),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch((e=>{throw new l.default("webscene:load-portal-item","Failed to load portal item",{error:e})})),"Web Scene"!==e.type)throw new l.default("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const r={origin:"web-scene",url:(0,g.urlToObject)(e.itemUrl),portal:e.portal||T.default.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(t,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let r;if("local"!==e.viewingMode){if(!(0,B.M)(t,Z.RT.Global))return Promise.reject(new l.default("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||(0,P.canProjectWithoutEngine)(e,t)}else{if(!(0,B.M)(t,Z.RT.Local))return Promise.reject(new l.default("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||e.equals(t)}const i=e=>e?.camera?.position.spatialReference??e?.targetGeometry?.spatialReference,a=e.viewpoint,o=i(a);if(o&&!r(o))return Promise.reject(new l.default("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:t,viewingMode:e.viewingMode}));const n=this.presentation.slides.find((e=>!r(i(e.viewpoint))));if(n){const r=i(n.viewpoint);return Promise.reject(new l.default("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:r,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=(0,E.TR)(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){this.sourceVersion?.greaterEqual(1,35)||this.layers.forEach((e=>{"feature"===e.type&&e.addHandles((0,w.watch)((()=>e.loaded),(()=>{"on-the-ground"===e.elevationInfo?.mode&&"simple"===e.renderer?.type&&"polygon-3d"===e.renderer.symbol?.type&&e.renderer.symbol.symbolLayers.some((t=>"fill"===t.type&&null!=t.material&&(!t.material.color||t.material.color.a*e.opacity<ne.Q)&&(e.loadWarnings.push(new v.A("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:e})),!0)))}),{once:!0,sync:!0}))}))}_validateJSON(e){const t=oe.parse(e.version||"","webscene");return pe.validate(t),e.version=`${t.major}.${t.minor}`,1===t.major&&t.minor<=2&&(e.spatialReference=L.default.WebMercator.toJSON()),e}_updateTypeKeywords(e){(0,N.Sm)(e,N.mm.LOCAL_SCENE,"local"===this.initialViewProperties.viewingMode),(0,N.Sm)(e,N.mm.DEVELOPER_BASEMAP,(0,x.Rc)(this.basemap)||this.presentation.slides.some((e=>{let{basemap:t}=e;return!!t&&(0,x.Rc)(t)}))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||L.default.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?(0,g.urlToObject)(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout((()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()}),3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,t=e=>this.allLayers.some((t=>t.id===e&&t.persistenceEnabled));e?.layers&&(e.layers=e.layers.filter((e=>t(e.id))));const r=this.presentation&&this.presentation.slides;r&&r.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>t(e.id))))}))}static fromJSON(e){if(!e)throw new l.default("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};le=G.X,ue.version=`${pe.major}.${pe.minor}`,(0,i._)([(0,b.MZ)({type:z.default,json:{write:!0}})],ue.prototype,"applicationProperties",void 0),(0,i._)([(0,b.MZ)({type:R.default,json:{read:{source:"clippingArea.geometry",reader:V.fromJSON},write:{target:"clippingArea.geometry"}}})],ue.prototype,"clippingArea",void 0),(0,i._)([(0,A.K)("clippingArea")],ue.prototype,"writeClippingArea",null),(0,i._)([(0,b.MZ)({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],ue.prototype,"clippingEnabled",void 0),(0,i._)([(0,_.w)("clippingEnabled",["clippingArea"])],ue.prototype,"readClippingEnabled",null),(0,i._)([(0,A.K)("clippingEnabled")],ue.prototype,"writeClippingEnabled",null),(0,i._)([(0,b.MZ)({type:W.default,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],ue.prototype,"floorInfo",void 0),(0,i._)([(0,b.MZ)({type:O.default,json:{write:!0}})],ue.prototype,"heightModelInfo",void 0),(0,i._)([(0,b.MZ)({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],ue.prototype,"layers",void 0),(0,i._)([(0,A.K)("layers")],ue.prototype,"writeLayers",null),(0,i._)([(0,b.MZ)({readOnly:!0,type:oe,json:{type:(()=>{const e=[],t=pe.major;for(let r=8;r<=pe.minor;r++)e.push(`${t}.${r}`);return e})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],ue.prototype,"sourceVersion",void 0),(0,i._)([(0,_.w)("sourceVersion",["version"])],ue.prototype,"readSourceVersion",null),(0,i._)([(0,A.K)("sourceVersion")],ue.prototype,"writeSourceVersion",null),(0,i._)([(0,b.MZ)({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],ue.prototype,"tables",void 0),(0,i._)([(0,A.K)("tables")],ue.prototype,"writeTables",null),(0,i._)([(0,b.MZ)()],ue.prototype,"thumbnailUrl",null),(0,i._)([(0,b.MZ)({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],ue.prototype,"authoringApp",null),(0,i._)([(0,A.K)("authoringApp")],ue.prototype,"writeAuthoringApp",null),(0,i._)([(0,b.MZ)({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],ue.prototype,"authoringAppVersion",null),(0,i._)([(0,A.K)("authoringAppVersion")],ue.prototype,"writeAuthoringAppVersion",null),(0,i._)([(0,b.MZ)({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],ue.prototype,"ground",void 0),(0,i._)([(0,A.K)("ground")],ue.prototype,"writeGround",null),(0,i._)([(0,b.MZ)({type:s.default.ofType(ie),json:{write:!0}})],ue.prototype,"transportationNetworks",void 0),(0,i._)([(0,b.MZ)({type:ee.default,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,r,i)=>{if(e.slides&&e.slides.length>0){const r={...i,isPresentation:!0};t.presentation=e.write({},r)}}}}})],ue.prototype,"presentation",void 0),(0,i._)([(0,b.MZ)({type:Q.default,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new Q.default({viewingMode:"global",spatialReference:L.default.WebMercator})}})],ue.prototype,"initialViewProperties",void 0),(0,i._)([(0,_.w)("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],ue.prototype,"readInitialViewProperties",null),(0,i._)([(0,b.MZ)({type:L.default,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],ue.prototype,"spatialReference",null),(0,i._)([(0,b.MZ)({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],ue.prototype,"viewingMode",null),(0,i._)([(0,b.MZ)({type:U.default})],ue.prototype,"portalItem",void 0),(0,i._)([(0,b.MZ)()],ue.prototype,"resourceInfo",void 0),(0,i._)([(0,b.MZ)({type:J.A,json:{write:!0}})],ue.prototype,"widgets",void 0),ue=(0,i._)([(0,S.$)("esri.WebScene")],ue);const de=ue},45355:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var i,a=r(35143),o=r(69539),n=r(46053),s=(r(81806),r(76460),r(47249),r(6409)),l=r(85842),p=r(85192),c=r(13206);let u=i=class extends c.default{constructor(e){super(e),this.type="color",this.color=new o.default([0,0,0,1])}clone(){return new i(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};(0,a._)([(0,s.e)({color:"color"},{readOnly:!0})],u.prototype,"type",void 0),(0,a._)([(0,n.MZ)((0,p.E)({nonNullable:!0}))],u.prototype,"color",void 0),u=i=(0,a._)([(0,l.$)("esri.webscene.background.ColorBackground")],u);const d=u},65847:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var i,a=r(35143),o=r(48053),n=r(42553),s=r(46053),l=(r(81806),r(76460),r(47249),r(85842)),p=r(13312),c=r(28897),u=r(41653);let d=i=class extends n.A{constructor(e){super(e),this.environment=new u.default,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(e){this._set("viewingMode",e)}clone(){return new i({environment:this.environment.clone(),spatialReference:this.spatialReference?.clone()??null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?.clone()??null,timeExtent:this.timeExtent?.clone()??null})}};(0,a._)([(0,s.MZ)({type:u.default,json:{write:{isRequired:!0}}})],d.prototype,"environment",void 0),(0,a._)([(0,s.MZ)({type:p.default})],d.prototype,"spatialReference",void 0),(0,a._)([(0,s.MZ)({type:["local","global"]})],d.prototype,"viewingMode",null),(0,a._)([(0,s.MZ)({type:o.default,json:{write:{isRequired:!0}}})],d.prototype,"viewpoint",void 0),(0,a._)([(0,s.MZ)(c.E)],d.prototype,"timeExtent",void 0),d=i=(0,a._)([(0,l.$)("esri.webscene.InitialViewProperties")],d);const h=d},72027:(e,t,r)=>{r.d(t,{X:()=>i});const i=Symbol("WebScene")},75569:(e,t,r)=>{r.d(t,{Q:()=>i});const i=1/255.5},77404:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var i,a=r(35143),o=r(42553),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),l=r(9342);let p=i=class extends o.A{constructor(e){super(e),this.viewing=null}clone(){return new i({viewing:this.viewing?.clone()??null})}};(0,a._)([(0,n.MZ)({type:l.default,json:{write:!0}})],p.prototype,"viewing",void 0),p=i=(0,a._)([(0,s.$)("esri.webscene.ApplicationProperties")],p);const c=p},79880:(e,t,r)=>{r.d(t,{S:()=>l,r:()=>s});var i=r(50076),a=r(50346),o=r(49723),n=r(33106);async function s(e,t,r){const i=await p(e,t,r);await c(i,t,r)}async function l(e,t,r,i,a){const o=await p(r,i,a);await e.update({data:t}),await c(o,i,a)}async function p(e,t,s){if(!t?.resources)return;const l=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const p=new Set(t.resources.toKeep.map((e=>e.resource.path))),c=new Set,u=[];p.forEach((t=>{l.delete(t),e.paths.push(t)}));const d=[],h=[],f=[];for(const r of t.resources.toUpdate)if(l.delete(r.resource.path),p.has(r.resource.path)||c.has(r.resource.path)){const{resource:t,content:i,finish:a}=r,s=(0,n.bg)(t,(0,o.lk)());e.paths.push(s.path),d.push({resource:s,content:await(0,n.cL)(i),compress:r.compress}),a&&f.push((()=>a(s)))}else{e.paths.push(r.resource.path),h.push({resource:r.resource,content:await(0,n.cL)(r.content),compress:r.compress});const t=r.finish;t&&f.push((()=>t(r.resource))),c.add(r.resource.path)}for(const r of t.resources.toAdd)if(e.paths.push(r.resource.path),l.has(r.resource.path))l.delete(r.resource.path);else{d.push({resource:r.resource,content:await(0,n.cL)(r.content),compress:r.compress});const e=r.finish;e&&f.push((()=>e(r.resource)))}if(d.length||h.length){const{addOrUpdateResources:e}=await Promise.resolve().then(r.bind(r,33106));await e(t.portalItem,d,"add",s),await e(t.portalItem,h,"update",s)}if(f.forEach((e=>e())),0===u.length)return l;const m=await(0,a.allSettledErrors)(u);if((0,a.throwIfAborted)(s),m.length>0)throw new i.default("save:resources","Failed to save one or more resources",{errors:m});return l}async function c(e,t,r){if(!e||!t.portalItem)return;const i=[];for(const a of e){const e=t.portalItem.resourceFromPath(a);i.push(e.portalItem.removeResource(e,r))}await(0,a.eachAlways)(i)}}}]);
//# sourceMappingURL=44670.662ca420.chunk.js.map