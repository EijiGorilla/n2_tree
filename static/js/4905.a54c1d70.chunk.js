"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[3620,4905,35617,43036,56203,59844,63391,81923],{3136:(e,t,r)=>{r.d(t,{J_:()=>s,aE:()=>u,cq:()=>l,uu:()=>c});var n=r(15941),i=r(34111),a=r(19247);function o(e,t,r){if(null==t.longitude||null==t.latitude||null==r.longitude||null==r.latitude)throw new Error("Invalid points: no lon/lat");return function(e,t,r,i,a){const o=(0,n.kU)(r),s=(0,n.kU)(a),l=o-s,c=(0,n.kU)(t)-(0,n.kU)(i),u=Math.sin(l/2),h=Math.sin(c/2),d=2*(0,n.YN)(Math.sqrt(u*u+Math.cos(o)*Math.cos(s)*h*h))*e;return Math.round(1e4*d)/1e4}(e,t.longitude,t.latitude,r.longitude,r.latitude)}function s(e,t,r){const n=t.spatialReference,s=(0,i.tO)(n),l=new a.default(t.x,e.y,n),c=new a.default(r.x,e.y,n),u=new a.default(e.x,t.y,n),h=new a.default(e.x,r.y,n);return{lon:o(s.radius,l,c),lat:o(s.radius,u,h)}}function l(e,t,r){const i=t/r,a=(0,n.kU)(e),o=Math.sin(i/2),s=Math.cos(a),l=2*(0,n.YN)(Math.sqrt(o*o/(s*s)));return(0,n.KJ)(l)}function c(e,t){let r=e/15;return t||(r=Math.round(r)),r}function u(e,t){const r=e?.[0];if(null==r)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=c(r,!0);const n=t.hours%1;t.hours-=n,t.minutes=60*n;const i=t.minutes%1;return t.minutes-=i,t.seconds=Math.round(60*i),t}},4852:(e,t,r)=>{r.d(t,{Ad:()=>m,O_:()=>d,m6:()=>f,wF:()=>p,y0:()=>h});var n=r(3825),i=r(50076),a=r(15941),o=r(50346),s=r(90534),l=r(97572),c=r(44538),u=r(38338);const h=e=>"FA"===e,d=async(e,t,n)=>{const a=new(await Promise.resolve().then(r.bind(r,9708)).then((e=>e.default)))({objectIds:[t]}),o=await e.queryAttachments(a,n),s=o[`${t}`]?.[0],l=s?.url;if(!l)throw new i.default("NoAttachmentError","no attachments found",{[e.objectIdField]:t,layer:e});return{datasetFormat:s.contentType.split("/")[1].toUpperCase(),url:l}};async function p(e,t){const n="string"==typeof e,i=n?e:e.url,{pathname:a,searchParams:l,origin:c}=new URL(i);let h=n?(0,s.getPathExtension)(a):e.datasetFormat;h||(h=await(0,u.gt)(i));const d=await Promise.resolve().then(r.bind(r,80068)).then((e=>e.default)),p=await d.open({ioConfig:{customFetchParameters:Object.fromEntries(l),skipMapInfo:!0},datasetFormat:h?.toUpperCase(),url:`${c}${a}`,signal:t?.signal});return p?async function(e,t){const{level:r,offset:n,size:i}=function(e){const{storageInfo:t,width:r,height:n}=e.rasterInfo,{maximumPyramidLevel:i,pyramidScalingFactor:a}=t,o=a??2;return{level:i,offset:{x:0,y:0},size:{width:Math.ceil(r/o**i),height:Math.ceil(n/o**i)}}}(e),{pixelBlock:a}=await e.fetchRawPixels(r,n,i,t);return(0,o.throwIfAborted)(t),a}(p,{signal:t?.signal}):null}async function f(e,t,r){if(!e)throw new i.default("NoLayerError","No layer provided, cannot load image from attachment",{layer:e,objectId:t});const{datasetFormat:a,url:o}=await d(e,+t,r);return(0,u.RP)(a)?await p({datasetFormat:a,url:o},r):(await(0,n.default)(o,{...r,useRequestQueue:!0,responseType:"image",query:{w:c.RK}})).data}function m(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{height:n,width:i}=e;t.width=i,t.height=n;const o=t.getContext("2d");if(!o)return;const s=function(e,t,r){const n=document.createElement("canvas"),i=n.getContext("2d");if(e instanceof HTMLImageElement)n.width=e.width,n.height=e.height,i?.drawImage(e,0,0);else{const a=r.createImageData(t.width,t.height);a&&(a.data.set(e.getAsRGBA()),n.width=a.width,n.height=a.height,i?.putImageData(a,0,0))}return n}(e,t,o);s.getContext("2d")&&(r>0?function(e,t,r,n,i){const o=(0,a.kU)(i),s=[(0,l.cC)(0,0,o),(0,l.cC)(r,0,o),(0,l.cC)(r,n,o),(0,l.cC)(0,n,o)],c=Math.max(...s.map((e=>e[0])))-Math.min(...s.map((e=>e[0]))),u=Math.max(...s.map((e=>e[1])))-Math.min(...s.map((e=>e[1]))),h=Math.min(r/c,n/u);e.save(),e.clearRect(0,0,r,n),e.translate(r/2,n/2),e.rotate(o),e.scale(h,h),e.drawImage(t,-r/2,-n/2,r,n),e.restore()}(o,s,i,n,r):o.drawImage(s,0,0))}},7839:(e,t,r)=>{r.d(t,{A:()=>v});var n=r(35143),i=r(69098),a=r(42553),o=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),l=r(59913);let c=class extends(i.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=1}toString(){const{type:e,horizontalWKID:t,verticalWKID:r,x:n,y:i,z:a,heading:o,pitch:s,roll:l,affineTransformations:c,focalLength:u,principalOffsetPoint:h,radialDistortionCoefficients:d,tangentialDistortionCoefficients:p}=this,f=[e,t,r,n,i,a,o,s,l];return this.isAdvanced&&(c?.forEach((e=>f.push(e))),f.push(u),h?.forEach((e=>f.push(e))),d?.forEach((e=>f.push(e))),p?.forEach((e=>f.push(e)))),f.map((e=>Number.isNaN(e)?"":e)).join("|")}};(0,n._)([(0,o.MZ)({json:{write:!0}})],c.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"affineTransformations",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"focalLength",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"principalOffsetPoint",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"radialDistortionCoefficients",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"tangentialDistortionCoefficients",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"heading",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"pitch",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"roll",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"x",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"y",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"z",void 0),c=(0,n._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationHPR")],c);const u=c;let h=class extends(i.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=4}toString(){const{type:e,latitude:t,longitude:r,ellipsoidRadius:n,squaredEccentricity:i,properties:a}=this,o=`${a}`.split("|");return o.splice(1,1),`${e}|${t}|${r}|${n}|${i}|${o.join("|")}`}};(0,n._)([(0,o.MZ)({json:{write:!0}})],h.prototype,"type",void 0),(0,n._)([(0,o.MZ)({json:{write:!0},type:Number})],h.prototype,"latitude",void 0),(0,n._)([(0,o.MZ)({json:{write:!0},type:Number})],h.prototype,"longitude",void 0),(0,n._)([(0,o.MZ)({json:{write:!0},type:Number})],h.prototype,"ellipsoidRadius",void 0),(0,n._)([(0,o.MZ)({json:{write:!0},type:Number})],h.prototype,"squaredEccentricity",void 0),(0,n._)([(0,o.MZ)({json:{write:!0}})],h.prototype,"properties",void 0),h=(0,n._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationLTP")],h);const d=h;let p=class extends(i.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=2}toString(){const{type:e,horizontalWKID:t,verticalWKID:r,x:n,y:i,z:a,omega:o,phi:s,kappa:l,affineTransformations:c,focalLength:u,principalOffsetPoint:h,radialDistortionCoefficients:d,tangentialDistortionCoefficients:p}=this,f=[e,t,r,n,i,a,o,s,l];return this.isAdvanced&&(c?.forEach((e=>f.push(e))),f.push(u),h?.forEach((e=>f.push(e))),d?.forEach((e=>f.push(e))),p?.forEach((e=>f.push(e)))),f.map((e=>isNaN(e)?"":e)).join("|")}};(0,n._)([(0,o.MZ)({json:{write:!0}})],p.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"affineTransformations",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"focalLength",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"principalOffsetPoint",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"radialDistortionCoefficients",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"tangentialDistortionCoefficients",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"omega",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"phi",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"kappa",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"x",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"y",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"z",void 0),p=(0,n._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationOPK")],p);const f=p;let m=class extends(i.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=3}get isAdvanced(){const{affineTransformations:e,focalLength:t,principalOffsetPoint:r,radialDistortionCoefficients:n,tangentialDistortionCoefficients:i}=this;return e?.length>1||!Number.isNaN(t)||r?.length>1||n?.length>1||i?.length>1}toString(){const{type:e,horizontalWKID:t,verticalWKID:r,x:n,y:i,z:a,yaw:o,pitch:s,roll:l,affineTransformations:c,focalLength:u,principalOffsetPoint:h,radialDistortionCoefficients:d,tangentialDistortionCoefficients:p}=this,f=[e,t,r,n,i,a,o,s,l];return this.isAdvanced&&(c?.forEach((e=>f.push(e))),f.push(u),h?.forEach((e=>f.push(e))),h?.forEach((e=>f.push(e))),d?.forEach((e=>f.push(e))),p?.forEach((e=>f.push(e)))),f.map((e=>Number.isNaN(e)?"":e)).join("|")}};(0,n._)([(0,o.MZ)({json:{write:!0}})],m.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"affineTransformations",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"focalLength",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"principalOffsetPoint",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"radialDistortionCoefficients",void 0),(0,n._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"tangentialDistortionCoefficients",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"yaw",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"pitch",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"roll",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"x",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"y",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"z",void 0),m=(0,n._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationYPR")],m);const g=m;var y=r(40350);const v=new Map;v.set(`${y.g.OPK}`,{desc:"Using Omega Phi Kappa",constructor:f}),v.set(`${y.g.HPR}`,{desc:"Using Heading, Pitch and Roll",constructor:u}),v.set(`${y.g.YPR}`,{desc:"Using Yaw, Pitch and Roll",constructor:g}),v.set(`${y.g.LTP}`,{desc:"Using Local Tangent Plane",constructor:d})},8595:(e,t,r)=>{r.d(t,{Qv:()=>g,RR:()=>c,Rf:()=>s,eR:()=>l,fs:()=>h,l6:()=>u,y4:()=>m});var n=r(45802),i=r(7839),a=r(58872),o=r(40350);function s(e,t,r){return t&&(e=`${t}${e}`),r&&(e+=`${r}`),e}function l(e,t,r){return e?(0,a.E1)(e)?new a.Mr(e):function(e,t,r){let{url:n}=e;return n?(n=s(n,t,r),new a.TH({...e,url:n})):null}(e,t,r):e}const c=new n.J({Minutes:"minutes",Hours:"hours",Days:"days",Weeks:"weeks",Months:"months",Years:"years"}),u=new n.J({Feet:"feet",Meter:"meter"}),h=new n.J({360:"360",Horizontal:"horizontal",Inspection:"inspection",Nadir:"nadir",Oblique:"oblique","":null}),d=new Map;d.set(`${o.g.HPR}`,(function(e){const[t,r,n,i,a,o,s,l,c,u,h,d,p,m,g,y,v,w,M,b,_,x]=e.slice(1);return{horizontalWKID:t,verticalWKID:r,x:n,y:i,z:a,heading:o,pitch:s,roll:l,...f([c,u,h,d,p,m],[y,v],[w,M,b],[_,x],g)}})),d.set(`${o.g.YPR}`,(function(e){const[t,r,n,i,a,o,s,l,c,u,h,d,p,m,g,y,v,w,M,b,_,x]=e.slice(1);return{horizontalWKID:t,verticalWKID:r,x:n,y:i,z:a,yaw:o,pitch:s,roll:l,...f([c,u,h,d,p,m],[y,v],[w,M,b],[_,x],g)}})),d.set(`${o.g.OPK}`,(function(e){const[t,r,n,i,a,o,s,l,c,u,h,d,p,m,g,y,v,w,M,b,_,x]=e.slice(1);return{horizontalWKID:t,verticalWKID:r,x:n,y:i,z:a,omega:o,phi:s,kappa:l,...f([c,u,h,d,p,m],[y,v],[w,M,b],[_,x],g)}})),d.set(`${o.g.LTP}`,(function(e){const[t,r,n,a,o,...s]=e.slice(1),l=d.get(o),c=i.A.get(o)?.constructor;return l&&c?{latitude:t,longitude:r,ellipsoidRadius:n,squaredEccentricity:a,properties:new c(l([o,"",...s]))}:null}));const p=e=>{const t=e.map((e=>parseFloat(e))).filter((e=>!isNaN(e)));if(t.length===e.length)return t};function f(e,t,r,n,i){const a=p(e),o=p(t),s=p(r),l=p(n);return{affineTransformations:6===a?.length?a:void 0,focalLength:6===a?.length?parseFloat(i):void 0,principalOffsetPoint:2!==o?.length?[0,0]:o,radialDistortionCoefficients:3!==s?.length?[0,0,0]:s,tangentialDistortionCoefficients:2!==l?.length?[0,0]:l}}function m(e){if(!e)return null;const t=`${e}`.split("|");if(0===t.length)return null;const r=i.A.get(t[0]);if(!r)return null;const n=d.get(t[0]);return n?new(0,r.constructor)(n(t)):null}function g(e){return Array.isArray(e)&&9===e?.length&&!e.some(isNaN)}},9634:(e,t,r)=>{r.d(t,{G:()=>l,y:()=>o});var n=r(54093),i=r(43036),a=r(85632);function o(e){s=e}let s;function l(e){return null===e?null:(0,i.g)(e)?e.clone():(0,i.d)(e)?e:(0,i.l)(e)?e.clone():(0,i.m)(e)?e.toArray().map((e=>l(e))):(0,a.cy)(e)?e.map((e=>l(e))):(0,i.n)(e)?s.createFromArcadeFeature(e):(0,i.o)(e)||(0,i.p)(e)?e:(0,i.q)(e)||"esri.arcade.Attachment"===e?.declaredClass?e.deepClone():("esri.arcade.Portal"===e?.declaredClass||(0,i.r)(e)||e instanceof n.x||(0,i.i)(e),e)}},9861:(e,t,r)=>{r.d(t,{B:()=>p,D$:()=>l,Nh:()=>d,O$:()=>h,TX:()=>n,mT:()=>u,ps:()=>m});var n,i=r(88685);!function(e){e.AsyncNotEnabled="AsyncNotEnabled",e.ModulesNotSupported="ModulesNotSupported",e.CircularModules="CircularModules",e.CannotCompareDateAndTime="CannotCompareDateAndTime",e.NeverReach="NeverReach",e.UnsupportedHashType="UnsupportedHashType",e.InvalidParameter="InvalidParameter",e.FeatureSetDoesNotHaveSubtypes="FeatureSetDoesNotHaveSubtypes",e.UnexpectedToken="UnexpectedToken",e.Unrecognized="Unrecognized",e.UnrecognizedType="UnrecognizedType",e.MaximumCallDepth="MaximumCallDepth",e.BooleanConditionRequired="BooleanConditionRequired",e.TypeNotAllowedInFeature="TypeNotAllowedInFeature",e.KeyMustBeString="KeyMustBeString",e.WrongNumberOfParameters="WrongNumberOfParameters",e.CallNonFunction="CallNonFunction",e.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",e.NoFunctionInDictionary="NoFunctionInDictionary",e.NoFunctionInArray="NoFunctionInArray",e.AssignModuleFunction="AssignModuleFunction",e.LogicExpressionOrAnd="LogicExpressionOrAnd",e.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",e.FunctionNotFound="FunctionNotFound",e.InvalidMemberAccessKey="InvalidMemberAccessKey",e.UnsupportedUnaryOperator="UnsupportUnaryOperator",e.InvalidIdentifier="InvalidIdentifier",e.MemberOfNull="MemberOfNull",e.UnsupportedOperator="UnsupportedOperator",e.Cancelled="Cancelled",e.ModuleAccessorMustBeString="ModuleAccessorMustBeString",e.ModuleExportNotFound="ModuleExportNotFound",e.Immutable="Immutable",e.OutOfBounds="OutOfBounds",e.IllegalResult="IllegalResult",e.FieldNotFound="FieldNotFound",e.PortalRequired="PortalRequired",e.LogicError="LogicError",e.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",e.KeyAccessorMustBeString="KeyAccessorMustBeString",e.WrongSpatialReference="WrongSpatialReference",e.CannotChangeTimeZoneTime="CannotChangeTimeZoneTime",e.CannotChangeTimeZoneDateOnly="CannotChangeTimeZoneDateOnly"}(n||(n={}));const a={[n.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[n.LogicError]:"Logic error - {reason}",[n.CannotCompareDateAndTime]:"Cannot compare date or dateonly with timeonly types",[n.NeverReach]:"Encountered unreachable logic",[n.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[n.ModuleAccessorMustBeString]:"Module accessor must be a string",[n.ModuleExportNotFound]:"Module has no export with provided identifier",[n.ModulesNotSupported]:"Current profile does not support modules",[n.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[n.FunctionNotFound]:"Function not found",[n.FieldNotFound]:"Key not found - {key}",[n.CircularModules]:"Circular module dependencies are not allowed",[n.Cancelled]:"Execution cancelled",[n.UnsupportedHashType]:"Type not supported in hash function",[n.IllegalResult]:"Value is not a supported return type",[n.PortalRequired]:"Portal is required",[n.InvalidParameter]:"Invalid parameter",[n.WrongNumberOfParameters]:"Call with wrong number of parameters",[n.Unrecognized]:"Unrecognized code structure",[n.UnrecognizedType]:"Unrecognized type",[n.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[n.BooleanConditionRequired]:"Conditions must use booleans",[n.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[n.NoFunctionInArray]:"Arrays cannot contain functions.",[n.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[n.KeyAccessorMustBeString]:"Accessor must be a string",[n.KeyMustBeString]:"Object keys must be a string",[n.Immutable]:"Object is immutable",[n.UnexpectedToken]:"Unexpected token",[n.MemberOfNull]:"Cannot access property of null object",[n.MaximumCallDepth]:"Exceeded maximum function depth",[n.OutOfBounds]:"Out of bounds",[n.InvalidIdentifier]:"Identifier not recognized",[n.CallNonFunction]:"Expression is not a function",[n.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[n.AssignModuleFunction]:"Cannot assign function to module variable",[n.UnsupportedUnaryOperator]:"Unsupported unary operator",[n.UnsupportedOperator]:"Unsupported operator",[n.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[n.LogicExpressionOrAnd]:"Logical expression can only be combined with || or &&",[n.CannotChangeTimeZoneTime]:"Cannot change the timezone of a Time",[n.CannotChangeTimeZoneDateOnly]:"Cannot change the timezone of a DateOnly",[n.FeatureSetDoesNotHaveSubtypes]:"FeatureSet does not have subtypes"};class o extends Error{constructor(){super(...arguments)}}class s extends o{constructor(e,t){super(c(t)+e.message,{cause:e}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,s),t?.loc&&(this.loc=t.loc)}}class l extends Error{constructor(e,t,r,n){super("Execution error - "+c(r)+(0,i.HC)(a[t],n)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,l),r?.loc&&(this.loc=r.loc)}}function c(e){return e&&e.loc?`Line : ${e.loc.start?.line}, ${e.loc.start?.column}: `:""}class u extends Error{constructor(e,t,r,n){super("Compilation error - "+c(r)+(0,i.HC)(a[t],n)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,u),r?.loc&&(this.loc=r.loc)}}class h extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,h)}}function d(e,t,r){return"esri.arcade.arcadeexecutionerror"===r.declaredRootClass||"esri.arcade.arcadecompilationerror"===r.declaredRootClass?null===r.loc&&t?.loc?new s(r,{cause:r}):r:("esri.arcade.featureset.support.featureseterror"===r.declaredRootClass||"esri.arcade.featureset.support.sqlerror"===r.declaredRootClass||r.declaredRootClass,t?.loc?new s(r,{cause:r}):r)}var p;!function(e){e.UnrecognizedUri="UnrecognizedUri",e.UnsupportedUriProtocol="UnsupportedUriProtocol"}(p||(p={}));const f={[p.UnrecognizedUri]:"Unrecognized uri - {uri}",[p.UnsupportedUriProtocol]:"Unrecognized uri protocol"};class m extends Error{constructor(e,t){super((0,i.HC)(f[e],t)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,m)}}},11113:(e,t,r)=>{r.d(t,{Ee:()=>l,Jd:()=>y,Nk:()=>d,OM:()=>g,Oo:()=>m,W4:()=>c,ix:()=>p,t_:()=>h,tr:()=>u,yh:()=>f,zJ:()=>o});var n=r(73582),i=r(24648),a=r(96820);function o(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,a.zJ)(e,(0,i.kM)(t,r).value,r,n,o)}function s(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,a.nD)(e,(0,i.kM)(t,r).value,r,n,o)}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Ee)(e,t.value,t.unit,r,n)}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.W4)(e,t.value,t.unit,r,n)}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.tr)(e,t.value,t.unit,r,n)}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.t_)(e,t.value,t.unit,r,n)}function d(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.ie,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,a.Me)(e.value,e.unit,e.rotationType,t,r,i,o)}function p(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(n=n??2,r){case"imperial":return u(e,t,n,i);case"metric":return l(e,t,n,i);default:return o(e,t,r,n,i)}}function f(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.J1)(e,t.value,t.unit,r,n)}(e,t,n,i);case"metric":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Mm)(e,t.value,t.unit,r,n)}(e,t,n,i);default:return s(e,t,r,n,i)}}function m(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return h(e,t,n,i);case"metric":return c(e,t,n,i);default:return o(e,t,r,n,i)}}function g(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.LF)(e,t.value,t.unit,r,n)}(e,t,n,i);case"metric":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.e_)(e,t.value,t.unit,r,n)}(e,t,n,i);default:return s(e,t,r,n,i)}}function y(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Sz)(e,t.value,t.unit,r,n)}(e,t,n,i);case"metric":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.zq)(e,t.value,t.unit,r,n)}(e,t,n,i);default:return o(e,t,r,n,i)}}},13014:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var n=r(35143),i=r(50076),a=r(53084),o=r(48611),s=r(46053),l=(r(81806),r(76460),r(85842)),c=r(30907),u=r(78817),h=r(8595),d=r(59187),p=r(61701);const f=new Set(["demPathPrefix","demPathSuffix","depthImagePathPrefix","depthImagePathSuffix","elevationSource","horizontalMeasurementUnit","imageGeometryField","imageReferenceField","verticalMeasurementUnit","videoPathPrefix","videoPathSuffix","timeAnimation","visibilityTimeExtent"]),m=(e,t)=>!f.has(t)&&e;function g(e,t,r,n){const{name:i,write:a,read:o}=((e,t,r)=>{const n=`orientedImageryProperties.${e}`;return{name:n,write:t?{ignoreOrigin:!0,target:n,writer:t}:{ignoreOrigin:!0},read:r?{ignoreOrigin:!0,source:n,reader:r}:{ignoreOrigin:!0}}})(e,t,r),s={name:i,write:a,read:o,origins:{service:{name:`orientedImageryInfo.${i}`,write:t,read:r},"web-scene":{name:i,write:m(a,e),read:m(o,e)},"web-map":{name:i,write:a,read:o}}};return n&&s.origins?(s.type=n,s.origins["web-map"].type=n,s.origins["web-scene"].type=n,s):s}let y=class extends c.default{constructor(){super(...arguments),this.cameraHeading=null,this.cameraHeight=null,this.cameraPitch=null,this.cameraRoll=null,this.coveragePercent=null,this.demPathPrefix=null,this.demPathSuffix=null,this.depthImagePathPrefix=null,this.depthImagePathSuffix=null,this.elevationSource=null,this.farDistance=null,this.geometryType="point",this.horizontalFieldOfView=null,this.horizontalMeasurementUnit=null,this.imageGeometryField="ImageGeometry",this.imagePathPrefix=null,this.imagePathSuffix=null,this.imageReferenceField="OIObjectID",this.imageRotation=null,this.maximumDistance=null,this.nearDistance=null,this.operationalLayerType="OrientedImageryLayer",this.orientationAccuracy=null,this.orientedImageryType=null,this.supportedSourceTypes=new Set(["Oriented Imagery Layer"]),this.type="oriented-imagery",this.timeIntervalUnit="days",this.useViewTime=!0,this.verticalFieldOfView=null,this.verticalMeasurementUnit=null,this.videoPathPrefix=null,this.videoPathSuffix=null,this.visibilityTimeExtent=null}get effectiveElevationSource(){const{elevationSource:e,demPathPrefix:t,demPathSuffix:r}=this;return(0,h.eR)(e,t,r)}async save(e){return this._debouncedSaveOperations(p.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(p.X.SAVE_AS,t,e)}findFirstValidLayerId(e){return e.layers?.find((e=>this.supportedSourceTypes.has(e.type)))?.id}_verifySource(){if(super._verifySource(),"point"!==this.geometryType)throw new i.default("oriented-imagery-layer:invalid-geometry-type","OrientedImageryLayer only supports point geometry type")}};(0,n._)([(0,s.MZ)({type:Number,json:g("cameraHeading")})],y.prototype,"cameraHeading",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("cameraHeight")})],y.prototype,"cameraHeight",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("cameraPitch")})],y.prototype,"cameraPitch",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("cameraRoll")})],y.prototype,"cameraRoll",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("coveragePercent")})],y.prototype,"coveragePercent",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("demPathPrefix")})],y.prototype,"demPathPrefix",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("demPathSuffix")})],y.prototype,"demPathSuffix",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("depthImagePathPrefix")})],y.prototype,"depthImagePathPrefix",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("depthImagePathSuffix")})],y.prototype,"depthImagePathSuffix",void 0),(0,n._)([(0,s.MZ)({type:Object,json:g("elevationSource")})],y.prototype,"elevationSource",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],y.prototype,"effectiveElevationSource",null),(0,n._)([(0,s.MZ)({type:Number,json:g("farDistance")})],y.prototype,"farDistance",void 0),(0,n._)([(0,s.MZ)()],y.prototype,"geometryType",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("horizontalFieldOfView")})],y.prototype,"horizontalFieldOfView",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("horizontalMeasurementUnit")})],y.prototype,"horizontalMeasurementUnit",void 0),(0,n._)([(0,s.MZ)({type:String,json:{...g("imageGeometryField"),default:"ImageGeometry"}})],y.prototype,"imageGeometryField",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("imagePathPrefix")})],y.prototype,"imagePathPrefix",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("imagePathSuffix")})],y.prototype,"imagePathSuffix",void 0),(0,n._)([(0,s.MZ)({type:String,json:{...g("imageReferenceField"),default:"OIObjectID"}})],y.prototype,"imageReferenceField",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("imageRotation")})],y.prototype,"imageRotation",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("maximumDistance")})],y.prototype,"maximumDistance",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("nearDistance")})],y.prototype,"nearDistance",void 0),(0,n._)([(0,s.MZ)({type:["OrientedImageryLayer"],json:{origins:{"portal-item":{name:"layerType",write:{enabled:!0,ignoreOrigin:!0}}}}})],y.prototype,"operationalLayerType",void 0),(0,n._)([(0,s.MZ)({json:{...g("orientationAccuracy",((e,t,r)=>{(0,o.sM)(r,e.join(";"),t)}),(e=>{const t=e?.split(";")?.map(Number);return(0,h.Qv)(t)?t:[0,0,0,0,0,0,0,0,0]}),String)}})],y.prototype,"orientationAccuracy",void 0),(0,n._)([(0,s.MZ)({json:{...g("orientedImageryType",h.fs.write,h.fs.read,h.fs.jsonValues.slice(1))}})],y.prototype,"orientedImageryType",void 0),(0,n._)([(0,s.MZ)({json:{read:!1},value:"oriented-imagery",readOnly:!0})],y.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:h.RR.apiValues,json:{...g("timeIntervalUnit",h.RR.write,h.RR.read,h.RR.jsonValues)}})],y.prototype,"timeIntervalUnit",void 0),(0,n._)([(0,s.MZ)(function(e){return e.json?(e.json.origins=e.json.origins??{},e.json.origins["web-scene"]={write:!1,read:!1},e):e}((0,a.clone)(u.B)))],y.prototype,"useViewTime",void 0),(0,n._)([(0,s.MZ)({type:Number,json:g("verticalFieldOfView")})],y.prototype,"verticalFieldOfView",void 0),(0,n._)([(0,s.MZ)({type:h.l6.apiValues,json:{...g("verticalMeasurementUnit",h.l6.write,h.l6.read,h.l6.jsonValues)}})],y.prototype,"verticalMeasurementUnit",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("videoPathPrefix")})],y.prototype,"videoPathPrefix",void 0),(0,n._)([(0,s.MZ)({type:String,json:g("videoPathSuffix")})],y.prototype,"videoPathSuffix",void 0),(0,n._)([(0,s.MZ)({type:d.default,json:{origins:{"web-scene":{write:!1,read:!1}}}})],y.prototype,"visibilityTimeExtent",void 0),y=(0,n._)([(0,l.$)("esri.layers.OrientedImageryLayer")],y);const v=y},14902:(e,t,r)=>{r.d(t,{k:()=>l});var n=r(80324),i=r(38042),a=r(24241);function o(e){if(!e)return"";const t=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let r="";for(const n of e.match(t)||[])switch(n){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":r+=n;break;case"A":case"a":r+="a";break;default:r+=`'${n}'`}return r}const s="esri.core.sql.timeonly";class l{constructor(e,t,r,n){this._hour=e,this._minute=t,this._second=r,this._millisecond=n,this.declaredRootClass=s}static isTimeOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===s}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return l.isTimeOnly(e)&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new l(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,n.Fq)(this.hour)&&(0,n.Fq)(this.minute)&&(0,n.Fq)(this.second)&&(0,n.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e||""===e?this.toString():(e=o(e))?a.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:(0,i.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,t,r,n){const i=new l(e,t,r,n);return i.isValid()?i:null}static fromReader(e){if(!e)return null;const t=e.split(":");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const t=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),n=Math.floor(e/36e5%24),i=Math.floor(e%1e3);return new l(n,r,t,i)}static fromDateJS(e){return new l(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new l(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const r=[];t?(t=o(t))&&r.push(t):null!==t&&""!==t||(r.push("HH:mm:ss"),r.push("HH:mm:ss.SSS"),r.push("hh:mm:ss a"),r.push("hh:mm:ss.SSS a"),r.push("HH:mm"),r.push("hh:mm a"),r.push("H:mm"),r.push("h:mm a"),r.push("H:mm:ss"),r.push("h:mm:ss a"),r.push("H:mm:ss.SSS"),r.push("h:mm:ss.SSS a"));for(const n of r){const t=a.c9.fromFormat(e,n);if(t.isValid)return new l(t.hour,t.minute,t.second,t.millisecond)}return null}plus(e,t){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}return null}toUTCDateTime(){return a.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}}},16503:(e,t,r)=>{r.d(t,{n:()=>l});var n=r(46405),i=r(38042),a=r(24241);function o(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let t="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const n of e.match(r)||[])switch(n){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"X":case"x":t+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?t+=`'${n.slice(1,-1)}'`:t+=`'${n}'`}return t}const s="esri.core.sql.dateonly";class l{constructor(e,t,r){this._year=e,this._month=t,this._day=r,this.declaredRootClass=s}static isDateOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===s}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return l.isDateOnly(e)&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new l(this._year,this._month,this._day)}toDateTime(e){return a.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(e)})}toDateTimeLuxon(e){return a.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e||""===e)return this.toString();if(t&&(e=o(e)),!e)return"";const r=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(r).toFormat(e,{locale:(0,i.JK)(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,t){return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}toUTCDateTime(){return a.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const t=a.c9.fromMillis(e,{zone:a.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromSeconds(e){const t=a.c9.fromSeconds(e,{zone:a.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromReader(e){if(!e)return null;const t=e.split("-");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}static fromParts(e,t,r){const n=new l(e,t,r);return!1===n.isValid?null:n}static fromDateJS(e){return l.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return l.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const r=[];if(t)(t=o(t))&&r.push(t);else if(null===t||""===t){const t=a.c9.fromISO(e,{setZone:!0});return t.isValid?l.fromParts(t.year,t.month,t.day):null}for(const n of r){const r=a.c9.fromFormat(e,t??n);if(r.isValid)return new l(r.year,r.month,r.day)}return null}static fromNow(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"system";const t=a.c9.fromJSDate(new Date).setZone((0,n.mT)(e));return new l(t.year,t.month,t.day)}}},19562:(e,t,r)=>{r.d(t,{C1:()=>T,FT:()=>b,Fz:()=>M,IL:()=>x,Jb:()=>A,Mi:()=>I,OO:()=>y,P1:()=>w,PR:()=>P,Tu:()=>F,Xg:()=>R,at:()=>v,dg:()=>O,fg:()=>C,ov:()=>_,pB:()=>S,ph:()=>D});var n=r(69539),i=r(19276),a=r(59784),o=r(89465),s=r(84847),l=r(27796),c=r(34913),u=r(94918),h=r(47943),d=r(54347),p=r(37471),f=r(86875),m=r(38996),g=r(76940);const y=new g.default({size:15,style:"circle",color:[255,102,102,.5],outline:null}),v=new g.default({size:10,style:"circle",color:[0,128,192,.5],outline:null}),w=new f.default({style:"solid",color:[0,128,192,.5],outline:null}),M=new f.default({style:"solid",color:[255,102,102,.5],outline:null}),b=new g.default({size:10,style:"diamond",color:[255,102,102],outline:null}),_=new p.default({symbolLayers:new i.default([new l.default({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),x=new p.default({symbolLayers:new i.default([new h.default({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),S=new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),R=new u.default({symbolLayers:new i.default([new s.default({material:{color:[255,102,102,.5]},edges:null})])}),I=new u.default({symbolLayers:new i.default([new s.default({material:{color:[0,128,192,.25]},edges:null})])}),T=new g.default({size:8,style:"triangle",color:[255,165,0],outline:{color:[0,0,0],width:.5}}),P=new p.default({symbolLayers:new i.default([new h.default({width:12,height:12,depth:12,material:{color:[255,165,0]},resource:{primitive:"tetrahedron"},outline:{color:"black",size:1},castShadows:!1})])}),A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3.5;return new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:(0,a.bJ)(e).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:e.toArray()}]}}})},F=new c.default({symbolLayers:new i.default([new d.default({profile:"circle",width:7,material:{color:"orange"},cap:"round"})])}),C=e=>new f.default({color:(0,a._L)(e,.3),outline:{color:e,width:2}});function O(e){switch(e){case"point":return e=>new g.default({size:10,style:"circle",color:e??N(),outline:new m.default({color:[0,0,0],width:2})});case"polygon":return e=>new f.default({color:null,outline:Z(e),style:"none"});case"polyline":return e=>Z(e)}}function N(){return new n.default([255,0,0])}function Z(e){return new m.default({color:e??N(),width:2})}function D(e,t,r){return e===t?r:"polyline"===e?Z(r?.color):function(e){return new f.default({color:null,outline:Z(e),style:"none"})}(r?.color)}},20481:(e,t,r)=>{r.d(t,{B:()=>c,GP:()=>s,ZY:()=>o,qg:()=>u});var n=r(88685),i=r(38042);const a={ar:[".",","],bg:[",","\xa0"],bs:[",","."],ca:[",","."],cs:[",","\xa0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xa0"],fi:[",","\xa0"],fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xa0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xa0"],lv:[",","\xa0"],mk:[",","."],nb:[",","\xa0"],nl:[",","."],no:[",","\xa0"],pl:[",","\xa0"],pt:[",","."],"pt-pt":[",","\xa0"],ro:[",","."],ru:[",","\xa0"],sk:[",","\xa0"],sl:[",","."],sr:[",","."],sv:[",","\xa0"],th:[".",","],tr:[",","."],uk:[",","\xa0"],vi:[",","."],zh:[".",","]};function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.JK)(),t=(e=e.toLowerCase())in a;if(!t){const r=e.split("-");r.length>1&&r[0]in a&&(e=r[0],t=!0),t||(e="en")}const[r,n,o="#,##0.###"]=a[e];return{decimal:r,group:n,pattern:o}}function s(e,t){const r=o((t={...t}).locale);t.customs=r;const n=t.pattern||r.pattern;return isNaN(e)||Math.abs(e)===1/0?null:function(e,t,r){const n=(r=r||{}).customs.group,i=r.customs.decimal,a=t.split(";"),o=a[0];if((t=a[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xa4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const s=l,c=o.match(s);if(!c)throw new Error("unable to find a number expression in pattern: "+t);return!1===r.fractional&&(r.places=0),t.replace(s,function(e,t,r){!0===(r=r||{}).places&&(r.places=0),r.places===1/0&&(r.places=6);const n=t.split("."),i="string"==typeof r.places&&r.places.indexOf(",");let a=r.places;i?a=r.places.slice(i+1):+a>=0||(a=(n[1]||[]).length),r.round<0||(e=Number(e.toFixed(Number(a))));const o=String(Math.abs(e)).split("."),s=o[1]||"";if(n[1]||r.places){i&&(r.places=r.places.slice(0,Math.max(0,i)));const e=void 0!==r.places?r.places:n[1]&&n[1].lastIndexOf("0")+1;+e>s.length&&(o[1]=s.padEnd(Number(e),"0")),+a<s.length&&(o[1]=s.slice(0,Math.max(0,Number(a))))}else o[1]&&o.pop();const l=n[0].replace(",","");let c=l.indexOf("0");-1!==c&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].slice(-c)));let u,h,d=n[0].lastIndexOf(",");if(-1!==d){u=n[0].length-d-1;const e=n[0].slice(0,d);d=e.lastIndexOf(","),-1!==d&&(h=e.length-d-1)}const p=[];for(let f=o[0];f;){const e=f.length-u;p.push(e>0?f.slice(Math.max(0,e)):f),f=e>0?f.slice(0,e):"",h&&(u=h,h=void 0)}return o[0]=p.reverse().join(r.group||","),o.join(r.decimal||".")}(e,c[0],{decimal:i,group:n,places:r.places,round:r.round}))}(e,n,t)}const l=/[#0,]*[#0](?:\.0*#*)?/;function c(e){const t=o((e=e||{}).locale),r=e.pattern||t.pattern,i=t.group,a=t.decimal;let s=1;if(r.includes("%"))s/=100;else if(r.includes("\u2030"))s/=1e3;else if(r.includes("\xa4"))throw new Error("currency notation not supported");const c=r.split(";");1===c.length&&c.push("-"+c[0]);const u=d(c,(t=>(t="(?:"+(0,n.Cj)(t,".")+")").replace(l,(t=>{const r={signed:!1,separator:e.strict?i:[i,""],fractional:e.fractional,decimal:a,exponent:!1},n=t.split(".");let o=e.places;1===n.length&&1!==s&&(n[1]="###"),1===n.length||0===o?r.fractional=!1:(void 0===o&&(o=e.pattern?n[1].lastIndexOf("0")+1:1/0),o&&null==e.fractional&&(r.fractional=!0),!e.places&&+o<n[1].length&&(o+=","+n[1].length),r.places=o);const l=n[0].split(",");return l.length>1&&(r.groupSize=l.pop().length,l.length>1&&(r.groupSize2=l.pop().length)),"("+function(e){"places"in(e=e||{})||(e.places=1/0),"string"!=typeof e.decimal&&(e.decimal="."),"fractional"in e&&!String(e.places).startsWith("0")||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=h(e),r=d(e.fractional,(t=>{let r="";return t&&0!==e.places&&(r="\\"+e.decimal,e.places===1/0?r="(?:"+r+"\\d+)?":r+="\\d{"+e.places+"}"),r}),!0);let n=t+r;return r&&(n="(?:(?:"+n+")|(?:"+r+"))"),n+d(e.exponent,(t=>t?"([eE]"+h({signed:e.eSigned})+")":""))}(r)+")"}))),!0);return{regexp:u.replaceAll(/[\xa0 ]/g,"[\\s\\xa0]"),group:i,decimal:a,factor:s}}function u(e,t){const r=c(t),n=new RegExp("^"+r.regexp+"$").exec(e);if(!n)return NaN;let i=n[1];if(!n[1]){if(!n[2])return NaN;i=n[2],r.factor*=-1}return i=i.replaceAll(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,"."),Number(i)*r.factor}function h(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",d(e.signed,(e=>e?"[-+]":""),!0)+d(e.separator,(t=>{if(!t)return"(?:\\d+)";" "===(t=(0,n.Cj)(t))?t="\\s":"\xa0"===t&&(t="\\s\\xa0");const r=e.groupSize,i=e.groupSize2;if(i){const e="(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*["+t+"]\\d{"+r+"})";return r-i>0?"(?:"+e+"|(?:0|[1-9]\\d{0,"+(r-1)+"}))":e}return"(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*)"}),!0)}const d=(e,t,r)=>{if(!Array.isArray(e))return t(e);const n=[];for(let i=0;i<e.length;i++)n.push(t(e[i]));return p(n.join("|"),Boolean(r))},p=(e,t)=>"("+(t?"?:":"")+e+")"},20749:(e,t,r)=>{r.r(t),r.d(t,{imageToWorld:()=>P,imageToWorldPanoramic:()=>D});var n=r(18690),i=r(9392),a=r(20664),o=r(19247),s=r(95925),l=r(78315),c=r(58872),u=r(9634),h=(r(50076),r(81806),r(76460),r(65215)),d=r(13927),p=r(42269),f=r(97572),m=r(85367);async function g(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;const{cameraLocation:a,farPlaneVertices:s}=r,l=(0,f.n3)(a),c=new Array;await b(s,r,c);let u=(0,d.Cr)(c[0],c[1],c[2]),h=e.clone();for(let p=0;p<n;p++){const n=(0,i.vt)();if(!(0,d.U5)(u,l,(0,f.n3)(e),n))break;let s=0,p=null;if(({error:s,imagePoint:p,pointWithZ:h}=await _(t,new o.default(n,a.spatialReference),r)),s<=1)break;const[m,g]=M(a.spatialReference,c);if((0,f.or)(m<=1,g<=1))break;c.splice(0,c.length,...await I(m,g,new o.default(n,a.spatialReference),r)),u=(0,d.Cr)(c[0],c[1],c[2])}return(0,f.n3)(h)}async function y(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;const{cameraLocation:a,farPlaneVertices:s}=r,l=(0,f.n3)(a),c=new Array;await b(s,r,c);let u=(0,d.Cr)(c[0],c[1],c[2]),h=e.clone();for(let p=0;p<n;p++){const n=(0,i.vt)();if(!(0,d.U5)(u,l,(0,f.n3)(e),n))break;let s,p=0;if(({error:p,imagePoint:s,pointWithZ:h}=await x(t,new o.default(n,a.spatialReference),r)),p<=1)break;const[m,g]=M(a.spatialReference,c);if((0,f.or)(m<=1,g<=1))break;c.splice(0,c.length,...await I(m,g,new o.default(n,a.spatialReference),r)),u=(0,d.Cr)(c[0],c[1],c[2])}return(0,f.n3)(h)}const v=10,w=10;function M(e,t){const r=new h.default({spatialReference:e});return r.addRing(t),[r.extent?.width?r.extent.width/w:1,r.extent?.height?r.extent.height/w:1]}async function b(e,t,r){const n=(0,u.G)(e),i=await(0,p.A)(n,t);r.push(...i.map(f.n3))}async function _(e,t,r){const n=await(0,p.A)(t,r),i=(0,m.worldToImage)(n,r);return{error:S(i,e),imagePoint:i,pointWithZ:n}}async function x(e,t,r){const n=await(0,p.A)(t,r),i=(0,m.worldToImagePanoramic)(n,r);return{error:R(i,e),imagePoint:i,pointWithZ:n}}const S=(e,t)=>Math.abs(e.x-t.x)+Math.abs(e.y-t.y),R=(e,t)=>Math.abs(e.heading-t.heading)+Math.abs(e.pitch-t.pitch);async function I(e,t,r,n){const i=[[-e,-t],[e,-t],[e,t],[-e,t]].map((e=>{let[t,n]=e;return new o.default([r.x+t,r.y+n],r.spatialReference)}));return(0,p.A)(i,n).then((e=>e.map((e=>e.toArray()))))}var T=r(57134);async function P(e,t,r){const{verticalFieldOfView:i,imageBoundaries:a,scalingFactor:s,farPlaneVertices:l,cameraLocation:c,pixelsToTransform:u,vecToPoint:h}=function(e,t){const r=(0,n.Xj)(e)||"items"in e?e:[e],{cameraLocation:i,rotationMatrix:a}=t;if((0,f.ZA)(r,i),(0,f._)(a),9!==a?.length)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix");const s=(0,f.i2)(i.y,i.spatialReference),l=(0,f.eM)({...t,scalingFactor:s}),c=(0,m.worldToImage)(l.map((e=>new o.default(e,i.spatialReference))),t),{vfov:u}=(0,f.x1)(t.horizontalFieldOfView,t.verticalFieldOfView,t.cameraRoll);return{cameraLocation:i.toArray(),imageBoundaries:c.map((e=>{let{x:t,y:r}=e;return[t,r,1]})),verticalFieldOfView:u,farPlaneVertices:l,scalingFactor:s,pixelsToTransform:r.map((e=>[e.x,e.y,1])),vecToPoint:(0,f.Yc)(i.spatialReference)}}(e,t),d=new Array;return await A(u,l,a,h,t,d,c,s,i,r),Array.isArray(e)?d:d[0]}async function A(e,t,r,n,i,a,o,s,l,c){let u=i.averageElevation;for(const h of e){const e=C(t,r,h,n,i);c&&(0,f.or)((0,f.sp)(c.elevationSample),(0,f.tB)(c))&&(u=(await g(n(e),{x:h[0],y:h[1]},{...i,...c,farPlaneVertices:t.map(n)}))[2]),a.push(n(F(e,o,s,u,i.cameraPitch,l)))}}function F(e,t,r,n,o,s){let l=(0,i.o8)(e);const c=Math.sqrt((e[2]-t[2])**2+(Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)/r)**2)*r,u=(0,f.Qu)((0,a.a)((0,i.Ul)(),e,t),1/c,1/r);if(function(e,t,r,n){return e<t||r+n/2<90}(e[2],n,o,s)){const e=Math.abs((t[2]-n)/-u[2])*r;l=(0,f.MY)(t,u,e,r)}else l[2]=n;return l}function C(e,t,r,n,i){let a=null;let o,s=0,l=e,c=t;for(;s<=9;){const e=N(r,c,l,i);if(o=e.error,a=e.transformedPoint,(0,f.or)(o<=1,9===s))break;l=(0,f.cV)(l,o,r,t),c=O(l,n,i),s++}return a}function O(e,t,r){return(0,m.worldToImage)(e.map(t),r).map((e=>{let{x:t,y:r}=e;return[t,r,1]}))}function N(e,t,r,n){const{cameraLocation:i}=n,a=(0,f.cL)(e,t,r),{x:s,y:l}=(0,m.worldToImage)(new o.default(a,i.spatialReference),n);return{transformedPoint:a,error:Z(e,[s,l,1])}}function Z(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}async function D(e,t,r){const{cameraHeading:n,cameraLocation:a,farDistance:u,imageHeight:h,imageWidth:d,verticalFieldOfView:p}=t,m=(0,f.i2)(a.y,a.spatialReference),g=new Array,[v,w,M]=a.toArray(),b=(0,l.l)([v,w,M??0],u*m),_=T.ZH.toArray(),x=Array.isArray(e)?e:[e];for(const S of x){let e,x;if((0,f.L2)(S))e=S.heading,x=S.pitch;else{const t=(0,f.dM)({x:S.x,y:S.y},d,h);e=t.heading,x=t.pitch}e=(e+n)%360;const R=(0,s.Cr)([_[0],_[1],_[2]],(0,f.id)(e,x)),I=(0,s.fA)([v,w,M??0],R.direction),T=(0,i.Ul)();(0,l.j)(b,I,T);let P=t.averageElevation;r&&((0,c.jV)(r)||(0,f.sp)(r.elevationSample))&&x+p/2<90&&(P=(await y(new o.default(T,a.spatialReference),{heading:e,pitch:x},{...t,...r,farPlaneVertices:(0,f.Hk)(u,u).map((e=>{let[t,r]=e;return new o.default([a.x+t,a.y+r],a.spatialReference)}))}))[2]),g.push(new o.default(F(T,a.toArray(),m,P,x,p),a.spatialReference))}return Array.isArray(e)?g:g[0]}},32186:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var n,i=r(35143),a=r(42553),o=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),l=r(34761),c=r(13191),u=r(60008),h=r(4336),d=r(9392),p=r(52896);let f=n=class extends a.A{constructor(e){super(e),this.translation=(0,d.vt)(),this.rotationAxis=(0,d.ci)(p.up),this.rotationAngle=0,this.scale=(0,d.fA)(1,1,1)}get rotation(){return(0,p.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,d.o8)((0,p.yo)(e)),this.rotationAngle=(0,p.g7)(e)}get localMatrix(){const e=(0,c.vt)();return(0,u.x8)(m,(0,p.yo)(this.rotation),(0,p.$I)(this.rotation)),(0,l.o1)(e,m,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.B8)((0,c.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,l.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,d.o8)(this.translation),rotationAxis:(0,d.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,d.o8)(this.scale)};return new n(e)}};(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAxis",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAngle",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),(0,i._)([(0,o.MZ)()],f.prototype,"rotation",null),(0,i._)([(0,o.MZ)()],f.prototype,"localMatrix",null),(0,i._)([(0,o.MZ)()],f.prototype,"localMatrixInverse",null),f=n=(0,i._)([(0,s.$)("esri.geometry.support.MeshTransform")],f);const m=(0,h.vt)(),g=f},35617:(e,t,r)=>{r.r(t),r.d(t,{hydratedAdapter:()=>l});var n=r(76797),i=r(66388),a=r(19247),o=r(65215),s=r(23701);const l={convertToGEGeometry:function(e,t){if(null==t)return null;let r="cache"in t?t.cache._geVersion:void 0;return null==r&&(r=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=r)),r},exportPoint:function(e,t,r){const n=e.hasZ(t),i=e.hasM(t),o=new a.default({x:e.getPointX(t),y:e.getPointY(t),spatialReference:r});return n&&(o.z=e.getPointZ(t)),i&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o},exportPolygon:function(e,t,r){const n=new o.default({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:r});return n.cache._geVersion=t,n},exportPolyline:function(e,t,r){const n=new s.default({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:r});return n.cache._geVersion=t,n},exportMultipoint:function(e,t,r){const n=new i.default({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:r});return n.cache._geVersion=t,n},exportExtent:function(e,t,r){const i=e.hasZ(t),a=e.hasM(t),o=new n.default({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:r});if(i){const r=e.getZExtent(t);o.zmin=r.vmin,o.zmax=r.vmax}if(a){const r=e.getMExtent(t);o.mmin=r.vmin,o.mmax=r.vmax}return o.cache._geVersion=t,o}}},39839:(e,t,r)=>{r.d(t,{$0:()=>k,AG:()=>M,AX:()=>U,CN:()=>J,EH:()=>z,Fj:()=>H,Md:()=>W,QI:()=>B,QV:()=>$,Qu:()=>v,WB:()=>j,Z9:()=>A,_I:()=>P,bO:()=>x,cG:()=>L,eY:()=>S,gO:()=>G,jr:()=>_,lW:()=>Z,mf:()=>w,uH:()=>V,wv:()=>E,yP:()=>q});var n=r(50346),i=r(11113),a=r(24648),o=r(19555),s=r(63391),l=r(19247),c=r(65215),u=r(23701),h=r(9624),d=r(13312),p=r(7137),f=r(20749),m=r(97572),g=r(85367);const y=1e5;function v(e,t){let r=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return r<0&&(r+=180),r*Math.PI/180}function w(e,t){let r=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return r<0&&(r+=180),r*Math.PI/180}function M(e,t,r){if(!e?.length||!t?.length||!r)return;const[n,i]=e,[,a]=t,o=a-i;return[n+o*Math.cos(r),i+o*Math.sin(r)]}function b(e,t,r){if((0,p.isSupported)(e)){const e=(0,p.geodesicLengths)([t],"meters")[0];return{area:(0,p.geodesicAreas)([r],"square-meters")[0],perimeter:e}}const n=d.default.WGS84,i=(0,h.project)(t,n),a=(0,h.project)(r,n);let o=(0,s.geodesicDensify)(a,y);if(o=(0,s.simplify)(o),!o)return null;const l=(0,p.geodesicLengths)([i],"meters")[0];return{area:(0,p.geodesicAreas)([o],"square-meters")[0],perimeter:l}}async function _(e,t,r,i){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;if(t.length<2||!i||!r||!e)return null;const s=G(r,e);if(!s)return null;const l=t.map((e=>[e.x,e.y])),c=l.at(0),u=l.at(-1);if(!c||!u)return null;const h=s.map((t=>U([c,u],t,e,a,!1))),d=await Promise.all(h);(0,n.throwIfAborted)(o);let p=0;for(const n of d){if(!n)return null;const e=Math.abs(n-i);p=Math.max(e,p)}return p}async function x(e,t,r,i,a){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0;if(t.length<2||!i||!r||!e)throw new Error("Missing parameters");const l=L(r,e),c=t.map((e=>[e.x,e.y])),u=c.at(0),h=c.at(-1),d=l.map((t=>B([u,h],t,e,a,o,!1))),p=await Promise.all(d);(0,n.throwIfAborted)(s);let f=0;for(const n of p){if(!n)return 0;const e=Math.abs(n-i);f=Math.max(e,f)}return f}function S(e,t){const r=k(e,!1);if(r?.length)return 20*(0,o.Io)([r[0].x,r[0].y],[r.at(-1).x,r.at(-1).y])/t}function R(e){const t=e.spatialReference;if(t.isGeographic){if((0,p.isSupported)(t))return(0,p.geodesicLengths)([e],"meters")[0];const r=(0,h.project)(e,d.default.WGS84);return(0,p.geodesicLengths)([r],"meters")[0]}return t.isWebMercator?(0,s.geodesicLength)(e,"meters"):(0,s.planarLength)(e,"meters")}function I(e,t){const r=(0,s.simplify)(t);if(!r)return null;const n=(0,s.planarLength)(e,"meters");return{area:(0,s.planarArea)(r,"square-meters"),perimeter:n}}function T(e,t){let r=(0,s.geodesicDensify)(t,y,"meters");if(r=(0,s.simplify)(r),!r)return null;const n=(0,s.geodesicLength)(e,"meters");return{area:(0,s.geodesicArea)(r,"square-meters"),perimeter:n}}async function P(e,t,r){if(!t||!e)throw new Error("Missing required parameters");const i=await(0,f.imageToWorld)(e,t);(0,n.throwIfAborted)(r);const a=i.clone();a.z?a.z+=20:a.z=20;const{averageElevation:o,cameraPitch:s,cameraRoll:l,farDistance:c,...u}=t;return(0,g.worldToImage)(a,u)}async function A(e,t,r,i){const{attributes:a}=r,{location:o}=a,{updateElevationProps:s,...l}=t;if(!e||!t)throw new Error("Missing parameters");let c=o.clone();c.spatialReference.isGeographic&&(c=await(0,h.projectWithZConversion)(c,d.default.WebMercator));const u=await(0,f.imageToWorldPanoramic)(e,{...l,cameraLocation:c},s);(0,n.throwIfAborted)(i);const p=u.clone();return p.z?p.z+=20:p.z=20,(0,g.worldToImagePanoramic)(p,l)}function F(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,cameraPitch:c,cameraRoll:u,farDistance:h,...d}=n;if(i>=5||a<=.1)return{value:e};const p=new l.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:n.cameraLocation.spatialReference}),f=(0,g.worldToImage)(p,d),m=(0,o.Io)([r[0].x,r[0].y],[f.x,f.y]),y=r.at(0),v=r.at(-1);if(!y||!v)return null;const w=(0,o.Io)([y.x,y.y],[v.x,v.y])*e/m;return F(w,t,r,n,i+1,Math.abs(e-w))}function C(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,horizontalFieldOfView:c,verticalFieldOfView:u,farDistance:h,...d}=n;if(i>=5||a<=.1)return{value:e};const p=new l.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:n.cameraLocation.spatialReference}),f=(0,g.worldToImagePanoramic)(p,d),m=(0,o.Io)([r[0].x,r[0].y],[f.x,f.y]),y=r.at(0),v=r.at(-1);if(!y||!v)return null;const w=(0,o.Io)([y.x,y.y],[v.x,v.y])*e/m;return C(w,t,r,n,i+1,Math.abs(e-w))}async function O(e,t){const{updateElevationProps:r,...n}=t;return await(0,f.imageToWorld)(e,n,r)}async function N(e,t){const{updateElevationProps:r,...n}=t;return(0,f.imageToWorldPanoramic)(e,n,r)}function Z(e){navigator.clipboard.writeText(e).catch((e=>{throw e}))}function D(e){const t=e.map((e=>[e.x,e.y])),r=e[0].spatialReference;return new u.default({paths:[t],spatialReference:r})}function k(e,t){return e.map((e=>({x:t?.5+e[0]:e[0],y:t?.5-e[1]:e[1]})))}function E(e,t,r,n,o){const s="measurement"===e?t:r;if(o&&s)return(0,i.ix)(n,(0,a.d_)(s,"meters"),o,3)||null}function G(e,t){const{cameraPitch:r,cameraRoll:n,cameraLocation:i}=e,{x:a,y:o,z:s,spatialReference:c}=i;if(t.every((e=>0===e))||!t||!t.length)return null;const[u,h,,d,p]=t,f=[-d,0,d],m=[-p,0,p],g=[-u,0,u],y=[-h,0,h],v=[];for(const w of f)for(const t of m)for(const i of g)for(const u of g)for(const h of y){const d={...e};d.cameraPitch=r+w,d.cameraRoll=n+t,d.cameraLocation=new l.default({x:a+i,y:o+u,z:s?s+h:0,spatialReference:{wkid:c.wkid}}),v.push(d)}return v}function L(e,t){const{cameraHeading:r,cameraLocation:n}=e,{x:i,y:a,z:o,spatialReference:s}=n;if(t.every((e=>0===e))||!t||!t.length)throw new Error("Invalid parameters");const[c,u,h]=t,d=h>0?[-h,0,h]:[],p=c>0?[-c,0,c]:[],f=u>0?[-u,0,u]:[],m=[];for(const g of d)for(const t of p)for(const n of p)for(const c of f){const u={...e};u.cameraHeading=r+g,u.cameraLocation=new l.default({x:i+t,y:a+n,z:o?o+c:0,spatialReference:{wkid:s.wkid}}),m.push(u)}return m}function z(e,t,r,n,o){const s="measurement"===e?t:j(r);if(o&&s)return(0,i.ix)(n,(0,a.d_)(s,"meters"),o,3)||null}function V(e,t,r,n,o){const s="measurement"===e?t:r;if(o&&s)return(0,i.Jd)(n,(0,a.gT)(s,"square-meters"),o,3)||null}function j(e){return Math.sqrt(e.reduce(((e,t)=>e+t**2),0))}function H(e,t,r){if("default"===t)return e;const n={x:e[0],y:e[1],z:e[2]},i=(0,m.pq)(n,r[0],r[1]);return[i.x,i.y]}async function U(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;if(!e||!t||e.length<2)return null;const l=k(e,i);if(!l||l.length<2)return null;const[c,u]=[l[0],l.at(-1)];if(!u)return null;const h=[c],d=await(0,f.imageToWorld)(c,t);(0,n.throwIfAborted)(s);const p=d.clone();p.z?p.z+=20:p.z=20;const{averageElevation:m,cameraPitch:y,cameraRoll:w,farDistance:b,..._}=t,x=(0,g.worldToImage)(p,_),S=(0,o.Io)([c.x,c.y],[x.x,x.y]),R=v(c,x);if(!R)return;const I=M([c.x,c.y],[u.x,u.y],R);if(!I?.length)return;h.push({x:I[0],y:I[1]});const T=20*(0,o.Io)([h[0].x,h[0].y],[h[1].x,h[1].y])/S;if(!a)return T;const P=F(T,d,h,t,0,1);return P?.value}async function B(e,t,r,i){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0;const{attributes:c}=i,{location:u}=c,{updateElevationProps:p,...m}=t;if(!e||!t||e.length<2)throw new Error("Invalid parameters");const y=k(e,a),[w,b]=[y[0],y.at(-1)],_=[w];let x=u.clone();x.spatialReference.isGeographic&&(x=await(0,h.projectWithZConversion)(x,d.default.WebMercator));const S=await(0,f.imageToWorldPanoramic)(w,{...m,cameraLocation:x},p);(0,n.throwIfAborted)(l);const R=S.clone();R.z?R.z+=20:R.z=20;const I=(0,g.worldToImagePanoramic)(R,m),T=(0,o.Io)([w.x,w.y],[I.x,I.y]),P=v(w,I);if(!P)return;const A=M([w.x,w.y],[b.x,b.y],P);if(!A?.length)return;_.push({x:A[0],y:A[1]});const F=20*(0,o.Io)([_[0].x,_[0].y],[_[1].x,_[1].y])/T;if(!s)return F;const O=C(F,S,_,t,0,1);return O?.value}async function W(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<3)return null;const n=k(e,r),i=await O(n,t),a=i.map((e=>{let{x:t,y:r}=e;return[t,r]}));e.push(e[0]),a.push(a[0]);const o=i[0].spatialReference,s=new u.default({paths:[a],spatialReference:o}),l=new c.default({rings:[a],spatialReference:o});return o.isGeographic?b(o,s,l):o.isWebMercator?T(s,l):I(s,l)}async function q(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;if(e.length<3)return null;const a=k(e,r),o=await N(a,t);(0,n.throwIfAborted)(i);const s=o.map((e=>{let{x:t,y:r}=e;return[t,r]}));e.push(e[0]),s.push(s[0]);const l=o[0].spatialReference,h=new u.default({paths:[s],spatialReference:l}),d=new c.default({rings:[s],spatialReference:l});return l.isGeographic?b(l,h,d):l.isWebMercator?T(h,d):I(h,d)}async function J(e,t){const r=k(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]);return R(D(await O(r,t)))}async function $(e,t){let r=arguments.length>3?arguments[3]:void 0;const i=k(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),a=await N(i,t);return(0,n.throwIfAborted)(r),R(D(a))}},40350:(e,t,r)=>{var n;r.d(t,{g:()=>n}),function(e){e[e.HPR=1]="HPR",e[e.OPK=2]="OPK",e[e.YPR=3]="YPR",e[e.LTP=4]="LTP"}(n||(n={}))},42269:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(36116),i=r(97572);async function a(e,t,r){const a=Array.isArray(e)?e:[e];let o;if((0,i.SP)(t))o=await(0,n.h)(a,t.elevationSample,r);else if((0,i.tB)(t)){const{elevationSource:e,extent:i}=t,{url:s,lod:l,rasterFunction:c}=e;o=await(0,n.Ys)(a,{url:s,lod:l,rasterFunction:c,extent:i},r)}else o=await(0,n.kV)(a,t.elevationSource.constantElevation,r);return Array.isArray(e)?o:o[0]}},43036:(e,t,r)=>{r.d(t,{$:()=>Te,A:()=>ie,B:()=>ae,C:()=>Fe,D:()=>Q,E:()=>_e,F:()=>Se,G:()=>Re,H:()=>Ie,I:()=>A,J:()=>E,K:()=>Ve,L:()=>G,M:()=>re,N:()=>X,O:()=>Ee,P:()=>ze,Q:()=>Le,R:()=>P,S:()=>je,T:()=>Ge,U:()=>ge,V:()=>V,W:()=>N,X:()=>He,Y:()=>le,Z:()=>De,_:()=>Ae,a:()=>Ce,a0:()=>we,a1:()=>ye,a2:()=>ve,a3:()=>D,a4:()=>Y,a5:()=>ee,a6:()=>te,a7:()=>fe,a8:()=>be,a9:()=>ke,aa:()=>Ue,b:()=>Ne,c:()=>oe,d:()=>k,e:()=>pe,f:()=>se,g:()=>J,h:()=>de,i:()=>Z,j:()=>$,k:()=>K,l:()=>L,m:()=>q,n:()=>z,o:()=>B,p:()=>j,q:()=>H,r:()=>W,s:()=>ce,t:()=>he,u:()=>me,v:()=>Be,w:()=>F,x:()=>C,y:()=>O,z:()=>U});var n=r(86560),i=r(55171),a=r(46405),o=r(54093),s=r(9861),l=r(55742),c=r(98264),u=r(69637),h=r(96866),d=r(64379),p=r(20481),f=r(16503),m=r(14902),g=r(76797),y=r(89189),v=r(66388),w=r(19247),M=r(65215),b=r(23701),_=r(13312),x=r(5262),S=r(19902),R=r(38042),I=r(85632),T=r(24241);class P{constructor(e){this.value=e}}class A{constructor(e){this.value=e}}const F={type:"VOID"},C=Symbol("BREAK"),O=Symbol("CONTINUE");function N(e,t,r){return""===t||null==t||t===r||t===r?e:e=e.split(t).join(r)}function Z(e){return e instanceof l.fF}function D(e){return e instanceof o.x}function k(e){return!!(0,I.Kg)(e)||!!(0,I.Et)(e)||!!J(e)||!!$(e)||!!K(e)||!!(0,I.Lm)(e)||null===e||e===F||"number"==typeof e}function E(e,t){return void 0===e?t:e}function G(e){return null==e?"":(0,I.cy)(e)||q(e)?"Array":J(e)?"Date":K(e)?"Time":$(e)?"DateOnly":(0,I.Kg)(e)?"String":(0,I.Lm)(e)?"Boolean":(0,I.Et)(e)?"Number":"esri.arcade.Attachment"===e?.declaredClass?"Attachment":"esri.arcade.Portal"===e?.declaredClass?"Portal":"esri.arcade.Dictionary"===e?.declaredClass?"Dictionary":W(e)?"KnowledgeGraph":e instanceof o.x?"Module":z(e)?"Feature":e instanceof w.default?"Point":e instanceof M.default?"Polygon":e instanceof b.default?"Polyline":e instanceof v.default?"Multipoint":e instanceof g.default?"Extent":Z(e)?"Function":j(e)?"FeatureSet":B(e)?"FeatureSetCollection":V(e)?"Voxel":e===F?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognized Type"}function L(e){return e instanceof y.default}function z(e){return"esri.arcade.Feature"===e?.arcadeDeclaredClass}function V(e){return"esri.arcade.Voxel"===e?.arcadeDeclaredClass}function j(e){return"esri.arcade.featureset.support.FeatureSet"===e?.declaredRootClass}function H(e){return"esri.arcade.Dictionary"===e?.declaredClass}function U(e){return H(e)||z(e)||V(e)}function B(e){return"esri.arcade.featureSetCollection"===e?.declaredRootClass}function W(e){return"esri.rest.knowledgeGraph.KnowledgeGraph"===e?.declaredClass}function q(e){return e instanceof c.A}function J(e){return e instanceof a.lY}function $(e){return e instanceof f.n}function K(e){return e instanceof m.k}function Y(e){return null!=e&&"object"==typeof e}function Q(e,t,r,n,i){if(e.length<t||e.length>r)throw new s.D$(n,s.TX.WrongNumberOfParameters,i)}function X(e){return e<0?-Math.round(-e):Math.round(e)}function ee(e,t){return isNaN(e)||null==t||""===t?e.toString():(t=N(t,"\u2030",""),t=N(t,"\xa4",""),(0,p.GP)(e,{pattern:t}))}function te(e,t){return null==t||""===t?e.toISOString(!0):e.toFormat(re(t),{locale:(0,R.JK)(),numberingSystem:"latn"})}function re(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let r="";const n=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const i of e.match(n)||[])switch(i){case"D":r+="d";break;case"DD":r+="dd";break;case"DDD":r+="o";break;case"d":r+="c";break;case"ddd":r+="ccc";break;case"dddd":r+="cccc";break;case"M":r+="L";break;case"MM":r+="LL";break;case"MMM":r+="LLL";break;case"MMMM":r+="LLLL";break;case"YY":r+="yy";break;case"Y":case"YYYY":r+="yyyy";break;case"Q":r+="q";break;case"Z":r+="Z";break;case"ZZ":r+="ZZ";break;case"ZZZ":r+="ZZZ";break;case"ZZZZ":r+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":r+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":r+="'S'";break;case"SS":r+="'SS'";break;case"SSS":r+="u";break;case"A":case"a":r+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":r+=i;break;default:i.length>=2&&"["===i.slice(0,1)&&"]"===i.slice(-1)?r+=`'${i.slice(1,-1)}'`:r+=`'${i}'`}return r}function ne(e,t,r){switch(r){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function ie(e,t,r){if(null===e){if(null===t||t===F)return ne(null,null,r);if((0,I.Et)(t))return ne(0,t,r);if((0,I.Kg)(t))return ne(0,he(t),r);if((0,I.Lm)(t))return ne(0,he(t),r);if(J(t))return ne(0,t.toNumber(),r);if(K(t))return ne(e,t.toNumber(),r);if($(t))return ne(e,t.toNumber(),r)}if(e===F){if(null===t||t===F)return ne(null,null,r);if((0,I.Et)(t))return ne(0,t,r);if((0,I.Kg)(t))return ne(0,he(t),r);if((0,I.Lm)(t))return ne(0,he(t),r);if(J(t))return ne(0,t.toNumber(),r);if(K(t))return ne(e,t.toNumber(),r);if($(t))return ne(e,t.toNumber(),r)}else if((0,I.Et)(e)){if((0,I.Et)(t))return ne(e,t,r);if((0,I.Lm)(t))return ne(e,he(t),r);if(null===t||t===F)return ne(e,0,r);if((0,I.Kg)(t))return ne(e,he(t),r);if(J(t))return ne(e,t.toNumber(),r);if(K(t))return ne(e,t.toNumber(),r);if($(t))return ne(e,t.toNumber(),r)}else if((0,I.Kg)(e)){if((0,I.Kg)(t))return ne(se(e),se(t),r);if(J(t))return ne(he(e),t.toNumber(),r);if(K(t))return ne(he(e),t.toNumber(),r);if($(t))return ne(he(e),t.toNumber(),r);if((0,I.Et)(t))return ne(he(e),t,r);if(null===t||t===F)return ne(he(e),0,r);if((0,I.Lm)(t))return ne(he(e),he(t),r)}else if(J(e)){if(J(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=a.lY.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=a.lY.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),ne(e.toNumber(),t.toNumber(),r);if(null===t||t===F)return ne(e.toNumber(),0,r);if((0,I.Et)(t))return ne(e.toNumber(),t,r);if((0,I.Lm)(t))return ne(e.toNumber(),he(t),r);if((0,I.Kg)(t))return ne(e.toNumber(),he(t),r);if(K(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null);if($(t))return ne(e.toNumber(),t.toNumber(),r)}else if((0,I.Lm)(e)){if((0,I.Lm)(t))return ne(e,t,r);if((0,I.Et)(t))return ne(he(e),he(t),r);if(J(t))return ne(he(e),t.toNumber(),r);if(K(t))return ne(he(e),t.toNumber(),r);if($(t))return ne(he(e),t.toNumber(),r);if(null===t||t===F)return ne(he(e),0,r);if((0,I.Kg)(t))return ne(he(e),he(t),r)}else if($(e)){if(J(t))return ne(e.toNumber(),t.toNumber(),r);if(null===t||t===F)return ne(e.toNumber(),0,r);if((0,I.Et)(t))return ne(e.toNumber(),t,r);if((0,I.Lm)(t))return ne(e.toNumber(),he(t),r);if((0,I.Kg)(t))return ne(e.toNumber(),he(t),r);if(K(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null);if($(t))return ne(e.toNumber(),t.toNumber(),r)}else if(K(e)){if(J(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null);if(null===t||t===F)return ne(e.toNumber(),0,r);if((0,I.Et)(t))return ne(e.toNumber(),t,r);if((0,I.Lm)(t))return ne(e.toNumber(),he(t),r);if((0,I.Kg)(t))return ne(e.toNumber(),he(t),r);if(K(t))return ne(e.toNumber(),t.toNumber(),r);if($(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null)}return!!ae(e,t)&&("<="===r||">="===r)}function ae(e,t){if(e===t)return!0;if(null===e&&t===F||null===t&&e===F)return!0;if(J(e)&&J(t))return e.equals(t);if(K(e)&&K(t))return e.equals(t);if($(e)&&$(t))return e.equals(t);if(e instanceof u.A)return e.equalityTest(t);if(e instanceof h.A)return e.equalityTest(t);if(e instanceof w.default&&t instanceof w.default){const r=e.cache._arcadeCacheId,n=t.cache._arcadeCacheId;if(null!=r)return r===n}if(Y(e)&&Y(t)){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function oe(e,t){let{useNumbersForDates:r}=t,n="";for(const i in e){""!==n&&(n+=",");const t=e[i];null==t?n+=JSON.stringify(i)+":null":(0,I.Lm)(t)||(0,I.Et)(t)||(0,I.Kg)(t)?n+=JSON.stringify(i)+":"+JSON.stringify(t):L(t)?n+=JSON.stringify(i)+":"+ce(t):K(t)||$(t)?n+=`${JSON.stringify(i)}:${JSON.stringify(t.toString())}`:q(t)||Array.isArray(t)?n+=JSON.stringify(i)+":"+ce(t,null,r):J(t)?n+=r?JSON.stringify(i)+":"+JSON.stringify(t.getTime()):JSON.stringify(i)+":"+t.stringify():null!==t&&"object"==typeof t&&"castToText"in t&&(n+=JSON.stringify(i)+":"+t.castToText(r))}return"{"+n+"}"}function se(e,t){if((0,I.Kg)(e))return e;if(null===e)return"";if((0,I.Et)(e))return ee(e,t);if((0,I.Lm)(e))return e.toString();if(J(e))return te(e,t);if(K(e))return e.toFormat(t);if($(e))return e.toFormat(t);if(e instanceof y.default)return JSON.stringify(e.toJSON());if((0,I.cy)(e)){const t=[];for(let r=0;r<e.length;r++)t[r]=ue(e[r]);return"["+t.join(",")+"]"}if(e instanceof c.A){const t=[];for(let r=0;r<e.length();r++)t[r]=ue(e.get(r));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText():Z(e)?"object, Function":e===F?"":D(e)?"object, Module":""}function le(e){const t=[];if(e instanceof c.A){for(let r=0;r<e.length();r++)t[r]=he(e.get(r));return t}if(!(0,I.cy)(e))return null;for(let r=0;r<e.length;r++)t[r]=he(e[r]);return t}function ce(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,I.Kg)(e))return e;if(null===e)return"";if((0,I.Et)(e))return ee(e,t);if((0,I.Lm)(e))return e.toString();if(J(e))return te(e,t);if(K(e))return e.toFormat(t);if($(e))return e.toFormat(t);if(e instanceof y.default)return e instanceof g.default?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+be(e.spatialReference)+"}":be(e.toJSON(),((e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0));if((0,I.cy)(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=ue(e[n],r);return"["+t.join(",")+"]"}if(e instanceof c.A){const t=[];for(let n=0;n<e.length();n++)t[n]=ue(e.get(n),r);return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText(r):Z(e)?"object, Function":e===F?"":D(e)?"object, Module":""}function ue(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===e)return"null";if((0,I.Lm)(e)||(0,I.Et)(e)||(0,I.Kg)(e))return JSON.stringify(e);if(e instanceof y.default)return ce(e,null,t);if(e instanceof c.A)return ce(e,null,t);if(Array.isArray(e))return ce(e,null,t);if(J(e))return t?JSON.stringify(e.getTime()):JSON.stringify(te(e,""));if(K(e))return JSON.stringify(e.toString());if($(e))return JSON.stringify(e.toString());if(null!==e&&"object"==typeof e){if("castToText"in e)return e.castToText(t)}else if(e===F)return"null";return"null"}function he(e,t){return(0,I.Et)(e)?e:null===e||""===e?0:J(e)||$(e)||K(e)?NaN:(0,I.Lm)(e)?e?1:0:(0,I.cy)(e)||""===e||void 0===e?NaN:void 0!==t&&(0,I.Kg)(e)?(t=N(t,"\u2030",""),t=N(t,"\xa4",""),(0,p.qg)(e,{pattern:t})):e===F?0:Number(e)}function de(e,t){if(J(e))return e;if((0,I.Kg)(e)){const r=function(e,t){const r=/ (\d\d)/,n=(0,a.mT)(t);let i=T.c9.fromISO(e,{zone:n});return i.isValid||r.test(e)&&(e=e.replace(r,"T$1"),i=T.c9.fromISO(e,{zone:t}),i.isValid)?i:null}(e,t);if(r)return a.lY.dateTimeToArcadeDate(r)}return null}function pe(e){return(0,I.Lm)(e)?e:(0,I.Kg)(e)?"true"===(e=e.toLowerCase()):!!(0,I.Et)(e)&&0!==e&&!isNaN(e)}function fe(e,t){const r=JSON.parse(e);return r&&!r.spatialReference&&(r.spatialReference=t),(0,S.fromJSON)(r)}function me(e,t){return null==e?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=t),e)}function ge(e){if(null===e)return null;if(e instanceof w.default)return"NaN"===e.x||null===e.x||isNaN(e.x)?null:e;if(e instanceof M.default){if(0===e.rings.length)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof b.default){if(0===e.paths.length)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof v.default?0===e.points.length?null:e:e instanceof g.default?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function ye(e,t){if(!e)return t;if(!e.domain)return t;let r=null,n=null;if(J(t))r=t.toNumber();else if($(t))r=t.toString();else if(K(t))r=t.toStorageString();else if("string"===e.field.type||"esriFieldTypeString"===e.field.type)r=se(t);else{if(null==t)return null;if(""===t)return t;r=he(t)}for(let i=0;i<e.domain.codedValues.length;i++){const t=e.domain.codedValues[i];t.code===r&&(n=t)}return null===n?se(t):n.name}function ve(e,t){if(!e)return t;if(!e.domain)return t;let r=null;const n=se(t);for(let i=0;i<e.domain.codedValues.length;i++){const t=e.domain.codedValues[i];t.name===n&&(r=t)}return null===r?t:r.code}function we(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!t)return null;if(!t.fields)return null;let i,a,o=null;for(let s=0;s<t.fields.length;s++){const r=t.fields[s];r.name.toLowerCase()===e.toString().toLowerCase()&&(o=r)}if(null===o)throw new s.D$(null,s.TX.FieldNotFound,null,{key:e});let l=t.typeIdField,c="id",u=t.types;if(t.subtypeField&&(l=t.subtypeField,c="code",u=t.subtypes??[]),null===n&&r&&l)n=r.hasField(l)?r.field(l):null;else if(l&&null!==n){let e=!1;for(const t of u||[])if(n===t[c]){e=!0;break}if(!e)for(const t of u||[])if(n===t.name){n=t[c],e=!0;break}e||(n=null,r&&l&&(n=r.hasField(l)?r.field(l):null))}return null!=n&&u.some((e=>e[c]===n&&(i=e.domains?.[o.name],i&&"inherited"===i.type&&(i=Me(o.name,t),a=!0),!0))),a||i||(i=Me(e,t)),{field:o,domain:i}}function Me(e,t){let r;return t.fields.some((t=>(t.name.toLowerCase()===e.toLowerCase()&&(r=t.domain),!!r))),r}function be(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const r="boolean"==typeof t.cycles&&t.cycles,n=t.cmp&&(i=t.cmp,function(e){return function(t,r){const n={key:t,value:e[t]},a={key:r,value:e[r]};return i(n,a)}});var i;const a=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let i,o;if(Array.isArray(t)){for(o="[",i=0;i<t.length;i++)i&&(o+=","),o+=e(t[i])||"null";return o+"]"}if(null===t)return"null";if(a.includes(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const s=a.push(t)-1,l=Object.keys(t).sort(n?.(t));for(o="",i=0;i<l.length;i++){const r=l[i],n=e(t[r]);n&&(o&&(o+=","),o+=JSON.stringify(r)+":"+n)}return a.splice(s,1),"{"+o+"}"}(e)}function _e(e){if(null===e)return null;const t=[];for(const r of e)z(r)?t.push(r.geometry()):t.push(r);return t}function xe(e,t){if(!(t instanceof w.default))throw new s.D$(null,s.TX.InvalidParameter,null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Se(e,t){if((0,I.cy)(e)||q(e)){let r=!1,n=!1,i=[],a=t;if((0,I.cy)(e)){for(const t of e)xe(i,t);i.length>0&&(a=e[0].spatialReference,r=e[0].hasZ,n=e[0].hasM)}else if(e instanceof h.A)i=e._elements,i.length>0&&(r=e._hasZ,n=e._hasM,a=e.get(0).spatialReference);else{if(!q(e))throw new s.D$(null,s.TX.InvalidParameter,null);for(const t of e.toArray())xe(i,t);i.length>0&&(a=e.get(0).spatialReference,r=!0===e.get(0).hasZ,n=!0===e.get(0).hasM)}return 0===i.length?null:((0,x.$3)(i)||(i=i.slice().reverse()),new M.default({rings:[i],spatialReference:a,hasZ:r,hasM:n}))}return e}function Re(e,t){if((0,I.cy)(e)||q(e)){let r=!1,n=!1,i=[],a=t;if((0,I.cy)(e)){for(const t of e)xe(i,t);i.length>0&&(a=e[0].spatialReference,r=!0===e[0].hasZ,n=!0===e[0].hasM)}else if(e instanceof h.A)i=e._elements,i.length>0&&(r=e._hasZ,n=e._hasM,a=e.get(0).spatialReference);else if(q(e)){for(const t of e.toArray())xe(i,t);i.length>0&&(a=e.get(0).spatialReference,r=!0===e.get(0).hasZ,n=!0===e.get(0).hasM)}return 0===i.length?null:new b.default({paths:[i],spatialReference:a,hasZ:r,hasM:n})}return e}function Ie(e,t){if((0,I.cy)(e)||q(e)){let r=!1,n=!1,i=[],a=t;if((0,I.cy)(e)){for(const t of e)xe(i,t);i.length>0&&(a=e[0].spatialReference,r=!0===e[0].hasZ,n=!0===e[0].hasM)}else if(e instanceof h.A)i=e._elements,i.length>0&&(r=e._hasZ,n=e._hasM,a=e.get(0).spatialReference);else if(q(e)){for(const t of e.toArray())xe(i,t);i.length>0&&(a=e.get(0).spatialReference,r=!0===e.get(0).hasZ,n=!0===e.get(0).hasM)}return 0===i.length?null:new v.default({points:i,spatialReference:a,hasZ:r,hasM:n})}return e}function Te(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=[];if(null===e)return r;if(!0===(0,I.cy)(e)){for(let n=0;n<e.length;n++){const i=se(e[n]);""===i&&!0!==t||r.push(i)}return r}if(e instanceof c.A){for(let n=0;n<e.length();n++){const i=se(e.get(n));""===i&&!0!==t||r.push(i)}return r}if(k(e)){const n=se(e);return""===n&&!0!==t||r.push(n),r}return[]}let Pe=0;function Ae(e){return Pe++,Pe%100==0?(Pe=0,new Promise((t=>{setTimeout((()=>{t(e)}),0)}))):e}function Fe(e,t,r){switch(r){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function Ce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null==e?null:(0,I.Lm)(e)||(0,I.Et)(e)||(0,I.Kg)(e)?e:e instanceof y.default?!0===t?.keepGeometryType?e:e.toJSON():e instanceof c.A?e.toArray().map((e=>Ce(e,t))):Array.isArray(e)?e.map((e=>Ce(e,t))):(0,I.$P)(e)?e:J(e)?e.toJSDate():K(e)?e.toString():$(e)?e.toJSDate():null!==e&&"object"==typeof e&&void 0!==e.castAsJson?e.castAsJson(t):null}async function Oe(e,t,r,n,i){const a=await Ne(e,t,r);i[n]=a}async function Ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e instanceof c.A&&(e=e.toArray()),null==e)return null;if(k(e)||e instanceof y.default||(0,I.$P)(e)||J(e))return Ce(e,r);if(Array.isArray(e)){const n=[],i=[];for(const a of e)null===a||k(a)||a instanceof y.default||(0,I.$P)(a)||J(a)?i.push(Ce(a,r)):(i.push(null),n.push(Oe(a,t,r,i.length-1,i)));return n.length>0&&await Promise.all(n),i}return null!==e&&"object"==typeof e&&void 0!==e.castAsJsonAsync?e.castAsJsonAsync(t,r):null}function Ze(e){return De(e)?e.parent:e}function De(e){return e&&"declaredClass"in e&&"esri.layers.support.SubtypeSublayer"===e.declaredClass}function ke(e){return e&&"declaredClass"in e&&"esri.layers.SubtypeGroupLayer"===e.declaredClass}function Ee(e,t,r){const n=Ze(e.fullSchema());return null===n?null:n.fields?we(t,n,e,r):null}function Ge(e){const t=Ze(e.fullSchema());return null===t?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map((e=>({name:e.name,code:e.code}))):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map((e=>({name:e.name,code:e.id}))):[]}:null:null}function Le(e,t,r,n){const i=Ze(e.fullSchema());if(null===i)return null;if(!i.fields)return null;const a=we(t,i,e,n);if(void 0===r)try{r=e.field(t)}catch(o){return null}return ye(a,r)}function ze(e,t,r,n){const i=Ze(e.fullSchema());if(null===i)return null;if(!i.fields)return null;if(void 0===r){try{r=e.field(t)}catch(a){return null}return r}return ve(we(t,i,e,n),r)}function Ve(e){return e?.timeZone??"system"}function je(e){const t=Ze(e.fullSchema());if(null===t)return null;if(!t.fields)return null;const r=[];for(const n of t.fields)r.push((0,d.nE)(n));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:void 0===d.yT[t.geometryType]?"":d.yT[t.geometryType],fields:r}}function He(e,t){const r=a.lY.systemTimeZoneCanonicalName;return"system"===e&&(e=r),{version:Ue,engineVersion:i.version,timeZone:e,userTimeZone:r,spatialReference:t instanceof _.default?t.toJSON():t,application:n.default.applicationName??"",engine:"web",locale:(0,R.JK)()}}const Ue="1.30",Be=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:A,ReturnResult:P,absRound:X,arcadeVersion:Ue,autoCastArrayOfPointsToMultiPoint:Ie,autoCastArrayOfPointsToPolygon:Se,autoCastArrayOfPointsToPolyline:Re,autoCastFeatureToGeometry:_e,binaryOperator:Fe,breakResult:C,castAsJson:Ce,castAsJsonAsync:Ne,castRecordToText:oe,continueResult:O,defaultExecutingContext:He,defaultTimeZone:Ve,defaultUndefined:E,equalityTest:ae,featureDomainCodeLookup:ze,featureDomainValueLookup:Le,featureFullDomain:Ee,featureSchema:je,featureSubtypes:Ge,fixNullGeometry:ge,fixSpatialReference:me,formatDate:te,formatNumber:ee,getDomain:we,getDomainCode:ve,getDomainValue:ye,getType:G,greaterThanLessThan:ie,isArray:I.cy,isBoolean:I.Lm,isDate:J,isDateOnly:$,isDictionary:H,isDictionaryLike:U,isFeature:z,isFeatureSet:j,isFeatureSetCollection:B,isFunctionParameter:Z,isGeometry:L,isGraphic:I.DU,isImmutableArray:q,isInteger:I.Fq,isJsDate:I.$P,isKnowledgeGraph:W,isModule:D,isNumber:I.Et,isObject:Y,isSimpleType:k,isString:I.Kg,isSubtypeGrouplayer:ke,isSubtypeSublayer:De,isTime:K,isVoxel:V,multiReplace:N,parseGeometryFromJson:fe,pcCheck:Q,stableStringify:be,standardiseDateFormat:re,tick:Ae,toBoolean:pe,toDate:de,toNumber:he,toNumberArray:le,toString:se,toStringArray:Te,toStringExplicit:ce,voidOperation:F},Symbol.toStringTag,{value:"Module"}))},54093:(e,t,r)=>{r.d(t,{x:()=>n});class n{}},55742:(e,t,r)=>{r.d(t,{CU:()=>s,UQ:()=>o,fF:()=>i,o6:()=>a});var n=r(50346);class i{constructor(){}}function a(e,t,r){if(e instanceof i&&!(e instanceof s)){const n=new s;return n.fn=e,n.parameterEvaluator=r,n.context=t,n}return e}class o extends i{constructor(e){super(),this.fn=e}createFunction(e){var t=this;return function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return t.fn(e,{preparsed:!0,arguments:n})}}call(e,t){return this.fn(e,t)}marshalledCall(e,t,r,o){return o(e,t,((t,l,c)=>{c=c.map((t=>t instanceof i&&!(t instanceof s)?a(t,e,o):t));const u=this.call(r,{args:c});return(0,n.isPromiseLike)(u)?u.then((e=>a(e,r,o))):u}))}}class s extends i{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,t){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}marshalledCall(e,t,r){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}}},56203:(e,t,r)=>{r.r(t),r.d(t,{buffer:()=>Z,changeDefaultSpatialReferenceTolerance:()=>Y,clearDefaultSpatialReferenceTolerance:()=>Q,clip:()=>f,contains:()=>g,convexHull:()=>P,crosses:()=>y,cut:()=>m,densify:()=>U,difference:()=>A,disjoint:()=>x,distance:()=>v,equals:()=>w,extendedSpatialReferenceInfo:()=>p,flipHorizontal:()=>V,flipVertical:()=>j,generalize:()=>H,geodesicArea:()=>J,geodesicBuffer:()=>D,geodesicDensify:()=>B,geodesicLength:()=>$,intersect:()=>C,intersectLinesToPoints:()=>K,intersects:()=>M,isSimple:()=>I,nearestCoordinate:()=>k,nearestVertex:()=>E,nearestVertices:()=>G,offset:()=>N,overlaps:()=>S,planarArea:()=>W,planarLength:()=>q,relate:()=>R,rotate:()=>z,simplify:()=>T,symmetricDifference:()=>F,touches:()=>b,union:()=>O,within:()=>_});var n=r(16783),i=r(19247),a=r(19902);function o(e){return Array.isArray(e)?e[0]?.spatialReference:e?.spatialReference}function s(e){return e?Array.isArray(e)?e.map(s):e.toJSON?e.toJSON():e:e}function l(e){return Array.isArray(e)?e.map((e=>(0,a.fromJSON)(e))):(0,a.fromJSON)(e)}let c;async function u(){return c||(c=(0,n.ho)("geometryEngineWorker",{strategy:"distributed"})),c}async function h(e,t){return(await u()).invoke("executeGEOperation",{operation:e,parameters:s(t)})}async function d(e,t){const r=await u();return Promise.all(r.broadcast("executeGEOperation",{operation:e,parameters:s(t)}))}function p(e){return h("extendedSpatialReferenceInfo",[e])}async function f(e,t){return l(await h("clip",[o(e),e,t]))}async function m(e,t){return l(await h("cut",[o(e),e,t]))}function g(e,t){return h("contains",[o(e),e,t])}function y(e,t){return h("crosses",[o(e),e,t])}function v(e,t,r){return h("distance",[o(e),e,t,r])}function w(e,t){return h("equals",[o(e),e,t])}function M(e,t){return h("intersects",[o(e),e,t])}function b(e,t){return h("touches",[o(e),e,t])}function _(e,t){return h("within",[o(e),e,t])}function x(e,t){return h("disjoint",[o(e),e,t])}function S(e,t){return h("overlaps",[o(e),e,t])}function R(e,t,r){return h("relate",[o(e),e,t,r])}function I(e){return h("isSimple",[o(e),e])}async function T(e){return l(await h("simplify",[o(e),e]))}async function P(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l(await h("convexHull",[o(e),e,t]))}async function A(e,t){return l(await h("difference",[o(e),e,t]))}async function F(e,t){return l(await h("symmetricDifference",[o(e),e,t]))}async function C(e,t){return l(await h("intersect",[o(e),e,t]))}async function O(e){const t=function(e,t){let r;return Array.isArray(e)?r=e:(r=[],r.push(e),null!=t&&r.push(t)),r}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null);return l(await h("union",[o(t),t]))}async function N(e,t,r,n,i,a){return l(await h("offset",[o(e),e,t,r,n,i,a]))}async function Z(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=[o(e),e,t,r,n];return l(await h("buffer",i))}async function D(e,t,r,n,i,a){const s=[o(e),e,t,r,n,i,a];return l(await h("geodesicBuffer",s))}async function k(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=await h("nearestCoordinate",[o(e),e,t,r]);return{...n,coordinate:i.default.fromJSON(n.coordinate)}}async function E(e,t){const r=await h("nearestVertex",[o(e),e,t]);return{...r,coordinate:i.default.fromJSON(r.coordinate)}}async function G(e,t,r,n){return(await h("nearestVertices",[o(e),e,t,r,n])).map((e=>({...e,coordinate:i.default.fromJSON(e.coordinate)})))}function L(e){return"xmin"in e?e.center:"x"in e?e:e.extent?.center}async function z(e,t,r){if(null==e)throw new X;const n=e.spatialReference;if(null==(r=r??L(e)))throw new X;const i=e.constructor.fromJSON(await h("rotate",[n,e,t,r]));return i.spatialReference=n,i}async function V(e,t){if(null==e)throw new X;const r=e.spatialReference;if(null==(t=t??L(e)))throw new X;const n=e.constructor.fromJSON(await h("flipHorizontal",[r,e,t]));return n.spatialReference=r,n}async function j(e,t){if(null==e)throw new X;const r=e.spatialReference;if(null==(t=t??L(e)))throw new X;const n=e.constructor.fromJSON(await h("flipVertical",[r,e,t]));return n.spatialReference=r,n}async function H(e,t,r,n){return l(await h("generalize",[o(e),e,t,r,n]))}async function U(e,t,r){return l(await h("densify",[o(e),e,t,r]))}async function B(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return l(await h("geodesicDensify",[o(e),e,t,r,n]))}function W(e,t){return h("planarArea",[o(e),e,t])}function q(e,t){return h("planarLength",[o(e),e,t])}function J(e,t,r){return h("geodesicArea",[o(e),e,t,r])}function $(e,t,r){return h("geodesicLength",[o(e),e,t,r])}async function K(e,t){return l(await h("intersectLinesToPoints",[o(e),e,t]))}async function Y(e,t){await d("changeDefaultSpatialReferenceTolerance",[e,t])}async function Q(e){await d("clearDefaultSpatialReferenceTolerance",[e])}class X extends Error{constructor(){super("Illegal Argument Exception")}}},59844:(e,t,r)=>{r.d(t,{DO:()=>K,FT:()=>W,Hh:()=>T,OM:()=>$,OO:()=>N,Ps:()=>ee,Wo:()=>A,_I:()=>D,_l:()=>H,dK:()=>ne,eh:()=>re,l0:()=>Y,t$:()=>te,uk:()=>U,vI:()=>P,xh:()=>f});var n,i=r(18690),a=r(50076),o=r(31633),s=r(76797),l=r(7724),c=r(19247),u=r(65215),h=r(9624),d=r(13312),p=r(80963);function f(e,t,r){return!(0,h.canProjectWithoutEngine)(e,t,r)}function m(e,t,r){const n=f(e,t,r);if(n&&!(0,h.isLoaded)())throw new a.default("rasterprojectionhelper-project","projection engine is not loaded");return n}!function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"}(n||(n={}));const g=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(1===r[0])return[0,0];let i=1,a=-1,o=1,s=-1;for(let g=0;g<e.length;g+=2)isNaN(e[g])||(i=i>e[g]?e[g]:i,a=a>e[g]?a:e[g],o=o>e[g+1]?e[g+1]:o,s=s>e[g+1]?s:e[g+1]);const{cols:l,rows:c}=t,u=(a-i)/l/r[0],h=(s-o)/c/r[1],d=2*n;let p=0,f=!1,m=[0,0];for(let g=0;g<l-3;g++){for(let t=0;t<c-3;t++){const r=g*c*2+2*t,n=(e[r]+e[r+4]+e[r+4*c]+e[r+4*c+4])/4,i=(e[r+1]+e[r+5]+e[r+4*c+1]+e[r+4*c+5])/4,a=Math.abs((n-e[r+2*c+2])/u),o=Math.abs((i-e[r+2*c+3])/h);if(a+o>p&&(p=a+o,m=[a,o]),d&&p>d){f=!0;break}}if(f)break}return m},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},v=32,w=4,M=w,b=new Map,_=new Map,x=500,S=39.37,R=96;let I=null;async function T(){I&&(0,h.isLoaded)()||((0,h.isLoaded)()||await(0,h.load)(),I=await Promise.all([r.e(52612),r.e(97265)]).then(r.bind(r,63391)))}function P(e,t,r){return m(e.spatialReference,t),r?(0,h.getTransformation)(t,e.spatialReference,e):(0,h.getTransformation)(e.spatialReference,t,e)}function A(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=e.spatialReference;if(!i||!t||i.equals(t))return e;m(i,t,n);const a=r.center,o=new s.default({xmin:a.x-e.x/2,xmax:a.x+e.x/2,ymin:a.y-e.y/2,ymax:a.y+e.y/2,spatialReference:i}),l=(0,h.project)(o,t,n),c=W(t);return null==l||null!=c&&l.width>=c?F(e,i,t):{x:l.width,y:l.height}}function F(e,t,r){const n=(0,o.GA)(t)/(0,o.GA)(r);return{x:e.x*n,y:e.y*n}}function C(e,t,r){const{spatialReference:n}=r;if(!n||!t||n.equals(t))return e;if(n.isGeographic&&t.isGeographic)return F(e,n,t);if(m(n,t),!I)throw new a.default("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:i,y:s}=e;const l=(i+s)/2*(0,o.GA)(n);let c=1;l>30&&(c=30/l,i*=c,s*=c);const d=256,p=i*d/2,f=s*d/2,{x:g,y:y}=r.center,v=[];for(let a=0;a<=d;a++)v.push([g-p,y-f+a*s]);for(let a=1;a<=d;a++)v.push([g-p+a*i,y+f]);for(let a=1;a<=d;a++)v.push([g+p,y+f-a*s]);for(let a=1;a<d;a++)v.push([g+p-a*i,y-f]);v.push(v[0]);const w=new u.default({rings:[v],spatialReference:n}),M=(0,h.project)(w,t);if(!M)return F(e,n,t);const b=M.extent,_=W(t);if(null==b||null!=_&&b.width>=_)return F(e,n,t);const x=I.planarArea(M),S=i*s*d*d,R=Math.sqrt(x/S)/c,T={x:b.width/c/d,y:b.height/c/d},P={x:i*R,y:s*R},A=T.x*T.y;return Math.abs(A-P.x*P.y)/A<.1?T:P}function O(e,t){return("number"==typeof e?e:(e.x+e.y)/2)*(0,o.GA)(t)*R*S}function N(e,t){const{pixelSize:r,extent:n}=e;return O(C(r,t,n),t)}function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return(0,o.GA)(e)?t/(0,o.GA)(e):0}function D(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=e.spatialReference;if(i.equals(t))return e;m(i,t,r);const a=(0,h.project)(e,t,r);return n&&a?(k([e],[a],i,t),a):a}function k(e,t,r,n){const i=q(r,!0),a=q(n,!0),o=Z(r,x),s=Z(n,x);if(o&&null!=i&&null!=a)for(let l=0;l<e.length;l++){const r=t[l];if(!r)continue;const{x:n}=e[l],{x:c}=r;c>=a[1]-s&&Math.abs(n-i[0])<o?r.x-=a[1]-a[0]:c<=a[0]+s&&Math.abs(n-i[1])<o&&(r.x+=a[1]-a[0])}}function E(e){const{inSR:t,outSR:r,datumTransformation:n,preferPE:i}=e;if(t.equals(r)){const{points:t}=V(e,null);return t}if(t.isWebMercator&&r.isWGS84||t.isWGS84&&r.isWebMercator)return function(e){const{cols:t,rows:r,xres:n,yres:i,usePixelCenter:a,inSR:o,outSR:s}=e;let{xmin:l,ymax:u}=e;a&&(l+=n/2,u-=i/2);const d=[],p=[],f=Math.max(t,r);for(let g=0;g<f;g++){const e=l+n*Math.min(t,g),a=u-i*Math.min(r,g),f=(0,h.project)(new c.default({x:e,y:a,spatialReference:o}),s);g<=t&&d.push(f.x),g<=r&&p.push(f.y)}const m=[];for(let c=0;c<t;c++)for(let e=0;e<r;e++)m.push([d[c],p[e]]);return m}(e);if(m(t,r,n)&&i){if(t.isGeographic)return G(e);if(null!=L(t))return G(e)}return function(e){const{points:t}=V(e,null),{inSR:r,outSR:n,datumTransformation:i}=e,a=t.map((e=>new c.default(e[0],e[1],r))),o=(0,h.project)(a,n,i);return i&&k(a,o,r,n),o.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function G(e){const{inSR:t,outSR:r,datumTransformation:n}=e,i=L(t),{points:a,mask:o}=V(e,i);if(!t.isGeographic){const e=t.wkid?l.P.coordsys(t.wkid):l.P.fromString(t.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,t.wkt2||t.wkt);l.g.projToGeog(e,a.length,a)}if(null!=n&&n.steps.length){let e;const t=179.9955;if(r.isGeographic&&(e=a.map((e=>{let[r]=e;return r>t?1:r<-179.9955?-1:0}))),n.steps.forEach((e=>{const t=e.wkid?l.P.geogtran(e.wkid):l.P.fromString(l.a.PE_TYPE_GEOGTRAN,e.wkt);l.h.geogToGeog(t,a.length,a,null,e.isInverse?l.a.PE_TRANSFORM_2_TO_1:l.a.PE_TRANSFORM_1_TO_2)})),e)for(let r=0;r<a.length;r++){const n=e[r],i=a[r][0],o=i>t?1:i<-179.9955?-1:0;n&&o&&n!==o&&(a[r][0]=n>0?i+360:i-360)}}if(!r.isGeographic){const e=L(r,!0),t=null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[r,n]=t;for(let i=0;i<e.length;i++){const t=e[i][1];(t<r||t>n)&&(e[i]=[NaN,NaN])}}(a,t);const n=r.wkid?l.P.coordsys(r.wkid):l.P.fromString(r.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,r.wkt2||r.wkt);l.g.geogToProj(n,a.length,a)}let s=a;if(o&&a.length!==o.length){s=[];for(let e=0,t=0;e<o.length;e++)o[e]?s.push(a[t++]):s.push([NaN,NaN])}return s}function L(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.wkid||e.wkt2||e.wkt;if(!r||e.isGeographic)return null;if(r=String(r),b.has(r)){const e=b.get(r);return t?e?.gcs:e?.pcs}const n=e.wkid?l.P.coordsys(e.wkid):l.P.fromString(e.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt),i=z(n,Z(e,1e-4)),a=z(n,0,!0);return b.set(r,{pcs:i,gcs:a}),t?a:i}function z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=l.j.generate(e),i=r?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!n||!i?.length)return null;let a=!1,o=i.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!o){if(o=i.find((e=>1===e.getInclusive()&&0===e.getKind())),!o)return null;a=!0}const s=r?0:(2===n.getNorthPoleLocation()?1:0)|(2===n.getSouthPoleLocation()?2:0),c=n.isPannableRectangle(),u=o.getCoord();if(a)return{isEnvelope:a,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-t,u[0][1]-t,u[1][0]+t,u[1][1]+t],poleLocation:s};let h=0;const d=[];let[p,f]=u[0],[m,g]=u[0];for(let l=0,y=u.length;l<y;l++){h++,h===y&&(h=0);const[e,t]=u[l],[r,n]=u[h];if(n===t)d.push([e,r,t,n,2]);else{const i=(r-e)/(n-t||1e-4),a=e-i*t;t<n?d.push([i,a,t,n,0]):d.push([i,a,n,t,1])}p=p<e?p:e,f=f<t?f:t,m=m>e?m:e,g=g>t?g:t}return{isEnvelope:!1,isPannable:c,vertices:u,coef:d,bbox:[p,f,m,g],poleLocation:s}}function V(e,t){const r=[],{cols:n,rows:i,xres:a,yres:o,usePixelCenter:s}=e;let{xmin:l,ymax:c}=e;if(s&&(l+=a/2,c-=o/2),null==t){for(let e=0;e<n;e++)for(let t=0;t<i;t++)r.push([l+a*e,c-o*t]);return{points:r}}const u=new Uint8Array(n*i);if(t.isEnvelope){const{bbox:[e,s,h,d]}=t;for(let p=0,f=0;p<n;p++){const n=l+a*p,m=t.isPannable||n>=e&&n<=h;for(let e=0;e<i;e++,f++){const t=c-o*e;m&&t>=s&&t<=d&&(r.push([n,t]),u[f]=1)}}return{points:r,mask:u}}const h=t.coef,d=[];for(let p=0;p<i;p++){const e=c-o*p,t=[],r=[];for(let i=0;i<h.length;i++){const[n,a,o,s,l]=h[i];if(e===o&&o===s)t.push(n),t.push(a),r.push(2),r.push(2);else if(e>=o&&e<=s){const i=n*e+a;t.push(i),r.push(l)}}let n=t;if(t.length>2){let e=2===r[0]?0:r[0],i=t[0];n=[];for(let a=1;a<r.length;a++)2===r[a]&&a!==r.length-1||(r[a]!==e&&(n.push(0===e?Math.min(i,t[a-1]):Math.max(i,t[a-1])),e=r[a],i=t[a]),a===r.length-1&&n.push(0===r[a]?Math.min(i,t[a]):Math.max(i,t[a])));n.sort(((e,t)=>e-t))}else t[0]>t[1]&&(n=[t[1],t[0]]);d.push(n)}for(let p=0,f=0;p<n;p++){const e=l+a*p;for(let t=0;t<i;t++,f++){const n=c-o*t,i=d[t];if(2===i.length)e>=i[0]&&e<=i[1]&&(r.push([e,n]),u[f]=1);else if(i.length>2){let t=!1;for(let r=0;r<i.length;r+=2)if(e>=i[r]&&e<=i[r+1]){t=!0;break}t&&(r.push([e,n]),u[f]=1)}}}return{points:r,mask:u}}function j(e,t){const r=W(e[0].spatialReference);if(e.length<2||null==r)return e[0];if(t=t??Z(e[0].spatialReference),1===(e=e.filter((e=>e.width>t))).length)return e[0];let{xmin:n,xmax:i,ymin:a,ymax:o}=e[0];for(let s=1;s<e.length;s++){const t=e[s];i=t.xmax+r*s,a=Math.min(a,t.ymin),o=Math.max(o,t.ymax)}return new s.default({xmin:n,xmax:i,ymin:a,ymax:o,spatialReference:e[0].spatialReference})}function H(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=e.spatialReference;if(o.equals(t))return e;const l=$(e),c=W(o,!0),d=W(t);if(0===l||null==c||null==d){const i=B(e,t,r,a);if(null==c&&null!=d&&Math.abs(i.width-d)<Z(t)&&(0,h.isLoaded)()){const r=L(o);if(null!=r&&r.poleLocation===n.None&&e.width<(r.bbox[2]-r.bbox[0])/2)return function(e,t){const r=W(t);if(null==r)return null;let{xmin:n,ymin:i,xmax:a,ymax:o}=e;const l=e.spatialReference,c=new u.default({spatialReference:l,rings:[[[n,i],[a,i],[a,o],[n,o],[n,i]]]}),d=(0,h.project)(c,t);if(2!==d.rings.length||!d.rings[0].length||!d.rings[1].length)return null;const{rings:p}=d,f=Z(l),m=new s.default({spatialReference:t});for(let s=0;s<2;s++){n=a=p[s][0][0],i=o=p[s][0][1];for(let e=0;e<p[s].length;e++)n=n>p[s][e][0]?p[s][e][0]:n,a=a<p[s][e][0]?p[s][e][0]:a,i=i>p[s][e][1]?p[s][e][1]:i,o=o<p[s][e][1]?p[s][e][1]:o;if(0===s)m.ymin=i,m.ymax=o,m.xmin=n,m.xmax=a;else if(m.ymin=Math.min(m.ymin,i),m.ymax=Math.max(m.ymax,o),Math.abs(a-r/2)<f)m.xmin=n,m.xmax=m.xmax+r;else{if(!(Math.abs(n+r/2)<f))return null;m.xmax=a+r}}return m}(e,t)||i}return i}const p=e.clone().normalize();if(1===p.length&&e.xmax<c&&e.xmax-c/2>Z(o)){const{xmin:t,xmax:r}=e;for(let n=0;n<=l;n++){const i=0===n?t:-c/2,a=n===l?r-c*n:c/2;p[n]=new s.default({xmin:i,xmax:a,ymin:e.ymin,ymax:e.ymax,spatialReference:o})}}return j(p.map((e=>B(e,t,r,a))).filter(i.Ru))}function U(e,t,r){if("extent"===e.type){const{xmin:t,ymin:r,xmax:n,ymax:i,spatialReference:a}=e;e=new u.default({rings:[[[t,i],[n,i],[n,r],[t,r],[t,i]]],spatialReference:a})}return e.spatialReference.equals(t)?e:(m(e.spatialReference,t,r),(0,h.project)(e,t,r))}function B(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=e.spatialReference;if(a.equals(t)||!t)return e;m(a,t,r);const o=(0,h.project)(e,t,r);if(i&&t.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!n||!o)return o;const s=q(a,!0),l=q(t,!0);if(null==s||null==l)return o;const u=Z(a,.001),d=Z(a,x),p=Z(t,.001);if(Math.abs(o.xmin-l[0])<p&&Math.abs(o.xmax-l[1])<p){const n=Math.abs(e.xmin-s[0]),i=Math.abs(s[1]-e.xmax);if(n<u&&i>d){o.xmin=l[0];const n=[];n.push(new c.default(e.xmax,e.ymin,a)),n.push(new c.default(e.xmax,(e.ymin+e.ymax)/2,a)),n.push(new c.default(e.xmax,e.ymax,a));const i=n.map((e=>D(e,t,r))).filter((e=>!isNaN(e?.x))).map((e=>e.x));o.xmax=Math.max.apply(null,i)}if(i<u&&n>d){o.xmax=l[1];const n=[];n.push(new c.default(e.xmin,e.ymin,a)),n.push(new c.default(e.xmin,(e.ymin+e.ymax)/2,a)),n.push(new c.default(e.xmin,e.ymax,a));const i=n.map((e=>D(e,t,r))).filter((e=>!isNaN(e?.x))).map((e=>e.x));o.xmin=Math.min.apply(null,i)}}else{const e=Z(t,.001);Math.abs(o.xmin-l[0])<e&&(o.xmin=l[0]),Math.abs(o.xmax-l[1])<e&&(o.xmax=l[1])}return o}function W(e){if(!e)return null;const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?20037508.342787:20037508.342788905;return e.isWebMercator?2*t:e.wkid&&e.isGeographic?360:2*y[e.wkid]||null}function q(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.isGeographic)return[-180,180];const r=W(e,t);return null!=r?[-r/2,r/2]:null}function J(e,t,r,n){let i=(e-t)/r;return i-Math.floor(i)!=0?i=Math.floor(i):n&&(i-=1),i}function $(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=W(e.spatialReference);if(null==r)return 0;const n=t?0:-r/2,i=Z(e.spatialReference),a=!t&&Math.abs(e.xmax-r/2)<i?r/2:e.xmax,o=!t&&Math.abs(e.xmin+r/2)<i?-r/2:e.xmin;return J(a,n,r,!0)-J(o,n,r,!1)}function K(e){const t=e.storageInfo.origin.x,r=W(e.spatialReference,!0);if(null==r)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const n=r/2,{nativePixelSize:i,storageInfo:a,extent:o}=e,{maximumPyramidLevel:s,blockWidth:l,pyramidScalingFactor:c}=a;let u=i.x;const h=[],d=null!=e.transform&&"gcs-shift"===e.transform.type,p=t+(d?0:n),f=d?r-t:n-t;for(let m=0;m<=s;m++){const e=(o.xmax-t)/u/l,r=e-Math.floor(e)==0?e:Math.ceil(e),n=f/u/l,i=n-Math.floor(n)==0?n:Math.ceil(n),a=Math.floor(p/u/l),s=Math.round(p/u)%l,d=(l-Math.round(f/u)%l)%l;h.push({resolutionX:u,blockWidth:l,datasetColumnCount:r,worldColumnCountFromOrigin:i,leftMargin:s,rightPadding:d,originColumnOffset:a}),u*=c}return{originX:t,halfWorldWidth:n,pyramidsInfo:h,hasGCSSShiftTransform:d}}function Y(e){const t=e.isAdaptive&&null==e.spacing;let r=e.spacing||[v,v],n=Q(e),i={cols:n.size[0]+1,rows:n.size[1]+1};const a=n.outofBoundPointCount>0&&n.outofBoundPointCount<n.offsets.length/2;let o=n.outofBoundPointCount===n.offsets.length/2||t&&a?[0,0]:g(n.offsets,i,r,M);const s=(o[0]+o[1])/2,c=e.projectedExtent.spatialReference,u=e.srcBufferExtent.spatialReference;if(t&&(a||s>M)&&(f(c,u,e.datumTransformation)&&(c.isGeographic||L(c)),r=[w,w],n=Q({...e,spacing:r}),i={cols:n.size[0]+1,rows:n.size[1]+1},o=g(n.offsets,i,r,M)),n.error=o,r[0]>1&&(n.coefficients=X(n.offsets,i,a)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(u.isGeographic)n.gcsGrid={offsets:n.offsets,coefficients:n.coefficients,spacing:r};else{const t=L(c);if(null!=t&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let r;return _.has(t)?r=_.get(t):(r=(e.wkid?l.P.coordsys(e.wkid):l.P.fromString(l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),_.set(t,r)),new d.default({wkid:r})}(c),o=H(e.projectedExtent,t),{offsets:s}=Q({...e,srcBufferExtent:o,spacing:r}),u=X(s,i,a);n.gcsGrid={offsets:s,coefficients:u,spacing:r}}}return n}function Q(e){const{projectedExtent:t,srcBufferExtent:r,pixelSize:n,datumTransformation:i,rasterTransform:a}=e,o=t.spatialReference,s=r.spatialReference,l=m(o,s),{xmin:u,ymin:h,xmax:d,ymax:p}=t,f=W(s),g=null!=f&&(e.hasWrapAround||"gcs-shift"===a?.type),y=e.spacing||[v,v],M=y[0]*n.x,b=y[1]*n.y,_=1===y[0],S=Math.ceil((d-u)/M-.1/y[0])+(_?0:1),R=Math.ceil((p-h)/b-.1/y[1])+(_?0:1),I=E({cols:S,rows:R,xmin:u,ymax:p,xres:M,yres:b,inSR:o,outSR:s,datumTransformation:i,preferPE:y[0]<=w,usePixelCenter:_}),T=[];let P,A=0;const F=_?-1:NaN,{xmin:C,xmax:O,ymax:N,width:D,height:k}=r,G=Z(s,x),z=null!=f&&C>0&&O>f/2;let V=!1;if(l){const e=L(o);V=null!=e&&e.poleLocation>0}for(let m=0;m<S;m++){const e=[];for(let t=0;t<R;t++){let r=I[m*R+t];if(g&&r[0]>O&&r[0]>f/2-G?r[0]-=f:g&&0===m&&r[0]<0&&z&&!a&&(r[0]+=f),!r||isNaN(r[0])||isNaN(r[1]))T.push(F),T.push(F),e.push(null),A++;else{if(a){const e=a.inverseTransform(new c.default({x:r[0],y:r[1],spatialReference:s}));r=[e.x,e.y]}e.push(r),m>0&&g&&P[t]&&r[0]<P[t][0]&&(r[0]+=f,V&&r[0]>O&&r[0]>f&&(r[0]-=f)),T.push((r[0]-C)/D),T.push((N-r[1])/k)}}P=e}return{offsets:T,error:null,coefficients:null,outofBoundPointCount:A,spacing:y,size:_?[S,R]:[S-1,R-1]}}function X(e,t,r){const{cols:n,rows:i}=t,a=new Float32Array((n-1)*(i-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),s=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<n-1;l++){for(let t=0;t<i-1;t++){let r=l*i*2+2*t;const c=e[r],u=e[r+1],h=e[r+2],d=e[r+3];r+=2*i;const p=e[r],f=e[r+1],m=e[r+2],g=e[r+3];let y=0,v=12*(t*(n-1)+l);for(let e=0;e<3;e++)a[v++]=o[y++]*c+o[y++]*h+o[y++]*m;y=0;for(let e=0;e<3;e++)a[v++]=o[y++]*u+o[y++]*d+o[y++]*g;y=0;for(let e=0;e<3;e++)a[v++]=s[y++]*c+s[y++]*p+s[y++]*m;y=0;for(let e=0;e<3;e++)a[v++]=s[y++]*u+s[y++]*f+s[y++]*g}if(r)for(let e=0;e<a.length;e++)isNaN(a[e])&&(a[e]=-1)}return a}function ee(e){const{spatialReference:t}=e,r=(0,p.Vp)(t);if(!r)return e;const[n,i]=r.valid,a=i-n;let o=0;if(e.xmin<n){const t=n-e.xmin;o=Math.ceil(t/a)}else if(e.xmin>i){const t=e.xmin-i;o=-Math.ceil(t/a)}return new s.default({spatialReference:e.spatialReference,xmin:e.xmin+o*a,ymin:e.ymin,xmax:e.xmax+o*a,ymax:e.ymax})}function te(e,t,r){const{storageInfo:n,pixelSize:i}=t;let a=0,s=!1;const{pyramidResolutions:l}=n,u="mixed"===n.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,n.tileInfo.dpi/96)):1,h=(e.x+e.y)/2/u;if(null!=l&&l.length){const e=l[l.length-1],n=(e.x+e.y)/2,u=(i.x+i.y)/2;if(h<=u)a=0;else if(h>=n)a=l.length,s=h/n>8;else{let e,t=u;for(let n=1;n<=l.length;n++){if(e=(l[n-1].x+l[n-1].y)/2,h<=e){h===e?a=n:"down"===r?(a=n-1,s=h/t>8):a="up"===r||h-t>e-h||h/t>2?n:n-1;break}t=e}}const d=0===a?i:l[a-1];return s&&Math.min(d.x,d.y)*(0,o.GA)(t.spatialReference)>19567&&(s=!1),{pyramidLevel:a,pyramidResolution:new c.default({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:s}}const d=Math.log(e.x/i.x)/Math.LN2,p=Math.log(e.y/i.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;a="down"===r?Math.floor(Math.min(d,p)):"up"===r?Math.ceil(Math.max(d,p)):Math.round((d+p)/2),a<0?a=0:a>f&&(s=a>f+3,a=f);const m=2**a;return{pyramidLevel:a,pyramidResolution:new c.default({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function re(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{pixelSize:n,extent:i}=e,a=P(i,t,!1),o=H(function(e,t){const r=e.clone().normalize();return 1===r.length?r[0]:j(r,t)}(i,(n.x+n.y)/16),t,a);return r||0===$(o)?o:B(i,t,a)}function ne(e,t,r){const n=r?.tileSize??512,i=r?.alignGlobalDatasetWithAGOL??!0,a=!!r?.limitToSrcResolution,{extent:o,spatialReference:s,pixelSize:l}=e,c=C(l,t,o);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,h=O(u,t),p=t.isGeographic?256/n*295828763.7958547:256/n*591657527.591555;let f="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const m=re(e,t,!0),g=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(p/2/h)/Math.LN2));if(!f&&i&&(t.isGeographic||t.isWebMercator)){const r=W(t);if(f=$(m)>0||null!=r&&m.width>r/4,!f&&null!=r){let t=-1;if(g<3)t=2**g*u*n;else if(e.storageInfo){const{maximumPyramidLevel:r=0,pyramidScalingFactor:i=2}=e.storageInfo;t=i**r*u*n}const i=Math.ceil(r/t);f=1===i||2===i&&r/2-m.xmax<t}}let y,v=h;const w=1.001,M=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(f){v=p;const r=t.isGeographic?1341104507446289e-21:.29858214164761665,n=O(r,t),i=t.isGeographic?4326:3857;y=C({x:r,y:r},s,re(e,new d.default({wkid:i}),!0)),y.x*=v/n,y.y*=v/n}else{y={x:l.x,y:l.y};let e=0;for(;v<p*(w/2)&&e<g;)e++,v*=M,y.x*=M,y.y*=M;Math.max(v,p)/Math.min(v,p)<=w&&(v=p)}const b=[v],_=[{x:y.x,y:y.y}],x=Math.min(70.5310735,h)/w;for(;v>=x;)v/=M,y.x/=M,y.y/=M,b.push(v),_.push({x:y.x,y:y.y});if(a){const e=.001*l.x;let t=_.findIndex((t=>t.x>=l.x-e&&t.x<=l.x+e));t>-1?(_.length=t+1,b.length=t+1):(t=_.findIndex((t=>t.x<=l.x+e)),t>0&&(_.length=t,b.length=t))}return{projectedPixelSize:c,scales:b,srcResolutions:_,isCustomTilingScheme:!f}}},59913:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(35143),i=r(91967),a=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),s=r(80963);let l=class extends i.default{set horizontalWKID(e){e?(0,s.fn)({wkid:+e})?this._set("horizontalWKID",+e):this._set("horizontalWKID",e):this._set("horizontalWKID",null)}set verticalWKID(e){e?this._set("verticalWKID",isFinite(e)&&(0,s.fn)({wkid:+e})?+e:null):this._set("verticalWKID",null)}get isAdvanced(){const{affineTransformations:e,focalLength:t,principalOffsetPoint:r,radialDistortionCoefficients:n,tangentialDistortionCoefficients:i}=this;return e?.length>1&&!Number.isNaN(t)&&r?.length>1&&n?.length>1&&i?.length>1}};(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"affineTransformations",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"focalLength",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"principalOffsetPoint",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"radialDistortionCoefficients",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"tangentialDistortionCoefficients",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"horizontalWKID",null),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"verticalWKID",null),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"x",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"y",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"z",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"type",void 0),l=(0,n._)([(0,o.$)("esri.layers.orientedImagery.core.CameraOrientation")],l);const c=l},60216:(e,t,r)=>{r.d(t,{C:()=>s,E:()=>o});var n=r(9392),i=r(9624),a=r(14487);function o(e,t,r){return!!(0,a.F)(e,t,l,r.spatialReference)&&(r.x=l[0],r.y=l[1],r.z=l[2],!0)}async function s(e,t,r,n){return await(0,i.initializeProjection)(t,r.spatialReference,null,n),o(e,t,r)}const l=(0,n.vt)()},61985:(e,t,r)=>{r.d(t,{P:()=>l,r:()=>n});var n,i,a=r(20664),o=r(9392),s=r(4763);class l{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=(0,s.vt)(),this._points=(0,s.Qy)(),this.lines=new Array(12),this._origin=(0,o.vt)(),this._direction=(0,o.vt)(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:(0,o.vt)(),endpoint:null}}update(e){(0,s.ui)(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),(0,a.c)(this._origin,e.eye),(0,a.c)(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)(0,a.c)(this._points[t],e[t]);(0,s.DV)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return(0,s.m7)(this.frustum,e)}intersectsRay(e){return(0,s.pw)(this.frustum,e)}intersectsLineSegment(e,t){return(0,s.ST)(this.frustum,e,t)}intersectsPoint(e){return(0,s.bU)(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const r=t+4;c(this.lines[t],e[t],e[r]),c(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),c(this.lines[t+8],e[r],3===t?e[4]:e[r+1])}}}function c(e,t,r){e.origin=t,e.endpoint=r,(0,a.o)(e.direction,t,r)}l.planePointIndices=s.c8,l.nearFarLineIndices=[[s.J7.NEAR_BOTTOM_LEFT,s.J7.FAR_BOTTOM_LEFT],[s.J7.NEAR_BOTTOM_RIGHT,s.J7.FAR_BOTTOM_RIGHT],[s.J7.NEAR_TOP_RIGHT,s.J7.FAR_TOP_RIGHT],[s.J7.NEAR_TOP_LEFT,s.J7.FAR_TOP_LEFT]],(i=n||(n={}))[i.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT",i[i.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT",i[i.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT",i[i.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT",i[i.NEAR_BOTTOM=4]="NEAR_BOTTOM",i[i.NEAR_RIGHT=5]="NEAR_RIGHT",i[i.NEAR_TOP=6]="NEAR_TOP",i[i.NEAR_LEFT=7]="NEAR_LEFT",i[i.FAR_BOTTOM=8]="FAR_BOTTOM",i[i.FAR_RIGHT=9]="FAR_RIGHT",i[i.FAR_TOP=10]="FAR_TOP",i[i.FAR_LEFT=11]="FAR_LEFT"},63391:(e,t,r)=>{r.r(t),r.d(t,{buffer:()=>F,changeDefaultSpatialReferenceTolerance:()=>q,clearDefaultSpatialReferenceTolerance:()=>J,clip:()=>u,contains:()=>d,convexHull:()=>S,crosses:()=>p,cut:()=>h,densify:()=>z,difference:()=>R,disjoint:()=>w,distance:()=>f,equals:()=>m,extendedSpatialReferenceInfo:()=>c,flipHorizontal:()=>E,flipVertical:()=>G,generalize:()=>L,geodesicArea:()=>U,geodesicBuffer:()=>C,geodesicDensify:()=>V,geodesicLength:()=>B,intersect:()=>T,intersectLinesToPoints:()=>W,intersects:()=>g,isSimple:()=>_,nearestCoordinate:()=>O,nearestVertex:()=>N,nearestVertices:()=>Z,offset:()=>A,overlaps:()=>M,planarArea:()=>j,planarLength:()=>H,relate:()=>b,rotate:()=>k,simplify:()=>x,symmetricDifference:()=>I,touches:()=>y,union:()=>P,within:()=>v});var n=r(40565),i=r(38590),a=r(52612),o=r(13312),s=r(35617);function l(e){const t=Array.isArray(e)?e[0].spatialReference:e.spatialReference;return t?(0,n.PZ)(o.default,t):o.default.WGS84}function c(e){return a.G.extendedSpatialReferenceInfo(e)}function u(e,t){return(0,i.f)(e),a.G.clip(s.hydratedAdapter,l(e),e,t)}function h(e,t){return(0,i.f)(e),a.G.cut(s.hydratedAdapter,l(e),e,t)}function d(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.contains(s.hydratedAdapter,l(e),e,t)}function p(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.crosses(s.hydratedAdapter,l(e),e,t)}function f(e,t,r){return(0,i.f)(e),(0,i.f)(t),a.G.distance(s.hydratedAdapter,l(e),e,t,r)}function m(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.equals(s.hydratedAdapter,l(e),e,t)}function g(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.intersects(s.hydratedAdapter,l(e),e,t)}function y(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.touches(s.hydratedAdapter,l(e),e,t)}function v(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.within(s.hydratedAdapter,l(e),e,t)}function w(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.disjoint(s.hydratedAdapter,l(e),e,t)}function M(e,t){return(0,i.f)(e),(0,i.f)(t),a.G.overlaps(s.hydratedAdapter,l(e),e,t)}function b(e,t,r){return(0,i.f)(e),(0,i.f)(t),a.G.relate(s.hydratedAdapter,l(e),e,t,r)}function _(e){return(0,i.f)(e),a.G.isSimple(s.hydratedAdapter,l(e),e)}function x(e){return(0,i.f)(e),a.G.simplify(s.hydratedAdapter,l(e),e)}function S(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.G.convexHull(s.hydratedAdapter,l(e),e,t)}function R(e,t){return(0,i.f)(t),a.G.difference(s.hydratedAdapter,l(e),e,t)}function I(e,t){return(0,i.f)(t),a.G.symmetricDifference(s.hydratedAdapter,l(e),e,t)}function T(e,t){return(0,i.f)(t),a.G.intersect(s.hydratedAdapter,l(e),e,t)}function P(e){return a.G.union(s.hydratedAdapter,l(e),e)}function A(e,t,r,n,i,o){return a.G.offset(s.hydratedAdapter,l(e),e,t,r,n,i,o)}function F(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return a.G.buffer(s.hydratedAdapter,l(e),e,t,r,n)}function C(e,t,r,n,i,o){return a.G.geodesicBuffer(s.hydratedAdapter,l(e),e,t,r,n,i,o)}function O(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,i.f)(e),a.G.nearestCoordinate(s.hydratedAdapter,l(e),e,t,r)}function N(e,t){return(0,i.f)(e),a.G.nearestVertex(s.hydratedAdapter,l(e),e,t)}function Z(e,t,r,n){return(0,i.f)(e),a.G.nearestVertices(s.hydratedAdapter,l(e),e,t,r,n)}function D(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent?.center??null:null}function k(e,t,r){if(null==e)throw new $;const n=e.spatialReference;if(null==(r=r??D(e)))throw new $;const i=e.constructor.fromJSON(a.G.rotate(e,t,r));return i.spatialReference=n,i}function E(e,t){if(null==e)throw new $;const r=e.spatialReference;if(null==(t=t??D(e)))throw new $;const n=e.constructor.fromJSON(a.G.flipHorizontal(e,t));return n.spatialReference=r,n}function G(e,t){if(null==e)throw new $;const r=e.spatialReference;if(null==(t=t??D(e)))throw new $;const n=e.constructor.fromJSON(a.G.flipVertical(e,t));return n.spatialReference=r,n}function L(e,t,r,n){return(0,i.f)(e),a.G.generalize(s.hydratedAdapter,l(e),e,t,r,n)}function z(e,t,r){return(0,i.f)(e),a.G.densify(s.hydratedAdapter,l(e),e,t,r)}function V(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,i.f)(e),a.G.geodesicDensify(s.hydratedAdapter,l(e),e,t,r,n)}function j(e,t){return(0,i.f)(e),a.G.planarArea(s.hydratedAdapter,l(e),e,t)}function H(e,t){return(0,i.f)(e),a.G.planarLength(s.hydratedAdapter,l(e),e,t)}function U(e,t,r){return(0,i.f)(e),a.G.geodesicArea(s.hydratedAdapter,l(e),e,t,r)}function B(e,t,r){return(0,i.f)(e),a.G.geodesicLength(s.hydratedAdapter,l(e),e,t,r)}function W(e,t){return a.G.intersectLinesToPoints(s.hydratedAdapter,l(e),e,t)}function q(e,t){a.G.changeDefaultSpatialReferenceTolerance(e,t)}function J(e){a.G.clearDefaultSpatialReferenceTolerance(e)}class $ extends Error{constructor(){super("Illegal Argument Exception")}}},64379:(e,t,r)=>{r.d(t,{$P:()=>d,At:()=>M,J6:()=>i,JB:()=>_,Lk:()=>p,NI:()=>x,Qi:()=>b,eB:()=>S,eg:()=>g,f0:()=>m,gO:()=>y,ik:()=>v,ke:()=>u,nE:()=>h,rX:()=>f,yT:()=>w,zl:()=>n});var n,i,a=r(46405),o=r(16503),s=r(14902),l=r(44135),c=r(24241);function u(e){return l.default.fromJSON(e.toJSON())}function h(e){return e.toJSON?e.toJSON():e}function d(e){return e instanceof Date}function p(e){return e instanceof c.c9}function f(e){return e instanceof a.lY}function m(e){return e instanceof o.n}function g(e){return e instanceof s.k}!function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"}(n||(n={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(i||(i={}));const y=1e3;const v={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},w={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},M={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};function b(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function _(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const r="boolean"==typeof t.cycles&&t.cycles,n=t.cmp&&(i=t.cmp,function(e){return function(t,r){const n={key:t,value:e[t]},a={key:r,value:e[r]};return i(n,a)}});var i;const a=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let i,o;if(Array.isArray(t)){for(o="[",i=0;i<t.length;i++)i&&(o+=","),o+=e(t[i])||"null";return o+"]"}if(null===t)return"null";if(a.includes(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const s=a.push(t)-1,l=Object.keys(t).sort(n?.(t));for(o="",i=0;i<l.length;i++){const r=l[i],n=e(t[r]);n&&(o&&(o+=","),o+=JSON.stringify(r)+":"+n)}return a.splice(s,1),"{"+o+"}"}(e)}function x(e){switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"knowledge-graph-sublayer":case"oriented-imagery":case"subtype-group":case"wfs":return!0;default:return!1}}function S(e){switch(e.type){case"catalog-footprint":case"subtype-sublayer":return!0;default:return x(e)}}},69637:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(98264),i=r(96866);class a extends n.A{constructor(e,t,r,n,i){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=n,this._spRef=t,this._cacheId=i}get(e){if(void 0===this._lazyPath[e]){const t=this._elements[e];if(void 0===t)return;this._lazyPath[e]=new i.A(t,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||null!==e&&e instanceof a!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}},70961:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var n,i=r(35143),a=r(31633),o=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),l=r(34111),c=r(19247),u=r(65215),h=r(13312),d=r(7137),p=r(45417),f=r(85996);let m=n=class extends u.default{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const r=(0,a.oU)(this.radius,this.radiusUnit,"meters"),n=e.spatialReference;let i,o="geographic";if(n.isWebMercator?o="webMercator":(null!=(n.wkid&&f.A[n.wkid])||(n.wkt2||n.wkt)&&(0,a.x1)(n.wkt2||n.wkt))&&(o="projected"),this.geodesic){let n;switch(o){case"webMercator":n=(0,p.webMercatorToGeographic)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":n=e}i=this._createGeodesicCircle(n,r,t),"webMercator"===o&&(i=(0,p.geographicToWebMercator)(i))}else{let n;"webMercator"===o||"projected"===o?n=r/(0,a.Ao)(e.spatialReference):"geographic"===o&&(n=(0,a.vl)(r,"meters",(0,l.tO)(e.spatialReference).radius)),i=this._createPlanarCircle(e,n,t)}this.spatialReference=i.spatialReference,this.addRing(i.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:r,radiusUnit:i,geodesic:a}=this;return new n({center:e?.clone(),numberOfPoints:t,radius:r,radiusUnit:i,geodesic:a})}_createGeodesicCircle(e,t,r){const n=[],i=[e.x,e.y];for(let a=0;a<360;a+=360/r){const r=this.hasZ?[0,0,e.z??0]:[0,0];(0,d.directGeodeticSolver)(r,i,a,t,h.default.WGS84),n.push(r)}return n.push(n[0]),new u.default({rings:[n]})}_createPlanarCircle(e,t,r){const n=[],i=2*Math.PI/r;for(let a=0;a<r;++a){const r=i*a,o=[e.x+Math.cos(-r)*t,e.y+Math.sin(-r)*t];this.hasZ&&o.push(e.z??0),n.push(o)}return n.push(n[0]),new u.default({spatialReference:e.spatialReference,rings:[n]})}};(0,i._)([(0,o.MZ)({type:c.default})],m.prototype,"center",void 0),(0,i._)([(0,o.MZ)()],m.prototype,"geodesic",void 0),(0,i._)([(0,o.MZ)()],m.prototype,"numberOfPoints",void 0),(0,i._)([(0,o.MZ)()],m.prototype,"radius",void 0),(0,i._)([(0,o.MZ)()],m.prototype,"radiusUnit",void 0),m=n=(0,i._)([(0,s.$)("esri.geometry.Circle")],m);const g=m},71372:(e,t,r)=>{r.d(t,{NP:()=>u,gn:()=>h,gz:()=>d});var n=r(15941),i=r(20664),a=r(9392),o=r(44230),s=r(13927);const l=(0,a.vt)(),c=(0,a.vt)();function u(){return{direction:(0,a.vt)(),up:(0,a.vt)()}}function h(e,t,r,a,o){let s=(0,i.n)(l,e),u=(0,i.f)(s,a);const h=u>0;u=Math.abs(u),u>.99&&(u=Math.abs((0,i.f)(t,a)),u<.99?((0,i.c)(s,t),h&&(0,i.h)(s,s,-1)):s=null);let d=0;if(s){(0,i.h)(c,a,(0,i.f)(a,s)),(0,i.d)(s,s,c);const e=(0,i.f)(s,o)/((0,i.l)(s)*(0,i.l)(o));(0,i.e)(c,s,o),d=((0,i.f)(c,a)>0?1:-1)*(0,n.KJ)((0,n.XM)(e))}const p=(0,n.KJ)((0,n.XM)(-(0,i.f)(a,e)/(0,i.l)(e)));return r?(r.heading=d,r.tilt=p,r):{heading:d,tilt:p}}function d(e,t,r,n){(0,i.d)(p,r,t),(0,s.T7)(n,(0,o.LV)(t,p),e)||e===r||(0,i.c)(e,r)}const p=(0,a.vt)()},71523:(e,t,r)=>{r.d(t,{Cy:()=>s,UT:()=>h,hs:()=>c,lR:()=>l,wW:()=>u});var n=r(15941),i=r(2413),a=r(65391),o=r(5262);function s(e,t,r,n){if(null==n||e.hasZ||(n=void 0),"point"===e.type)return e.x+=t,e.y+=r,e.hasZ&&null!=n&&(e.z+=n),e;if("multipoint"===e.type){const i=e.points;for(let e=0;e<i.length;e++)i[e]=d(i[e],t,r,n);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=r,e.ymax+=r,null!=n&&(e.zmin??=0,e.zmin+=n,e.zmax??=0,e.zmax+=n),e;const i=(0,o.$K)(e),a="polyline"===e.type?e.paths:e.rings;for(let o=0;o<i.length;o++){const e=i[o];for(let i=0;i<e.length;i++)e[i]=d(e[i],t,r,n)}return"paths"in e?e.paths=a:e.rings=a,e}function l(e,t,r,n,i){const a=e.clone(),l=n.resolution;if("point"===a.type){if(i)s(a,t*l,-r*l);else{const e=n.state.transform,i=n.state.inverseTransform,o=e[0]*a.x+e[2]*a.y+e[4],s=e[1]*a.x+e[3]*a.y+e[5];a.x=i[0]*(o+t)+i[2]*(s+r)+i[4],a.y=i[1]*(o+t)+i[3]*(s+r)+i[5]}return a}if("multipoint"===a.type){if(i)s(a,t*l,-r*l);else{const e=a.points,i=n.state.transform,o=n.state.inverseTransform;for(let n=0;n<e.length;n++){const a=e[n],s=i[0]*a[0]+i[2]*a[1]+i[4],l=i[1]*a[0]+i[3]*a[1]+i[5],c=o[0]*(s+t)+o[2]*(l+r)+o[4],u=o[1]*(s+t)+o[3]*(l+r)+o[5];e[n]=p(a,c,u,void 0)}}return a}if("extent"===a.type){if(i)s(a,t*l,-r*l);else{const e=n.state.transform,i=n.state.inverseTransform,o=e[0]*a.xmin+e[2]*a.ymin+e[4],s=e[1]*a.xmin+e[3]*a.ymin+e[5],l=e[0]*a.xmax+e[2]*a.ymax+e[4],c=e[1]*a.xmax+e[3]*a.ymax+e[5];a.xmin=i[0]*(o+t)+i[2]*(s+r)+i[4],a.ymin=i[1]*(o+t)+i[3]*(s+r)+i[5],a.xmax=i[0]*(l+t)+i[2]*(c+r)+i[4],a.ymax=i[1]*(l+t)+i[3]*(c+r)+i[5]}return a}if(i)s(a,t*l,-r*l);else{const e=(0,o.$K)(a),i="polyline"===a.type?a.paths:a.rings,s=n.state.transform,l=n.state.inverseTransform;for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++){const n=i[e],a=s[0]*n[0]+s[2]*n[1]+s[4],o=s[1]*n[0]+s[3]*n[1]+s[5],c=l[0]*(a+t)+l[2]*(o+r)+l[4],u=l[1]*(a+t)+l[3]*(o+r)+l[5];i[e]=p(n,c,u,void 0)}}"paths"in a?a.paths=i:a.rings=i}return a}function c(e,t,r,n){if("point"===e.type){const{x:i,y:a}=e,o=n?n[0]:i,s=n?n[1]:a,l=e.clone(),c=(i-o)*t+o,u=(a-s)*r+s;return l.x=c,l.y=u,l}if("multipoint"===e.type){const s=(0,o.$K)(e),l=(0,i.vt)(),[c,u,h,d]=(0,a.Yz)(l,[s]),f=n?n[0]:(c+h)/2,m=n?n[1]:(d+u)/2,g=e.clone(),y=g.points;for(let e=0;e<y.length;e++){const n=y[e],[i,a]=n,o=(i-f)*t+f,s=(a-m)*r+m;y[e]=p(n,o,s,void 0)}return g}if("extent"===e.type){const{xmin:i,xmax:a,ymin:o,ymax:s}=e,l=n?n[0]:(i+a)/2,c=n?n[1]:(s+o)/2,u=e.clone();if(u.xmin=(i-l)*t+l,u.ymax=(s-c)*r+c,u.xmax=(a-l)*t+l,u.ymin=(o-c)*r+c,u.xmin>u.xmax){const e=u.xmin,t=u.xmax;u.xmin=t,u.xmax=e}if(u.ymin>u.ymax){const e=u.ymin,t=u.ymax;u.ymin=t,u.ymax=e}return u}const s=(0,o.$K)(e),l=(0,i.vt)(),[c,u,h,d]=(0,a.Yz)(l,s),f=n?n[0]:(c+h)/2,m=n?n[1]:(d+u)/2,g=e.clone(),y="polyline"===g.type?g.paths:g.rings;for(let i=0;i<s.length;i++){const e=s[i];for(let n=0;n<e.length;n++){const a=e[n],[o,s]=a,l=(o-f)*t+f,c=(s-m)*r+m;y[i][n]=p(a,l,c,void 0)}}return"paths"in g?g.paths=y:g.rings=y,g}function u(e,t,r,n,i,a){const o=Math.sqrt((r-e)*(r-e)+(n-t)*(n-t));return Math.sqrt((i-e)*(i-e)+(a-t)*(a-t))/o}function h(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=Math.atan2(t.y-r.y,t.x-r.x)-Math.atan2(e.y-r.y,e.x-r.x),o=Math.atan2(Math.sin(a),Math.cos(a));return i?o:(0,n.KJ)(o)}function d(e,t,r,n){return p(e,e[0]+t,e[1]+r,null!=e[2]&&null!=n?e[2]+n:void 0)}function p(e,t,r,n){const i=[t,r];return e.length>2&&i.push(null!=n?n:e[2]),e.length>3&&i.push(e[3]),i}},77357:(e,t,r)=>{r.r(t),r.d(t,{default:()=>bt});var n=r(35143),i=r(39356),a=r(18690),o=r(98773),s=r(19276),l=r(63241),c=r(50076),u=r(54099),h=r(42553),d=r(53084),p=r(76460),f=r(15941),m=r(30726),g=r(91291),y=r(50346),v=r(67993),w=r(68134),M=r(34154),b=r(31633),_=r(46053),x=(r(81806),r(85842)),S=r(19555),R=r(19451),I=r(56203),T=r(66388),P=r(19247),A=r(65215),F=r(23701),C=r(9624),O=r(13312),N=r(5262),Z=r(45417),D=r(63733),k=r(76797),E=r(13014),G=r(69098),L=r(21403),z=r(6409),V=r(28379),j=r(17707),H=r(86729),U=r(59913),B=(r(47249),r(7839)),W=r(8595);let q=class{static getCameraOrientation(e){return(0,W.y4)(e)}static register(e,t,r){B.A.set(e,{desc:t,constructor:r})}};q=(0,n._)([(0,x.$)("esri.layers.orientedImagery.core.cameraOrientationFactory")],q);const J=q;var $=r(40350),K=r(97572);const Y=e=>({cast:e=>{const t=parseFloat(e);return Number.isFinite(t)?t:void 0},json:{name:e,write:{writer:(e,t,r)=>{t[r]=Number.isFinite(e)?e:void 0}}}}),Q=e=>({cast:e=>"string"==typeof e?e.split(";").map(Number):e,json:{default:e,write:{writer:(e,t,r)=>{t[r]=e?.join(";")}}}});let X=class extends(G.A.ClonableMixin(h.A)){constructor(e){super(e),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(e,t){const r={},{attributes:n,layer:i,geometry:a}=e,o={};for(const s in n)r[s.toLowerCase()]=n[s],o[s.toLowerCase()]=s;super.read({geometry:a,layer:i??{},sourceMap:o,...r},t)}write(e,t){const r=super.write(e,t),{sourceMap:n}=this;if(!n||!r)return r;const i={};for(const a in r){const e=n[a.toLowerCase()];e&&(i[e]=r[a])}return i}readCameraHeading(e,t){const{cameraheading:r,camheading:n,layer:i}=t;return r??n??i.cameraHeading}readCameraHeight(e,t){const{cameraheight:r,avghtag:n,layer:i}=t;return r??n??i.cameraHeight}readCamOffset(e,t){const{cameraoffset:r,camoffset:n}=t;return r?.split(";").map(Number)??n?.split(";").map(Number)??null}writeCameraOffset(e,t){e&&(t.cameraOffset=e.join(";"))}readCameraOrientation(e,t){const{cameraorientation:r,camori:n}=t;return r??n}readCameraPitch(e,t){const{camerapitch:r,campitch:n,layer:i}=t;return r??n??i.cameraPitch}readCameraRoll(e,t){const{cameraroll:r,camroll:n,layer:i}=t;return r??n??i.cameraRoll}readDepthImage(e,t){const{depthimage:r,depthimg:n,layer:i}=t,a=r??n??null,{depthImagePathPrefix:o,depthImagePathSuffix:s}=i??{};return(0,W.Rf)(a,o,s)}readElevationSource(e,t){const{elevationsource:r,layer:n}=t,{demPathSuffix:i,demPathPrefix:a}=n;if(r){const e=this._parseIfJSON(r);return(0,W.eR)(e,a,i)}return n.effectiveElevationSource}readFarDistance(e,t){const{fardistance:r,fardist:n,layer:i}=t;return r??n??i.farDistance}readHFOV(e,t){const{horizontalfieldofview:r,hfov:n,layer:i}=t;return r??n??i.horizontalFieldOfView}readImageURL(e,t){const{imagepath:r,layer:n}=t;r||function(e,t){throw new c.default("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:t})}("imagePath",this);const{imagePathPrefix:i,imagePathSuffix:a}=n;return(0,W.Rf)(r,i,a)}readImageRotation(e,t){const{imagerotation:r,imgrot:n,layer:i}=t;return r??n??i.imageRotation}get isHorizontal(){return"horizontal"===this.orientedImageryType}get isInspection(){return"inspection"===this.orientedImageryType}get isNadir(){return"nadir"===this.orientedImageryType}get isOblique(){return"oblique"===this.orientedImageryType}get isSpherical(){return"360"===this.orientedImageryType}get location(){const{cameraOrientation:e,cameraHeight:t,elevation:r}=this;if(e){const{type:t,x:r,y:n,z:i,horizontalWKID:a,verticalWKID:o}=e,s="number"==typeof a?{wkid:a}:{wkt:a};if(t===$.g.LTP){const{latitude:t,longitude:r,ellipsoidRadius:n,squaredEccentricity:i,properties:a}=e,{x:o,y:s,z:l}=a;return new P.default((0,K.Zq)([o,s,l],[t,r,n,i]))}const l=new P.default({x:r,y:n,z:i,spatialReference:s}),c=o?(0,H.N)("point",{wkid:o},s):null;return c&&c(l),l}if("number"!=typeof t)throw function(e){throw new c.default("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}("cameraHeight");const n=this.geometry.clone();return n.z=n.hasZ?n.z:(r??0)+t,n}set matrix(e){if(!e||9!==e.length)return p.A.getLogger(this).warn("Ignoring rotation matrix because it doesn't have 9 values",{value:e}),void this._set("matrix",null);this._set("matrix",e)}readNearDistance(e,t){const{neardistance:r,neardist:n,layer:i}=t;return r??n??i.nearDistance}readOrientationAccuracy(e,t){const{accuracy:r,orientationaccuracy:n}=t;return n?.split(";").map(Number)??r?.split(";").map(Number)??null}writeOrientationAccuracy(e,t){e&&(t.orientationAccuracy=e.join(";"))}readOIType(e,t){const{orientedimagerytype:r,oitype:n,camerapitch:i,campitch:a,layer:o}=t,s=W.fs.read(r??n??o.orientedImageryType),l=i??a??o.cameraPitch;return"oblique"===s?l<10?"nadir":"oblique":s}set radial(e){if(e)if("string"!=typeof e)this._set("radial",e);else{const[t,r,n]=e.split(";").map(Number);this._set("radial",[t??0,r??0,n??0])}else this._set("radial",[0,0,0])}set tangential(e){if(e)if("string"!=typeof e)this._set("tangential",e);else{const[t,r]=e.split(";").map(Number);this._set("tangential",[t??0,r??0])}else this._set("tangential",[0,0])}readVFOV(e,t){const{verticalfieldofview:r,vfov:n,layer:i}=t;return r??n??i.verticalFieldOfView}_parseIfJSON(e){let t=null;try{t=JSON.parse(e)}catch(r){p.A.getLogger(this).error("couldn't parse the given elevation source JSON",e,r)}return t}};(0,n._)([(0,_.MZ)(Y())],X.prototype,"a0",void 0),(0,n._)([(0,_.MZ)(Y())],X.prototype,"a1",void 0),(0,n._)([(0,_.MZ)(Y())],X.prototype,"a2",void 0),(0,n._)([(0,_.MZ)({type:Date,json:{write:{enabled:!0,target:"acquisitionDate"},name:"acquisitiondate"}})],X.prototype,"acquisitionDate",void 0),(0,n._)([(0,_.MZ)(Y())],X.prototype,"b0",void 0),(0,n._)([(0,_.MZ)(Y())],X.prototype,"b1",void 0),(0,n._)([(0,_.MZ)(Y())],X.prototype,"b2",void 0),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],X.prototype,"cameraHeading",void 0),(0,n._)([(0,V.w)("cameraHeading")],X.prototype,"readCameraHeading",null),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraHeight",void 0),(0,n._)([(0,V.w)("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],X.prototype,"readCameraHeight",null),(0,n._)([(0,_.MZ)()],X.prototype,"cameraOffset",void 0),(0,n._)([(0,V.w)("cameraOffset",["cameraoffset","camoffset"])],X.prototype,"readCamOffset",null),(0,n._)([(0,j.K)("cameraOffset")],X.prototype,"writeCameraOffset",null),(0,n._)([(0,_.MZ)({json:{write:{writer:(e,t,r)=>{t[r]=e.toString()}}},type:U.A}),(0,L.w)((e=>e?J.getCameraOrientation(e):null))],X.prototype,"cameraOrientation",void 0),(0,n._)([(0,V.w)("cameraOrientation",["cameraorientation","camori"])],X.prototype,"readCameraOrientation",null),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraPitch",void 0),(0,n._)([(0,V.w)("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],X.prototype,"readCameraPitch",null),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraRoll",void 0),(0,n._)([(0,V.w)("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],X.prototype,"readCameraRoll",null),(0,n._)([(0,_.MZ)({json:{write:!0},type:String})],X.prototype,"depthImage",void 0),(0,n._)([(0,V.w)("depthImage",["depthimage","depthimg"])],X.prototype,"readDepthImage",null),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"elevation",void 0),(0,n._)([(0,_.MZ)({json:{write:!0},clonable:"reference"})],X.prototype,"elevationSource",void 0),(0,n._)([(0,V.w)("elevationSource",["elevationsource","layer.effectiveElevationSource"])],X.prototype,"readElevationSource",null),(0,n._)([(0,_.MZ)({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],X.prototype,"exposureStationId",void 0),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"farDistance",void 0),(0,n._)([(0,V.w)("farDistance",["fardistance","fardist","layer.farDistance"])],X.prototype,"readFarDistance",null),(0,n._)([(0,_.MZ)(Y("focallength"))],X.prototype,"focalLength",void 0),(0,n._)([(0,_.MZ)({type:P.default,json:{name:"geometry"}})],X.prototype,"geometry",void 0),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"horizontalFieldOfView",void 0),(0,n._)([(0,V.w)("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],X.prototype,"readHFOV",null),(0,n._)([(0,_.MZ)({json:{write:!0},type:String})],X.prototype,"imagePath",void 0),(0,n._)([(0,V.w)("imagePath",["imagepath"])],X.prototype,"readImageURL",null),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"imageRotation",void 0),(0,n._)([(0,V.w)("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],X.prototype,"readImageRotation",null),(0,n._)([(0,_.MZ)()],X.prototype,"isHorizontal",null),(0,n._)([(0,_.MZ)()],X.prototype,"isInspection",null),(0,n._)([(0,_.MZ)()],X.prototype,"isNadir",null),(0,n._)([(0,_.MZ)()],X.prototype,"isOblique",null),(0,n._)([(0,_.MZ)()],X.prototype,"isSpherical",null),(0,n._)([(0,_.MZ)()],X.prototype,"location",null),(0,n._)([(0,_.MZ)(Q())],X.prototype,"matrix",null),(0,n._)([(0,_.MZ)({json:{write:!0},type:String})],X.prototype,"name",void 0),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"nearDistance",void 0),(0,n._)([(0,V.w)("nearDistance",["neardistance","neardist","layer.nearDistance"])],X.prototype,"readNearDistance",null),(0,n._)([(0,_.MZ)({json:{write:!0,name:"objectid"},type:Number})],X.prototype,"objectId",void 0),(0,n._)([(0,_.MZ)()],X.prototype,"orientationAccuracy",void 0),(0,n._)([(0,V.w)("orientationAccuracy",["accuracy","orientationaccuracy"])],X.prototype,"readOrientationAccuracy",null),(0,n._)([(0,j.K)("orientationAccuracy")],X.prototype,"writeOrientationAccuracy",null),(0,n._)([(0,z.e)(W.fs)],X.prototype,"orientedImageryType",void 0),(0,n._)([(0,V.w)("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],X.prototype,"readOIType",null),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0,read:{source:"principalx"}}})],X.prototype,"principalX",void 0),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0,read:{source:"principaly"}}})],X.prototype,"principalY",void 0),(0,n._)([(0,_.MZ)(Q([0,0,0]))],X.prototype,"radial",null),(0,n._)([(0,_.MZ)({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],X.prototype,"sortOrder",void 0),(0,n._)([(0,_.MZ)({type:Object})],X.prototype,"sourceMap",void 0),(0,n._)([(0,_.MZ)(Q([0,0]))],X.prototype,"tangential",null),(0,n._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"verticalFieldOfView",void 0),(0,n._)([(0,V.w)("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],X.prototype,"readVFOV",null),X=(0,n._)([(0,x.$)("esri.layers.orientedImagery.core.ExposurePoint")],X);const ee=X;var te=r(68295);const re={};async function ne(e,t){const{point:r,queryParams:n}=e;if(null==r)return null;const i={};let a=e.layerInstanceOrURL;const o=r.spatialReference.isGeographic?(0,Z.geographicToWebMercator)(r.clone()):r.clone();if(i.outSpatialReference=o.spatialReference,n&&(i.maxRecordCountFactor=n.maxRecordCountFactor??5,i.outFields=n.outFields??["*"],i.where=n.where??"1=1",i.returnGeometry=n.returnGeometry??!0,i.outSpatialReference=n.outSpatialReference),"string"==typeof a&&(re.layer&&re.layer.url===a?a=re.layer:(re.layer?.destroy(),a=re.layer=new E.default({url:a}))),a)try{await a.load();const e=a,r=function(e,t){const r=e.x-t,n=e.x+t,i=e.y-t,a=e.y+t;return new k.default({xmin:r,xmax:n,ymin:i,ymax:a,spatialReference:e.spatialReference})}(o,n?.maximumDistance??e.maximumDistance??1e3);i.returnZ=e.hasZ;const s=new te.default({geometry:r,...i}),l=await e.queryFeatures(s,t);return function(e){return t=>{const{features:r,spatialReference:n}=t;return r.forEach((t=>{t.geometry&&(t.geometry.spatialReference=n);const r=ee.fromJSON({...t.toJSON(),layer:e});r&&(t.attributes=r),t.layer=e,t.spatialReference=n})),t}}(e)(l)}catch(s){(0,y.throwIfNotAbortError)(s)}return null}var ie=r(14556),ae=r(12294);function oe(e){const{camera:t,features:r,selectedPoint:n}=e;if(!r.length)return[];e.currentImage??={attributes:{cameraHeading:0,cameraPitch:0}};const i=function(e,t,r){return t.z??=0,t.elevation??=0,n=>{const{hfovWeight:i,vfovWeight:a,distanceWeight:o}=se(n.attributes,e?"3d":"2d"),s=n.attributes,{cameraHeight:l,cameraHeading:c,cameraPitch:u,farDistance:h,horizontalFieldOfView:d,verticalFieldOfView:p,isOblique:f}=s,m=s.geometry,g=180*Math.atan2(m.y-t.y,m.x-t.x)/Math.PI,y=(0,ae.Io)(t,m);let v,w,M=d,b=p,_=!1;e?(v=e.heading,w=e.tilt,M=180,b=180,_=!0):!f||u<10?(v=c,w=u,_=!1):(v=r.attributes.cameraHeading,w=u,_=!0,M=180),v>180&&(v-=360);let x=1;m.spatialReference.isWebMercator&&(x=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*m.y/ie.$O.radius))));const S=Math.sqrt((Math.sqrt((t.x-m.x)**2+(t.y-m.y)**2)/x)**2+((t.z??0)-(t.elevation??0)-l)**2),R=90-180*Math.atan2(t.y-m.y,t.x-m.x)/Math.PI;let I=(Math.abs(R-v)>180?Math.abs(360-Math.abs(R-v)):Math.abs(R-v))/M;I=4*I+1;const T=180*Math.acos((s.cameraHeight-(t.z??0)+(t.elevation??0))/S)/Math.PI;let P=Math.abs(T-w)/b;P=4*P+1;let A=S/Math.sqrt(h**2+l**2);A=4*A+1;const F=i*I+a*P+o*A;let C;if(_){const e=c>180?c-360:c;C=i*((Math.abs(R-e)>180?Math.abs(360-Math.abs(R-e)):Math.abs(R-e))/d*4+1)+a*(Math.abs(T-u)/p*4+1)+o*A}else C=F;return{suitability:F,trueSuitability:C,feature:n,angle:g,distance:y,verticalAngle:Math.abs(180*Math.atan(y/l)/Math.PI)}}}(t,n,e.currentImage);return r.map(i)}function se(e,t){const r="isOblique"in e?e:new ee(e),{isOblique:n,isSpherical:i,isNadir:a}=r;return i?{hfovWeight:"2d"===t?0:1,vfovWeight:"2d"===t?0:.6,distanceWeight:"2d"===t?1:.5}:a?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:n?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}var le=r(86017),ce=r(58872),ue=r(20749),he=r(42269),de=r(36116),pe=r(85367),fe=r(46530),me=r(38996),ge=r(48280),ye=r(71523),ve=r(57308),we=r(7989),Me=r(25329),be=r(18364),_e=r(58963),xe=r(3825),Se=r(45802),Re=r(75939),Ie=r(38338),Te=r(57134);let Pe=class extends(G.A.ClonableMixin(h.A)){constructor(e){super(e),this.maxFOV=0,this.minFOV=0,this.view=null,this.zoomFactor=5}get canZoomIn(){return!!this.view&&(0===this.minFOV||this.view.camera.fov>this.minFOV)}get canZoomOut(){return!!this.view&&(0===this.maxFOV||this.view.camera.fov<this.maxFOV)}};(0,n._)([(0,_.MZ)({type:Boolean,readOnly:!0})],Pe.prototype,"canZoomIn",null),(0,n._)([(0,_.MZ)({type:Boolean,readOnly:!0})],Pe.prototype,"canZoomOut",null),(0,n._)([(0,_.MZ)({type:Number})],Pe.prototype,"maxFOV",void 0),(0,n._)([(0,_.MZ)({type:Number})],Pe.prototype,"minFOV",void 0),(0,n._)([(0,_.MZ)()],Pe.prototype,"view",void 0),(0,n._)([(0,_.MZ)({type:Number})],Pe.prototype,"zoomFactor",void 0),Pe=(0,n._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],Pe);const Ae=Pe;var Fe=r(75657);let Ce=class extends Fe.default{constructor(e){super(e),this.panoramicZoomConditions=new Ae,this.zoomTo=e=>{this.view.camera.fov=this.constrainFOV(e),this.view.camera=this.view.camera.clone()}}initialize(){this.addHandles([(0,w.watch)((()=>[this.view?.ready,this.panoramicZoomConditions]),(()=>{this.view?.ready&&(this.panoramicZoomConditions.view=this.view,this.zoomTo(this.view.camera.fov))}),w.syncAndInitial),(0,w.watch)((()=>[this.panoramicZoomConditions.maxFOV,this.panoramicZoomConditions.minFOV]),(e=>{let[t,r]=e;null!=t&&null!=r&&this.zoomTo(this.view.camera.fov)}),w.sync)])}get canZoomIn(){return this.panoramicZoomConditions.canZoomIn}get canZoomOut(){return this.panoramicZoomConditions.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._set("view",e)}constrainFOV(e){const{maxFOV:t,minFOV:r}=this.panoramicZoomConditions;return(0,f.qE)(e,r,t)}zoomIn(){if(!this.canZoomIn)return;const e=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}zoomOut(){if(!this.canZoomOut)return;const e=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}};(0,n._)([(0,_.MZ)()],Ce.prototype,"canZoomIn",null),(0,n._)([(0,_.MZ)()],Ce.prototype,"canZoomOut",null),(0,n._)([(0,_.MZ)({type:Ae})],Ce.prototype,"panoramicZoomConditions",void 0),(0,n._)([(0,_.MZ)()],Ce.prototype,"state",null),(0,n._)([(0,_.MZ)()],Ce.prototype,"view",null),Ce=(0,n._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Ce);const Oe=Ce;var Ne=r(10851),Ze=r(33905),De=r(75257),ke=r(84847),Ee=r(94918);function Ge(e,t){return 2*(0,f.KJ)(Math.atan(Math.tan((0,f.kU)(e/2))*Math.sqrt(t**2+1)))}const Le="default",ze="navigation",Ve="fov-constraint",je="image-click-action";let He=class extends u.A.EventedAccessor{constructor(e){super(e),this._startPosition=null,this._targetPosition=null,this._graphics=new D.default({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this._loadController=null,this._map=new _e.default({ground:new be.default({opacity:0,navigationConstraint:null}),layers:new s.default([this._graphics])}),this._zoomViewModel=null,this.autoLoad=!1,this.clickAction="none",this.imageSize=null,this.imageSource=null,this.pitch=90,this.state="ready",this.yaw=0,this._addNavigationHandles=()=>{this.imageRenderer.basemapTerrain.suspended=!0,this.imageRenderer.constraints.tilt.max=180,this.removeHandles(ze),this.addHandles([this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("double-click",this._handleDoubleClick),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",(e=>{const t=e.key;["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t)&&e.stopPropagation()}))],ze)},this._addHFOVHandles=()=>{this.removeHandles(Ve),this.addHandles((0,w.watch)((()=>[this.maxHFOV,this.minHFOV]),(()=>{this._zoomViewModel&&(this._zoomViewModel.panoramicZoomConditions=new Ae({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))}),w.syncAndInitial),Ve)},this._addZoomHandles=()=>{this._zoomViewModel=new Oe({view:this.imageRenderer,panoramicZoomConditions:new Ae({maxFOV:this.maxHFOV,minFOV:this.minHFOV})});const e=this.imageRenderer.ui.find("zoom");e&&(e.viewModel=this._zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._handleDoubleClick=e=>{e.stopPropagation(),e.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=e=>{e.stopPropagation();const{action:t,x:r,y:n}=e;switch(t){case"start":this._startPosition=this._targetPosition={x:r,y:n};break;case"update":this._targetPosition={x:r,y:n},this._updateCameraHeadingAndTilt()}},this._handleImageClick=e=>{if("image-loaded"===this.state&&this.imageRenderer.ready)switch(this.clickAction){case"emit":e.stopPropagation(),this.emit("click",e);break;case"hittest":e.stopPropagation(),e.async((async()=>{const t=await this.imageRenderer.hitTest(e.screenPoint,{include:this._graphics});this.emit("hittest-response",t)}));break;case"pixel-location":{if(e.stopPropagation(),!this.imageSize||!e.mapPoint)return void this.emit("pixel-location",null);const t=(0,K.pq)(e.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",{...t,spatialReference:O.default.WebMercator});break}}},this._handleWheel=e=>{const t=e.deltaX??e.native.deltaX;e.stopPropagation(),t>0||e.deltaY>0?this._zoomOut():this._zoomIn()},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._zoomIn=()=>this._zoomViewModel?.zoomIn(),this._zoomOut=()=>this._zoomViewModel?.zoomOut(),this.addGraphic=(e,t)=>"image-loaded"===this.state&&!this._graphics.graphics.includes(e)&&(this._graphics.graphics.add(e,t),!0),this.addManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>!this._graphics.graphics.includes(e)));return this._graphics.graphics.addMany(t),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.removeGraphic=e=>!("image-loaded"!==this.state||!this._graphics.graphics.includes(e))&&(this._graphics.remove(e),!0),this.removeManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>this._graphics.graphics.includes(e)));return this._graphics.removeMany(t),!0},this._imageRenderer=new Re.default({map:this._map,viewingMode:"local",camera:{position:Te.ZH},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:O.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,w.watch)((()=>this.imageSource),(()=>{this.imageSource&&this.autoLoad&&this._loadWithController()}),w.syncAndInitial),(0,w.watch)((()=>this.fov),(()=>{this._reloadCamera()}),w.syncAndInitial),(0,w.watch)((()=>this.yaw),(e=>{this.camera.heading=e,this._reloadCamera()}),w.syncAndInitial),(0,w.watch)((()=>this.pitch),(e=>{this.camera.tilt=e,this._reloadCamera()}),w.syncAndInitial),(0,w.when)((()=>this.imageRenderer.ready),(()=>{this._addNavigationHandles(),this._addZoomHandles()}),w.syncAndInitial),(0,w.watch)((()=>this.clickAction),(e=>{this.removeHandles(je),"none"!==e&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))}),w.syncAndInitial)],Le)}get camera(){return this.imageRenderer.camera}set camera(e){e&&(this.imageRenderer.camera=e.clone())}get fov(){return this.camera.fov}set fov(e){Number.isFinite(e)&&this._zoomViewModel?.zoomTo(e)}get hfov(){const{fov:e}=this.camera,{size:[t,r]}=this.imageRenderer,n=t/r,i=Math.atan(n);return 2*(0,f.KJ)(Math.atan(Math.tan((0,f.kU)(e/2))*Math.sin(i)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[e,t]}=this.imageRenderer;return Ge(Te.EA,e/t)}get minHFOV(){const{size:[e,t]}=this.imageRenderer;return Ge(Te.li,e/t)}get vfov(){const{fov:e}=this.camera,{size:[t,r]}=this.imageRenderer,n=t/r,i=Math.atan(n);return 2*(0,f.KJ)(Math.atan(Math.tan((0,f.kU)(e/2))*Math.cos(i)))}async _loadImageInternal(e,t){let r;this.state="image-loading";try{r=(await(0,xe.default)(e,{responseType:"image",...t})).data}catch(n){throw(0,y.isAbortError)(n)?this.state="image-load-aborted":this.state="image-load-error",n}return this._updateImageSphere(r,t)}_reloadCamera(){this.camera=this.camera.clone()}_removeImageSphere(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=(0,m.pR)(this._imageGraphic)),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition)return;const e=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(e+360)%360;const t=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,t)),this._startPosition=this._targetPosition}async _updateImageSphere(e,t){await(0,y.waitTick)(t);const{size:[r,n]}=this.imageRenderer;return this._imageGraphic=function(e){return new i.default({geometry:e,symbol:new Ee.default({symbolLayers:new s.default([new ke.default])})})}(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Te.ZH,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Te.vK;const n=t.clone();n.z=-500;const i=Ne.default.createSphere(n,{size:r,densificationFactor:2,vertexSpace:"georeferenced",material:new Ze.default({colorTexture:new De.default({data:e})})});if(i.components[0].trustSourceNormals=!0,i.vertexAttributes.uv){const e=i.vertexAttributes.uv.length??0;for(let t=0;t<e;t++)i.vertexAttributes.uv[2*t+0]=1-i.vertexAttributes.uv[2*t+0],i.vertexAttributes.uv[2*t+1]=i.vertexAttributes.uv[2*t+1]}return i.centerAt(n),i}(e)),this._graphics.add(this._imageGraphic),this.fov=Ge(Te.EF,r/n),this.state="image-loaded",this.imageSize=[e.width,e.height],this._imageGraphic.geometry}async loadImage(e){return this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,e):(0,Ie.EW)(this.declaredClass,new c.default((0,Ie.Fe)("panoramic-viewer"),(0,Ie.br)("PanoramicViewerViewModel","imageSource")))}};(0,n._)([(0,_.MZ)()],He.prototype,"_graphics",void 0),(0,n._)([(0,_.MZ)()],He.prototype,"_imageGraphic",void 0),(0,n._)([(0,_.MZ)()],He.prototype,"_imageRenderer",void 0),(0,n._)([(0,_.MZ)()],He.prototype,"_loadController",void 0),(0,n._)([(0,_.MZ)()],He.prototype,"_map",void 0),(0,n._)([(0,_.MZ)()],He.prototype,"_zoomViewModel",void 0),(0,n._)([(0,_.MZ)({type:Boolean})],He.prototype,"autoLoad",void 0),(0,n._)([(0,_.MZ)({type:we.default})],He.prototype,"camera",null),(0,n._)([(0,z.e)(new Se.J({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],He.prototype,"clickAction",void 0),(0,n._)([(0,_.MZ)({type:Number})],He.prototype,"fov",null),(0,n._)([(0,_.MZ)({readOnly:!0})],He.prototype,"hfov",null),(0,n._)([(0,_.MZ)({readOnly:!0})],He.prototype,"imageRenderer",null),(0,n._)([(0,_.MZ)()],He.prototype,"imageSize",void 0),(0,n._)([(0,_.MZ)()],He.prototype,"imageSource",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],He.prototype,"maxHFOV",null),(0,n._)([(0,_.MZ)({readOnly:!0})],He.prototype,"minHFOV",null),(0,n._)([(0,_.MZ)({type:Number})],He.prototype,"pitch",void 0),(0,n._)([(0,_.MZ)()],He.prototype,"state",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],He.prototype,"vfov",null),(0,n._)([(0,_.MZ)({type:Number})],He.prototype,"yaw",void 0),He=(0,n._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],He);const Ue=He;var Be=r(98108),We=(r(76099),r(12254)),qe=r(54761);let Je=class extends Me.default{constructor(e){super(e),this.viewModel=new Ue,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get fov(){return this.camera.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}render(){return(0,qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(Be.D.widget,"esri-panoramic-viewer")})}};(0,n._)([(0,_.MZ)({type:Boolean})],Je.prototype,"autoLoad",null),(0,n._)([(0,_.MZ)({type:we.default})],Je.prototype,"camera",null),(0,n._)([(0,_.MZ)()],Je.prototype,"clickAction",null),(0,n._)([(0,_.MZ)({type:Number})],Je.prototype,"fov",null),(0,n._)([(0,_.MZ)({readOnly:!0,type:Number})],Je.prototype,"hfov",null),(0,n._)([(0,_.MZ)()],Je.prototype,"icon",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Je.prototype,"imageRenderer",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Je.prototype,"imageSize",null),(0,n._)([(0,_.MZ)()],Je.prototype,"imageSource",null),(0,n._)([(0,_.MZ)({type:Number})],Je.prototype,"pitch",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Je.prototype,"state",null),(0,n._)([(0,_.MZ)({readOnly:!0,type:Number})],Je.prototype,"vfov",null),(0,n._)([(0,We.U)(["click","hittest-response","pixel-location"]),(0,_.MZ)({type:Ue})],Je.prototype,"viewModel",void 0),(0,n._)([(0,_.MZ)({type:Number})],Je.prototype,"yaw",null),Je=(0,n._)([(0,x.$)("esri.widgets.PanoramicViewer")],Je);const $e=Je;var Ke=r(44538),Ye=r(99464),Qe=r(4852),Xe=r(39839),et=r(19562),tt=r(42810),rt=r(63391),nt=r(33562),it=r(44038),at=r(17941),ot=r(88235),st=r(28632);const lt="click-handle",ct="enhancements-handle";let ut=class extends u.A.EventedAccessor{constructor(e){var t;super(e),t=this,this._imageChanged=!1,this._panConstraint=null,this._image=null,this._loadController=null,this._overlays=new D.default({blendMode:"source-atop"}),this._map=new _e.default,this.autoLoad=!1,this.clickAction="none",this.error=null,this.imageSource=null,this.imageRotation=0,this.state="ready",this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._createImageHandles=()=>{this.removeHandles(ct),this.addHandles((0,w.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(e=>{let[t,r,n]=e;this.image?.loaded&&(this.image.effect=`contrast(${10*(r+10)}%) brightness(${10*(t+10)}%)`,this.sharpenImage(this.image,n))}),w.syncAndInitial))},this._createPanConstraint=()=>{const{image:e,imageRenderer:t}=this,r=r=>{if(!(e&&t&&r.targetGeometry&&e.serviceRasterInfo))return r;const{extent:n}=e.serviceRasterInfo,{constraints:i,rotation:a,width:o,height:s}=t,{extent:l}=(0,rt.rotate)(A.default.fromExtent(n),a),{width:c,height:u}=l,h=r.targetGeometry.clone(),d=i.scaleToZoom(r.scale),p=1/2**d,f=o/s;let m=p*c,g=p*u;d&&(c/o>u/s?g=m/f:m=g*f);const y=l.clone();return y.xmin+=m/2,y.xmax-=m/2,y.ymin+=g/2,y.ymax-=g/2,r.targetGeometry=(0,rt.nearestCoordinate)(y,h).coordinate,this.state="image-loaded",r};return{constrain:r,applyPanConstraint:r}},this._createResizeHandles=e=>{e.removeHandles("resize"),e.addHandles((0,w.watch)((()=>{if(!this.imageRenderer.ready)return;const{extent:t}=e.serviceRasterInfo,{width:r,height:n,rotation:i}=this.imageRenderer,{extent:a}=(0,rt.rotate)(A.default.fromExtent(t),i),{width:o,height:s}=a;return Math.max(o/r,s/n)}),(e=>{if(!this.imageRenderer||null==e)return;const{constraints:t,scale:r,spatialReference:n}=this.imageRenderer,i=t.minScale,a=(0,st.fr)(n),o=.25*a,s=a*e;let l=s;const c=[];for(;l>o;)c.push(l),l/=2;c.push(l);const{lods:u}=ot.default.create({scales:c});if(t.set({minScale:s,lods:u}),this._imageChanged)return this.imageRenderer.scale=s,void(this._imageChanged=!1);this.imageRenderer.scale=Math.abs(r-i)<=1e-6?s:r}),w.syncAndInitial),"resize")},this._loadImageInternal=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.state="image-loading",t.clearImage(),t.error=null,t._imageChanged=!0;const n="string"==typeof e,i=n?void 0:e.datasetFormat,a=n?e:e.url,{customParameters:o,options:s}=r;return t._image=new nt.default({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:i},url:a,customParameters:o}),t._image.when((async e=>{t._updatePanConstraint(),t._createResizeHandles(e),t._map.add(e),t.state="image-loaded"}),(r=>{(0,y.isAbortError)(r)?t.state="image-load-aborted":(t.state="image-load-error",t.error=r,p.A.getLogger(t).error(`error occurred while loading image ${n?e:JSON.stringify(e)}`,r),t.imageSource=null)})),t._image.load(s)},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._updatePanConstraint=()=>{this._panConstraint&&this.imageRenderer.constraints.customConstraints.remove(this._panConstraint),this._panConstraint=this._createPanConstraint(),this.imageRenderer.constraints.customConstraints.add(this._panConstraint)},this.addGraphic=(e,t)=>{this._overlays.graphics.add(e,t)},this.addManyGraphics=e=>{this._overlays.addMany(e)},this.clearGraphics=()=>{this._overlays.graphics.removeAll()},this.clearImage=()=>{this.image&&(this._map.layers.remove(this.image),this._image=(0,m.pR)(this._image))},this.loadImage=e=>{const{customParameters:t,imageSource:r}=this;return r?this._loadImageInternal(r,{customParameters:t,options:e}):(0,Ie.EW)(this.declaredClass,new c.default((0,Ie.Fe)("image-viewer"),(0,Ie.br)("ImageViewerViewModel","imageSource")))},this.removeGraphic=e=>{this._overlays.remove(e)},this.removeManyGraphics=e=>{this._overlays.removeMany(e)},this._imageRenderer=new tt.default({constraints:{snapToZoom:!0,rotationEnabled:!1},map:this._map,popupEnabled:!1,spatialReference:O.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,w.watch)((()=>this.imageSource),(e=>{e&&this.autoLoad&&this._loadWithController()}),w.syncAndInitial),(0,w.watch)((()=>this.image?.loaded),(()=>{this._createImageHandles()})),(0,w.watch)((()=>this.imageRotation),(()=>{this._rotateImage()})),(0,w.watch)((()=>this.imageRenderer.map),((e,t)=>{t?.layers.remove(this._overlays),e?.layers.add(this._overlays)}),w.initial),(0,w.watch)((()=>this.imageRenderer.map.allLayers.length),(e=>{e&&this.imageRenderer.map.layers.reorder(this._overlays,e-1)}),w.syncAndInitial),(0,w.watch)((()=>this.clickAction),(e=>{this.removeHandles(lt),"none"!==e&&this.addHandles(this.imageRenderer.on("click",(t=>{if(this.image?.loaded&&this.imageRenderer.ready)switch(e){case"emit":t.stopPropagation(),this.emit("click",t);break;case"hittest":t.stopPropagation(),t.async((async()=>{const e=await this.imageRenderer.hitTest(t.screenPoint,{include:this._overlays});this.emit("hittest-response",e)}));break;case"pixel-location":{if(t.stopPropagation(),!this.image?.serviceRasterInfo||!t.mapPoint)return void this.emit("pixel-location",null);const{extent:e,pixelSize:r}=this.image.serviceRasterInfo,n=(t.mapPoint.x-e.xmin)*r.x,i=(e.ymax-t.mapPoint.y)*r.y,a=new P.default({x:n,y:i,spatialReference:e.spatialReference});this.emit("pixel-location",a);break}}})))}),w.syncAndInitial)])}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",(0,f.qE)(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",(0,f.qE)(e,-10,10))}get image(){return this._image}get imagePointsInView(){const{extent:e,ready:t}=this.imageRenderer,r=this.imageRotation,n=this.image?.fullExtent,i=this.image?.serviceRasterInfo,a=!0===this._imageRenderer.allLayerViews.find((e=>{let{layer:t}=e;return t===this.image}))?.attached;if(!(t&&e&&n&&i&&a))return null;const o=(0,rt.rotate)(A.default.fromExtent(e),r),s=A.default.fromExtent(n),l=(0,rt.intersect)(o,s),{rings:c}=l;return c.flat().map((e=>{let[t,r]=e;return{x:(t-i.extent.xmin)*i.pixelSize.x,y:(i.extent.ymax-r)*i.pixelSize.y}}))}get imageSize(){const{image:e}=this;if(!e?.raster)return null;const{width:t,height:r}=e.raster.rasterInfo;return[t,r]}get imageRenderer(){return this._imageRenderer}get imageView(){return this.imageRenderer.allLayerViews.find((e=>e.layer===this.image))}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",(0,f.qE)(e,0,1))}_rotateImage(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}sharpenImage(e,t){if(!t)return void(e.rasterFunction=null);const r=[0,-1*t,0,-1*t,4*t+1,-1*t,0,-1*t,0],n=new it.default({functionName:"Convolution",functionArguments:{type:at.convolutionKernel.userDefined,cols:3,rows:3,kernel:r,convolutionType:at.convolutionKernel.userDefined}});e.rasterFunction=n}};(0,n._)([(0,_.MZ)()],ut.prototype,"_image",void 0),(0,n._)([(0,_.MZ)()],ut.prototype,"_imageRenderer",void 0),(0,n._)([(0,_.MZ)()],ut.prototype,"_loadController",void 0),(0,n._)([(0,_.MZ)()],ut.prototype,"_overlays",void 0),(0,n._)([(0,_.MZ)()],ut.prototype,"_map",void 0),(0,n._)([(0,_.MZ)({type:Boolean})],ut.prototype,"autoLoad",void 0),(0,n._)([(0,_.MZ)({type:Number})],ut.prototype,"brightness",null),(0,n._)([(0,_.MZ)()],ut.prototype,"clickAction",void 0),(0,n._)([(0,_.MZ)({type:Number})],ut.prototype,"contrast",null),(0,n._)([(0,_.MZ)({type:Object})],ut.prototype,"customParameters",void 0),(0,n._)([(0,_.MZ)({type:c.default})],ut.prototype,"error",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"image",null),(0,n._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"imagePointsInView",null),(0,n._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"imageSize",null),(0,n._)([(0,_.MZ)({cast:Ie.mz})],ut.prototype,"imageSource",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"imageRenderer",null),(0,n._)([(0,_.MZ)({type:Number})],ut.prototype,"imageRotation",void 0),(0,n._)([(0,_.MZ)()],ut.prototype,"imageView",null),(0,n._)([(0,_.MZ)({type:Number})],ut.prototype,"sharpness",null),(0,n._)([(0,_.MZ)()],ut.prototype,"state",void 0),ut=(0,n._)([(0,x.$)("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],ut);const ht=ut;let dt=class extends Me.default{constructor(){super(...arguments),this.viewModel=new ht,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=async e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get brightness(){return this.viewModel.brightness}set brightness(e){this.viewModel.brightness=e}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get contrast(){return this.viewModel.contrast}set contrast(e){this.viewModel.contrast=e}get customParameters(){return this.viewModel.customParameters}set customParameters(e){this.viewModel.customParameters=e}get error(){return this.viewModel.error}get imageSize(){const e=this.viewModel.image?.serviceRasterInfo;return e?[e.width,e.height]:[0,0]}get imagePointsInView(){return this.viewModel.imagePointsInView}get imageRenderer(){return this.viewModel.imageRenderer}get imageRotation(){return this.viewModel.imageRotation}set imageRotation(e){this.viewModel.imageRotation=e}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get sharpness(){return this.viewModel.sharpness}set sharpness(e){this.viewModel.sharpness=e}get state(){return this.viewModel.state}render(){return(0,qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(Be.D.widget,"esri-image-viewer")})}};(0,n._)([(0,_.MZ)({type:Boolean})],dt.prototype,"autoLoad",null),(0,n._)([(0,_.MZ)({type:Number}),(0,_.MZ)()],dt.prototype,"brightness",null),(0,n._)([(0,_.MZ)()],dt.prototype,"clickAction",null),(0,n._)([(0,_.MZ)({type:Number})],dt.prototype,"contrast",null),(0,n._)([(0,_.MZ)({type:Object})],dt.prototype,"customParameters",null),(0,n._)([(0,_.MZ)({readOnly:!0})],dt.prototype,"error",null),(0,n._)([(0,_.MZ)()],dt.prototype,"imageSize",null),(0,n._)([(0,_.MZ)({readOnly:!0})],dt.prototype,"imagePointsInView",null),(0,n._)([(0,_.MZ)({readOnly:!0,type:tt.default})],dt.prototype,"imageRenderer",null),(0,n._)([(0,_.MZ)()],dt.prototype,"imageRotation",null),(0,n._)([(0,_.MZ)()],dt.prototype,"imageSource",null),(0,n._)([(0,We.U)(["click","hittest-response","pixel-location"]),(0,_.MZ)({type:ht})],dt.prototype,"viewModel",void 0),(0,n._)([(0,_.MZ)({type:Number})],dt.prototype,"sharpness",null),(0,n._)([(0,_.MZ)({readOnly:!0})],dt.prototype,"state",null),dt=(0,n._)([(0,x.$)("esri.widgets.OrientedImageryViewer.components.ImageViewer")],dt);const pt=dt,ft="view-click",mt="image-click",gt="interaction-handles",yt=new Set(["JPG","JPEG"]),vt=/\.(\w+)$/,wt=()=>new c.default("orientedimageryviewer:sketch-not-initialized","Sketch property is not initialized, call loadSketch first");let Mt=class extends(u.A.EventedMixin(g.A)){constructor(e){super(e),this.additionalFeatures=new s.default,this.additionalCameraLocations=new s.default,this.additionalFootprints=new s.default,this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.bestFeatureAngle=0,this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null,this.collectionId=null,this.conversionProps=null,this.coverageFrustums=new s.default,this.coveragePolygons=new s.default,this.currentBestFeature=null,this.currentBestFeatureLocation=null,this.currentCoverageVisible=!0,this.determineWorkflowForFeature=async(e,t,r)=>{const{currentBestFeature:n,selectedPoint:i,view:a}=this;if(a?.closePopup(),n&&i){this._initialCurrentCoverageUpdate=!0,this._updateGroundElevation=!0;try{await this._updatePointsAndPolygons(r),await this._loadImage(r)}catch(o){(0,y.isAbortError)(o)||(this.loadImageError(o),p.A.getLogger(this).error("#loadIImage()","error occured while loading image",o))}}},this.disabled=!1,this.displayMessage={key:"onLoadMessage",type:"info"},this.displayNewMeasurementButton=!0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.dataCaptureLayer=null,this.features=new s.default,this.groundCoordinates=null,this.heightMeasurementPixels=[],this.heightGraphic=null,this.heightMeasurementResult=0,this.heightMeasurementAccuracy=0,this.measurementAngle=null,this.tempDistance=null,this.imageGeometryField=null,this.imageLocationToolState=!1,this.isAdditionalCoverageVisible=!1,this.isAdditionalPointSourcesVisible=!1,this.layer=null,this.localPort=null,this.mapImageConversionToolState=!1,this.measureType=null,this.measurementGraphic=null,this.navigatorCurrentBestFeature=null,this.oiObjectIdField=null,this.overlayedCameraLocations=new s.default,this.overlayedMapFeatures=new v.A,this.pixelCoordinates=null,this.pointSources=new s.default,this.previousFeatureAngle=0,this.selectedPoint=null,this.shouldShowSelectedImage=!1,this.sketch=null,this.draw=null,this.sketchAdapter=null,this.updateFootprint=async(e,t)=>{"image-loaded"===this.state&&await(this._adapter?.updateFootprint(e,t))},this.updateFootprintPanorama=async(e,t)=>{await(this._adapter?.updateFootprintPanorama(e,t))},this._adapter=null,this._highlightedFeatureHandle=null,this._imageViewer=new pt,this._initialCurrentCoverageUpdate=!0,this._locationPointOnImage=null,this._overlays=new D.default({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"}}),this._panoramicViewer=new $e,this._previousCursor=null,this._referencePointOnGround=null,this._referencePointOnImage=null,this._sectorData=null,this._updatingHandles=new R.U,this._clickTask=null,this._crossSymbol=null,this.footprintExtent=null,this._featureChangedTask=null,this._openPopupTask=null,this._suitabilities=null,this._transformController=new AbortController,this._updateFootprintTask=null,this._updateGroundElevation=!1,this.hideImageGeometry=e=>{},this.highlight=e=>{if(!this._overlaysView)return;this.removeHighlight();const t=this.additionalFootprints.find((t=>{let{attributes:{imageID:r}}=t;return r===Number(e)}));this._highlightedFeatureHandle=t?this._overlaysView?.highlight(t):null},this.loadDataCaptureAdapter=async e=>{await this.loadSketch(e);const t=r.e(26964).then(r.bind(r,4583)),{default:n}=await t;return(0,y.throwIfAborted)(e),this.sketchAdapter=new n({viewModel:this}),this.sketchAdapter},this.loadImageFromSource=async(e,t)=>this._updatingHandles.addPromise(this._loadImageFromSourceInternal(e,t)),this.loadImageViewer=e=>{this._imageViewer.container=e},this.loadPanoramicViewer=e=>{this._panoramicViewer.container=e},this.removeHighlight=()=>this._highlightedFeatureHandle?.remove(),this.revealImageGeometry=e=>{},this.toggleImageAttributes=()=>{(0,m.DC)(this._openPopupTask),this._openPopupTask=(0,o.UT)((async e=>{const{currentBestFeature:t,popupEnabled:r,layer:n,view:a}=this;if(a?.closePopup(),!(a&&t&&r&&n))return;const{attributes:o,geometry:s}=t,l=new i.default({geometry:s,attributes:o.toJSON(),layer:n});(0,y.throwIfAborted)(e),await a.openPopup({features:[l],location:o.location.clone()})}))},this._createViewClickHandle=()=>{if(this.removeHandles(ft),"disabled"===this.state||null==this.view)return;const e=this.mapImageConversionToolState&&"image-loaded"===this.state?this._mapImageConversionToolViewClickHandler:this._viewClickHandler;this.addHandles(this.view.on("click",e,ve.o.WIDGET),ft)},this._createImageClickHandle=()=>{this.removeHandles(mt);const{mapImageConversionToolState:e,mode:t,activeViewer:r,currentBestFeature:n,footprintExtent:i}=this,a=r?.imageSize;if(!(e&&"none"!==t&&a&&i&&n))return;r.clickAction="pixel-location";let s=null;const l=(0,w.on)((()=>r),"pixel-location",(e=>{this.plotReferencePointOnImage(e),s?.abort(),s=(0,o.UT)((async r=>{if(!e)return;const i=await this.getMapPoint(e,{feature:n,imageSize:a,mode:t}).then((e=>{const t=this.view?.spatialReference;return(0,K.or)(!t,e.spatialReference.equals(t))?e:(0,C.projectWithZConversion)(e,t)}));(0,y.throwIfAborted)(r),this.plotReferencePointOnGround(i)}))}));this.addHandles(l,mt)},this._createImageLocationHandle=()=>{this.removeHandles(mt);const{imageLocationToolState:e,mode:t,activeViewer:r,currentBestFeature:n,footprintExtent:i}=this,a=r?.imageSize;if(!(e&&"none"!==t&&a&&i&&n))return;r.clickAction="pixel-location";let s=null;const l=(0,w.on)((()=>r),"pixel-location",(e=>{this.pixelCoordinates=e,this.plotLocationPointOnImage(e),s?.abort(),s=(0,o.UT)((async r=>{if(!e)return;let i=await this.getMapPoint(e,{feature:n,imageSize:a,mode:t});(0,y.throwIfAborted)(r);const o=this.view?.spatialReference;o&&!i.spatialReference.equals(o)&&(i=await(0,C.projectWithZConversion)(i,o),(0,y.throwIfAborted)(r)),this.groundCoordinates=i}))}));this.addHandles(l,mt)},this._loadImage=async e=>{const{currentBestFeature:t,layer:r,mode:n}=this;if(this.clearGraphics(),!r||!t||"none"===n)return;const{attributes:i}=t,{imagePath:a,imageRotation:o,cameraHeading:s,cameraRoll:l,cameraPitch:c,objectId:u,cameraOrientation:h,location:d}=i,f=(l??0)+(o??0),m=d.spatialReference.isWGS84&&4!==h?.type?(0,Z.geographicToWebMercator)(d):new P.default(d);let g=a;if((0,Qe.y0)(a))try{g=await(0,Qe.O_)(r,u,e)}catch(v){if((0,y.isAbortError)(v))return;return(0,Ie.NL)(v)?(p.A.getLogger(this).error(v),void this.setMessage("noAttachment","error",`${r.objectIdField}: ${u}`)):(p.A.getLogger(this).error(v,{[r.objectIdField]:u,layer:r}),void this.setMessage("imageLoadError","error",`query-attachments-failed:${r.objectIdField} ${u}`))}try{await this.loadImageFromSource(g,{imageRotation:f,options:e,pitch:c,yaw:s,mode:n,cameraLocation:m}),(0,y.throwIfAborted)(e),await this.transformAndPlotSelectedLocation(e)}catch(v){(0,y.isAbortError)(v)||this.loadImageError(v)}},this._loadImageFromSourceInternal=async(e,t)=>{const{mode:r,imageRotation:n,options:i}=t,a="string"==typeof e,o=a?e:e.url,{pathname:s,searchParams:l}=new URL(o);let c=a?s.match(vt)?.[1]:e.datasetFormat;if(!c)try{c=await(0,Ie.gt)(o,{...t.options})}catch(u){(0,y.isAbortError)(u)||p.A.getLogger(this).error("#getContentType()",u)}switch(c??="UNKNOWN FORMAT",r){case"default":this._imageViewer.imageSource={datasetFormat:c.toUpperCase(),url:o.split("?")[0]},this._imageViewer.customParameters=Object.fromEntries(l),this._imageViewer.imageRotation=n??0,await this._imageViewer.loadImage(i);break;case"panoramic":if(yt.has(c.toUpperCase())){const{selectedPoint:e}=this,{pitch:r,yaw:n,cameraLocation:a,viewAngle:s}=t;this._panoramicViewer.imageSource=o;let l=n??0;"number"==typeof s?l=s-l:a&&e&&(l=await(0,K.ox)(a,e)-l),this._panoramicViewer.pitch=r??0,this._panoramicViewer.yaw=l,await this._panoramicViewer.loadImage(i)}else this.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:c})}},this._loadViewAdapter=async e=>{const{view:t}=this;if(t)switch(t.type){case"2d":{const{default:t}=await r.e(15208).then(r.bind(r,15208));(0,y.throwIfAborted)(e),this._adapter=new t(this);break}case"3d":{const{default:t}=await r.e(11334).then(r.bind(r,11334));(0,y.throwIfAborted)(e),this._adapter=new t(this);break}}else this._adapter=null},this._mapImageConversionToolViewClickHandler=e=>{e.stopPropagation(),e.preventDefault(),e.mapPoint&&this.plotMapPoint(e.mapPoint)},this._viewClickHandler=e=>{this._clickTask?.abort(),this._clickTask=(0,o.UT)((async t=>{const{pointerType:r,button:n,mapPoint:i}=e;if(("mouse"!==r||0===n)&&i)return e.stopPropagation(),e.preventDefault(),this._updatingHandles.addPromise(this.loadBestImage(i,{signal:t}))}))},this.plotSelectedPointOnImage=async(e,t)=>{if(await(0,y.waitTick)(t),!e)return;const r=new P.default({...h.A.isSerializable(e)?e.toJSON():e});if("default"===this.mode)r.x-=.5,r.y=.5-r.y,r.spatialReference=this._imageViewer.imageRenderer.spatialReference.clone(),this._crossSymbol=new i.default({geometry:r,symbol:et.pB}),this._imageViewer.addGraphic(this._crossSymbol,0);else if("panoramic"===this.mode){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[r,n]=t,{heading:a,pitch:o}=(0,K.dM)(e,r,n),s=(0,K.id)(a,o);this._crossSymbol=new i.default({geometry:new P.default(s,O.default.WebMercator),symbol:et.ov}),this._panoramicViewer.addGraphic(this._crossSymbol,0)}},this.handleSectorClick=this.handleSectorClick.bind(this),this.searchBestImage=this.searchBestImage.bind(this),this.transformAndPlotReferencePointOnImage=this.transformAndPlotReferencePointOnImage.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this),this.selectBestFeature=this.selectBestFeature.bind(this)}initialize(){this.addHandles([(0,w.watch)((()=>this.view),(()=>{this.load()}),w.syncAndInitial),(0,w.watch)((()=>this.view?.map),((e,t)=>{t?.layers.remove(this._overlays),e?.layers.add(this._overlays)}),w.initial),(0,w.watch)((()=>this.view?.map?.allLayers?.length),(e=>{e&&this.view?.map?.layers.reorder(this._overlays,e-1)}),w.initial),(0,w.watch)((()=>[this.state,this.mapImageConversionToolState,this.view]),(()=>{this._createViewClickHandle(),this._createImageClickHandle()}),w.syncAndInitial),(0,w.watch)((()=>[this.state,this.imageLocationToolState,this.view]),(()=>{if(this._createImageLocationHandle(),!this.imageLocationToolState)return this.clearPreviousGroundLocation(),void this._resetCursor();this._setMeasurementCursor()}),w.syncAndInitial),(0,w.watch)((()=>this.measureType),(()=>{this.clearPreviousMeasurements()}),w.syncAndInitial),(0,w.watch)((()=>this.bestFeatureAngle),((e,t)=>{this.previousFeatureAngle=t??0}),w.syncAndInitial),(0,w.watch)((()=>this.currentBestFeature),(async(e,t)=>{(0,m.DC)(this._featureChangedTask),this._featureChangedTask=(0,o.UT)((async r=>this.determineWorkflowForFeature.apply(this,[e,t,{signal:r}]))),await this._featureChangedTask.promise}),{sync:!0}),(0,w.watch)((()=>this.mode),(e=>{switch(this.removeHandles(gt),e){case"default":this.addHandles((0,w.watch)((()=>{const{state:e}=this;return"image-loaded"===e?this._imageViewer.imagePointsInView:null}),(e=>{e&&((0,m.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,o.UT)((async t=>{await this.updateFootprint(e,{signal:t})})))}),{...w.syncAndInitial,equals:(e,t)=>(0,a.aI)(e,t,d.equalsShallow)}),gt);break;case"panoramic":this.addHandles((0,w.watch)((()=>{const{currentBestFeature:e,state:t}=this,{imageSize:r,vfov:n,hfov:i,pitch:a,yaw:o}=this._panoramicViewer;return e&&r&&!t.includes("loading")?[n,i,o,a]:null}),(e=>{if(!e||this.state.includes("loading"))return;const[t,r,n,i]=e;(0,m.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,o.UT)((async e=>{await this.updateFootprintPanorama({verticalFieldOfView:t,horizontalFieldOfView:r,yaw:n,pitch:i},{signal:e})}))}),{...w.syncAndInitial,equals:(e,t)=>(0,a.aI)(e,t,d.equalsShallow)}),gt)}}),w.syncAndInitial),(0,w.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(()=>{const{_imageViewer:e,brightness:t,contrast:r,mode:n,sharpness:i}=this;"default"===n&&(e.brightness=t,e.contrast=r,e.sharpness=i)}),w.syncAndInitial),(0,w.watch)((()=>this.activeViewer?.imageRenderer),(()=>{this.sketch&&(this.sketch.view=this.activeViewer?.imageRenderer)}))]),this.when().finally((()=>{this.notifyChange("state")}))}destroy(){this._updateFootprintTask=(0,m.DC)(this._updateFootprintTask),this._clickTask=(0,m.DC)(this._clickTask),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=(0,m.pR)(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint),this._crossSymbol=(0,m.pR)(this._crossSymbol),this._referencePointOnGround=(0,m.pR)(this._referencePointOnGround),this._referencePointOnImage=(0,m.pR)(this._referencePointOnImage),this._locationPointOnImage=(0,m.pR)(this._locationPointOnImage),this._overlays&&this.view?.map?.remove(this._overlays),this._overlays.destroy(),this._imageViewer.destroy(),this._panoramicViewer.destroy()}get activeLayer(){return(0,l.Lx)(p.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){(0,l.Lx)(p.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get activeViewer(){const{_imageViewer:e,_panoramicViewer:t,mode:r}=this;switch(r){case"default":return e;case"panoramic":return t;default:return null}}get accuracyParametersMissing(){return this.layer?.orientationAccuracy?.every((e=>0===e))??!0}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",(0,f.qE)(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",(0,f.qE)(e,-10,10))}get featureCount(){return this.features?.length??0}get imageGalleryEnabled(){const{currentBestFeature:e}=this;if(!e)return!1;const t=e.attributes.imagePath?.trim();return(0,Ie._U)(t)||(0,Qe.y0)(t)}get imageLoaded(){return(0,l.Lx)(p.A.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),"image-loaded"===this.state}get invalidCameraHeading(){return this.currentBestFeature?.attributes?.cameraHeading===Ke.BH}get imagePointsInView(){const{mode:e,_imageViewer:t}=this;return"default"===e?t.imagePointsInView:null}get layerView(){const{layer:e,view:t}=this;if(e&&t)return t.allLayerViews.find((0,Ie.FL)(e))}get layerFloorFilterClause(){const{layerView:e}=this;return e?(0,fe.E)(e):null}get mode(){const e=this.currentBestFeature?.attributes;if(!e)return"none";const{horizontalFieldOfView:t,isSpherical:r}=e;return 360===t||r?"panoramic":"default"}get popupEnabled(){return!0===this.layer?.popupEnabled}get referencePoint(){return this._referencePointOnGround?.geometry}get sectorData(){const{_sectorData:e}=this;return e?Ke.PD.map((t=>e[t])):null}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",(0,f.qE)(e,0,1))}get sketchGraphicsLayer(){return this.sketch?.layer}get state(){const{mode:e,disabled:t,_updatingHandles:{updating:r},_featureChangedTask:n}=this;if(t)return"disabled";if(!this.isFulfilled()||r||!1===n?.finished)return"loading";if(this.isRejected())return"error";if("error"===this.displayMessage?.type)return"image-load-error";switch(e){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state}return"ready"}get thumbnails(){const{features:e}=this;return e?new s.default(e.map((e=>{let{attributes:{imagePath:t,objectId:r,cameraRoll:n,imageRotation:i}}=e;const a=t?.trim();return(0,Ie._U)(a)||(0,Qe.y0)(a)?{url:a,objectId:r,rotation:(n??0)+(i??0)}:null})).filter(a.Ru)):null}set view(e){this._set("view",e)}get _sketchGraphicsLayer(){const{mode:e}=this;switch(e){case"panoramic":return new D.default({elevationInfo:{mode:"absolute-height"}});case"default":return new D.default;case"none":return}}get _overlaysView(){return this.view?.layerViews.find((e=>{let{layer:t}=e;return t===this._overlays}))}async computeHeight(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{currentBestFeature:n,activeViewer:i,layer:a,footprintExtent:o}=this,s=i?.imageSize,l=n?.attributes,c=a?.orientationAccuracy;if(!l||!s||!e||e.length<2||!c)return;const u="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,K.Mm)(l,s[0],s[1]),h=e.at(0),d=e.at(-1);if(!(u&&h&&d&&c&&o))return;const p=[d,h],f=(0,Xe.$0)(p,!1),m="panoramic"===t?await(0,Xe.QI)(p,u,c,n,!0,!1):await(0,Xe.AX)(p,u,c,!0,r);if(!m)return;const g="panoramic"===t?await(0,Xe.bO)(c,f,u,m,n,!0):await(0,Xe.jr)(c,f,u,m,!0);return g?{value:m,accuracy:g}:{value:m}}async calculateAreaMeasurement(e,t,r){if(e.length<3||!this.currentBestFeature||!this.activeViewer?.imageSize||"none"===t)return null;const n="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,y.throwIfAborted)(r),n?"default"===t?await(0,Xe.Md)(e,n,!0):await(0,Xe.yP)(e,n,!0,r):null}async calculateDistanceMeasurement(e,t,r){const{currentBestFeature:n,activeViewer:i}=this;if(e.length<2||!n||!i?.imageSize||"none"===t)return null;const a="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,y.throwIfAborted)(r),a?"default"===t?await(0,Xe.CN)([e.at(0),e.at(-1)],a,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],a,!0):null}async calculateAccuracy(e,t,r){const{layer:n,currentBestFeature:i,activeViewer:a}=this,o=n?.orientationAccuracy,s=o?.every((e=>0===e))||!o?.length;if("area"===t&&e.length<3||"distance"===t&&e.length<2||!i||!a?.imageSize||s)return null;const l=await this.getMeasurementProperties();if((0,y.throwIfAborted)(r),!l)return null;const c="area"===t?await(0,Xe.Md)(e,l,!0):await(0,Xe.CN)([e.at(0),e.at(-1)],l,!0);(0,y.throwIfAborted)(r);const{updateElevationProps:u,...h}=l,d=(0,Xe.gO)(h,o);if(!d?.length)return null;const p=d.map((e=>({...e,updateElevationProps:u}))).map((async n=>{const i="area"===t?await(0,Xe.Md)(e,n,!0):await(0,Xe.CN)([e.at(0),e.at(-1)],n,!0);if((0,y.throwIfAborted)(r),i&&c){if("area"===t){const e="number"!=typeof i?i.area:null;return e?Math.abs(e-c.area):null}return Math.abs(i-c)}return null})),f=await Promise.all(p);(0,y.throwIfAborted)(r);const m=f.filter((e=>null!==e));return 0===m.length?null:(0,Xe.WB)(m)}async calculateAccuracyPanoramic(e,t,r){const{layer:n,currentBestFeature:i,activeViewer:a,mode:o}=this,s=n?.orientationAccuracy,l=s?.every((e=>0===e))||!s?.length;if("area"===t&&e.length<3||"distance"===t&&e.length<2||!i||!a?.imageSize||l||"panoramic"!==o)return null;const c=await this.getMeasurementPropertiesPanoramic();if((0,y.throwIfAborted)(r),!c)return null;const u="area"===t?await(0,Xe.yP)(e,c,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],c,!0);(0,y.throwIfAborted)(r);const{updateElevationProps:h,...d}=c,p=(0,Xe.cG)(d,s);if(!p?.length)return null;const f=p.map((e=>({...e,updateElevationProps:h}))).map((async n=>{const i="area"===t?await(0,Xe.yP)(e,n,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],n,!0);if((0,y.throwIfAborted)(r),i&&u){if("area"===t){const e="number"!=typeof i?i.area:null;return e?Math.abs(e-u.area):null}return Math.abs(i-u)}return null})),m=await Promise.all(f);(0,y.throwIfAborted)(r);const g=m.filter((e=>null!==e));return 0===g.length?null:(0,Xe.WB)(g)}async calculateHeightMeasurementInfo(e,t,r){const{currentBestFeature:n,activeViewer:i}=this,a=i?.imageSize;if(!n||!i||!a?.length||"none"===t)return;const{attributes:o}=n,[s]=(0,Xe.$0)([e],"panoramic"!==t),l="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,K.Mm)(o,a[0],a[1]);if("panoramic"===t){if(!l)return;const e=await(0,Xe.Z9)(s,l,n,r);if(!e)return;e?.heading>180&&(e.heading-=360);const t=(0,Xe.mf)(s,e),i=(0,S.Io)([s.x,s.y],[e.x,e.y]);if(!t||!i)return;return{measurementAngle:t,tempDistance:i}}const c=await(0,Xe._I)(s,l,r);if(!c)return;const u=(0,Xe.Qu)(s,c),h=(0,S.Io)([s.x,s.y],[c.x,c.y]);return u&&h?{measurementAngle:u,tempDistance:h}:void 0}clearPreviousMeasurements(){this.clearMeasurementGraphics(),this.resetMeasurementData(),this.stopMeasurement()}clearPreviousGroundLocation(){this.groundCoordinates=null,this.pixelCoordinates=null,this.clearLocationPointOnImage()}clearMeasurementGraphics(){this.measurementGraphic&&(this.activeViewer?.removeGraphic(this.measurementGraphic),this.measurementGraphic=null),this.heightGraphic&&(this.activeViewer?.removeGraphic(this.heightGraphic),this.heightGraphic=null)}digitizeCancel(){return this.sketch?.cancel()}digitizeCanRedo(){return this.sketch?.canRedo()??!1}digitizeCanUndo(){return this.sketch?.canUndo()??!1}digitizeComplete(){return this.sketch?.complete()}async digitizeCreate(e,t){const{sketch:r,dataCaptureLayer:n}=this;if(!r)throw wt();(0,Ye.DV)(n,e,r),await r.create(e,{...t,defaultZ:0})}async digitizeDelete(){if(!this.sketch)throw wt();return this.sketch.delete()}digitizeDuplicate(){if(!this.sketch)throw wt();return this.sketch.duplicate()}digitizePlace(e,t){if(!this.sketch)throw wt();return this.sketch.place(e,t)}digitizeRedo(){if(!this.sketch)throw wt();return this.sketch.redo()}digitizeUndo(){if(!this.sketch)throw wt();return this.sketch.undo()}digitizeUpdate(e,t){if(!this.sketch)throw wt();return this.sketch.update(e,t)}async displayHeightResults(){const{currentBestFeature:e,activeViewer:t,heightMeasurementPixels:r,mode:n}=this,i=t?.imageSize,a=e?.attributes;if(!a||!i)return;const o=await this.computeHeight(r,n);o?.value&&o?.accuracy&&(this.heightMeasurementResult=o.value,this.heightMeasurementAccuracy=o.accuracy)}filterByFootprints(e,t){const r=[],n=[],i=[];return e.forEach((e=>{const{layer:{coveragePercent:a},attributes:o}=e;let s;const l=(0,b.GA)(e.geometry.spatialReference);o.cameraHeight/=l,o.farDistance/=l,o.nearDistance/=l,(0,ce.E1)(o.elevationSource)&&(o.elevationSource.constantElevation/=l);const{polygon:c,frustum:u}=(0,le.ns)(o);if(s=c.clone(),o.isInspection&&(s=(0,le.nt)(o)),a&&(s=(0,le.v3)(s,a)),(0,le.Eh)(s,t)){i.push(e);const{geometry:t,objectId:a,cameraHeight:s,cameraHeading:l}=o,h=t.clone();h.z=s,h.imageID=a,this.pointSources.push(h),l!==Ke.BH&&(r.push(c),u&&n.push(u))}})),{features:i,polygons:r,frustums:n}}getMeasurementProperties(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!t?.imageSize)return;const{elevationSample:r,attributes:n}=e,{elevationSource:i,cameraHeight:a}=n,o=(0,K.Mm)(n,t.imageSize[0],t.imageSize[1]);let s=o.cameraLocation;return(s.spatialReference.isGeographic?(0,C.projectWithZConversion)(s,O.default.WebMercator):Promise.resolve(s)).then((e=>(s=e,(0,K.Ns)((s.z??0)-a,{elevationSample:r,elevationSource:i,extent:this.footprintExtent})))).then((t=>("elevationSample"in t&&(0,K.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),{...o,cameraLocation:s,updateElevationProps:t})))}getMeasurementPropertiesPanoramic(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!t?.imageSize)return;const{elevationSample:r,attributes:n}=e,{elevationSource:i,cameraHeight:a}=n,o=(0,K.m0)(n,t.imageSize[0],t.imageSize[1]);let s=o.cameraLocation;return(s.spatialReference.isGeographic?(0,C.projectWithZConversion)(s,O.default.WebMercator):Promise.resolve(s)).then((e=>(s=e,(0,K.Ns)((s.z??0)-a,{elevationSample:r,elevationSource:i,extent:this.footprintExtent})))).then((t=>("elevationSample"in t&&(0,K.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),{...o,cameraLocation:s,updateElevationProps:t})))}async deleteDataCaptureFeatures(e){const{dataCaptureLayer:t}=this;if(!t)throw new c.default("Data capture layer is not available");return t.queryFeatures({objectIds:e}).then((e=>{let{features:r}=e;return t.applyEdits({deleteFeatures:r})}))}handleSectorClick(e){if(isNaN(e))return;const t=this._sectorData?.[Ke.PD[e]];t?.length&&this._updateCurrentBestFeature(t.at(0))}handleFeatureClick(e){const{sector:t,featureIndexInSector:r}=e;if(isNaN(r))return;const n=this._sectorData?.[t];n?.length&&this._updateCurrentBestFeature(n.at(r))}handleDrawCursorUpdateEvents(e){const{measurementAngle:t,tempDistance:r,heightMeasurementPixels:n,mode:i,activeViewer:a}=this,o=a?.imageSize;if(!e.vertices||!o)return;const s=(0,Xe.Fj)(e.vertices.at(-1),i,o);if(n.length<1||!s||!r||!t||"none"===i)return;const l=(0,Xe.AG)(n[0],s,t);if(!l?.length)return;this.heightMeasurementPixels.push(l),"panoramic"===i?this.createPolylineGraphicPano():this.createPolylineGraphic();const c=(0,Xe.eY)(this.heightMeasurementPixels,r);c&&(this.heightMeasurementResult=c)}async handleDrawVertexAddEvents(e,t){const{currentBestFeature:r,activeViewer:n,heightMeasurementPixels:i,mode:a}=this;if(!r||!n||!e.vertices?.length||"none"===a)return;const o=n?.imageSize;if(!i.length&&o){const r=(0,Xe.Fj)(e.vertices.at(-1),a,o);this.heightMeasurementPixels.push(r);const n=await this.calculateHeightMeasurementInfo(r,a,t);if(!n?.measurementAngle||!n?.tempDistance)return;this.measurementAngle=n.measurementAngle,this.tempDistance=n.tempDistance}}async load(e){return this.addResolvingPromise(this._loadViewAdapter(e).catch((e=>{if(!(0,y.isAbortError)(e))throw e}))),this}async loadBestImage(e,t){return this.view?.closePopup(),this.displayMessage=null,this.clearPreviousGroundLocation(),this.imageLocationToolState=!1,this.selectedPoint=e.spatialReference.isGeographic?(0,Z.geographicToWebMercator)(e):e.clone(),this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint),this._overlays?.removeAll(),this._fetchFeaturesWithController(e,t)}loadImageError(e){p.A.getLogger(this).error("oriented-imagery-viewer:load-image",e),this.setMessage("imageLoadError","error",e.message)}async loadSketch(e){if(!this.sketch){const t=Promise.all([r.e(64344),r.e(81257)]).then(r.bind(r,81257)),{default:n}=await t;(0,y.throwIfAborted)(e),this.sketch=new n({layer:this._sketchGraphicsLayer,view:this.activeViewer?.imageRenderer,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{edgeOperation:"none",shapeOperation:"none",vertexOperation:void 0},enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"transform"}})}return this.sketch}async loadMeasurementAdapter(e){if(!this.sketchAdapter){const t=r.e(41526).then(r.bind(r,41526)),{default:n}=await t;if((0,y.throwIfAborted)(e),this.sketchAdapter=new n({viewModel:this}),!this.sketchAdapter.viewModel.isResolved())return}return this.sketchAdapter}async startMeasurement(e,t){await this.loadSketch(t),await this.loadMeasurementAdapter(t);const{sketch:r,sketchAdapter:n,activeViewer:i,mode:a}=this;if(!r||!n||!i||"none"===a)return;if(this.displayNewMeasurementButton=!1,"panoramic"===a&&(r.defaultCreateOptions.defaultZ=0),await r.create(e),"panoramic"===a){const{drawOperation:e}=r.view.activeTool;e.constraintsEnabled=!1,e._set("elevationDrawSurface",null)}const o=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;o&&this.sketch&&(this.sketch.polygonSymbol=(0,et.fg)(o),this.sketch.polylineSymbol="panoramic"===a?et.Tu:(0,et.Jb)(o))}startHeightMeasurement(){this.heightMeasurementPixels=[],this.displayNewMeasurementButton=!1,this.draw??=new ge.default({view:this.activeViewer?.imageRenderer}),this.draw.create("polyline").on(["cursor-update","vertex-add","draw-complete"],(e=>this.handleDrawEvents(e)))}createPolylineGraphic(){const e=[this.heightMeasurementPixels[0],this.heightMeasurementPixels.at(-1)],t=this.activeViewer?.imageRenderer.spatialReference;if(this.heightGraphic)this.heightGraphic.geometry=new F.default({paths:[e],spatialReference:t});else{const r=new F.default({paths:[e],spatialReference:t}),n=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;this.heightGraphic=new i.default({geometry:r,symbol:(0,et.Jb)(n,2.5)}),this.activeViewer?.addGraphic(this.heightGraphic)}}createPolylineGraphicPano(){const e=this.activeViewer?.imageRenderer.spatialReference,t=this.activeViewer?.imageSize;if(!t)return;const r={x:this.heightMeasurementPixels[0][0],y:this.heightMeasurementPixels[0][1]},n={x:this.heightMeasurementPixels.at(-1)[0],y:this.heightMeasurementPixels.at(-1)[1]},{heading:a,pitch:o}=(0,K.dM)(r,t[0],t[1]),{heading:s,pitch:l}=(0,K.dM)(n,t[0],t[1]),c=[[...(0,K.id)(a,o)],[...(0,K.id)(s,l)]];if(this.heightGraphic)this.heightGraphic.geometry=new F.default({paths:[c],spatialReference:e});else{const t=new F.default({paths:[c],spatialReference:e});this.heightGraphic=new i.default({geometry:t,symbol:et.Tu}),this._panoramicViewer.addGraphic(this.heightGraphic,0)}}async handleDrawEvents(e,t){if(this.draw)switch(e.type){case"cursor-update":this.handleDrawCursorUpdateEvents(e);break;case"vertex-add":this.handleDrawVertexAddEvents(e,t);break;case"draw-complete":await this.displayHeightResults()}}initializeMeasurement(e){switch(this.clearMeasurementGraphics(),this.resetMeasurementData(),e){case"distance":this.startMeasurement("polyline");break;case"area":this.startMeasurement("polygon");break;case"height":this.startHeightMeasurement()}}async overlayCameraLocations(e){const{activeViewer:t,currentBestFeature:r,overlayedCameraLocations:n,layer:a,mode:o,state:s}=this,l=t?.imageSize;if(!l||!r||!a||"none"===o||s.includes("loading"))return;const{polygon:c}=(0,le.ns)(r.attributes);if(t.removeManyGraphics(n.toArray()),n.removeAll(),e){const{features:e}=await a.queryFeatures({where:`${a.objectIdField} <> ${r.attributes.objectId}`,geometry:c,returnGeometry:!0,outFields:[a.objectIdField]}),s=await Promise.all(e.map((async e=>{const{attributes:t,geometry:n}=e,a=await this.getPixels(n,{feature:r,imageSize:l,mode:o}),s=et.at.clone();return s.outline=new me.default({color:[0,0,0],width:1}),new i.default({attributes:t,symbol:s,geometry:a})})));n.addMany(s),t.addManyGraphics(n.toArray())}}overlayGraphicsOnImage(e,t){this.removeOverlayedGraphicsOnImage(e),this.overlayedMapFeatures.set(e,t),this.activeViewer?.addManyGraphics(t.toArray())}async overlayMapFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{activeViewer:r,currentBestFeature:n,mode:o,state:l,layer:c}=this,u=r?.imageSize;if(!u||!n||"none"===o||l.includes("loading")||!c)return;const{polygon:h}=(0,le.ns)(n.attributes);try{const{imageGeometryField:t,oiObjectIdField:r}=(0,Ye.Qv)(e,c.imageGeometryField,c.imageReferenceField);this.imageGeometryField=t.name,this.oiObjectIdField=r.name}catch(m){p.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features",m)}const{features:d}=await e.queryFeatures({geometry:h,returnGeometry:!0,outFields:["*"]}),f=new s.default((await Promise.all(d.map((async r=>{const a=r.symbol?.clone()??e.renderer?.getSymbol(r)?.clone(),{attributes:s,geometry:l}=r,c=l,{imageGeometryField:h,oiObjectIdField:d}=this;if(h&&d&&(0,Ye.gE)(e,h,d)&&`${s[d]}`==`${n.attributes.objectId}`)try{return(0,Ye.jQ)(s,h,e,t,u,o,a)}catch(m){p.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features","couldn't create graphic from attributes, geometry will be used",{error:m,feature:r,layer:e,imageGeometryField:this.imageGeometryField,imageReferenceField:this.oiObjectIdField})}switch(c?.type){case"point":{const r=await this.getPixels(c,{feature:n,imageSize:u,mode:o});return new i.default({attributes:s,layer:e,symbol:a,geometry:r,visible:e.visible&&t})}case"polygon":{const{rings:r,spatialReference:l}=c,h=r.map((e=>e.map((e=>{let[t,r,n]=e;return new P.default({x:t,y:r,z:n,spatialReference:l})})))),d=await Promise.all(h.map((async e=>this.getPixels(e,{feature:n,imageSize:u,mode:o}).then((e=>e.map(K.n3))))));return new i.default({attributes:s,layer:e,symbol:a,geometry:new A.default({rings:d,spatialReference:O.default.WebMercator}),visible:e.visible&&t})}case"polyline":{const{paths:r,spatialReference:l}=c,h=r.map((e=>e.map((e=>{let[t,r,n]=e;return new P.default({x:t,y:r,z:n,spatialReference:l})})))),d=await Promise.all(h.map((async e=>this.getPixels(e,{feature:n,imageSize:u,mode:o}).then((e=>e.map(K.n3))))));return new i.default({attributes:s,layer:e,symbol:a,geometry:new F.default({paths:d,spatialReference:O.default.WebMercator}),visible:e.visible&&t})}case"multipoint":{const{points:r,spatialReference:l}=c,h=r.map((e=>{let[t,r,n]=e;return new P.default({x:t,y:r,z:n,spatialReference:l})})),d=await this.getPixels(h,{feature:n,imageSize:u,mode:o}).then((e=>e.map(K.n3)));return new i.default({attributes:s,layer:e,symbol:a,geometry:new T.default({points:d,spatialReference:O.default.WebMercator}),visible:e.visible&&t})}}return null})))).filter(a.Ru));this.overlayGraphicsOnImage(`${e.id}`,f)}async getPixels(e,t){const{imageSize:r,mode:n}=t,i=(await this.worldToImage(Array.isArray(e)?e:[e])).map((e=>{if("default"===n)return new P.default({x:e.x-.5,y:.5-e.y,spatialReference:O.default.WebMercator});const[t,i]=r,{heading:a,pitch:o}=(0,K.dM)(e,t,i),s=(0,K.id)(a,o);return new P.default(s,O.default.WebMercator)}));return Array.isArray(e)?i:i[0]}async getMapPoint(e,t){const{feature:r,mode:n,imageSize:i}=t,{elevationSample:a,attributes:o}=r,{elevationSource:s,location:l,elevation:c,cameraHeight:u}=o;let h=l.clone();h.spatialReference.isGeographic&&(h=await(0,C.projectWithZConversion)(h,O.default.WebMercator));const d=await(0,K.Ns)(c??(l.z??0)-u,{elevationSample:a,elevationSource:s,extent:this.footprintExtent});let p;if("elevationSample"in d&&(0,K.sp)(d.elevationSample)&&(r.elevationSample=d.elevationSample),"default"===n){const t=(0,K.Mm)(o,i[0],i[1]);p=await(0,ue.imageToWorld)(Array.isArray(e)?e:[e],{...t,cameraLocation:h},d)}else{const t=(0,K.m0)(o,i[0],i[1]);p=await(0,ue.imageToWorldPanoramic)(Array.isArray(e)?e:[e],{...t,cameraLocation:h},d)}return Array.isArray(e)?p:p[0]}async plotMapPoint(e){return this.plotReferencePoint(e),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:e,options:{signal:this._transformController?.signal}})}plotReferencePointOnGround(e){this._referencePointOnGround&&(this._overlays?.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),null!=e&&(this._referencePointOnGround=new i.default({geometry:new P.default({...e.toJSON()}),symbol:et.FT}),this.view?this._overlays?.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:this._referencePointOnGround?.geometry}}))}plotReferencePointOnImage(e){if("image-loaded"===this.state)switch(this.clearReferencePointOnImage(),this.mode){case"default":{const t=h.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._referencePointOnImage=new i.default({geometry:new P.default({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:et.FT}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break}case"panoramic":{const{imageSize:t}=this._panoramicViewer;if(!t)return;const[r,n]=t,{heading:a,pitch:o}=(0,K.dM)(e,r,n),s=(0,K.id)(a,o);this._referencePointOnImage=new i.default({geometry:new P.default(s,O.default.WebMercator),symbol:et.IL}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0);break}}}plotLocationPointOnImage(e){if("image-loaded"===this.state)switch(this.clearLocationPointOnImage(),this.mode){case"default":this._plotLocationPointOnDefaultImage(e);break;case"panoramic":this._plotLocationPointOnPanoramicImage(e)}}removeAllOverlayMapFeatures(){this.overlayedMapFeatures.forEach((e=>{this._imageViewer.removeManyGraphics(e.toArray())})),this.overlayedMapFeatures.clear()}removeOverlayedGraphicsOnImage(e){const t=this.overlayedMapFeatures.get(e);t?.length&&(this.activeViewer?.removeManyGraphics(t.toArray()),this.overlayedMapFeatures.delete(e))}resetImage(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._clickTask=(0,m.DC)(this._clickTask)}resetMeasurementData(){this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.heightMeasurementPixels=[],this.heightMeasurementResult=0,this.tempDistance=null,this.measurementAngle=null,this.heightMeasurementAccuracy=0,this.heightGraphic=null}async saveDrawing(){const{dataCaptureLayer:e,sketchAdapter:t}=this;if(!e||"data-capture"!==t?.type)return;const{pendingGraphics:r,savedGraphics:n}=t,i=r.get(e.id),a=i?.toArray();if(!i||!a?.length)return;const{addFeatureResults:o}=await this.saveDataCaptureFeatures(a),s=o.reduce(((t,r,n)=>{let{objectId:i,globalId:o,error:s}=r;const l=a[n],{attributes:c}=l;return s?t.error.push(l):(i&&(c[e.objectIdField]=i),o&&e.globalIdField&&(c[e.globalIdField]=o),t.success.push(l)),t}),{success:[],error:[]});n.addMany(s.success),i.removeAll(),i.addMany(s.error)}async saveDataCaptureFeatures(e){const{activeViewer:t,currentBestFeature:n,dataCaptureLayer:i,mode:o}=this,s=t?.imageSize;if(!s||!n||"none"===o)throw new c.default("Image size, current best feature and mode are required to save data capture features");if(!i)throw new c.default("Data capture layer is not available");const l=await Promise.all(e.map((async e=>{const t=e.clone(),{geometry:a}=t;if(!a)return;const l=a.type,c=i.hasZ,u=i.geometryType,h=l!==u,d=h?await r.e(71083).then(r.bind(r,71083)):null,p=d?.default[u],f=h?p?.(a):a;if(f)switch(f.type){case"point":return t.geometry=await this.getMapPoint((0,K.Dy)(o,f,s),{feature:n,imageSize:s,mode:o}),c||(delete t.geometry.z,t.geometry.hasZ=!1),t.geometry.hasM=!1,t;case"polygon":{const e=await Promise.all(f.rings.map((async e=>this.getMapPoint(e.map((e=>{let[t,r,n]=e;return(0,K.Dy)(o,{x:t,y:r,z:n},s)})),{feature:n,imageSize:s,mode:o}))));return t.geometry=new A.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,rings:e.map((e=>e.map(K.n3)))}),t}case"polyline":{const e=await Promise.all(f.paths.map((async e=>this.getMapPoint(e.map((e=>{let[t,r,n]=e;return(0,K.Dy)(o,{x:t,y:r,z:n},s)})),{feature:n,imageSize:s,mode:o}))));return t.geometry=new F.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,paths:e.map((e=>e.map(K.n3)))}),t}}}))),u=l.filter(a.Ru);return i.applyEdits({addFeatures:u}).then((e=>{const{addFeatureResults:t}=e;let r=0;const n=l.map((e=>{const n=t[r++];return e?n:{error:new c.default("Error in saving data capture features"),objectId:null,globalId:null}}));return{...e,addFeatureResults:n}}))}async searchBestImage(e,t){try{const r=await ne(e,t);r&&await this._processFeatureResponse(r,e.point,{signal:t?.signal})}catch(r){(0,y.isAbortError)(r)||(this.setMessage("imageLoadError","error",r.message),p.A.getLogger(this).error("error occurred while finding best image",r))}}selectBestFeature(e){this.currentBestFeature=this.features?.find((t=>{let{attributes:r}=t;return r.objectId===Number(e)}))}setAdditionalCameraLocationsVisibility(e){this.additionalCameraLocations.forEach((t=>{t.visible=e}))}setAdditionalCoverageVisibility(e){this.additionalFootprints.forEach((t=>{t.visible=e}))}setCurrentCoverageVisibility(e){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=e),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=e)}setMapImageConversionToolState(e){this.mapImageConversionToolState=e}async startDataCapture(e,t){const r=this.activeViewer?.imageRenderer,{oiObjectIdField:n,currentBestFeature:i}=this;if(!r||!i||!n)return;const{attributes:{objectId:a}}=i,o=this.overlayedMapFeatures.get(e.id)?.toArray()??[],l=[],c=[];for(const s of o)`${s.getAttribute(n)}`==`${a}`?l.push(s):c.push(s);this.overlayGraphicsOnImage(e.id,new s.default(c)),this.collectionId=e.id;const u=await this.loadSketch(t),h=await this.loadDataCaptureAdapter(t);(0,y.throwIfAborted)(t),u.layer.addMany(l),u.layer.blendMode="source-atop",h.savedGraphics.addMany(l),r.ui.find("zoom").visible=!1,r.map.layers.add(this.sketchGraphicsLayer)}async stopDataCapture(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.sketch?.cancel(),this.sketchGraphicsLayer?.removeAll(),this.sketchAdapter=(0,m.pR)(this.sketchAdapter),this.sketch=(0,m.pR)(this.sketch),this.collectionId=null;const{dataCaptureLayer:t}=this,r=this.activeViewer?.imageRenderer;if(!r||r.destroyed)return;r.map.layers.remove(this.sketchGraphicsLayer),e&&t&&await this.overlayMapFeatures(t,!0);const n=r.ui.find("zoom");n&&(n.visible=!0)}stopMeasurement(){this.heightMeasurementPixels=[],this.draw?.reset(),this.sketch?.cancel()}toggleAllOverlayMapFeatures(e){this.overlayedMapFeatures.forEach((t=>{this._toggleVisiblity(t,e)}))}toggleOverlayMapFeatures(e,t){const r=this.overlayedMapFeatures.get(e);r&&this._toggleVisiblity(r,t)}toggleSelection(e){const{sketch:t}=this;t&&(t.updateOnGraphicClick=e,t.cancel())}async transformAndPlotReferencePointOnImage(e){const{selectedLocation:t,options:r}=e;let n=!1,i=!1;const a=this.bestFeatureFootprint?.geometry;switch(a?.type){case"polygon":{const e=t.spatialReference.equals(a.spatialReference)?t:await(0,C.projectWithZConversion)(t,a.spatialReference);n=a.contains(e);break}case"mesh":{const e=t.spatialReference.equals(a.spatialReference)?t:await(0,C.projectWithZConversion)(t,a.spatialReference);i=a.extent.contains(e);break}}if(!n&&!i)return void this.clearReferencePointOnImage();const o=await this.worldToImage(t,r);if(o)return(0,y.throwIfAborted)(r),this.plotReferencePointOnImage(o),{x:o.x,y:o.y};this.clearReferencePointOnImage()}updateSuitabilities(e){e.sort(((e,t)=>e.suitability-t.suitability)),this._suitabilities=e;const t=this._suitabilities.map((e=>{let{feature:t}=e;return t}));this._initialCurrentCoverageUpdate=!0,this._updateFeatures(t),this._groupFeaturesBySectors()}async _fetchFeatures(e,t){if(!this.view)return;const r=this.layer;if(r){const n={include:r},i=this.view.toScreen(e);if(!i)return;const a=await this.view.hitTest(i,n);return this._processHitTestResults(r,a,t)}}async _fetchFeaturesWithController(e,t){try{await this._fetchFeatures(e,t)}catch(r){if((0,y.isAbortError)(r))return;this.setMessage("imageLoadError","error"),p.A.getLogger(this).error("error occurred while fetching features",r)}}_groupFeaturesBySectors(){const{_suitabilities:e,additionalFeatures:t,currentBestFeature:r,features:n,invalidCameraHeading:i}=this;if(!e||!t||!r||!n||i)return void(this._sectorData=null);this._sectorData={};for(const c of Ke.PD)this._sectorData[c]=new s.default;const a=e.map(((e,t)=>({...e,featureIndex:t})));a.sort(((e,t)=>e.trueSuitability-t.trueSuitability));const o=a.map((e=>{let{distance:t}=e;return t})),l=Math.max(...o);a.forEach((e=>{const{distance:t,angle:r,featureIndex:i}=e,a=t/l*Ke.rV[2],o=(0,Ie.Cg)(t,l),s=(0,Ie.wB)(r);if(!this._sectorData)return;const c=Ke.rV[3]+a*Math.sin(r*Math.PI/180),u=Ke.rV[3]+a*Math.cos(r*Math.PI/180);let h;const d=n.at(i),p=d===this.currentBestFeature,f=this.currentBestFeature?.attributes.cameraPitch&&this.currentBestFeature?.attributes.cameraPitch<5;if(p&&f)h=-90;else{const e=c-Ke.rV[3],t=u-Ke.rV[3],r=t/Math.sqrt(e**2+t**2);let n=180*Math.acos(r)/Math.PI;(e<0&&t<0||e<0&&t>0)&&(n*=-1),h=n}const m=""===o?s:`${o}_${s}`;p&&(h===this.bestFeatureAngle?this.previousFeatureAngle=h:this.bestFeatureAngle=h,this.navigatorCurrentBestFeature=f?null:{x:c,y:u,direction:s});const g=this._sectorData[m];g.add({angle:r,featureIndex:i,x:c,y:u,objectID:d.attributes.objectId,sector:m,featureIndexInSector:g.length})}))}_plotLocationPointOnDefaultImage(e){const t=h.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._locationPointOnImage=new i.default({geometry:new P.default({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:et.C1}),this._imageViewer.addGraphic(this._locationPointOnImage,0)}_plotLocationPointOnPanoramicImage(e){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[r,n]=t,{heading:a,pitch:o}=(0,K.dM)(e,r,n),s=(0,K.id)(a,o);this._locationPointOnImage=new i.default({geometry:new P.default(s,O.default.WebMercator),symbol:et.PR}),this._panoramicViewer.addGraphic(this._locationPointOnImage,0)}async _processFeatureResponse(e,t,r){const{features:n}=e;if(!n?.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll();const{features:i,polygons:a,frustums:o}=this.filterByFootprints(n,t);if(!i.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);let s;if(this.coveragePolygons.addMany(a),this.coverageFrustums.addMany(o),a[0]){let e=new A.default({spatialReference:a[0].spatialReference});for(const r of a)e=await(0,I.union)(e,r);const t=[];for(const{geometry:r}of i)e.contains(r)||t.push([r.x,r.y]);if(t.sort(((e,t)=>+(0,N.$3)([e,t]))),e.addRing(t),this.footprintExtent=(0,ye.hs)(e.extent,2,2),this.view?.supportsGround)try{s=await this.view.map.ground.createElevationSampler(this.footprintExtent,r)}catch(l){(0,y.isAbortError)(l)||p.A.getLogger(this).error(l)}}if((s||i[0].attributes.elevationSource)&&this.footprintExtent){const e=i[0].attributes.elevationSource;(0,ce.jV)(e)&&!s&&(s=await(0,de.gm)({extent:this.footprintExtent,lod:e.lod,url:e.url,rasterFunction:e.rasterFunction}));const r=await(0,K.Ns)((i[0].attributes.location.z??0)-i[0].attributes.cameraHeight,{elevationSample:s,elevationSource:e,extent:this.footprintExtent}),[n,...a]=await(0,he.A)([t,...i.map((e=>e.attributes.geometry.clone()))],r);i[0].elevationSample=s??r.elevationSample,t.elevation=n.z,i.forEach(((e,t)=>{e.attributes.elevation=a[t].z}))}i[0].elevationSample&&i.forEach((e=>{e.elevationSample=i[0].elevationSample})),this._suitabilities=oe({features:i,selectedPoint:t,camera:(0,Ie.Gd)(this.view)?this.view.camera:null,currentImage:this.currentBestFeature}),this.updateSuitabilities(this._suitabilities)}async _processHitTestResults(e,t,r){const{screenPoint:n,results:[i]}=t,a="graphic"===i?.type&&this.shouldShowSelectedImage,o=i?.mapPoint??this.view?.toMap(n);if(!o)return;const{layerFloorFilterClause:s}=this,l=e.spatialReference.equals(o.spatialReference)?o:await(0,C.projectWithZConversion)(o,e.spatialReference),c=(0,M.sqlAnd)("1=1",(0,M.sqlAnd)(e.definitionExpression,s)),u=l.spatialReference.isGeographic?1:(0,b.GA)(l.spatialReference),h={layerInstanceOrURL:e,point:l,queryParams:{where:c,maximumDistance:e.maximumDistance?e.maximumDistance/u:void 0,objectIds:a?[i.graphic.getAttribute(e.objectIdField)]:void 0}};await this.searchBestImage(h,r)}_resetCursor(){const{activeViewer:e}=this;e&&(e.imageRenderer.cursor=this._previousCursor)}_setMeasurementCursor(){const{activeViewer:e}=this;e&&(this._previousCursor=e.imageRenderer.cursor,e.imageRenderer.cursor="crosshair")}_toggleVisiblity(e,t){e.forEach((e=>{e.visible=t}))}_updateFeatures(e){if(!e.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(e),e.length>1?this.additionalFeatures.addMany(e.slice(1)):this.additionalFeatures.removeAll(),this._updateGroundElevation=!0,this.currentBestFeature=e[0]}async _updatePointsAndPolygons(e){const{pointSources:t,currentBestFeature:r,currentCoverageVisible:n,isAdditionalPointSourcesVisible:a}=this;if(r&&(this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),!this.invalidCameraHeading)){await(this._adapter?.createFootprints(e)),(0,y.throwIfAborted)(e);for(const e of t)e.imageID===r.attributes.objectId?this.currentBestFeatureLocation=new i.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:et.OO,visible:n}):this.additionalCameraLocations.push(new i.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:et.at,visible:a}))}}_updateCurrentBestFeature(e){if(!e)return;this.currentBestFeature=this.features?.at(e.featureIndex);const t=this.currentBestFeature?.attributes.cameraPitch&&this.currentBestFeature?.attributes.cameraPitch<5;let r;if(t)r=-90;else{const t=e.x-Ke.rV[3],n=e.y-Ke.rV[3],i=n/Math.sqrt(t**2+n**2);let a=180*Math.acos(i)/Math.PI;(t<0&&n<0||t<0&&n>0)&&(a*=-1),r=a}r===this.bestFeatureAngle?this.previousFeatureAngle=r:this.bestFeatureAngle=r,this.navigatorCurrentBestFeature=t?null:{x:e.x,y:e.y,direction:e.sector.includes("_")?e.sector.split("_")[1]:e.sector}}clearGraphics(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics()}clearReferencePointOnImage(){this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage=(0,m.pR)(this._referencePointOnImage))}clearLocationPointOnImage(){this._locationPointOnImage&&(this._imageViewer.removeGraphic(this._locationPointOnImage),this._panoramicViewer.removeGraphic(this._locationPointOnImage),this._locationPointOnImage=(0,m.pR)(this._locationPointOnImage))}plotReferencePoint(e){"mapPoint"in e?this.plotReferencePointOnGround(e.mapPoint):this.plotReferencePointOnGround(e)}setMessage(e,t,r,n){this.displayMessage={key:e,type:t,data:r,map:n}}async transformAndPlotSelectedLocation(e){const{currentBestFeature:t,invalidCameraHeading:r,selectedPoint:n,activeViewer:i}=this;if(this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=(0,m.pR)(this._crossSymbol)),!n||!t||"image-loaded"!==i?.state||r)return;let a;try{a=await this.worldToImage(n,e),(0,y.throwIfAborted)(e),await this.plotSelectedPointOnImage(a,e)}catch(o){(0,y.isAbortError)(o)||p.A.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:o,selectedPoint:n,feature:t})}}async worldToImage(e,t){const{footprintExtent:r}=this,{imageSize:n}=this.activeViewer;if("none"===this.mode||!this.currentBestFeature||!n||!r)return;const{attributes:{location:i,elevationSource:a,cameraHeading:o,elevation:s,cameraHeight:l},elevationSample:c}=this.currentBestFeature;let u=i.clone();const h=await(0,K.Ns)(s??(i.z??0)-l,{elevationSample:c,elevationSource:a});this.currentBestFeature.elevationSample=h.elevationSample;const d=Array.isArray(e)?e:[e];let p,f=await Promise.all(d.map((e=>new Promise((t=>{if(!e.hasZ)return t((0,he.A)(e,h));t(e)})))));if(i.spatialReference.isGeographic&&(u=await(0,C.projectWithZConversion)(u,O.default.WebMercator,t)),f=await Promise.all(f.map((async e=>u.spatialReference.equals(e.spatialReference)?e:await(0,C.projectWithZConversion)(e,u.spatialReference,t)))),(0,y.throwIfAborted)(t),"panoramic"===this.mode)p=(0,pe.worldToImagePanoramic)(f,{imageHeight:n[1],imageWidth:n[0],cameraHeading:o,cameraLocation:u});else{const e=(0,K.cb)(this.currentBestFeature.attributes,n[0],n[1]);p=(0,pe.worldToImage)(f,{...e,cameraLocation:u})}return Array.isArray(e)?p:p[0]}updateCurrentCoveragePolygon(e){const{additionalFootprints:t,additionalCameraLocations:r,currentBestFeature:n,currentBestFeatureLocation:a,currentCoverageVisible:o,selectedPoint:s,view:l,_adapter:c,mode:u}=this,{attributes:{objectId:h},elevationSample:d}=n;if(this._initialCurrentCoverageUpdate){if(this._overlays?.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint),e&&!this.invalidCameraHeading&&(e.visible=o,this.bestFeatureCurrentFootprint=e),l){const e=[...t,...r,a].filter(Ie.DU);l.supportsGround&&d&&c?.updateGroundElevation&&(this._updateGroundElevation&&c.updateGroundElevation(e,d),"panoramic"===u&&c.updateGroundElevation([this.bestFeatureCurrentFootprint],d)),this._updateGroundElevation=!1,s&&(e.splice(-2,0,this.bestFeatureCurrentFootprint),e.push(new i.default({geometry:s.clone(),symbol:et.pB.clone(),attributes:{imageID:h}}))),this._overlays.graphics.addMany(e)}}else if(l){if(this.invalidCameraHeading)return;this.bestFeatureCurrentFootprint&&(this._overlays?.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint));const t=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;e&&(this.bestFeatureCurrentFootprint=e,l?.supportsGround&&d&&c?.updateGroundElevation&&"panoramic"===u&&c.updateGroundElevation([e],d),e.visible=this.currentCoverageVisible,this._overlays?.graphics.add(this.bestFeatureCurrentFootprint,t>=0?t:this._overlays.graphics.length-1))}}};(0,n._)([(0,_.MZ)()],Mt.prototype,"activeLayer",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"activeViewer",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"accuracyParametersMissing",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"additionalFeatures",void 0),(0,n._)([(0,_.MZ)({type:s.default.ofType(i.default)})],Mt.prototype,"additionalCameraLocations",void 0),(0,n._)([(0,_.MZ)({type:s.default.ofType(i.default)})],Mt.prototype,"additionalFootprints",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"areaMeasurementResult",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"areaMeasurementAccuracy",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"bestFeatureAngle",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"bestFeatureCurrentFootprint",void 0),(0,n._)([(0,_.MZ)({type:i.default})],Mt.prototype,"bestFeatureFootprint",void 0),(0,n._)([(0,_.MZ)({type:Number})],Mt.prototype,"brightness",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"collectionId",void 0),(0,n._)([(0,_.MZ)({type:Number})],Mt.prototype,"contrast",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"conversionProps",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"coverageFrustums",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"coveragePolygons",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"currentBestFeature",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"currentBestFeatureLocation",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"currentCoverageVisible",void 0),(0,n._)([(0,_.MZ)({json:{write:!1}})],Mt.prototype,"determineWorkflowForFeature",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"disabled",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"displayMessage",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"displayNewMeasurementButton",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"distanceMeasurementResult",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"distanceAccuracyArray",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"dataCaptureLayer",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"featureCount",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"features",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"groundCoordinates",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"heightMeasurementPixels",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"heightGraphic",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"heightMeasurementResult",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"heightMeasurementAccuracy",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"measurementAngle",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"tempDistance",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"imageGalleryEnabled",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"imageGeometryField",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"imageLoaded",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"imageLocationToolState",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"invalidCameraHeading",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"imagePointsInView",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"isAdditionalCoverageVisible",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"isAdditionalPointSourcesVisible",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"layer",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"layerView",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"layerFloorFilterClause",null),(0,n._)([(0,_.MZ)({type:Number})],Mt.prototype,"localPort",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"mapImageConversionToolState",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"measureType",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"measurementGraphic",void 0),(0,n._)([(0,_.MZ)({readOnly:!0,value:"none"})],Mt.prototype,"mode",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"navigatorCurrentBestFeature",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"oiObjectIdField",void 0),(0,n._)([(0,_.MZ)({type:s.default.ofType(i.default)})],Mt.prototype,"overlayedCameraLocations",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"overlayedMapFeatures",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"pixelCoordinates",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"pointSources",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"popupEnabled",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"previousFeatureAngle",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"referencePoint",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"sectorData",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"selectedPoint",void 0),(0,n._)([(0,_.MZ)({type:Number})],Mt.prototype,"sharpness",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"shouldShowSelectedImage",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"sketch",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"draw",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"sketchAdapter",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"sketchGraphicsLayer",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"state",null),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"thumbnails",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"updateFootprint",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"updateFootprintPanorama",void 0),(0,n._)([(0,_.MZ)({value:null})],Mt.prototype,"view",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"_adapter",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_sketchGraphicsLayer",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"_highlightedFeatureHandle",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_imageViewer",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_initialCurrentCoverageUpdate",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_locationPointOnImage",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_overlays",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"_overlaysView",null),(0,n._)([(0,_.MZ)()],Mt.prototype,"_panoramicViewer",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_previousCursor",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_referencePointOnGround",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_referencePointOnImage",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_sectorData",void 0),(0,n._)([(0,_.MZ)({readOnly:!0})],Mt.prototype,"_updatingHandles",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"footprintExtent",void 0),(0,n._)([(0,_.MZ)()],Mt.prototype,"_featureChangedTask",void 0),Mt=(0,n._)([(0,x.$)("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],Mt);const bt=Mt},80324:(e,t,r)=>{r.d(t,{Fq:()=>o,Yc:()=>i,Yq:()=>a});var n=r(76797);function i(e){if(null==e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new n.default({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function a(e){if(null==e)return null;const t=e.clone();return void 0!==e.cache._geVersion&&(t.cache._geVersion=e.cache._geVersion),t}function o(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},80935:(e,t,r)=>{r.d(t,{R1:()=>o,aY:()=>i,cN:()=>a});var n=r(81284);class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=r}}function a(e){return"array"in e}function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,n.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(a(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,t.spatialReference??e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},81923:(e,t,r)=>{r.d(t,{AO:()=>De,WE:()=>Ue,gn:()=>et,Fj:()=>He,Cz:()=>Le,V2:()=>Xe,CA:()=>Qe,gU:()=>Ye,F3:()=>dt,wI:()=>pt,rW:()=>rt,v2:()=>ke,ZC:()=>Ge,dl:()=>Ve,tv:()=>je,J9:()=>bt,Dd:()=>mt,w1:()=>ft,lr:()=>Ke,XM:()=>_t});var n,i,a,o=r(7989),s=r(73582),l=r(76460),c=r(15941),u=r(50346),h=r(20664),d=r(9392),p=r(34111),f=r(19247),m=r(9624),g=r(13312),y=r(64232),v=r(60216),w=r(14487),M=r(64465),b=r(84687),_=r(34761),x=r(13191),S=r(72745),R=r(76797),I=r(65215),T=r(5262),P=r(4763),A=r(19555);function F(e,t){const r=[],n=[];return C(r,e,t,a.LEFT),C(n,r,t,a.BOTTOM),C(r,n,t,a.RIGHT),C(n,r,t,a.TOP),n}function C(e,t,r,n){const a=N(r,n);if(e.length=0,t.length){a(Z,t[0],t[0])===i.INSIDE&&O(e,t[0]);for(let r=0;r<t.length;r++){const n=t[r===t.length-1?0:r+1];switch(a(Z,t[r],n)){case i.INSIDE:O(e,n);break;case i.INSIDE_OUT:O(e,(0,S.o8)(Z));break;case i.OUTSIDE_IN:O(e,(0,S.o8)(Z)),O(e,n);case i.OUTSIDE:}}}}function O(e,t){0!==e.length&&(0,A.aI)(e.at(-1),t)||e.push(t)}function N(e,t){const r=t===a.LEFT||t===a.RIGHT?0:1,o=e[t],s=t===a.LEFT||t===a.BOTTOM?n.MIN:n.MAX,l=0===r?1:0;return(e,t,a)=>{if(t[r]<o&&a[r]<o)return s===n.MIN?i.OUTSIDE:i.INSIDE;if(t[r]>o&&a[r]>o)return s===n.MIN?i.INSIDE:i.OUTSIDE;const c=(a[l]-t[l])/(a[r]-t[r]),u=t[l]+c*(o-t[r]);return e[r]=o,e[l]=u,(t[r]<o?1:-1)*s>0?i.OUTSIDE_IN:i.INSIDE_OUT}}!function(e){e[e.MIN=1]="MIN",e[e.MAX=-1]="MAX"}(n||(n={})),function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE_IN=2]="OUTSIDE_IN",e[e.INSIDE_OUT=3]="INSIDE_OUT"}(i||(i={})),function(e){e[e.LEFT=0]="LEFT",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP"}(a||(a={}));const Z=(0,S.vt)();var D=r(95925),k=r(61985),E=r(71372);const G=(0,d.fA)(0,1,0),L=(0,d.fA)(0,0,1),z=(0,x.vt)(),V=(0,d.vt)(),j=(0,d.vt)();function H(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,E.NP)();const{direction:i,up:a}=n;return(0,_.N9)(z,-(0,c.kU)(t)),(0,_.eL)(z,z,(0,c.kU)(r)),(0,h.t)(i,L,z),(0,h.h)(i,i,-1),(0,h.t)(a,G,z),n}function U(e,t,r,n,i){const a=t.lines[k.r.FAR_LEFT].direction,o=(i-r.getAltitude(n))/a[2];(0,h.b)(e,n,a,o)}const B=(0,d.vt)(),W=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,r,n){return(0,E.gn)(t,r,n,L,G)},eyeForCenterWithHeadingTilt:function(e,t,r,n){const i=H(e,r,n),a=(0,d.vt)();return(0,h.h)(a,i.direction,-t),(0,h.g)(a,a,e),{up:i.up,eye:a,heading:r,tilt:n}},eyeTiltToLookAtTilt:function(e){return(0,c.kU)(e)},headingTiltToDirectionUp:H,lookAtTiltToEyeTilt:function(e){return(0,c.KJ)(e)},toArea:function(e,t){const r=e.frustum,{renderCoordsHelper:n}=e,i=n.getAltitude(t),a=e.spatialReference,o=e.state.camera.eye,s=[],l=r.planes[P.FB.FAR];for(let c=0;c<4;c++){const e=r.lines[c];n.intersectInfiniteManifold((0,D.LV)(e.origin,e.direction),i,B)||U(B,r,n,e.endpoint,i),(0,E.gz)(B,o,B,l),s.push((0,S.fA)(B[0],B[1]))}return function(e,t,r){const n=e.map((e=>((0,h.i)(B,e[0],e[1],0),t.fromRenderCoords(B,B,r),[B[0],B[1]])));return n.length<=2?new I.default({spatialReference:r}):(n.push(n[0].slice()),(0,T.$3)(n)||n.reverse(),new I.default({rings:[n],spatialReference:r}))}(F(s,n.extent),n,a)},toExtent:function(e,t,r,n,i){const a=e.renderSpatialReference,o=e.spatialReference??t.spatialReference;return(0,y.g)(t,V,a),(0,y.g)(t,j,a),V[0]-=r/2,j[0]+=r/2,V[1]-=n/2,j[1]+=n/2,(0,w.F)(V,a,V,o),(0,w.F)(j,a,j,o),i?(i.xmin=V[0],i.ymin=V[1],i.xmax=j[0],i.ymax=j[1],i.spatialReference=o):i=new R.default(V[0],V[1],j[0],j[1],o),i}},Symbol.toStringTag,{value:"Module"}));var q=r(43047),J=r(55855),$=r(53494),K=r(44230),Y=r(13927),Q=r(78315),X=r(45417),ee=r(99767),te=r(3136),re=r(94966);const ne=(0,d.fA)(0,0,1),ie=(0,h.n)((0,d.vt)(),(0,d.fA)(1,1,1)),ae=new s.hr(-180,180),oe=(0,x.vt)(),se=(0,d.vt)(),le=(0,d.vt)();function ce(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,E.NP)();(0,h.e)(se,e,ne),0===(0,h.f)(se,se)&&(0,h.e)(se,e,ie),(0,_.$0)(oe,-(0,c.kU)(t),e),(0,_.e$)(oe,oe,-(0,c.kU)(r),se);const{up:i,direction:a}=n;return(0,h.e)(i,se,e),(0,h.n)(i,i),(0,h.t)(i,i,oe),(0,h.n)(a,e),(0,h.v)(a,a),(0,h.t)(a,a,oe),n}function ue(e){const t=e[1];e[1]=-e[2],e[2]=t}function he(e,t){const r=ce(t,e.heading,e.tilt);return e.up=r.up,e}function de(e,t){const r=[],n=[],i=(0,$.FD)();for(let o=0;o<e.length;o++){const a=e[o],s=o===e.length-1?e[0]:e[o+1],l=(0,K.Cr)(a,s,Me),c=(0,Y.vE)(t,l.origin,l.vector,Y.v1.NONE,ve);switch(c){case Y.Nj.INSIDE:r.push(a);break;case Y.Nj.OUTSIDE:n.push(a);break;case Y.Nj.INTERSECTS_INSIDE_OUT:case Y.Nj.INTERSECTS_OUTSIDE_IN:{const[e,o,s]=c===Y.Nj.INTERSECTS_INSIDE_OUT?[1,r,n]:[-1,n,r],l=(0,Y.Qj)(t),u=(0,h.b)((0,d.vt)(),ve,l,e*i),p=(0,h.b)((0,d.vt)(),ve,l,e*-i);o.push(a),o.push(u),s.push(p)}}}const a=[];return r.length&&a.push(r),n.length&&a.push(n),a}const pe={minCurvature:(0,c.kU)(5),maxCurvature:(0,c.kU)(50),minSamples:1,maxSamples:6},fe=(0,d.fA)(1,0,0),me=(0,d.fA)(0,1,0),ge=(0,d.vt)(),ye=(0,d.vt)(),ve=(0,d.vt)(),we=(0,Q.c)(),Me=(0,K.vt)(),be=(0,J.vt)(),_e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,r,n){const i=se,a=le;return(0,h.n)(i,e),(0,h.e)(le,i,ne),0===(0,h.f)(le,le)&&(0,h.e)(le,i,ie),(0,h.e)(a,le,i),(0,E.gn)(t,r,n,i,a)},eyeForCenterWithHeadingTilt:function(e,t,r,n){const i={eye:(0,d.vt)(),up:null,tilt:n,heading:r},a=se;a[0]=e[0],a[1]=e[2],a[2]=-e[1];const o=t,s=(0,c.kU)(r),l=(0,c.kU)(n),u=Math.sin(s),p=Math.cos(s),f=Math.sin(l),m=Math.cos(l),g=(0,h.l)(a);let y;if(Math.abs(l)<1e-8)y=o+g;else{const e=g/f,t=(0,c.YN)(o/e),r=Math.PI-l-t;y=e*Math.sin(r)}const v=m*o,w=o*o*(f*f),M=p*p*w,b=y-v,_=b*b,x=M*(M+_-a[1]*a[1]);if(x<0)return(0,h.h)(i.eye,a,y/g),i.tilt=0,he(i,e);const S=Math.sqrt(x),R=a[1]*b,I=M+_;let T;if(T=p>0?-S+R:S+R,Math.abs(I)<1e-8)return g<1e-8?(i.eye[0]=0,i.eye[1]=0,i.eye[2]=o):(0,h.h)(i.eye,a,y/g),i.tilt=0,ue(i.eye),he(i,e);i.eye[1]=T/I;const P=u*u*w,A=f*o,F=p*A*i.eye[1],C=i.eye[1]*i.eye[1],O=1-C,N=Math.sqrt(O),Z=M*C+P-2*F*N*b+O*_;return Math.abs(Z)<1e-8?((0,h.h)(i.eye,a,y/g),i.tilt=0,ue(i.eye),he(i,e)):(i.eye[0]=(O*(y*a[0]-v*a[0])-A*N*(a[0]*i.eye[1]*p+a[2]*u))/Z,i.eye[2]=(O*(y*a[2]-v*a[2])-A*N*(a[2]*i.eye[1]*p-a[0]*u))/Z,(0,h.h)(i.eye,i.eye,y),ue(i.eye),he(i,e))},eyeTiltToLookAtTilt:function(e,t,r){const n=(0,c.kU)(e),i=(0,h.l)(t);return(0,c.YN)(r/(i/Math.sin(n)))+n},headingTiltToDirectionUp:ce,lookAtTiltToEyeTilt:function(e,t,r){const n=(0,h.l)(t),i=Math.sqrt(r*r+n*n-2*r*n*Math.cos(Math.PI-e)),a=(0,c.YN)(r/(i/Math.sin(e)));return(0,c.KJ)(e-a)},toArea:function(e,t){const r=e.frustum,{renderCoordsHelper:n}=e,i=n.getAltitude(t),a=e.spatialReference,o=n.referenceEllipsoid.radius,s=e.state.camera,l=s.eye,u=1+(0,h.j)(l,t)/(o+i),p=Math.sqrt(u*u-1),{minCurvature:f,maxCurvature:m,minSamples:g,maxSamples:y}=pe,v=function(e){const{renderCoordsHelper:t,state:{camera:r}}=e,{center:n,eye:i}=r,a=Math.abs(t.getAltitude(n)),o=Math.abs(Math.PI/2-(0,ee.T)(t,n,i));return(0,Q.b)(we,t.referenceEllipsoid.radius+a),(0,Q.d)(we,o,r.distance,r.fovY)}(e),w=(0,c.qE)((p-f)/(m-f),0,1),M=Math.round((0,c.Cc)(g,y,w)),b=s.aboveGround,_=r.planes[P.FB.FAR],x=[],S=(0,Y.O_)(d.uY,fe,(0,Y.vt)()),R=(0,Y.O_)(d.uY,me,(0,Y.vt)());(0,q.s)(be,0,0,0,0);for(let I=0;I<4;I++){const e=I===k.r.NEAR_FAR_BOTTOM_RIGHT&&!b||I===k.r.NEAR_FAR_TOP_LEFT&&b?1-v:0,t=I===k.r.NEAR_FAR_BOTTOM_RIGHT&&b||I===k.r.NEAR_FAR_TOP_LEFT&&!b?v:1,a=r.lines[I],o=r.lines[3===I?0:I+1];for(let r=0;r<M;r++){const s=r/M,u=I===k.r.NEAR_FAR_BOTTOM_RIGHT?1-(1-s)**2:I===k.r.NEAR_FAR_TOP_LEFT?s**2:s,p=0===r?0:(0,c.Cc)(e,t,u),f=(0,h.m)(ye,a.origin,o.origin,p),m=(0,re.nu)(a.direction,o.direction,p,ge);n.intersectManifoldClosestSilhouette((0,D.LV)(f,m),i,ve),(0,E.gz)(ve,l,ve,_),x.push((0,d.o8)(ve)),0!==x.length&&(0,h.y)(x.at(-1),ve);const g=((0,Y.Tj)(S,ve)?1:0)|((0,Y.Tj)(R,ve)?2:0);be[g]=1}}x.length>2&&(0,h.y)(x[0],x.at(-1));const A=function(e,t,r){const n=2*(0,$.FD)();return e.map((e=>{const i=[];let a=!1;for(const o of e)t.fromRenderCoords(o,ve,r),Math.abs(o[0])<n&&Math.abs(o[1])<n?(i.push([null,ve[1]]),i.push([null,ve[1]]),a=!0):i.push([ve[0],ve[1]]);if(a)for(let t=0;t<i.length;t++){const e=i[t];if(null!=e[0])continue;const r=i[t+1],n=i.at(0===t?-1:t-1);e[0]=n[0],t++;const a=i.at(t===i.length-1?0:t+1);r[0]=a[0]}return i.push(i[0]),(0,T.$3)(i)||i.reverse(),i}))}((0,q.f)(be)>1?function(e,t){const r=[];for(const n of e)r.push(...de(n,t));return r}(de(x,S),R):[x],n,a);return new I.default({rings:A,spatialReference:a})},toExtent:function(e,t,r,n,i){let a,o,l,u;const h=t.latitude,d=(0,p.tO)(e.spatialReference).radius,f=t.longitude,m=(0,te.cq)(h,r,d)/2;a=f-m,o=f+m;const y=(0,c.kU)(h),v=(1+Math.sin(y))/(1-Math.sin(y)),w=(v+1)*Math.tan(n/d/2),M=w*w;function b(e){const t=Math.PI/2;return(e=s.uC.normalize(e,-t))>t&&(e=Math.PI-e),e}if(l=1.5*Math.PI-2*Math.atan(.5*(w+Math.sqrt(4*v+M))),u=l+n/d,l=b(l),u=b(u),u<l){const e=u;u=l,l=e}if(l=Math.max((0,c.KJ)(l),-90),u=Math.min((0,c.KJ)(u),90),o=ae.monotonic(a,o),o-a>180){const e=(o-a-180)/2;a+=e,o-=e}const _=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:g.default.WGS84;return i?(i.xmin=a,i.ymin=l,i.xmax=o,i.ymax=u,i.spatialReference=_):i=new R.default(a,l,o,u,_),e.spatialReference&&e.spatialReference.isWebMercator&&(0,X.geographicToWebMercator)(i,!1,i),i}},Symbol.toStringTag,{value:"Module"}));var xe=r(80935),Se=r(59801);const Re=()=>l.A.getLogger("esri.views.3d.support.cameraUtils"),Ie=96*39.37,Te=1,Pe=8,Ae=5,Fe=1,Ce={heading:0,tilt:0},Oe=(0,d.vt)(),Ne=new s.hr(-20037508.342788905,20037508.342788905),Ze=new s.hr(-180,180);var De;function ke(e){return e.spatialReference??g.default.WGS84}function Ee(e){let{state:t}=e;return t.isGlobal?_e:W}function Ge(e,t,r,n,i){return Ee(e).headingTiltToDirectionUp(t,r,n,i)}function Le(e,t){if(null==t)return null;const r=e.renderSpatialReference,n=Ee(e).headingTiltToDirectionUp,i=(0,d.vt)();if(!(0,y.g)(t.position,i,r))return null;const a=n(i,t.heading,t.tilt);(0,h.h)(a.direction,a.direction,e.state.camera.distance),(0,h.g)(a.direction,a.direction,i);const o=(0,b.bZ)(e,i,a.direction,a.up);return o.fov=(0,c.kU)(t.fov),o.row=t.layout.row,o.rows=t.layout.rows,o.column=t.layout.column,o.columns=t.layout.columns,o}!function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"}(De||(De={}));const ze=(0,d.vt)();function Ve(e,t,r){const n=e.renderSpatialReference,i=et(e,t.eye,t.viewForward,t.up,Ce);let a=ke(e);return(0,w.F)(t.eye,n,ze,a)||(a=g.default.WGS84,(0,w.F)(t.eye,n,ze,a)),null==r?r=new o.default(new f.default(ze,a),i.heading,i.tilt,(0,c.KJ)(t.fov)):(r.position.x=ze[0],r.position.y=ze[1],r.position.z=ze[2],r.position.spatialReference=a,r.heading=i.heading,r.tilt=i.tilt,r.fov=(0,c.KJ)(t.fov)),r.layout.row=t.row,r.layout.rows=t.rows,r.layout.column=t.column,r.layout.columns=t.columns,r}function je(e,t){const{camera:r}=e.state,{unitInMeters:n}=e.renderCoordsHelper;return t/=n,r.width/2/r.pixelRatio/(Ie/t)/Math.tan(r.fovX/2)}function He(e,t){const{camera:r}=e.state,{unitInMeters:n}=e.renderCoordsHelper,i=t*Math.tan(r.fovX/2),a=r.width/2/r.pixelRatio;return Ie/(a/i)*n}function Ue(e,t,r,n){const i=n.levelAtScale(t),a=We(et(e,r.eye,r.viewForward,r.up).tilt),o=Math.max(i-a,0);return n.scaleAtLevel(o)}function Be(e,t,r){const n=r.levelAtScale(e),i=We(t);return r.scaleAtLevel(n+i)}function We(e){return 2*((e>90?180-e:e)/90)**2}function qe(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=Le(e,t);return n?function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=e.basemapTerrain?.tilingScheme;if(!n)return 0;const i=(0,p.tO)(e.spatialReference).radius,a=e.state.viewingMode===M.RT.Local?t.eye[2]:(0,h.l)(t.eye)-i;return Ue(e,He(e,Math.abs(a-r)),t,n)}(e,n,r):0}const Je=1,$e=100;function Ke(e,t,r,n,i){if(0===t)return 0;const a=(0,h.j)(r.eye,n),o=e.basemapTerrain?.tilingScheme;if(!o)return Re().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),a;let s=a;const l=et(e,r.eye,r.viewForward,r.up),u=l.tilt>90;if(e.state.isLocal){const n=(je(e,Be(t,l.tilt,o))-Math.abs(r.eye[2]-i[2]))/Math.cos((0,c.kU)(l.tilt));return s=u?s-n:s+n,s}let d=1/0,f=0,m=rt(e,l.heading,l.tilt,n,a,De.ADJUST);if(!m)return s;const g=(0,h.l)(i);for(;d>Je&&f<$e;){const i=(0,h.l)(m.eye),a=u?180-m.tilt:m.tilt,y=(0,c.kU)(a),v=Math.sin(y)*i,w=Math.cos(y)*i,M=je(e,Be(t,m.tilt,o)),b=u?g-M:g+M,_=(0,c.YN)(v/b),x=Math.cos(_)*b-w,S=(0,h.j)(m.eye,n);s=u?S-x:S+x,m=rt(e,l.heading,l.tilt,n,s,De.ADJUST);const R=wt(e,m,(0,c.KJ)(r.fov));if(!m||!R)return s;const I=qe(e,R,g-(0,p.tO)(e.spatialReference).radius);d=Math.abs(t-I),++f}return s}async function Ye(e,t,r,n,i,a){return Xe(e,t,je(e,r),n,i,a)}function Qe(e,t,r,n,i,a){return wt(e,rt(e,n.heading,n.tilt,t,r,i),n.fov,a)}async function Xe(e,t,r,n,i,a){const o=await nt(e,n.heading,n.tilt,t,r,i,a);return(0,u.throwIfAborted)(a),Mt(e,o,n.fov,a)}function et(e,t,r,n,i){return Ee(e).directionToHeadingTilt(t,r,n,i)}function tt(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Oe,e.spatialReference)&&e.elevationProvider&&((0,xe.R1)(e.elevationProvider,Oe)??0)>Oe[2]-Fe)}function rt(e,t,r,n,i,a){return it(e,t,r,n instanceof f.default?n:null,function(e,t){const r=(0,d.vt)();if(null==t)return(0,h.c)(r,e.state.camera.center);if(t instanceof f.default){if(!(0,y.g)(t,r,e.renderSpatialReference))return null;const{basemapTerrain:n,elevationProvider:i}=e;if(null==t.z&&null!=n&&null!=i){const n=(0,xe.R1)(i,t);null!=n&&e.renderCoordsHelper.setAltitude(r,n)}return r}return(0,h.c)(r,t)}(e,n),i,a)}async function nt(e,t,r,n,i,a,o){const s=n instanceof f.default?n:null,l=await async function(e,t,r){const n=(0,d.vt)();if(null==t)return(0,h.c)(n,e.state.camera.center);if(t instanceof f.default){const{renderSpatialReference:i,basemapTerrain:a,elevationProvider:o}=e,s=t.spatialReference;if(await(0,y.W)(t,n,i,0,{signal:r}),(0,u.throwIfAborted)(r),null==t.z&&null!=a&&null!=o){const i=await o.queryElevation(t.x,t.y,t.z??0,s,"ground",r);(0,u.throwIfAborted)(r),null!=i&&e.renderCoordsHelper.setAltitude(n,i)}return n}return(0,h.c)(n,t)}(e,n,o);return(0,u.throwIfAborted)(o),at(e,t,r,s,l,i,a,o)}function it(e,t,r,n,i,a,o){if(null==i)return null;if(!n&&(n=new f.default({spatialReference:ke(e)}),!(0,v.E)(i,e.renderSpatialReference,n)))return null;const s=ot(e,t,r,i,a,o);if(st(e,r,o)&&tt(e,s.eye)){const{tilt:o,mode:s}=lt(e,r,i,a);return it(e,t,o,n,i,a,s)}return ct(s,i)}async function at(e,t,r,n,i,a,o,s){n||(n=new f.default({spatialReference:ke(e)}),await(0,v.C)(i,e.renderSpatialReference,n,{signal:s})||(n=null)),(0,u.throwIfAborted)(s);const l=ot(e,t,r,i,a,o);if(st(e,r,o)&&await async function(e,t,r){if(tt(e,t))return!0;const{elevationProvider:n,spatialReference:i,renderCoordsHelper:a}=e;if(null==n||!a.fromRenderCoords(t,Oe,i))return!1;const[o,s,l]=Oe,c=await n.queryElevation(o,s,l,i,"ground",r)??0;return(0,u.throwIfAborted)(r),c>l-Fe}(e,l.eye,s)){(0,u.throwIfAborted)(s);const{tilt:o,mode:l}=lt(e,r,i,a);return at(e,t,o,n,i,a,l,s)}return ct(l,i)}function ot(e,t,r,n,i,a){const o=function(e,t,r,n,i,a){let o=0;return a===De.ADJUST&&function(e,t,r){const n=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/n)/Math.LN2>Pe)return!0;const i=t,a=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return(0,h.j)(i,a)/(Math.tan(.5*e.state.camera.fov)*n)>Ae}(e,n,i)?(t=0,o=function(e,t,r,n){const i=vt(e,n,t,r);if(!e.state.constraints.tilt)return i;const a=e.state.constraints.tilt(t);a.max=Math.min(a.max,.5*Math.PI);const o=a.min*(1-gt)+a.max*gt;return Math.min(i,o)}(e,i,r,n)):o=vt(e,n,i,r),o=e.state.constraints.clampTilt(i,o),{heading:t,tilt:r=yt(e,n,i,o)}}(e,t,r,n,i=Math.max(i,e.state.constraints.minimumPoiDistance),a);return(0,Ee(e).eyeForCenterWithHeadingTilt)(n,i,o.heading,o.tilt)}function st(e,t,r){const n=e.map.ground.navigationConstraint;return r===De.ADJUST&&e.state.isGlobal&&t>0&&(null==n||"stay-above"===n.type)}function lt(e,t,r,n){const i=yt(e,r,n,function(e,t,r,n){let i=vt(e,n,t,r);if(!e.state.constraints.tilt)return i;const a=e.state.constraints.tilt(t);return i=Math.min(i,.5*Math.PI),a.min*(1-gt)+i*gt}(e,n,t,r));return{tilt:i,mode:t-i<1?De.LOCKED:De.ADJUST}}function ct(e,t){return{...e,center:(0,d.o8)(t)}}function ut(e,t){const{state:r,spatialReference:n}=e,i=t.spatialReference;return r.isGlobal&&(0,Se.M)(i,M.RT.Global)||r.isLocal&&n.equals(i)}function ht(e,t){let r,n,i;if(e.state.isGlobal){const e=new f.default(t.xmin,t.ymin,t.spatialReference),a=new f.default(t.xmax,t.ymax,t.spatialReference),o=t.spatialReference.isGeographic?Ze:Ne;r=new f.default({x:o.center(e.x,a.x),y:(a.y+e.y)/2,z:null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});const s=(0,p.tO)(t.spatialReference),l=(0,te.J_)(r,e,a);n=l.lon,i=l.lat,o.diff(e.x,a.x)>o.range/2&&(n+=s.halfCircumference),n=Math.min(n,s.halfCircumference),i=Math.min(i,s.halfCircumference)}else{const a=e.renderSpatialReference??t.spatialReference;a.equals(t.spatialReference)||(t=(0,m.project)(t,a)),n=t.xmax-t.xmin,i=t.ymax-t.ymin;const o=null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0;r=new f.default({x:t.xmin+.5*n,y:t.ymin+.5*i,z:o,spatialReference:a})}const a=null!=t.zmax&&null!=t.zmin?t.zmax-t.zmin:0,o=e.state.camera,s=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:r,distance:Math.max(.5*n*s,.5*i*l,.5*a*c)/Te}}async function dt(e,t,r,n,i,a){const o=ut(e,t)?t:await(0,m.projectWithZConversion)(t,e.spatialReference,{signal:a});(0,u.throwIfAborted)(a);const{center:s,distance:l}=ht(e,o),c=await nt(e,r,n,s,l,i,a);return(0,u.throwIfAborted)(a),Mt(e,c,e.camera.fov,a)}function pt(e,t,r,n,i,a){let o;try{o=ut(e,t)?t:(0,m.project)(t,e.spatialReference)}catch(u){return null}const{center:s,distance:l}=ht(e,o),c=rt(e,r,n,s,l,i);return null==c?null:wt(e,c,e.camera.fov,a)}function ft(e,t,r){const n=e.renderSpatialReference,i=new f.default({spatialReference:ke(e)});if(!(0,v.E)(r,n,i))return null;const a=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),s=(0,h.G)(t.eye,r),l=2*s*a*Te,c=2*s*o*Te;return Ee(e).toExtent(e,i,l,c)}function mt(e,t){return Ee(e).toArea(e,t)}const gt=.7;function yt(e,t,r,n){return Ee(e).lookAtTiltToEyeTilt(n,t,r)}function vt(e,t,r,n){return Ee(e).eyeTiltToLookAtTilt(n,t,r)}function wt(e,t,r,n){if(null==t)return null;const i=e.renderSpatialReference,a=new f.default({spatialReference:ke(e)});return(0,v.E)(t.eye,i,a)?(n??=new o.default,n.position=a,n.heading=t.heading,n.tilt=t.tilt,n.fov=r,n):null}async function Mt(e,t,r,n){const i=e.renderSpatialReference,a=new f.default({spatialReference:ke(e)});return await(0,v.C)(t.eye,i,a,{signal:n}),(0,u.throwIfAborted)(n),new o.default(a,t.heading,t.tilt,r)}function bt(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.levelAtScale(t);Re().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function _t(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.scaleAtLevel(t);Re().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}},84687:(e,t,r)=>{r.d(t,{HD:()=>l,Rt:()=>c,bZ:()=>u});var n=r(20664),i=r(9392),a=r(34111),o=r(2413),s=r(29808);function l(e,t,r,n){return null!=e.renderCoordsHelper.fromRenderCoords(t.eye,p,n)&&(0,o.Uc)(r,p)}function c(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function u(e,t,r,i){const o=e.state.camera.clone();t&&r&&i&&(o.eye=t,o.center=r,o.up=i),function(e,t,r){let i=d[e.viewingMode];i||(i=(0,s.hz)(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,d[e.viewingMode]=i);const{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,i,r)||h(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||h(e,t.origin,r))||!!o&&function(e,t,r){const i=(0,n.f)(e.origin,e.origin)-r*r,a=i>0?Math.sqrt(i)/3:1;return(0,n.h)(t,e.direction,a/(0,n.l)(e.direction)),(0,n.g)(t,t,e.origin),!0}(t,r,(0,a.tO)(e.spatialReference).radius)}(e,o.ray,f)||(0,n.c)(f,o.center);const l=e.state.constraints,c=l.minimumPoiDistance;if((0,n.s)(o.eye,f)<c){const t=l.collision.enabled;(0,n.c)(m,o.viewForward),(0,n.h)(m,m,c),t?o.eye=(0,n.d)(p,f,m):(0,n.g)(f,o.eye,m);const r=e.renderCoordsHelper,i=r.getAltitude(o.eye),a=l.collision.elevationMargin;t&&i<a&&((0,n.d)(m,f,o.eye),o.eye=r.setAltitude(p,a,o.eye),(0,n.g)(f,o.eye,m))}return o.center=f,o}function h(e,t,r){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=c(e,t),a=e.stateManager.constraintsManager.nearFarHeuristic,{far:o}=a.compute(t,r,e.renderDataExtent,i,g),s=o*o;return(0,n.s)(t,r)>s}const d={},p=(0,i.vt)(),f=(0,i.vt)(),m=(0,i.vt)(),g={near:0,far:0}},86017:(e,t,r)=>{r.d(t,{Eh:()=>S,PT:()=>N,WD:()=>F,ns:()=>b,nt:()=>T,v3:()=>A});var n=r(50346),i=r(44680),a=r(9392),o=r(63919),s=r(20664),l=r(70961),c=r(10851),u=r(66388),h=r(65215),d=r(9624),p=r(13312),f=r(14556),m=r(79629),g=r(56623),y=r(13927),v=r(80963),w=r(97572);const M=Math.PI/180;function b(e){return e.isSpherical?function(e){const{geometry:t,farDistance:r,objectId:n,nearDistance:i,cameraHeight:a}=e,o=(0,w.i2)(t.y,t.spatialReference),s=new l.default({center:t.clone(),radius:r*o});if(s.imageID=n,i){const e=new l.default({center:t.clone(),radius:i*o});s.addRing(e.rings[0])}const u=t.clone();u.z=a-r*o;const h=c.default.createSphere(u,{size:2*r*o});return h.imageID=n,{polygon:s,frustum:h}}(e):function(e){const{horizontalFieldOfView:t,verticalFieldOfView:r,geometry:n,cameraHeading:i}=e,a=(0,w.i2)(n.y,n.spatialReference);let o=e.cameraPitch,s=e.cameraRoll??0,l=150;t>150&&(o=90,s=0,l=5);const c=Math.ceil(t/l),u=function(e,t,r){const n=[];if(e%2==0)for(let i=0;i<e/2;i++)n.push(t-r/e*(i+.5),t+r/e*(i+.5));else{n.push(t);for(let i=1;i<e/2;i++)n.push(t-r/e*i,t+r/e*i)}return n.sort(),n}(c,i,t);let d=e.farDistance?e.farDistance*a:e.cameraHeight*a/Math.cos(o*M);e.cameraPitch+r/2>=90&&(d=(e.farDistance||20)*a);const p=new h.default({spatialReference:n?.spatialReference});p.imageID=e.objectId;let f=null;for(const h of u)f=_(h,o,e.cameraHeight,n,d,a,r,t,c,p,s,e.nearDistance);return f.imageID=e.objectId,{polygon:p,frustum:f}}(e)}function _(e,t,r,n,l,c,u,h,d,p){let f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0;const g=(0,o.mg)((0,i.vt)(),(0,w._i)([e,t,f??0])),y=I({cameraHeight:r,cameraPitch:t,farDistance:l,location:n,horizontalFieldOfView:h,nearDistance:m,verticalFieldOfView:u},g),v=(0,w.ei)([0,0,-1],g),{x:b,y:_}=n,S=(0,w.MY)([b,_,r],v,l,c),R=2*Math.tan(u*M/2)*l,T=2*Math.tan(h/d*M/2)*l,P=(0,w.ei)([0,1,0],g),A=(0,w.ei)([1,0,0],g),F=(0,w.Qu)(P,R/2,c),C=(0,w.Qu)(A,T/2,c),O=(0,s.a)((0,a.Ul)(),F,C),N=(0,s.g)((0,a.Ul)(),F,C),Z=x([(0,s.g)((0,a.Ul)(),S,O),(0,s.g)((0,a.Ul)(),S,N),(0,s.a)((0,a.Ul)(),S,O),(0,s.a)((0,a.Ul)(),S,N)],r,n,c);return Z.push(Z[0]),p.addRing(Z),y}function x(e,t,r,n){return e.map((e=>function(e,t,r,n){{const i=Math.sqrt((e[2]-t)**2+(Math.sqrt((e[0]-r.x)**2+(e[1]-r.y)**2)/n)**2)*n,o=(0,w.Qu)((0,s.a)((0,a.Ul)(),[e[0],e[1],e[2]],[r.x,r.y,t]),1/i,1/n),l=t/(t-e[2]),c={x:(1-l)*r.x+l*e[0],y:(1-l)*r.y+l*e[1],z:(1-l)*t+l*e[2]},u=Math.sqrt((c.z-t)**2+(Math.sqrt((c.x-r.x)**2+(c.y-r.y)**2)/n)**2)*n,h=(0,w.Qu)((0,s.a)((0,a.Ul)(),[c.x,c.y,c.z],[r.x,r.y,t]),1/u,1/n);return R(o[0],h[0])&&R(o[1],h[1])&&R(o[2],h[2])||e[2]>=0?[e[0],e[1],0]:[c.x,c.y,c.z]}}(e,t,r,n)))}function S(e,t){return e.contains(t)}function R(e,t){return Math.sign(e)!==Math.sign(t)}function I(e,t,r){const{cameraHeight:n,cameraPitch:i,farDistance:o,location:l,horizontalFieldOfView:u,nearDistance:h,verticalFieldOfView:d}=e,p=P(l),f=i+d/2>=90==0,m=2*Math.tan(d*M/2)*h,y=2*Math.tan(u*M/2)*h,v=2*Math.tan(d*M/2)*o,b=2*Math.tan(u*M/2)*o;let _,x;x=[0,0,-1],x=(0,w.ei)(x,t),_=(0,w.MY)([l.x,l.y,n],x,o,p),f&&(_[2]=0);const S=(0,w.MY)([l.x,l.y,n],x,h,p);let R=[0,1,0];R=(0,w.ei)(R,t);let I=[1,0,0];I=(0,w.ei)(I,t);let T=[],A=[];h?(A=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],T=T.concat((0,s.g)((0,a.Ul)(),S,(0,s.a)((0,a.Ul)(),(0,w.Qu)(R,m/2,p),(0,w.Qu)(I,y/2,p)))),T=T.concat((0,s.g)((0,a.Ul)(),S,(0,s.g)((0,a.Ul)(),(0,w.Qu)(R,m/2,p),(0,w.Qu)(I,y/2,p)))),T=T.concat((0,s.a)((0,a.Ul)(),S,(0,s.a)((0,a.Ul)(),(0,w.Qu)(R,m/2,p),(0,w.Qu)(I,y/2,p)))),T=T.concat((0,s.a)((0,a.Ul)(),S,(0,s.g)((0,a.Ul)(),(0,w.Qu)(R,m/2,p),(0,w.Qu)(I,y/2,p))))):(T=[l.x,l.y,n],A=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),T=T.concat((0,s.g)((0,a.Ul)(),_,(0,s.a)((0,a.Ul)(),(0,w.Qu)(R,v/2,p),(0,w.Qu)(I,b/2,p)))),T=T.concat((0,s.g)((0,a.Ul)(),_,(0,s.g)((0,a.Ul)(),(0,w.Qu)(R,v/2,p),(0,w.Qu)(I,b/2,p)))),T=T.concat((0,s.a)((0,a.Ul)(),_,(0,s.a)((0,a.Ul)(),(0,w.Qu)(R,v/2,p),(0,w.Qu)(I,b/2,p)))),T=T.concat((0,s.a)((0,a.Ul)(),_,(0,s.g)((0,a.Ul)(),(0,w.Qu)(R,v/2,p),(0,w.Qu)(I,b/2,p))));const F=new g.H({position:Float64Array.from(T)});return new c.default({vertexAttributes:F,components:A,spatialReference:l.spatialReference})}function T(e){const{spatialReference:t,x:r,y:n}=e.geometry,{cameraHeading:i,cameraPitch:a,farDistance:o,nearDistance:s}=e,l=P(e.geometry),c=new h.default({spatialReference:t}),u=Math.abs(1.44*o*l);let d=Math.abs(1.44*s*l);(a<20||null==i)&&(d=u);const p=[];return p[0]={x:r+u*Math.sin((i-45)*M),y:n+u*Math.cos((i-45)*M)},p[1]={x:r+u*Math.sin((i+45)*M),y:n+u*Math.cos((i+45)*M)},p[2]={x:r+d*Math.sin((i+135)*M),y:n+d*Math.cos((i+135)*M)},p[3]={x:r+d*Math.sin((i+225)*M),y:n+d*Math.cos((i+225)*M)},c.addRing([[p[0].x,p[0].y,0],[p[1].x,p[1].y,0],[p[2].x,p[2].y,0],[p[3].x,p[3].y,0],[p[0].x,p[0].y,0]]),c}function P(e){return e&&(0,v.K8)(e?.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/f.$O.radius))):1}function A(e,t){const r=1+t/100;if("esri.geometry.Circle"===e.declaredClass){const{radius:t,center:n}=e,i=new l.default({radius:t*r,center:n});return e.rings.length>1&&i.addRing(e.rings[1]),i}if("esri.geometry.Polygon"===e.declaredClass){const t=new h.default({spatialReference:e.spatialReference}),n=e.centroid;if(n){const i=[];for(let t=0;t<e.rings[0].length;t++){const o=Math.sqrt((n.x-e.rings[0][t][0])**2+(n.y-e.rings[0][t][1])**2),l=(0,w.Qu)((0,s.a)((0,a.Ul)(),[e.rings[0][t][0],e.rings[0][t][1],0],[n.x,n.y,0]),1/o,1),c=(0,w.MY)([n.x,n.y,0],l,o*r,1);i.push({x:c[0],y:c[1]})}t.addRing([[i[0].x,i[0].y,0],[i[1].x,i[1].y,0],[i[2].x,i[2].y,0],[i[3].x,i[3].y,0],[i[0].x,i[0].y,0]])}return t}return e}async function F(e,t,r){const{cameraHeight:n,cameraLocation:i,cameraPitch:a,frustumVertices:o,horizontalFieldOfView:s,imageHeight:l,imageWidth:u,inSRS:h,outSRS:d,verticalFieldOfView:f,cameraRoll:m,options:y}=r,v=new p.default(h),M=new p.default(d),b=(0,w.x1)(s,f,m??0),_=o.length>15;return a+b.vfov/2>=90?await async function(e,t,r,n,i,a,o,s){let l,u=o?new Array:[e[0],e[1],e[2]],h=new Array;for(const c of t)o?(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[r,0,1],[r,n,1],[0,n,1]],[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]]]),u=u.concat(...l),l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[r,0,1],[r,n,1],[0,n,1]],[[e[12],e[13],e[14]],[e[15],e[16],e[17]],[e[18],e[19],e[20]],[e[21],e[22],e[23]]]),h=h.concat(...l)):(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[r,0,1],[r,n,1],[0,n,1]],[[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]],[e[12],e[13],e[14]]]),u=u.concat(...l));u=u.concat(h);const d=await N(u,i,a,s),p=G(d);return new c.default({vertexAttributes:new g.H({position:d}),components:E(o?D(p,!0):k(p,!0)),spatialReference:a})}(o,e,u,l,v,M,_,y):await async function(e,t,r,n,i,a,o,s,l){const u=function(e,t,r,n,i){const a=Z(e),o=Z(e,"near");if(!a)return;const s=t.length;for(let l=0;l<s;l++){const e=Array.from(r[l]),t=[e[0]-n[0],e[1]-n[1],e[2]-(n[2]??i)];O(n,t,l,o),C(n,t,l,a)}return{farPlane:a,nearPlane:o}}(e,t,r,n,i);if(!u)return;const{farPlane:h,nearPlane:d}=u,p=await N([...d?.vertexPositions??e.slice(0,3),...h.vertexPositions],o,s,l),f=G(p);return new c.default({vertexAttributes:new g.H({position:p}),components:E(a?D(f,!0):k(f,!0)),spatialReference:s})}(o,e,t,i,n,_,v,M,y)}function C(e,t,r,n){const{coefficients:i,vertexPositions:o}=n,s=(0,a.Ul)();(0,y.Ui)(i,{origin:e,direction:t},s)&&o.splice(3*r,3,...s)}function O(e,t,r,n){if(!n)return;const i=(0,a.Ul)();(0,y.Ui)(n.coefficients,{origin:e,direction:t},i)&&n.vertexPositions.splice(3*r,3,...i)}async function N(e,t,r,i){if(t.equals(r))return e;const a=e.reduce(((e,t,r)=>{const n=Math.floor(r/3);return e[n]||(e[n]=new Array),e[n].push(t),e}),new Array),{points:o}=await(0,d.projectWithZConversion)(new u.default(a,t),r,i);return(0,n.throwIfAborted)(i),o.flat()}function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"far";const r=(0,y.vt)();let n;switch(t){case"far":if(n=Array.from(15===e.length?e.slice(3):e.slice(12)),(0,y.ci)(r,n,!1))return{coefficients:r,vertexPositions:n};break;case"near":if(n=Array.from(e.slice(0,12)),15===e.length||!(0,y.ci)(r,n,!1))return;return{coefficients:r,vertexPositions:n}}}const D=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&e-2<=4||e<=4||e%2!=0)throw new Error("Invalid number of vertices");const r=[],n=e/2,i=Math.round((t?e-2:e)/2);for(let a=0;a<i;a++){const i=a+n,o=t?i+1:i,s=o%e,l=(t?i:o+1)%e;r.push({faces:new Uint32Array([a,l,s,a,a+1,s])})}return r};function k(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<3||t&&e-1<3)throw new Error("Invalid number of vertices");const r=[],n=t?e-2:e-1;for(let i=0;i<n;i++)r.push({faces:new Uint32Array([0,i+1,i+2])});return r}const E=e=>e.map((e=>new m.default(e))),G=e=>e.length/3},96866:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(98264),i=r(19247);class a extends n.A{constructor(e,t,r,n,i,a){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=t,this._hasZ=r,this._hasM=n,this._cacheId=i,this._partId=a}get(e){if(void 0===this._lazyPt[e]){const t=this._elements[e];if(void 0===t)return;const r=new i.default(t[0],t[1],this._spRef);this._hasZ&&(r.z=t[2]),this._hasM&&(r.m=this._hasZ?t[3]:t[2]),r.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=r}return this._lazyPt[e]}equalityTest(e){return e===this||null!==e&&e instanceof a!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}},98264:(e,t,r)=>{r.d(t,{A:()=>n});class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._elements=e}length(){return this._elements.length}get(e){return this._elements[e]}toArray(){return this.slice()}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length();const r=[];for(let n=e;n<t;n++)r.push(this.get(n));return r}}},99464:(e,t,r)=>{r.d(t,{DV:()=>p,Qv:()=>f,gE:()=>h,gl:()=>d,jQ:()=>m,zT:()=>g});var n=r(39356),i=r(50076),a=r(65215),o=r(19902),s=r(97572),l=r(44538),c=r(19562);function u(e,t,r){const n=e.toLowerCase(),i=t.toLowerCase()===n,a=r?.toLowerCase()===n;return(0,s.or)(i,a)}function h(e,t,r){return function(e){return"point"===e||"polygon"===e||"polyline"===e}(e.geometryType)&&2===e.fields.filter((e=>{let{name:n,type:i,alias:a}=e;return u(r?.length?r:l.uS,n,a)||u(t?.length?t:l.j5,n,a)&&"blob"===i})).length}function d(e){return"feature"===e.type&&function(e){return"point"===e.geometryType||"polygon"===e.geometryType||"polyline"===e.geometryType}(e)}function p(e,t,r){if(!e)return;const{renderer:n}=e,i=(0,c.dg)(t),a=n?"symbol"in n?n.symbol:"defaultSymbol"in n?n.defaultSymbol:n.getSymbol():null,o=i(a?.color);r[`${t}Symbol`]=(t===e.geometryType?a:null)??o}function f(e,t,r){const n=e.fields.find((e=>{let{name:r,alias:n,type:i}=e;return u(t?.length?t:l.j5,r,n)&&"blob"===i})),a=e.fields.find((e=>{let{name:t,alias:n}=e;return u(r?.length?r:l.uS,t,n)}));if(!n||!a)throw new i.default("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:n,oiObjectIdField:a});return{imageGeometryField:n,oiObjectIdField:a}}function m(e,t,r,a,s,l,u){let h=function(e,t){const{geometry:r}=JSON.parse(atob(e[t]));return(0,o.fromJSON)(r)}(e,t);if(!h)throw new i.default("InvalidGeometry");return h=function(e,t,r){switch(t){case"default":return function(e){switch(e.type){case"point":e.x-=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,r]=e;return[t-.5,.5-r]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,r]=e;return[t-.5,.5-r]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,r]=e;return[t-.5,.5-r]}));break;case"extent":e.xmin-=.5,e.xmax-=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return v(e,r)}}(h,l,s),new n.default({attributes:e,layer:r,symbol:(0,c.ph)(h.type,r.geometryType,u),geometry:h,visible:r.visible&&a})}function g(e,t,r){switch(t){case"default":return function(e){switch(e.type){case"point":e.x+=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,r]=e;return[t+.5,.5-r]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,r]=e;return[t+.5,.5-r]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,r]=e;return[t+.5,.5-r]}));break;case"extent":e.xmin+=.5,e.xmax+=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return y(e,r)}}function y(e,t){switch(e.type){case"point":{const{x:r,y:n}=(0,s.pq)(e,t[0],t[1]);e.x=r,e.y=n,delete e.z;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const{x:r,y:n}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[r,n]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const{x:r,y:n}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[r,n]}))));break;case"multipoint":e.points=e.points.map((e=>{const{x:r,y:n}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[r,n]}));break;case"extent":{const{xmin:r,xmax:n,ymin:i,ymax:o}=y(a.default.fromExtent(e),t).extent;e.xmax=n,e.xmin=r,e.ymax=o,e.ymin=i;break}}return e}function v(e,t){switch(e.type){case"point":{const[r,n,i]=(0,s.D5)(e,t[0],t[1]);e.x=r,e.y=n,e.z=i;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const[r,n,i]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[r,n,i]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const[r,n,i]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[r,n,i]}))));break;case"multipoint":e.points=e.points.map((e=>{const[r,n,i]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[r,n,i]}));break;case"extent":{const{xmin:r,xmax:n,ymin:i,ymax:o}=v(a.default.fromExtent(e),t).extent;e.xmax=n,e.xmin=r,e.ymax=o,e.ymin=i}}return e}},99767:(e,t,r)=>{r.d(t,{T:()=>o});var n=r(15941),i=r(20664),a=r(9392);function o(e,t,r){e.worldUpAtPosition(t,s),(0,i.d)(l,r,t);const a=(0,i.l)(l);return 0===a?0:(0,n.XM)((0,i.f)(l,s)/a)}const s=(0,a.vt)(),l=(0,a.vt)()}}]);
//# sourceMappingURL=4905.a54c1d70.chunk.js.map