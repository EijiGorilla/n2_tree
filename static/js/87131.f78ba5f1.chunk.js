"use strict";(self.webpackChunkn2_tree=self.webpackChunkn2_tree||[]).push([[27980,87131],{27980:(t,e,s)=>{s.r(e),s.d(e,{default:()=>c});var i=s(35143),n=s(39356),a=s(91967),o=s(46053),l=(s(81806),s(76460),s(47249),s(85842)),r=s(19247);let h=class extends a.default{constructor(t){super(t),this.location=null,this.intersectedLocation=null,this.intersectedGraphic=null,this.visible=void 0}};(0,i._)([(0,o.MZ)({type:r.default})],h.prototype,"location",void 0),(0,i._)([(0,o.MZ)({type:r.default})],h.prototype,"intersectedLocation",void 0),(0,i._)([(0,o.MZ)({type:n.default})],h.prototype,"intersectedGraphic",void 0),(0,i._)([(0,o.MZ)({type:Boolean})],h.prototype,"visible",void 0),h=(0,i._)([(0,l.$)("esri.widgets.LineOfSight.LineOfSightTarget")],h);const c=h},29078:(t,e,s)=>{s.d(e,{D:()=>w});var i,n,a=s(35143),o=s(91967),l=s(98773),r=(s(81806),s(76460)),h=s(30726),c=s(50346),d=s(68134),y=s(46053),u=(s(47249),s(85842));(n=i||(i={}))[n.PENDING=0]="PENDING",n[n.WAIT_FOR_VIEW_READY=1]="WAIT_FOR_VIEW_READY",n[n.RUNNING=2]="RUNNING";let w=class extends o.default{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.view=null,this.analysisView=null,this._reconnectViewTask=null,this._forceInteractiveHandle=null,this._parentChangeFromReconnect=!1,this._startUserOperation=null;const e=t?.analysis;null!=e?this.analysis=e:(this._set("analysis",this.constructAnalysis()),this._set("isAnalysisOwner",!0)),null!=t?.visible&&(this.visible=t.visible)}normalizeCtorArgs(t){const{analysis:e,...s}=t;return s}initialize(){this.addHandles([(0,d.watch)((()=>({readyAndNotSupported:null!=this.view&&this.view.ready&&!this.supported})),(t=>{let{readyAndNotSupported:e}=t;e&&r.A.getLogger(this).errorOnce(this.unsupportedErrorMessage)}),d.syncAndInitial),(0,d.watch)((()=>this.analysis?.parent),(t=>{this._parentChangeFromReconnect||t===this.view||this._set("isAnalysisOwner",!1);const e=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,e&&this._scheduleViewReconnect()}),d.sync),(0,d.watch)((()=>({view:this.view,ready:null!=this.view&&this.view.ready,supported:this.supported})),((t,e)=>{let{view:s}=t;const i=e?.view;s!==i&&(this._startUserOperation=(0,h.DC)(this._startUserOperation),this._disconnectFromView(i)),this._scheduleViewReconnect()}),d.syncAndInitial)])}destroy(){this._reconnectViewTask=(0,h.DC)(this._reconnectViewTask),this._startUserOperation=(0,h.DC)(this._startUserOperation),null!=this.analysisView&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),this._set("view",null),null!=this.analysis&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set("analysis",null))}get supported(){return null==this.view||this.view.type===this.supportedViewType}set visible(t){this._set("visible",t),null!=this.analysisView&&(this.analysisView.visible=t)}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}set analysis(t){t!==this._get("analysis")&&(this._startUserOperation=(0,h.DC)(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(t),this._scheduleViewReconnect())}get ready(){return null!=this.analysisView&&!this.connectingToView}get connectingToView(){return null!=this._reconnectViewTask}get isAnalysisOwner(){return this._get("isAnalysisOwner")}get tool(){return null!=this.analysisView?this.analysisView.tool:null}clear(){this._startUserOperation=(0,h.DC)(this._startUserOperation),this._resetInteractiveCreationState(),null!=this.tool&&null!=this.view&&this.view.activeTool===this.tool&&(this.view.activeTool=null)}async start(){if(!this.visible)return void r.A.getLogger(this).warn("Cannot start analysis when not visible");this.clear();const t={task:null,abort:null,state:i.PENDING},e=(0,l.UT)((async e=>{if(t.state=i.WAIT_FOR_VIEW_READY,await(0,d.whenOnce)((()=>this.ready),e),t.state=i.RUNNING,null==this.analysisView||null==this.view)return;const s=this.analysisView.tool;null!=s&&(this.view.activeTool=s,(0,d.when)((()=>s.created),(()=>{s.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0}))}));return t.task=e,t.abort=()=>e.abort(),this._startUserOperation=t,e.promise}onConnectToAnalysisView(t){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=(0,h.DC)(this._reconnectViewTask);const t=(0,l.UT)((async e=>{try{await this._reconnectView(e)}catch(s){if((0,c.throwIfAborted)(e),!(0,c.isAbortError)(s))return void r.A.getLogger(this).warn("Failed to use analysis in view model",s);throw s}finally{t===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=t}async _reconnectView(t){const{view:e}=this,s=null!=e&&e.ready&&this.supported,i=this.analysis;if(this._startUserOperation=v(this._startUserOperation),this._disconnectFromView(e),s&&null!=e&&null!=i){if(this.isAnalysisOwner){if(null!=i.parent)return void r.A.getLogger(this).errorOnce("expected owned analysis to have null parent when connecting to view");this._parentChangeFromReconnect=!0,e.analyses.add(i)}this.analysisView=await e.whenAnalysisView(i),(0,c.isAborted)(t)?this._startUserOperation=v(this._startUserOperation):(this.analysisView.visible=this.visible,this._forceInteractiveHandle=this.analysisView.forceInteractiveForViewModel(),this.addHandles(this._forceInteractiveHandle),this.onConnectToAnalysisView(this.analysisView))}}_disconnectFromView(t){null!=t&&this.isAnalysisOwner&&t.analyses.includes(this.analysis)&&(this._parentChangeFromReconnect=!0,this.analysis.clear(),t.analyses.remove(this.analysis)),this.onDisconnectFromAnalysisView(),this._forceInteractiveHandle=(0,h.xt)(this._forceInteractiveHandle),this.analysisView=null}_setExternalAnalysis(t){null==this.analysisView||this.isAnalysisOwner||(this.analysisView.visible=void 0,this._forceInteractiveHandle=(0,h.xt)(this._forceInteractiveHandle)),this.analysisView=null,this._set("isAnalysisOwner",!1),this._set("analysis",t),this._parentChangeFromReconnect=!1}_resetInteractiveCreationState(){this.analysis.clear(),null!=this.tool&&this.tool.resetCreated()}get testInfo(){}};function v(t){return null!=t&&t.state>=i.RUNNING?(t.abort(),null):t}(0,a._)([(0,y.MZ)()],w.prototype,"supported",null),(0,a._)([(0,y.MZ)()],w.prototype,"view",void 0),(0,a._)([(0,y.MZ)({type:Boolean,value:!0})],w.prototype,"visible",null),(0,a._)([(0,y.MZ)()],w.prototype,"active",null),(0,a._)([(0,y.MZ)()],w.prototype,"disabled",null),(0,a._)([(0,y.MZ)({nonNullable:!0})],w.prototype,"analysis",null),(0,a._)([(0,y.MZ)()],w.prototype,"analysisView",void 0),(0,a._)([(0,y.MZ)()],w.prototype,"ready",null),(0,a._)([(0,y.MZ)()],w.prototype,"connectingToView",null),(0,a._)([(0,y.MZ)({readOnly:!0})],w.prototype,"isAnalysisOwner",null),(0,a._)([(0,y.MZ)()],w.prototype,"_reconnectViewTask",void 0),(0,a._)([(0,y.MZ)()],w.prototype,"_forceInteractiveHandle",void 0),(0,a._)([(0,y.MZ)()],w.prototype,"tool",null),w=(0,a._)([(0,u.$)("esri.widgets.support.AnalysisViewModel")],w)},87131:(t,e,s)=>{s.r(e),s.d(e,{default:()=>T});var i=s(35143),n=s(12245),a=s(78059),o=s(60664),l=s(19276),r=s(3975),h=s(54901),c=(s(81806),s(68134)),d=s(46053),y=(s(76460),s(47249),s(85842)),u=s(19247),w=s(12482),v=s(27980),p=s(29078);const _=l.default.ofType(v.default);let g=class extends p.D{constructor(t){super(t),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="LineOfSightViewModel is only supported in 3D views.",this._vmTargetsToConnection=new Map,this._analysisTargetsToConnection=new Map}initialize(){this.addHandles([this.targets.on("after-add",(t=>this._onViewModelTargetAdded(t.item))),this.targets.on("after-remove",(t=>this._onViewModelTargetRemoved(t.item))),(0,c.watch)((()=>this.analysis),(t=>this._onAnalysisChange(t)),c.syncAndInitial)])}destroy(){this._analysisTargetsToConnection.forEach((t=>t.remove()))}get state(){return this.disabled||!this.ready?"disabled":null==this.tool?"ready":this.tool.state}get observer(){const{observer:t}=this.analysis;return null==t?.position?null:this._convertAnalysisPointToAbsoluteHeight(t.position,t.elevationInfo)}set observer(t){let e=null;t&&(e=t.clone(),e.hasZ||(e.z=0)),this.analysis.observer=new a.default({position:e})}get targets(){return this._get("targets")||new _}set targets(t){this._set("targets",(0,r.V)(t,this.targets,_))}continue(){null!=this.tool&&this.tool.continue()}stop(){null!=this.tool&&this.tool.stop()}get testInfo(){}constructAnalysis(){return new n.default}async onConnectToAnalysisView(t){this.addHandles([t.on("result-changed",(t=>{const e=this._analysisTargetsToConnection.get(t.target);e&&(null!=t.result?(e.viewModelTarget.intersectedGraphic=t.result.intersectedGraphic,e.viewModelTarget.intersectedLocation=t.result.intersectedLocation,e.viewModelTarget.visible=t.result.visible):(e.viewModelTarget.intersectedGraphic=null,e.viewModelTarget.intersectedLocation=null,e.viewModelTarget.visible=void 0))}))],"view")}onDisconnectFromAnalysisView(){this.removeHandles("view")}_onViewModelTargetAdded(t){if(this._vmTargetsToConnection.get(t))return;const e=new o.default({position:t.location});this._connectViewModelWithAnalysisTarget(t,e),this.analysis.targets.add(e)}_onViewModelTargetRemoved(t){const e=this._vmTargetsToConnection.get(t);e&&(e.remove(),this.analysis.targets.remove(e.analysisTarget))}_onAnalysisTargetAdded(t){if(this._analysisTargetsToConnection.get(t))return;const{position:e}=t,s=new v.default({location:e?this._convertAnalysisPointToAbsoluteHeight(e,t.elevationInfo):null});this._connectViewModelWithAnalysisTarget(s,t),this.targets.add(s)}_onAnalysisTargetRemoved(t){const e=this._analysisTargetsToConnection.get(t);e&&(e.remove(),this.targets.remove(e.viewModelTarget))}_connectViewModelWithAnalysisTarget(t,e){let s=!1;const i=(0,h.vE)([(0,c.watch)((()=>({position:e.position,elevationInfo:e.elevationInfo})),(e=>{let{position:i,elevationInfo:n}=e;s||(s=!0,t.location=i?this._convertAnalysisPointToAbsoluteHeight(i,n):null,s=!1)}),c.sync),(0,c.watch)((()=>t.location),(t=>{if(!s){s=!0;let i=null;t&&(i=t.clone(),i.hasZ||(i.z=0)),e.position=i,e.elevationInfo=null,s=!1}}),c.sync)]),n={analysisTarget:e,viewModelTarget:t,remove:()=>{i.remove(),this._vmTargetsToConnection.delete(t),this._analysisTargetsToConnection.delete(e)}};this._vmTargetsToConnection.set(t,n),this._analysisTargetsToConnection.set(e,n)}_onAnalysisChange(t){const e="analysis";this.removeHandles(e),this.addHandles([this.analysis.targets.on("after-add",(t=>this._onAnalysisTargetAdded(t.item))),this.analysis.targets.on("after-remove",(t=>this._onAnalysisTargetRemoved(t.item)))],e),this.targets.removeAll(),t.targets.forEach((t=>{this._onAnalysisTargetAdded(t)}))}_convertAnalysisPointToAbsoluteHeight(t,e){const s=t.clone();if(null!=this.view){const i=(0,w.bK)(t.hasZ,e);s.z=(0,w.wS)(this.view,t,i,w.qt)}return s}};(0,i._)([(0,d.MZ)({type:n.default})],g.prototype,"analysis",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],g.prototype,"state",null),(0,i._)([(0,d.MZ)({type:u.default})],g.prototype,"observer",null),(0,i._)([(0,d.MZ)({type:_,cast:r.H,nonNullable:!0})],g.prototype,"targets",null),g=(0,i._)([(0,y.$)("esri.widgets.LineOfSight.LineOfSightViewModel")],g);const T=g}}]);
//# sourceMappingURL=87131.f78ba5f1.chunk.js.map