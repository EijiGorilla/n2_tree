{"version":3,"file":"static/js/22665.ec2efc67.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js","../node_modules/@arcgis/core/layers/graphics/sources/support/sourceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{throwIfAborted as a,isAbortError as s}from\"../../../core/promiseUtils.js\";import o from\"../../../core/Warning.js\";import{equals as n}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as i,convertToGeometry as u}from\"../featureConversionUtils.js\";import{executeQueryForSnapping as l}from\"../data/executeQueryForSnapping.js\";import h from\"../data/FeatureStore.js\";import{checkProjectionSupport as c,project as m}from\"../data/projectionSupport.js\";import{QueryEngine as p}from\"../data/QueryEngine.js\";import{validateGeoJSON as g,createOptimizedFeatures as d}from\"./geojson/geojson.js\";import{mixAttributes as f}from\"./support/sourceUtils.js\";import{getGetFeatureSpatialReference as y,getFeatureCount as _,getFeature as x}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";import{isNumber as C}from\"../../../support/guards.js\";import{utc as R}from\"../../../time/constants.js\";const F=\"esri.layers.WFSLayer\";class S{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r={}){const{getFeatureUrl:s,getFeatureOutputFormat:o,fields:n,geometryType:i,featureType:u,maxRecordCount:l,maxTotalRecordCount:m,maxPageCount:g,objectIdField:d,customParameters:f}=e,{spatialReference:_,getFeatureSpatialReference:x}=y(s,u,e.spatialReference);try{await c(x,_)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{inSpatialReference:x,outSpatialReference:_})}a(r),this._customParameters=f,this._featureType=u,this._fieldsIndex=w.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some((e=>\"esriFieldTypeDate\"===e.type))?{timeZoneIANA:R}:null}),this._geometryType=i,this._getFeatureUrl=s,this._getFeatureOutputFormat=o,this._getFeatureSpatialReference=x,this._maxRecordCount=l,this._maxTotalRecordCount=m,this._maxPageCount=g,this._objectIdField=d,this._spatialReference=_;let C=await this._snapshotFeatures(r);if(C.errors.length>0&&(this._supportsPagination=!1,C=await this._snapshotFeatures(r),C.errors.length>0))throw C.errors[0];return this._queryEngine=new p({fieldsIndex:this._fieldsIndex,geometryType:i,hasM:!1,hasZ:!1,objectIdField:d,spatialReference:_,timeInfo:null,featureStore:new h({geometryType:i,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(C.features),{warnings:E(C),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){await this._waitSnapshotComplete();return(await this._queryEngine.executeQueryForIds(e,t.signal)).filter(C)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),l(this._queryEngine,e,t.signal)}async queryAttributeBins(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeAttributeBinsQuery(e,t.signal)}async refresh(t){return this._customParameters=t.customParameters,this._maxRecordCount=t.maxRecordCount,this._maxTotalRecordCount=t.maxTotalRecordCount,this._maxPageCount=t.maxPageCount,this._snapshotTask?.abort(),this._snapshotTask=e((e=>this._snapshotFeatures({signal:e}))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const t of E(e))r.getLogger(F).warn(new o(\"wfs-layer:refresh-warning\",t.message,t.details));e.errors?.length&&r.getLogger(F).warn(new o(\"wfs-layer:refresh-error\",\"Refresh completed with errors\",{errors:e.errors}))}),(()=>{this._queryEngine.featureStore.clear()})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=e?.signal,r=this._maxTotalRecordCount,o=this._maxPageCount,n=this._supportsPagination?await _(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let i=[];const u=[];if(null==n)try{i=await this._singleQuery(t)}catch(l){s(l)||u.push(l)}else{const e=Math.min(n,r),a=T(this,Math.max(1,Math.min(Math.ceil(e/this._maxRecordCount),o)),t);await Promise.allSettled(Array.from({length:10}).map((()=>j(a,i,u))))}return a(t),{features:i,totalRecordCount:n,maxTotalRecordCount:r,maxPageCount:o,errors:u}}async _singleQuery(e){const t=await x(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:e});return this._processGeoJSON(t,{signal:e})}async _pageQuery(e,t){const r=e*this._maxRecordCount,a=await x(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:r,count:this._maxRecordCount,signal:t});return this._processGeoJSON(a,{startIndex:r,signal:t})}_processGeoJSON(e,t){g(e,this._getFeatureSpatialReference.wkid);const{startIndex:r,signal:s}=t;a(s);const o=d(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!n(this._spatialReference,this._getFeatureSpatialReference))for(const a of o)null!=a.geometry&&(a.geometry=i(m(u(a.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let l=r??1;for(const a of o){const e={};f(this._fieldsIndex,e,a.attributes,!0),a.attributes=e,null==e[this._objectIdField]&&(a.objectId=e[this._objectIdField]=l++)}return o}}function*T(e,t,r){for(let a=0;a<t;a++)yield e._pageQuery(a,r)}async function j(e,t,r){let a=e.next();for(;!a.done;){try{const e=await a.value;t.push(...e)}catch(o){s(o)||r.push(o)}a=e.next()}}function E(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:\"wfs-layer:maxRecordCount-too-low\",message:`Could only fetch ${e.features.length} of ${e.totalRecordCount} in ${e.maxPageCount} queries. Try increasing the value of WFSLayer.maxRecordCount.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:\"wfs-layer:large-dataset\",message:`The number of ${e.totalRecordCount} features exceeds the maximum allowed of ${e.maxTotalRecordCount}.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}export{S as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{parseDate as t}from\"../../../../core/date.js\";import{isValid as e}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{validateFieldValue as n,validationErrorToString as r,isNumericField as o,isStringField as i,isDateField as s,sanitizeNullFieldValue as l}from\"../../../support/fieldUtils.js\";class u{constructor(){this.code=null,this.description=null}}class a{constructor(t){this.error=new u,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=t}}function p(t){return new a(t)}class c{constructor(t){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=t}}function f(t){return new c(t)}const d=new Set;function g(t,e,o,i=!1){d.clear();for(const s in o){const l=t.get(s);if(!l)continue;const u=m(l,o[s]);if(d.add(l.name),l&&(i||l.editable)){const t=n(l,u);if(t)return p(r(t,l,u));e[l.name]=u}}for(const n of t.requiredFields??[])if(!d.has(n.name))return p(`missing required field \"${n.name}\"`);return null}function m(e,n){let r=n;return o(e)&&\"string\"==typeof n?r=parseFloat(n):i(e)&&null!=n&&\"string\"!=typeof n?r=String(n):s(e)&&\"string\"==typeof n&&(r=t(n)),l(r)}let y;function h(t,n){if(!t||!e(n))return t;if(\"rings\"in t||\"paths\"in t){if(null==y)throw new TypeError(\"geometry engine not loaded\");return y.simplify(n,t)}return t}async function I(){return null==y&&(y=await import(\"../../../../geometry/geometryEngineJSON.js\")),y}async function E(t,n){!e(t)||\"esriGeometryPolygon\"!==n&&\"esriGeometryPolyline\"!==n||await I()}const S={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:[\"COUNT\",\"SUM\",\"AVG\",\"VAR\",\"STDDEV\",\"MIN\",\"MAX\",\"PERCENTILE_CONT\",\"PERCENTILE_DISC\",\"CentroidAggregate\",\"EnvelopeAggregate\",\"ConvexHullAggregate\"],supportedNormalizationTypes:[\"field\",\"log\",\"naturalLog\",\"percentOfTotal\",\"squareRoot\"]};export{p as createFeatureEditErrorResult,f as createFeatureEditSuccessResult,E as loadGeometryEngineForSimplify,g as mixAttributes,S as queryBinsCapabilities,h as simplify};\n"],"names":["F","S","constructor","this","_customParameters","_queryEngine","_supportsPagination","destroy","load","e","r","arguments","length","undefined","getFeatureUrl","s","getFeatureOutputFormat","o","fields","n","geometryType","i","featureType","u","maxRecordCount","l","maxTotalRecordCount","m","maxPageCount","g","objectIdField","d","customParameters","f","spatialReference","_","getFeatureSpatialReference","x","y","c","t","inSpatialReference","outSpatialReference","a","_featureType","_fieldsIndex","w","fromLayerJSON","dateFieldsTimeReference","some","type","timeZoneIANA","R","_geometryType","_getFeatureUrl","_getFeatureOutputFormat","_getFeatureSpatialReference","_maxRecordCount","_maxTotalRecordCount","_maxPageCount","_objectIdField","_spatialReference","C","_snapshotFeatures","errors","p","fieldsIndex","hasM","hasZ","timeInfo","featureStore","h","addMany","features","warnings","E","extent","fetchRecomputedExtents","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","signal","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","filter","queryExtent","executeQueryForExtent","querySnapping","queryAttributeBins","executeAttributeBinsQuery","refresh","_snapshotTask","abort","promise","then","clear","getLogger","warn","message","details","finished","typeName","_singleQuery","push","Math","min","_pageQuery","T","max","ceil","Promise","allSettled","Array","from","map","async","next","done","value","j","totalRecordCount","_processGeoJSON","startIndex","count","wkid","geometry","attributes","objectId","name","recordCount","code","description","error","globalId","success","uniqueId","Set","get","add","editable","requiredFields","has","parseFloat","String","TypeError","simplify","I","supportsAutoIntervalBin","supportsFixedIntervalBin","supportsFixedBoundariesBin","supportsDateBin","supportsStackBy","supportsSplitBy","supportsNormalization","supportedStatisticTypes","supportedNormalizationTypes"],"sourceRoot":""}